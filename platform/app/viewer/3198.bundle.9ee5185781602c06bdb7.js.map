{"version":3,"file":"3198.bundle.9ee5185781602c06bdb7.js","mappings":"yIAEMA,E,4CAAKC,GCDLC,EAAsBF,IAAU,CACpCG,KAAM,iBACNH,KACAI,QAAQ,EACRC,QAAQ,IAGJC,EAAiB,CACrBH,KAAM,aACNH,GAAI,YACJI,QAAQ,EACRC,QAAQ,EACRE,QAAS,CACPC,cAAe,CAAC,aAIdC,EAA6C,CACjDC,gBAAiB,CACfC,WAAY,UACZC,aAAc,SACdC,YAAa,QACbC,YAAa,cACbC,oBAAqB,CAEnBC,OAAQ,SAEVC,WAAY,CACVf,EAAmB,aACnB,CACEC,KAAM,MACNH,GAAI,WACJI,QAAQ,EACRC,QAAQ,EACRE,QAAS,CACPW,cAAc,IAGlBZ,IAGJa,YAAa,CACX,CACEnB,GAAI,kBAKJoB,EAAgD,CACpDV,gBAAiB,CACfC,WAAY,aACZC,aAAc,SACdC,YAAa,WACbC,YAAa,cACbG,WAAY,CACVf,EAAmB,gBACnB,CACEC,KAAM,MACNH,GAAI,WACJI,QAAQ,EACRC,QAAQ,EACRE,QAAS,CACPW,cAAc,IAGlBZ,IAGJa,YAAa,CACX,CACEnB,GAAI,kBAKJqB,EAA+C,CACnDX,gBAAiB,CACfC,WAAY,YACZC,aAAc,SACdC,YAAa,UACbC,YAAa,cACbG,WAAY,CACVf,EAAmB,eACnB,CACEC,KAAM,MACNH,GAAI,WACJI,QAAQ,EACRC,QAAQ,EACRE,QAAS,CACPW,cAAc,IAGlBZ,IAGJa,YAAa,CACX,CACEnB,GAAI,kBAKJsB,EAA6C,CACjDZ,gBAAiB,CACfC,WAAY,UACZC,aAAc,SACdW,WAAY,CAAC,EAAG,EAAG,GACnBV,YAAa,QACbC,YAAa,cACbC,oBAAqB,CAEnBC,OAAQ,SAEVC,WAAY,CACVf,EAAmB,aACnB,CACEC,KAAM,MACNH,GAAI,WACJI,QAAQ,EACRC,QAAQ,EACRE,QAAS,CACPW,cAAc,IAGlB,CACEf,KAAM,MACNH,GAAI,iBACJI,QAAQ,EACRC,QAAQ,EACRE,QAAS,CACPW,cAAc,EACdM,iBAAiB,IAGrBlB,IAGJa,YAAa,CACX,CACEZ,QAAS,CACPkB,IAAK,CACHC,OAAQ,iBAEVC,aAAa,GAEf3B,GAAI,kBAKJ4B,EAAgD,CACpDlB,gBAAiB,CACfC,WAAY,aACZC,aAAc,SACdC,YAAa,WACbU,WAAY,CAAC,EAAG,EAAG,GACnBT,YAAa,cACbG,WAAY,CACVf,EAAmB,gBACnB,CACEC,KAAM,MACNH,GAAI,WACJI,QAAQ,EACRC,QAAQ,EACRE,QAAS,CACPW,cAAc,IAGlB,CACEf,KAAM,MACNH,GAAI,iBACJI,QAAQ,EACRC,QAAQ,EACRE,QAAS,CACPW,cAAc,EACdM,iBAAiB,IAGrBlB,IAGJa,YAAa,CACX,CACEZ,QAAS,CACPkB,IAAK,CACHC,OAAQ,iBAEVC,aAAa,GAEf3B,GAAI,kBAKJ6B,EAA+C,CACnDnB,gBAAiB,CACfC,WAAY,YACZC,aAAc,SACdC,YAAa,UACbU,WAAY,CAAC,EAAG,EAAG,GACnBT,YAAa,cACbG,WAAY,CACVf,EAAmB,eACnB,CACEC,KAAM,MACNH,GAAI,WACJI,QAAQ,EACRC,QAAQ,EACRE,QAAS,CACPW,cAAc,IAGlB,CACEf,KAAM,MACNH,GAAI,iBACJI,QAAQ,EACRC,QAAQ,EACRE,QAAS,CACPW,cAAc,EACdM,iBAAiB,IAGrBlB,IAGJa,YAAa,CACX,CACEZ,QAAS,CACPkB,IAAK,CACHC,OAAQ,iBAEVC,aAAa,GAEf3B,GAAI,kBAKJ8B,EAAiD,CACrDpB,gBAAiB,CACfC,WAAY,cACZC,aAAc,SACdC,YAAa,QACbC,YAAa,kBACbC,oBAAqB,CAEnBC,OAAQ,SAEVC,WAAY,CACVf,EAAmB,aACnB,CACEC,KAAM,MACNH,GAAI,WACJI,QAAQ,EACRC,QAAQ,GAEV,CACEF,KAAM,MACNH,GAAI,eACJI,QAAQ,EACRC,QAAQ,EACRE,QAAS,CACPW,cAAc,IAGlB,CACEf,KAAM,MACNH,GAAI,iBACJI,QAAQ,EACRC,QAAQ,EACRE,QAAS,CACPW,cAAc,EACdM,iBAAiB,IAGrBlB,IAGJa,YAAa,CACX,CACEnB,GAAI,gBAEN,CACEA,GAAI,eACJO,QAAS,CACPwB,SAAU,CACRC,KAAM,MACNC,QAAS,CACP,CAAEC,MAAO,EAAGD,QAAS,GACrB,CAAEC,MAAO,GAAKD,QAAS,IACvB,CAAEC,MAAO,EAAGD,QAAS,MAGzBR,IAAK,CACHC,OAAQ,qBAOZS,EAAiB,CACrBzB,gBAAiB,CACfC,WAAY,iBACZC,aAAc,SACdC,YAAa,WACbC,YAAa,kBAKbG,WAAY,CACVf,EAAmB,gBACnB,CACEC,KAAM,MACNH,GAAI,WACJI,QAAQ,EACRC,QAAQ,GAEV,CACEF,KAAM,MACNH,GAAI,eACJI,QAAQ,EACRC,QAAQ,EACRE,QAAS,CACPW,cAAc,IAGlB,CACEf,KAAM,MACNH,GAAI,iBACJI,QAAQ,EACRC,QAAQ,EACRE,QAAS,CACPW,cAAc,EACdM,iBAAiB,IAGrBlB,IAGJa,YAAa,CACX,CACEnB,GAAI,gBAEN,CACEA,GAAI,eACJO,QAAS,CACPwB,SAAU,CACRC,KAAM,MACNC,QAAS,CACP,CAAEC,MAAO,EAAGD,QAAS,GACrB,CAAEC,MAAO,GAAKD,QAAS,IACvB,CAAEC,MAAO,EAAGD,QAAS,MAGzBR,IAAK,CACHC,OAAQ,qBAOZU,EAAgB,CACpB1B,gBAAiB,CACfC,WAAY,gBACZC,aAAc,SACdC,YAAa,UACbC,YAAa,kBAKbG,WAAY,CACVf,EAAmB,eACnB,CACEC,KAAM,MACNH,GAAI,WACJI,QAAQ,EACRC,QAAQ,GAEV,CACEF,KAAM,MACNH,GAAI,eACJI,QAAQ,EACRC,QAAQ,EACRE,QAAS,CACPW,cAAc,IAGlB,CACEf,KAAM,MACNH,GAAI,iBACJI,QAAQ,EACRC,QAAQ,EACRE,QAAS,CACPW,cAAc,EACdM,iBAAiB,IAGrBlB,IAGJa,YAAa,CACX,CACEnB,GAAI,gBAEN,CACEA,GAAI,eACJO,QAAS,CACPwB,SAAU,CACRC,KAAM,MACNC,QAAS,CACP,CAAEC,MAAO,EAAGD,QAAS,GACrB,CAAEC,MAAO,GAAKD,QAAS,IACvB,CAAEC,MAAO,EAAGD,QAAS,MAGzBR,IAAK,CACHC,OAAQ,qBAOZW,EAAiD,CACrD3B,gBAAiB,CACfC,WAAY,cACZC,aAAc,SACdC,YAAa,WACbU,WAAY,CAAC,EAAG,EAAG,GACnBT,YAAa,eACbG,WAAY,CACV,CACEd,KAAM,MACNH,GAAI,WACJI,QAAQ,EACRC,QAAQ,EACRE,QAAS,CACPW,cAAc,IAGlB,CACEf,KAAM,MACNH,GAAI,iBACJI,QAAQ,EACRC,QAAQ,EACRE,QAAS,CACPW,cAAc,EACdM,iBAAiB,IAGrBlB,GAKFgC,oBAAqB,CAInBC,cAAc,IAGlBpB,YAAa,CACX,CACEZ,QAAS,CACPiC,UAAW,MACXC,cAAe,aACfhB,IAAK,CACHC,OAAQ,iBAEVC,aAAa,GAEf3B,GAAI,kBCjPJ0C,EAA0C,CAC9C1C,GAAI,kDACJ2C,QAAQ,EACRX,KAAM,UACNY,YAAa,2BACbC,aAAc,2BACdC,YAAa,CAAC,EACdC,WAAY,CAAC,EACbC,kBAAmB,wBACnBC,sBAAuB,CACrB,CACEC,UAAW,oBACXC,WAAY,CACVC,SAAU,CAAC,KAAM,QAGrB,CACEF,UAAW,mBACXC,WAAY,CACVC,SAAU,UAGd,CACEF,UAAW,mBACXC,WAAY,CACVC,SAAU,YAIhBC,oBAAqB,CACnBC,aAAc,CACZC,oBAAqB,CACnB,CACEL,UAAW,WACXC,WAAY,CACVK,OAAQ,CACNtB,MAAO,OAGXuB,UAAU,GAEZ,CACEP,UAAW,oBACXC,WAAY,CACVK,OAAQ,CACNtB,OAAO,IAGXuB,UAAU,GAEZ,CACEP,UAAW,oBACXC,WAAY,CACVC,SAAU,OAGd,CACEF,UAAW,oBACXC,WAAY,CACVC,SAAU,YAKlBM,aAAc,CACZH,oBAAqB,CACnB,CACEL,UAAW,WACXC,WAAY,CACVK,OAAQ,MAEVC,UAAU,GAEZ,CACEP,UAAW,oBACXC,WAAY,CACVK,OAAQ,CACNtB,OAAO,IAGXuB,UAAU,GAEZ,CACEP,UAAW,oBACXC,WAAY,CACVC,SAAU,cAGd,CACEO,OAAQ,EACRT,UAAW,oBACXC,WAAY,CACVS,eAAgB,CACd1B,MAAO,oBAOnB2B,OAAQ,CA5T6C,CACrD7B,KAAM,UACNhC,GAAI,UACJ8D,kBAAmB,CACjBC,WAAY,OACZC,WAAY,CACVC,KAAM,EACNC,QAAS,EACTC,cAAe,CACb,CACEC,EAAG,EACHC,EAAG,EACHC,MAAO,EAAI,EACXC,OAAQ,EAAI,GAEd,CACEH,EAAG,EAAI,EACPC,EAAG,EACHC,MAAO,EAAI,EACXC,OAAQ,EAAI,GAEd,CACEH,EAAG,GACHC,EAAG,EACHC,MAAO,EAAI,EACXC,OAAQ,EAAI,GAEd,CACEH,EAAG,EACHC,EAAG,EAAI,EACPC,MAAO,EAAI,EACXC,OAAQ,EAAI,GAEd,CACEH,EAAG,EAAI,EACPC,EAAG,EAAI,EACPC,MAAO,EAAI,EACXC,OAAQ,EAAI,GAEd,CACEH,EAAG,GACHC,EAAG,EAAI,EACPC,MAAO,EAAI,EACXC,OAAQ,EAAI,GAEd,CACEH,EAAG,EACHC,EAAG,EAAI,EACPC,MAAO,EAAI,EACXC,OAAQ,EAAI,GAEd,CACEH,EAAG,EAAI,EACPC,EAAG,EAAI,EACPC,MAAO,EAAI,EACXC,OAAQ,EAAI,GAEd,CACEH,EAAG,GACHC,EAAG,EAAI,EACPC,MAAO,EAAI,EACXC,OAAQ,EAAI,GAEd,CACEH,EAAG,EAAI,EACPC,EAAG,EACHC,MAAO,EAAI,EACXC,OAAQ,MAKhBC,UAAW,CACT/D,EACAW,EACAC,EACAC,EACAM,EACAC,EACAC,EACAK,EACAC,EACAC,GAEFO,YAAa,4BASA,CACbZ,KAAM,aACNhC,GAAI,aACJ8D,kBAAmB,CACjBC,WAAY,OACZC,WAAY,CACVC,KAAM,EACNC,QAAS,IAGbM,UAAW,CAAC/D,EAASqB,EAAaR,EAASe,IAUU,CACrDL,KAAM,aACNhC,GAAI,aACJ8D,kBAAmB,CACjBC,WAAY,OACZC,WAAY,CACVC,KAAM,EACNC,QAAS,IAGbM,UAAW,CAAC/D,EAASW,EAAYC,EAAWC,EAASM,EAAYC,IAYZ,CACrDG,KAAM,aACNhC,GAAI,aACJ8D,kBAAmB,CACjBC,WAAY,OACZC,WAAY,CACVC,KAAM,EACNC,QAAS,EACTC,cAAe,CACb,CACEC,EAAG,EACHC,EAAG,EACHC,MAAO,EAAI,EACXC,OAAQ,IAEV,CACEH,EAAG,EAAI,EACPC,EAAG,EACHC,MAAO,EAAI,EACXC,OAAQ,IAEV,CACEH,EAAG,GACHC,EAAG,EACHC,MAAO,EAAI,EACXC,OAAQ,IAEV,CACEH,EAAG,EAAI,EACPC,EAAG,EACHC,MAAO,EAAI,EACXC,OAAQ,GAEV,CACEH,EAAG,EACHC,EAAG,GACHC,MAAO,EAAI,EACXC,OAAQ,IAEV,CACEH,EAAG,EAAI,EACPC,EAAG,GACHC,MAAO,EAAI,EACXC,OAAQ,IAEV,CACEH,EAAG,GACHC,EAAG,GACHC,MAAO,EAAI,EACXC,OAAQ,OAKhBC,UAAW,CACT3C,EACAD,EACAN,EACAe,EACAD,EACAD,EACAL,KAyHF2C,0BAA2B,GAY7B,QATA,WACE,MAAO,CACL,CACEzC,KAAMU,EAAK1C,GACX0E,SAAUhC,GAGhB,E,oECpVA,MAAMiC,EAAoB,CACxBC,cAAe,KACfC,WAAY,KACZC,WAAY,KACZC,uCAAwC,CACtCC,sBAAuB,KACvBC,qBAAsB,KACtBC,6BAA8B,OAWnB,SAASC,GAAY,gBAAEC,EAAe,gBAAEC,IACrD,MAAM,EAAEC,IAAMC,EAAAA,EAAAA,IAAe,aACvB,kBAAEC,EAAiB,iBAAEC,EAAgB,eAAEC,EAAc,uBAAEC,GAC3DP,EAAgBQ,UACXC,EAAUC,IAAeC,EAAAA,EAAAA,UAASpB,IAClCjB,EAAcsC,IAAmBD,EAAAA,EAAAA,UAAS,MAE3CE,EAAuBJ,IAC3BC,GAAYI,IACV,MAAMC,EAAW,IAAKD,GAWtB,OAVAE,OAAOC,KAAKR,GAAUS,SAAQC,IACC,iBAAlBV,EAASU,GAClBJ,EAASI,GAAO,IACXL,EAAUK,MACVV,EAASU,IAGdJ,EAASI,GAAOV,EAASU,EAC3B,IAEKJ,CAAQ,GACf,EAGEK,EAA0BC,IAC9B,MAAM/C,EAAe2B,EAAgBqB,WAAW,0BAA2B,CACzED,yBAGF,IAAK/C,EACH,OAOF,MAAO,CACLA,eACAmC,SANeR,EAAgBqB,WAAW,gBAAiB,CAC3DhD,iBAMD,EA8DH,OA3DAiD,EAAAA,EAAAA,YAAU,KACR,MAAMxF,EAAcqE,EAAkBoB,wBAChC,qBAAEH,GAAyBd,EAAuBkB,kBACxD,IAAK1F,EAAY2F,OACf,OAGF,MAAMC,EAAiBP,EAAwBC,GAE/C,IAAKM,EACH,OAGF,MAAM,aAAErD,EAAY,SAAEmC,GAAakB,EACnCf,EAAgBtC,GAChBoC,EAAYD,EAAS,GACpB,KAGHc,EAAAA,EAAAA,YAAU,KACR,MAAM,YAAEK,GAAgBrB,EAAuBsB,UAC7CtB,EAAuBuB,OAAOC,kBAC9B,EAAGV,2BACD,MAAMM,EAAiBP,EAAwBC,GAE/C,IAAKM,EACH,OAEF,MAAM,aAAErD,EAAY,SAAEmC,GAAakB,EACnCf,EAAgBtC,GAChBoC,EAAYD,EAAS,IAGzB,MAAO,KACLmB,GAAa,CACd,GACA,IAwBDI,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAAA,OAAKC,UAAU,4FACbD,EAAAA,cAAA,OAAKC,UAAU,gEACbD,EAAAA,cAACE,EAAAA,GAAY,CAACC,MAAOjC,EAAE,wBACrB8B,EAAAA,cAAA,OAAKC,UAAU,iBACbD,EAAAA,cAAA,OAAKC,UAAU,2CACbD,EAAAA,cAACI,EAAAA,GAAK,CACJC,mBAAoB,0CACpBC,MAAOpC,EAAE,eACTqC,eAAe,oCACfN,UAAU,4BACVnF,MAAO2D,EAAShB,YAAc,GAC9B+C,SAAUC,IACR5B,EAAqB,CACnBpB,WAAYgD,EAAExH,OAAO6B,OACrB,IAGNkF,EAAAA,cAACI,EAAAA,GAAK,CACJC,mBAAoB,0CACpBC,MAAOpC,EAAE,UACTwC,cAAeV,EAAAA,cAAA,QAAMC,UAAU,kBAAiB,OAChDM,eAAe,oCACfN,UAAU,4BACVnF,MAAO2D,EAASjB,eAAiB,GACjCgD,SAAUC,IACR5B,EAAqB,CACnBrB,cAAeiD,EAAExH,OAAO6B,OACxB,EAEJlC,GAAG,iBAELoH,EAAAA,cAACI,EAAAA,GAAK,CACJC,mBAAoB,0CACpBC,MAAOpC,EAAE,cACTwC,cAAeV,EAAAA,cAAA,QAAMC,UAAU,kBAAiB,OAChDM,eAAe,oCACfN,UAAU,4BACVnF,MACE2D,EAASd,uCAAuCC,uBAAyB,GAE3E4C,SAAUC,IACR5B,EAAqB,CACnBlB,uCAAwC,CACtCC,sBAAuB6C,EAAExH,OAAO6B,QAElC,IAGNkF,EAAAA,cAACI,EAAAA,GAAK,CACJC,mBAAoB,0CACpBC,MAAOpC,EAAE,aACTwC,cAAeV,EAAAA,cAAA,QAAMC,UAAU,kBAAiB,MAChDM,eAAe,oCACfN,UAAU,4BACVnF,MAAO2D,EAASd,uCAAuCE,sBAAwB,GAC/E2C,SAAUC,IACR5B,EAAqB,CACnBlB,uCAAwC,CACtCE,qBAAsB4C,EAAExH,OAAO6B,QAEjC,IAGNkF,EAAAA,cAACI,EAAAA,GAAK,CACJC,mBAAoB,0CACpBC,MAAOpC,EAAE,kBACTwC,cAAeV,EAAAA,cAAA,QAAMC,UAAU,kBAAiB,MAChDM,eAAe,oCACfN,UAAU,4BACVnF,MACE2D,EAASd,uCAAuCG,8BAChD,GAEF0C,SAAUC,IACR5B,EAAqB,CACnBlB,uCAAwC,CACtCG,6BAA8B2C,EAAExH,OAAO6B,QAEzC,IAGNkF,EAAAA,cAACI,EAAAA,GAAK,CACJC,mBAAoB,0CACpBC,MAAOpC,EAAE,oBACTwC,cAAeV,EAAAA,cAAA,QAAMC,UAAU,kBAAiB,MAChDM,eAAe,oCACfN,UAAU,4BACVnF,MAAO2D,EAASf,YAAc,GAC9B8C,SAAUA,SAEZR,EAAAA,cAACW,EAAAA,GAAM,CACLV,UAAU,qCACVW,QAnHhB,WACE,IAAKtE,EACH,MAAM,IAAIuE,MAAM,yBAIlBC,EAAAA,GAAmBC,wBACjBzE,EAAa0E,iBACb1E,EAAa2E,kBACbxC,GAIFL,EAAkB8C,iCAAiC5E,EAAa6E,uBAIhEC,YAAW,KACTnD,EAAgBqB,WAAW,kBAAkB,GAC5C,EACL,GAgGe,oBAUjB,CAEAvB,EAAYsD,UAAY,CACtBrD,gBAAiBsD,IAAAA,MAAgB,CAC/B9C,SAAU8C,IAAAA,MAAgB,CACxBC,mBAAoBD,IAAAA,MAAgB,CAClCE,gBAAiBF,IAAAA,KAAeG,WAChC5B,UAAWyB,IAAAA,KAAeG,WAC1B3B,OAAQwB,IAAAA,OAAiBG,WACzBC,YAAaJ,IAAAA,OAAiBG,aAC7BA,aACFA,aACFA,Y,0BCjPE,MAAME,EAAwBC,OACnCC,iBACA5D,kBACA6D,0BAIA,MAAMC,EAAeD,EAAoBE,gBAAgBH,IAEzDI,EAAAA,EAAAA,cAAaC,EAAAA,YAAaC,EAAAA,MAAAA,OAAaC,oBAAqB,CAC1DC,SAAU,EACVtJ,KAAM,yBACNH,GAAIiJ,IAIN,MAAMS,EAA+B,CAAC,EACtC,IAAK,MAAOC,EAAcC,KAAYxD,OAAOyD,QAAQV,EAAaW,UAAW,CAC3E,IAAKF,EACH,SAGF,MAAMG,EAAsBC,OAAOL,GAE7BM,QAAoB5E,EAAgB6E,IAAI,iBAAkB,CAC9DjB,iBACAU,aAAcI,IAWVI,EAAc,CAClBF,cACAG,cAVoB/E,EAAgB6E,IAAI,mBAAoB,CAC5DjB,iBACAU,aAAcI,IASdM,sBAN4BJ,EAAYK,OAASL,EAAYM,WASzDC,EAA0B,IAC3BZ,EACHO,YAAa,IACRP,EAAQO,eACRA,IAIPT,EAA6BK,GAAuBI,EAEpDhB,EAAaW,SAASH,GAAgBa,CACxC,CAGA,MAAMC,EAAgBvB,EAAoBwB,mBACpCC,QAAatF,EAAgB6E,IAAI,gBAAiB,CAAEO,mBAE1DpB,EAAAA,EAAAA,cAAaC,EAAAA,YAAaC,EAAAA,MAAAA,OAAaC,oBAAqB,CAC1DC,SAAU,IACVtJ,KAAM,yBACNH,GAAIiJ,IAMNwB,EAAcnE,SAAQ6C,IACpBA,EAAagB,YAAc,IACtBhB,EAAagB,YAChBQ,QAIFvE,OAAOC,KAAK8C,EAAaW,UAAUxD,SAAQqD,IACzCR,EAAaW,SAASH,GAAcQ,YAAc,IAC7ChB,EAAaW,SAASH,GAAcQ,YACvCQ,OACD,IAIH,MAAMC,EAAoC,IACrCzB,EACHW,SAAU,IACLX,EAAaW,WAIpBZ,EAAoB2B,wBAAwBD,EAAoB,GAChE,E,eC7FJ,QCGe,UAAuC,gBACpDxF,EAAe,gBACfC,IAEA,MAAM,oBAAE6D,GAAwB9D,EAAgBQ,UACxCkF,iCAAkCC,IACxCC,EAAAA,EAAAA,8CAA6C,CAAE5F,qBAEjDuB,EAAAA,EAAAA,YAAU,KACR,MAAMsE,EAAkBF,EAAkBG,KACxCC,GAAoBA,EAAiBhC,aAAaF,iBAGjCD,WACjB,IAAK,MAAMC,KAAkBgC,QACrBlC,EAAsB,CAC1BE,iBACA5D,kBACA6D,uBAEJ,EAGFkC,EAAY,GACX,KAEHzE,EAAAA,EAAAA,YAAU,KACR,MAAM0E,GAAiCC,EAAAA,EAAAA,KAAStC,UAC9C,MAAM,eAAEC,GAAmBsC,QACrBxC,EAAsB,CAC1BE,iBACA5D,kBACA6D,uBACA,GACD,KAMGsC,EAA2BtC,EAAoBjC,UACnDiC,EAAoBhC,OAAOuE,4BALAF,IAC3BF,EAA+BE,EAAY,IAQ7C,MAAO,KACLC,EAAyBxE,aAAa,CACvC,GACA,CAAC3B,EAAiB6D,IAGrB,MAAMwC,EAAmBX,EAAkBY,MACzCC,QAAgDC,IAAxCD,EAAKzC,aAAagB,aAAaQ,OAEnCmB,EAAYJ,GAAkBvC,aAAagB,aAAaQ,KAE9D,OACEvD,EAAAA,cAAA,OAAKC,UAAU,4BACbD,EAAAA,cAAA,OAAKC,UAAU,yDACZyE,QACC1E,EAAAA,cAAA,OAAKC,UAAU,mEACbD,EAAAA,cAAA,QAAMC,UAAU,4DACb,SAEHD,EAAAA,cAAA,OAAKC,UAAU,cAAc,GAAGyE,EAAUC,QAAQ,UAElD,MAIZ,E,eCpEe,SAASC,GAAU,gBAChC5G,EAAe,gBACfC,EAAe,iBACf4G,EAAgB,cAChBC,IAEA,OACE9E,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAAC+E,EAAAA,kBAAiB,CAChB/G,gBAAiBA,EACjBC,gBAAiBA,EACjB4G,iBAAkBA,EAClBC,cAAeA,GAEf9E,EAAAA,cAACgF,EAAS,CACRhH,gBAAiBA,EACjBC,gBAAiBA,KAK3B,CAEA,MAAM+G,EAAYA,EAAGhH,kBAAiBC,sBACpC,MAAQyF,iCAAkCuB,IACxCrB,EAAAA,EAAAA,8CAA6C,CAAE5F,oBAE3CuF,EAAO0B,EAAgB,IAAIlD,aAAagB,aAAaQ,KAErDF,EAAgB4B,EAAgBnB,KAAIoB,GAAkBA,EAAenD,eAE3E,OAAKsB,EAAc3D,OAKjBM,EAAAA,cAAA,OAAKC,UAAU,+CACbD,EAAAA,cAACW,EAAAA,GAAM,CACLwE,KAAK,KACLC,QAAQ,QACRnF,UAAU,SACVW,QAASA,KACP3C,EAAgBqB,WAAW,sBAAuB,CAChD+D,gBACAE,OACA8B,OAAQ,CAAC,GACT,GAGJrF,EAAAA,cAACsF,EAAAA,GAAMC,SAAQ,MACfvF,EAAAA,cAAA,QAAMC,UAAU,QAAO,SAlBpB,IAoBD,EC+BV,QArFA,UAAwB,gBAAEhC,EAAe,iBAAE4G,EAAgB,gBAAE7G,IAsD3D,MAAO,CACL,CACEpD,KAAM,SACN4K,SAAU,mBACVC,UAAW,eACXnF,MAAO,eACPoF,UA3DuBC,IAEvB3F,EAAAA,cAACjC,EAAW,CACVE,gBAAiBA,EACjBD,gBAAiBA,EACjB6G,iBAAkBA,KAwDtB,CACEjK,KAAM,OACN4K,SAAU,mBACVC,UAAW,eACXC,UAlCqBE,IAErB5F,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAAC6F,EAAAA,GAAO,CACN5H,gBAAiBA,EACjBD,gBAAiBA,EACjB6G,iBAAkBA,EAClBiB,gBAAgB,sBAChB3F,MAAM,oBAERH,EAAAA,cAAC4E,EAAS,CACR3G,gBAAiBA,EACjBD,gBAAiBA,IAEnBgC,EAAAA,cAAC+F,EAAuB,CACtB9H,gBAAiBA,EACjBD,gBAAiBA,MAoBvB,CACEpD,KAAM,UACN4K,SAAU,mBACVC,UAAW,eACXnF,MAAO,uBACPoF,UA9D+BM,IAE/BhG,EAAAA,cAAC6F,EAAAA,GAAO,CACN5H,gBAAiBA,EACjBD,gBAAiBA,EACjB6G,iBAAkBA,EAClBiB,gBAAgB,sBAChB3F,MAAM,qBAyDV,CACEvF,KAAM,aACN4K,SAAU,mBACVC,UAAW,eACXnF,MAAO,sBACPoF,UAzD8BO,IAE9BjG,EAAAA,cAAC+F,EAAuB,CACtB9H,gBAAiBA,EACjBD,gBAAiBA,KAwDzB,E,eCxFA,SAAgB,iCC8DhB,EA3DsC,CACpCkI,aAAcA,CAACC,EAAaC,KAAdF,EAQdG,cAAeA,CAACC,EAAoBlI,EAAmBmI,KACrD,MAAM,WAAEC,EAAU,WAAEjN,GAAe+M,GAC7B,SAAE7H,EAAQ,KAAEgI,EAAI,cAAEC,GAAkBF,EAE1C,IAAK/H,IAAagI,EAEhB,OADAE,QAAQC,KAAK,yCACN,KAGT,MAAM,SAAEC,EAAQ,kBAAEC,EAAiB,oBAAEC,GAAwBtI,EAG7D,IAFsBuI,EAAgBC,SAASJ,GAG7C,MAAM,IAAIhG,MAAM,sBAGlB,MAAM,eAAEqG,EAAc,kBAAEjG,EAAiB,iBAAED,IAAqBmG,EAAAA,EAAAA,0BAC9DL,EACAP,EACAhN,GAGF,IAAI6N,EAWJ,OAREA,EADEF,EACW9I,EAAkBiJ,+BAC7BH,EACAjG,GAGW7C,EAAkBkJ,wBAAwBrG,GAGlD,CACLsG,IAAKb,EACLQ,iBACAH,sBAEAtI,WACA+I,mBAAoBvG,EACpBwG,kBAAmBzG,EACnB6F,SAAUpI,EAASoI,SACnB1F,sBAAuBiG,EAAWjG,sBAClCb,MAAO7B,EAAS6B,MAChBmG,KAAMA,EAAK1D,YACXhK,KAAM,gCACP,GCQL,EA/DmC,CACjCmN,aAAcA,CAACC,EAAaC,KAAdF,EAQdG,cAAeA,CAACC,EAAoBlI,EAAmBmI,KACrD,MAAM,WAAEC,EAAU,WAAEjN,GAAe+M,GAC7B,SAAE7H,EAAQ,KAAEgI,EAAI,cAAEC,GAAkBF,EAE1C,IAAK/H,IAAagI,EAEhB,OADAE,QAAQC,KAAK,yCACN,KAGT,MAAM,SAAEC,EAAQ,kBAAEC,EAAiB,oBAAEC,GAAwBtI,EAG7D,IAFsBuI,EAAgBC,SAASJ,GAG7C,MAAM,IAAIhG,MAAM,sBAGlB,MAAM,eAAEqG,EAAc,kBAAEjG,EAAiB,iBAAED,IAAqBmG,EAAAA,EAAAA,0BAC9DL,EACAP,EACAhN,GAGF,IAAI6N,EAGFA,EADEF,EACW9I,EAAkBiJ,+BAC7BH,EACAjG,GAGW7C,EAAkBkJ,wBAAwBrG,GAGzD,MAAM,YAAE8B,GAAgB0D,EAExB,MAAO,CACLc,IAAKb,EACLQ,iBACAH,sBAEAtI,WACA+I,mBAAoBvG,EACpBwG,kBAAmBzG,EACnB6F,SAAUpI,EAASoI,SACnB1F,sBAAuBiG,EAAWjG,sBAClCb,MAAO7B,EAAS6B,MAEhBmG,KAAMA,EAAK1D,YACXhK,KAAM,6BAEP,GCtBL,EArC0C2O,CACxCnG,EACAnD,EACAmI,KAEO,CACLoB,8BAA+B,CAC7BzB,aAAcyB,EAA8BzB,aAC5CG,cAAeuB,GACbD,EAA8BtB,cAC5BuB,EACAxJ,EACAmI,GAEJsB,iBAAkB,CAChB,CACEC,UAAWvG,EAAmBG,YAAYqG,wBAIhDC,2BAA4B,CAC1B9B,aAAc8B,EAA2B9B,aACzCG,cAAeuB,GACbI,EAA2B3B,cACzBuB,EACAxJ,EACAmI,GAEJsB,iBAAkB,CAChB,CACEC,UAAWvG,EAAmBG,YAAYqG,2BCxB9C,iCAAEE,EAAgC,oCAAEC,GAAwCC,EAAAA,MCPlF,SAASC,EAAYC,EAAkBC,GAErC,MAAM,UAAEC,GAAcF,EAChBG,EAASD,EAAUE,eAAeC,aAAaC,WAG/C,GAAEC,EAAE,UAAEC,GAkDd,SAAwBC,GAItB,MAAMD,GAAaE,IACbH,EAAKA,CAACI,EAAQC,KACdD,EAASC,IACXA,EAAWD,GAENC,GAET,MAAO,CAAEL,KAAIC,YACf,CA9D4BK,GAC1B,IAAIpO,EAAQ+N,EAEZ,MAAMM,EAAYC,EAAAA,UAAAA,iBAAAA,qCAChBd,EACAD,KAGMgB,EAAMC,IAAQC,EAAMC,IAAQC,EAAMC,IAASP,EAEnD,IAAK,IAAIQ,EAAIN,EAAMM,GAAKL,EAAMK,IAC5B,IAAK,IAAIC,EAAIL,EAAMK,GAAKJ,EAAMI,IAC5B,IAAK,IAAIC,EAAIJ,EAAMI,GAAKH,EAAMG,IAAK,CAEjC/O,EAAQ8N,EAAGJ,EADID,EAAUuB,mBAAmB,CAACH,EAAGC,EAAGC,KACxB/O,EAC7B,CAGJ,OAAOA,CACT,CA6CA,QA3CA,SACEiP,EACAC,EACA3E,GAEA,GAAwB,UAApBA,EAAO4E,SACT,MAAO,CACLC,QAAStH,OAAOyC,EAAO6E,SACvBC,QAASvH,OAAOyC,EAAO8E,SACvBC,QAASxH,OAAOyC,EAAO+E,SACvBC,QAASzH,OAAOyC,EAAOgF,UAI3B,MAAM,OAAE9N,GAAW8I,EACbiD,EAAcyB,EAAejG,KAAI4C,GACrC0C,EAAAA,WAAAA,MAAAA,cAAuC1C,KAKzC,MAAO,CACL0D,SAAUrB,IACVsB,QAAUtB,IACVmB,QAAS3N,EALK6L,EAAY4B,EAAkB,GAAI1B,GAMhD6B,QAAUpB,IAEd,E,yBCpDA,MAAM,cAAEuB,GAAkBC,EAAAA,GAAAA,KACpBC,EAAmBC,EAAAA,GAAQC,iBCHjC,QDKe,SAAiCpC,GAC9C,MAAMqC,EAAUC,EAAAA,GAAWC,cAAcC,KAAKC,4BAC5CzC,EACAkC,EACA1J,EAAAA,IAEIkK,EAAaV,EAAcK,GAGjC,IAAIM,EAAYC,IAAIC,gBAAgBH,GACpCI,OAAOC,SAASC,OAAOL,EACzB,GENM,4BAAEM,GAAgCpJ,EAAAA,MAElCqI,EAAmBC,EAAAA,GAAQC,iBAC3Bc,EAAgC,CACpC,gCACA,wBACA,8BAGIC,GAAgBC,EAAAA,EAAAA,uBAEhBvS,EAAU,CACdwS,mBAAoB,EACpBC,oBAAqB,CACnBC,SAAS,EACTC,kBAAmB,MAKjBC,GAAWA,IACR,IAAIC,OAAO,IAAId,IAAI,mBAAuD,CAC/EtQ,KAAM,oBAIV,SAASqR,GAA2BpK,GAClC,MACMqK,EADiB9C,EAAAA,aAAAA,MAAAA,gBAA2CvH,GAC9BsK,mBAClCZ,EAA4Ba,WAGxB,SAAEC,EAAQ,mBAAEC,GAAuBJ,EAIzC,MAAO,CAAEK,eAHcC,EAAAA,MAASC,UAAUJ,GAGjBhE,iBAFAmE,EAAAA,MAASC,UAAUH,GAG9C,CAEA,SAASI,GAAkC3K,GACzC,MAAM,mBAAEoK,GAAuBpK,GACzB,SAAEsK,GAAaF,EACnBZ,EAA4Ba,UAG9B,OAAOI,EAAAA,MAASC,UAAUJ,EAC5B,CAEA,MAkoBA,GAloBuBM,EAAG3O,kBAAiBC,kBAAiB4G,uBAC1D,MAAM,oBACJ+H,EAAmB,sBACnBC,EAAqB,kBACrBzO,EAAiB,uBACjBG,EAAsB,iBACtBF,EAAgB,2BAChBkI,EAA0B,oBAC1BzE,GACE9D,EAAgBQ,SAEdsO,EAAgBjI,EAAiBkI,eACrC,qDAGI,kBAAEC,GAAsBF,EAAcG,QAE5C,SAASC,IACP,MAAM,iBAAEC,GAAqBP,EAAoBQ,YAC3C,QAAEC,GAAYL,EAAkBG,IAAqB,CAAC,EAE5D,OADuBX,EAAAA,kBAAqBa,EAE9C,CAEA,SAASC,EAAmCC,GAC1C,OAAOA,EAAUC,QAAO,CAACC,EAAmB5G,KAC1C,MAAMkD,EACJX,EAAAA,WAAAA,UAAAA,iCAA8DvC,GAEhE,OAAO4G,EAAkBC,OAAO3D,EAAe,GAC9C,GACL,CAEA,MAAM4D,EAAU,CACdvO,wBAAyBA,EAAGC,2BAM1B,IAAI/C,EAAe,KACnB,IAAK,MAAO/C,EAAYqU,KAAoBvO,EAAsB,CAChE,MAAM,gBAAEwO,GAAoBD,EACtB7T,EAAc8T,EAAgB/J,KAAI,EAAG3C,2BACzC/C,EAAkB0P,mBAAmB3M,KAGvC,GAAKpH,GAAsC,IAAvBA,EAAY2F,SAIhCpD,EAAevC,EAAYwK,MAAK6C,GAAsC,OAAxBA,EAAW2G,WACrDzR,GACF,KAEJ,CAEA,OAAOA,CAAY,EAErB0R,cAAeA,EAAG1R,mBAChB,MAGM2R,EAHapJ,EAAiBqJ,iBAAiB,GACzBC,yBAAyB7R,GAEvB,GACxB8R,EAAW5D,EAAiB6D,IAAI,WAAYJ,GAClD,GAA0B,OAAtBG,EAASL,SACX,OAoBF,MAjBiB,CACfrQ,WAAY0Q,EAAS1Q,WACrBqQ,SAAUK,EAASL,SACnBtQ,WAAY2Q,EAAS3Q,WACrBD,cAAe4Q,EAAS5Q,cACxBG,uCAAwC,CACtCC,sBACEwQ,EAASzQ,uCAAuC,GAAGC,sBACrDC,qBACEuQ,EAASzQ,uCAAuC,GAAGE,qBACrDC,6BACEsQ,EAASzQ,uCAAuC,GAAGG,6BACrDwQ,iCACEF,EAASzQ,uCAAuC,GAAG2Q,kCAI1C,EAEjBC,wBAAyB3M,OAAStB,YAIhC,MAAM,qBAAEjB,GAAyBd,EAAuBkB,kBAElDnD,EAAeqR,EAAQvO,wBAAwB,CACnDC,yBAGF,IAAImP,EAAmB,KAEvB,IAAK,MAAOjV,GAAY,gBAAEsU,MAAsBxO,EAAqBoD,UAAW,CAM9E,GALaoL,EAAgBY,MAC3B,EAAGtN,2BACDA,IAA0B7E,EAAa6E,wBAGjC,CACRqN,EAAmBjV,EACnB,KACF,CACF,CAEA,IAAK+C,EAEH,YADAuQ,EAAsB6B,MAAM,oCAI9B,MAAMC,EACJ7M,EAAoB8M,+BAA+BJ,GAE/CpH,EAAahJ,EAAkB0P,mBAAmBxR,EAAa6E,uBAE/DU,QAAuBC,EAAoB+M,4BAA4BzH,EAAY,CACvF9G,MAAO,gBAAgBqO,EAAqBjP,OAAS,IACrDgD,SAAU,CAAE,EAAG,CAAEpC,MAAO,YAAawO,QAAQ,MAO/C,OAJAhN,EAAoBiN,8BAA8BP,EAAkB,CAClE3M,mBAGKA,CAAc,EAEvBmN,wCAAyCA,EAAGnN,iBAAgBwD,SAAQ9C,mBAClE,MAAMR,EAAeqH,EAAAA,aAAAA,MAAAA,gBAA2CvH,IAE1D,mBAAEsK,GAAuBpK,GACvBkN,uBAAwBC,GAAiB3Q,EAAuBkB,kBAIlE0P,EAAa,mCADED,EAAab,IAAI,gBACmBlN,yBAEjDkL,SAAU+C,GAAgBjD,EAChCZ,EAA4Ba,WAExB,mBAAEE,GAAuBE,EAAAA,MAASC,UAAU2C,GAE5CrF,EAAiBuD,EAAmC9B,GAE1D,GAA8B,IAA1BzB,EAAerK,OAMjB,YALAmN,EAAsBwC,KAAK,CACzBlP,MAAO,kBACPmP,QAAS,mCACTvW,KAAM,UAKV,MAAMwT,EAAiBC,EAAAA,MAASC,UAAU5K,GAC1C,IAAIwG,EAAmBmE,EAAAA,MAASC,UAAUH,GAC1C,MAAMiD,EAAqB/C,EAAAA,MAASC,UAAU0C,GAI9C,IAAK9G,EACH,MAAM,IAAIxH,MAAM,6BAGlB,IAAK0L,EACH,MAAM,IAAI1L,MAAM,+BAGlB,MAAM2F,EAAa4C,EAAAA,WAAAA,MAAAA,cAAuCW,EAAe,KAGvEtL,UACE+Q,gBAAgB,SAAEC,KAElBjJ,EAIJ,IAF+BiJ,EAASC,YAAYpD,GAEvB,CASIM,EAAoB+C,8BACjDF,EAAS7W,IAGYsG,SAAQiC,IAC7B,MAAM+B,EAASsJ,EAAAA,MACZoD,aACArL,MAAKrB,GAAUA,EAAOmJ,SAASpF,SAAS9F,KAGzCqL,EAAAA,UAAAA,QAAqBtJ,EAAO2M,WAAYtD,EAAesD,aACvDrD,EAAAA,UAAAA,QAAqBtJ,EAAO4M,QAASvD,EAAeuD,WAEpDzH,EAAmBnF,EACrB,GAEJ,CAEA,MAAM,QAAEgH,EAAO,QAAEC,EAAO,QAAEC,EAAO,QAAEC,GAAY0F,EAC7ChG,EACA,CAAC1B,EAAkBkH,GACnBlK,GAGF,OAAO+D,EAAAA,UAAAA,aAAAA,mCACLW,EACAwC,EACA,CACE,CAAErJ,OAAQmF,EAAkB2H,MAAO9F,EAAS+F,MAAO9F,GACnD,CAAEjH,OAAQqM,EAAoBS,MAAO5F,EAAS6F,MAAO5F,IAEvD,CAAE6F,WAAW,EAAM3N,gBACpB,EAEH4N,iBAAkBvO,OAASC,iBAAgBU,mBACzC,MAAMR,EAAeD,EAAoBE,gBAAgBH,IAEnD,mBAAEsK,GAAuBpK,GACzB,SAAEsK,EAAQ,mBAAEC,GAAuBH,EACvCZ,EAA4Ba,UAGxBgE,EAAW5D,EAAAA,MAASC,UAAUJ,GAC9BhE,EAAmBmE,EAAAA,MAASC,UAAUH,GAG5Cb,EAAc4E,eAAe,kBAAmBtE,GAAU5S,GAE1D,MAEMmP,EAFiBgF,EAAmC9B,GAEvB1H,KAAI4C,GACrC0C,EAAAA,WAAAA,MAAAA,cAAuC1C,KAGnC4J,EAAgB,CACpBT,WAAYO,EAASP,WACrBU,OAAQH,EAASG,OACjBC,UAAWJ,EAASI,UACpBV,QAASM,EAASN,QAClBrR,SAAU2R,EAAS3R,SACnBgS,WAAYL,EAASM,aAAaC,8BAG9BC,EAAuB,CAC3Bf,WAAYxH,EAAiBwH,WAC7BU,OAAQlI,EAAiBkI,OACzBC,UAAWnI,EAAiBmI,UAC5BV,QAASzH,EAAiByH,QAC1BrR,SAAU4J,EAAiB5J,SAC3BgS,WAAYpI,EAAiBqI,aAAaC,8BAMtCE,EAAoBvI,EAAYxE,KAAI0C,IACjC,IACFA,EACH/H,SAAU,IACL+H,EAAW/H,SACd+Q,eAAgB,IACXhJ,EAAW/H,SAAS+Q,eACvBC,SAAU,KACVqB,gBAAiB,KACjBzD,QAAS,WAMXrK,QACGyI,EAAcsF,YAAY,kBAAmB,mBAAoB,CACtET,gBACAM,uBACAtI,YAAauI,EACbtO,kBACK,CAAC,EAEV,MAAO,CACLS,QAASA,EAAQgO,KACjBC,OAAQjO,EAAQkO,IAChBC,UAAWnO,EAAQoO,OACnBC,UAAWrO,EAAQsO,OACpB,EAEHC,eAAgBA,EAAG1P,iBAAgBU,eAAe,MAChD,MAAM,eAAEgK,EAAc,iBAAElE,GAAqB4D,GAA2BpK,IAChE6O,aAAcc,EAAe,UAAEjJ,EAAS,QAAEuH,GAAYvD,GACtDmE,aAAce,GAAoBpJ,EAE1C,IAAIqJ,GAAmB3I,IACnB4I,EAAkB5I,IACtB,MAAM6I,EAAqB,GAC3B,IAAIC,EAAa,EAgBjBL,EAAgBtS,SAdC4S,EAAGhX,QAAOiX,YACzB,GAAIjX,IAAUyH,EAAc,CAC1B,MAAMyP,EAAWP,EAAgBQ,WAAWF,GAC5CH,EAAmBM,KAAKF,GACpBA,EAAWN,IACbA,EAAkBM,GAEhBA,EAAWL,IACbA,EAAkBK,GAEpBH,GACF,IAGgC,CAAEtJ,cACpC,MAAMyI,EAAOY,EAAmBpE,QAAO,CAAC2E,EAAGC,IAAMD,EAAIC,GAAG,GAAKP,EAY7D,MAXc,CACZQ,SAAUV,EACV1I,SAAUyI,EACVvO,UAAW6N,EACXsB,SAAUC,KAAKC,KACbZ,EAAmB9N,KAAI+F,IAAMA,EAAImH,IAAS,IAAGxD,QAAO,CAACiF,EAAKC,IAASD,EAAMC,GAAM,GAC7Eb,GAEJ3O,OAAQ2O,EAAa/B,EAAQ,GAAKA,EAAQ,GAAKA,EAAQ,GAAK,KAGlD,EAEd6C,0BAA2BA,EAAG9P,kBAC5B,MAAM,UAAEM,EAAS,OAAED,GAAWL,EAE9B,MAAO,CACLI,sBAAuBC,EAASC,EACjC,EAEHyP,cAAehR,OAASyB,oBACtB,MAAMiN,EAAgBjN,EAAcS,KAAI/B,IACtC,MAAMqO,EAAW1D,GAAkC3K,GACnD,MAAO,CACL8N,WAAYO,EAASP,WACrBC,QAASM,EAASN,QAClBW,WAAYL,EAASM,aAAaC,6BAClCJ,OAAQH,EAASG,OACjBC,UAAWJ,EAASI,UACrB,IAGH,GAAKF,EAAc5Q,OAInB,aAAa+L,EAAcsF,YAAY,kBAAmB,gBAAiBT,EAAc,EAE3FuC,oBAAqBjR,OAASyB,gBAAeE,OAAM8B,SAAQlM,cACzD,MAAM2Z,EAAY7U,EAAgBqB,WAAW,2BAA4B,CACvE+D,kBAII0P,EAAuB,CAC3B,CAAE5T,IAAK,0BAA2BrE,MAAO,CAAEkY,WAF3BrF,EAAQsF,yBAAyB,CAAE5P,mBAECsB,QAAQ,KAC5D,CAAExF,IAAK,0BAA2BrE,MAAO,IAAKuK,UAGnCZ,IAATlB,GACFwP,EAAqBG,QAAQ,CAC3B/T,IAAK,+BACLrE,MAAO,CAAEyI,UCnbJ,SAAqCuP,EAAWC,EAAsB5Z,EAAU,CAAC,GAC9F,MAAMga,EAAcL,EAAU9T,OAAOC,KAAK6T,GAAW,IAC/ChW,EAAUkC,OAAOC,KAAKkU,GACtBC,EAAM,CAACtW,EAAQuW,KAAK,MAE1BrU,OAAOwJ,OAAOsK,GAAW5T,SAAQ6C,IAC/B,MAAMuR,EAAM,GACZxW,EAAQoC,SAAQqU,IAEdD,EAAIpB,KACFsB,MAAMC,QAAQ1R,EAAawR,IAAWxR,EAAawR,GAAQF,KAAK,KAAOtR,EAAawR,GACrF,IAEHH,EAAIlB,KAAKoB,EAAID,KAAK,KAAK,IAGzBD,EAAIlB,KAAK,IACTkB,EAAIlB,KAAK,IACTkB,EAAIlB,KAAK,IAETkB,EAAIlB,KAAK,cAAciB,EAAYO,aACnCN,EAAIlB,KAAK,cAAciB,EAAYQ,aACnCP,EAAIlB,KAAK,IACTa,EAAqB7T,SAAQ,EAAGC,MAAKrE,MAAO0N,MAC1C,MAAMoL,EAAO,GACbA,EAAK1B,KAAK,GAAG/S,KACbH,OAAOC,KAAKuJ,GAAQtJ,SAAQ2K,IAC1B+J,EAAK1B,KAAK,GAAGrI,KACb+J,EAAK1B,KAAK,GAAG1J,EAAOqB,KAAK,IAG3BuJ,EAAIlB,KAAK0B,EAAKP,KAAK,KAAK,IAG1B,MAAMQ,EAAO,IAAIC,KAAK,CAACV,EAAIC,KAAK,OAAQ,CACtCta,KAAM,2BAGFgb,EAAM7I,IAAIC,gBAAgB0I,GAE1B1B,EAAI6B,SAASC,cAAc,KACjC9B,EAAE+B,KAAOH,EACT5B,EAAEgC,SAAWhb,EAAQib,UAAY,GAAGjB,EAAYO,qBAChDvB,EAAEkC,OACJ,CD2YMC,CAA4BxB,EAAWC,EAAsB5Z,EAAQ,EAEvE8Z,yBAA0BrR,OAASyB,oBACjC,MAAMiN,EAAgBjN,EAAcS,KAAI/B,IACtC,MAAMqO,EAAW1D,GAAkC3K,GACnD,MAAO,CACL8N,WAAYO,EAASP,WACrBC,QAASM,EAASN,QAClBW,WAAYL,EAASM,aAAaC,6BAClCJ,OAAQH,EAASG,OACjBC,UAAWJ,EAASI,UACrB,KAGKnI,iBAAkBkM,GAAatI,GACrC5I,EAAc,GAAGxB,gBAGb2S,EAAgB,CACpB3E,WAAY0E,EAAS1E,WACrBC,QAASyE,EAASzE,QAClBW,WAAY8D,EAAS7D,aAAaC,6BAClCJ,OAAQgE,EAAShE,OACjBC,UAAW+D,EAAS/D,WAGtB,aAAa/E,EAAcsF,YAAY,kBAAmB,2BAA4B,CACpFT,gBACAM,qBAAsB4D,GACtB,EAEJC,iCAAkCA,KAChC,MAAM,SAAEhF,GAAavC,KACf,WAAEwH,GAAejF,EAASkF,YAM1BjO,EAJyB4G,EAC7B9B,GAG2C,GAEvChF,EAAa4C,EAAAA,WAAAA,MAAAA,cAAuC1C,GAG1DF,EAAWC,KAAKmO,gBAAkBF,EAGlClO,EAAWqO,aAAc,EACzBpF,EAASqF,QAAQ,EAEnBC,+BAAgCA,KAC9B,MAAM,SAAEtF,GAAavC,IAMfxG,EAJyB4G,EAC7B9B,GAG2C,GAEvChF,EAAa4C,EAAAA,WAAAA,MAAAA,cAAuC1C,GAGpDsO,EAAkBvF,EAASkF,YAAYD,WAC7ClO,EAAWC,KAAKwO,cAAgBD,EAIhCxO,EAAWqO,aAAc,EAEzBpF,EAASqF,QAAQ,EAEnBI,mBAAoBA,KAElB,MAAMC,EAAe/L,EAAAA,WAAAA,MAAAA,uBAEfd,EAAc,GAEpBtJ,OAAOC,KAAKkW,EAAa7M,aAAapJ,SAAQkW,IAC5C,MAAMC,EAAiBF,EAAa7M,YAAY8M,GAC1CE,EAAiB9J,EAA8BgC,QACnD,CAAClF,EAAazB,IAAa,IAAIyB,KAAiB+M,EAAexO,IAAa,KAC5E,IAGFyB,EAAY4J,QAAQoD,EAAe,IAGrCrX,EAAgBqB,WAAW,+BAAgC,CACzDgJ,eACA,EAEJiN,yBAA0BA,EAAGlS,oBACtBA,GAAkBA,EAAc3D,SACnC2D,EAAgBvB,EAAoBwB,oBAGtC,MAAMkS,EAAS,CAAC,EAEhB,IAAK,MAAMzT,KAAgBsB,EAAe,CACxC,MAAM,MAAE/C,EAAK,eAAEuB,EAAc,mBAAEsK,GAC7BpK,EACInJ,EAAKiJ,EAELiR,EAAY,CAAEla,KAAI0H,SAExB,IAAK6L,EAAoB,CACvBqJ,EAAO5c,GAAMka,EACb,QACF,CAEA,MAAM,YAAE/P,GAAgBhB,EAAaW,SAAS,IAAM,CAAC,EAEjDK,GACF/D,OAAOyD,QAAQM,GAAa7D,SAAQ,EAAEC,EAAKrE,MACpB,iBAAVA,EACTgY,EAAU3T,GAAOrE,EAEjBkE,OAAOyD,QAAQ3H,GAAOoE,SAAQ,EAAEuW,EAAQC,MAEtC5C,EADe,GAAG3T,KAAOsW,KACLC,CAAQ,GAEhC,IAIJ,MAAMnJ,EACJxK,EAAaoK,mBAAmBZ,EAA4Ba,UAE9D,IAAKG,EAAgB,CACnBiJ,EAAO5c,GAAMka,EACb,QACF,CAEA,MAAMxG,EAAqBC,EAAeD,mBAEpCjE,EAAmBmE,EAAAA,MAASC,UAAUH,GAE5C,IAAKjE,EAAkB,CACrBmN,EAAO5c,GAAMka,EACb,QACF,CAEA,IAAKzK,EAAiBsN,WAAatN,EAAiBsN,SAASjW,OAAQ,CACnE8V,EAAO5c,GAAMka,EACb,QACF,CAEA,MAAM7E,EAAe5F,EAAiBsN,SAAS,GACzCvH,EAAWwH,EAAAA,GAAAA,QAAalL,iBAAiB2D,IAAI,WAAYJ,GAE1DG,EAKLoH,EAAO5c,GAAM,IACRka,EACHY,UAAWtF,EAASsF,WAAa,SACjCmC,YAAazH,EAASyH,YAAYC,WAClC9U,iBAAkBoN,EAASpN,iBAC3BC,kBAAmBmN,EAASnN,kBAC5B0S,UAAWvF,EAASuF,WAVpB6B,EAAO5c,GAAMka,CAYjB,CAEA,OAAO0C,CAAM,EAEfO,6BAA8BA,EAAGzN,kBAC/B0N,EAAwB1N,EAAY,EAEtC2N,oBAAqBA,EAAGvc,cAAaiB,eACnC,MAAMub,EAAY7X,EAAiB8X,aAAazc,GAEhD,IAAKwc,EACH,OAGF,MAAM,qBAAE7W,GAAyBd,EAAuBkB,kBAElDnD,EAAeqR,EAAQvO,wBAAwB,CACnDC,yBAGF,IAAK/C,EACH,OAGF,MAAM8Z,EAAoBF,EAAUG,iBAE9BjZ,EAAY,GAClBgZ,EAAkBlX,SAAQ3F,IACxB0E,EAAgBqB,WAAW,sBAAuB,CAChD/F,aACA4H,sBAAuB7E,EAAa6E,sBACpCxG,SAAU,CACRC,KAAMD,KAIVyC,EAAU8U,KAAK3L,EAA2B+P,uBAAuB/c,GAAY,IAG/E6D,EAAU8B,SAAQuQ,IAChBA,EAASqF,QAAQ,GACjB,GAIAyB,EAAc,CAClBxB,+BAAgC,CAC9ByB,UAAW7I,EAAQoH,gCAErBN,iCAAkC,CAChC+B,UAAW7I,EAAQ8G,kCAErBrV,wBAAyB,CACvBoX,UAAW7I,EAAQvO,yBAErB4O,cAAe,CACbwI,UAAW7I,EAAQK,eAErBO,wBAAyB,CACvBiI,UAAW7I,EAAQY,yBAErBS,wCAAyC,CACvCwH,UAAW7I,EAAQqB,yCAErBiE,yBAA0B,CACxBuD,UAAW7I,EAAQsF,0BAErB9C,iBAAkB,CAChBqG,UAAW7I,EAAQwC,kBAErBoB,eAAgB,CACdiF,UAAW7I,EAAQ4D,gBAErBqB,cAAe,CACb4D,UAAW7I,EAAQiF,eAErBC,oBAAqB,CACnB2D,UAAW7I,EAAQkF,qBAErBqC,mBAAoB,CAClBsB,UAAW7I,EAAQuH,oBAErBK,yBAA0B,CACxBiB,UAAW7I,EAAQ4H,0BAErBQ,6BAA8B,CAC5BS,UAAW7I,EAAQoI,8BAErBE,oBAAqB,CACnBO,UAAW7I,EAAQsI,sBAIvB,MAAO,CACLtI,UACA4I,cACAE,eAAgB,mBACjB,EEvrBUC,GAAW,WAGlBvd,GAAU,CACd,CAAE2B,MAAO4b,GAAUpW,MAAO,MAAOqW,YAAa,OAC9C,CAAE7b,MAJU,QAIIwF,MAAO,QAASqW,YAAa,UAqL/C,SAlLA,UAAmC,OAAEtR,EAAM,SAAEuR,EAAQ,WAAEtX,IACrD,MAAM,EAAEpB,IAAMC,EAAAA,EAAAA,IAAe,6BAE7B,OACE6B,EAAAA,cAAA,OAAKC,UAAU,2CACbD,EAAAA,cAAA,OAAKC,UAAU,4BACbD,EAAAA,cAAA,OAAKC,UAAU,uBACbD,EAAAA,cAAC6W,EAAAA,GAAM,CACLvW,MAAOpC,EAAE,YACT4Y,mBAAmB,EACnB7W,UAAU,gDACV9G,QAASA,GACT4d,YAAa5d,GAAQoL,MAAKyS,GAAUA,EAAOlc,QAAUuK,EAAO4E,WAAU0M,YACtE7b,MAAOuK,EAAO4E,SACdzJ,SAAUA,EAAG1F,YACX8b,EAAS,CACP7d,KAAM,cACNke,QAAS,CACPhN,SAAUnP,IAEZ,KAIRkF,EAAAA,cAAA,OAAKC,UAAU,SAEbD,EAAAA,cAACkX,EAAAA,GAAiB,KAChBlX,EAAAA,cAACmX,EAAAA,GAAY,CACXhS,KAAK,UACLlF,UAAU,iCACVmX,MAAM,eACNhS,QAAQ,WACRxE,QAASA,IAAMtB,EAAW,qCAEzBpB,EAAE,UAEL8B,EAAAA,cAACmX,EAAAA,GAAY,CACXhS,KAAK,UACLiS,MAAM,eACNhS,QAAQ,WACRnF,UAAU,iCACVW,QAASA,IAAMtB,EAAW,mCAEzBpB,EAAE,WAMVmH,EAAO4E,WAAayM,IACnB1W,EAAAA,cAACI,EAAAA,GAAK,CACJE,MAAOpC,EAAE,yBACTqC,eAAe,oCACfN,UAAU,+BACVlH,KAAK,OACLsH,mBAAmB,OACnBvF,MAAOuK,EAAO9I,OACdiE,SAAUC,IACRmW,EAAS,CACP7d,KAAM,YACNke,QAAS,CACP1a,OAAQkE,EAAExH,OAAO6B,QAEnB,IAIPuK,EAAO4E,WAAayM,IACnB1W,EAAAA,cAAA,OAAKC,UAAU,gBACbD,EAAAA,cAAA,aACEA,EAAAA,cAAA,aACEA,EAAAA,cAAA,MAAIC,UAAU,QACZD,EAAAA,cAAA,MACEC,UAAU,OACVoX,QAAQ,KAERrX,EAAAA,cAACsX,EAAAA,GAAK,CACJrX,UAAU,oCACVsX,KAAK,2BAIXvX,EAAAA,cAAA,MAAIC,UAAU,QACZD,EAAAA,cAAA,MAAIC,UAAU,yBACZD,EAAAA,cAACsX,EAAAA,GAAK,CACJrX,UAAU,aACVsX,KAAK,QAGTvX,EAAAA,cAAA,UACEA,EAAAA,cAAA,OAAKC,UAAU,wBACbD,EAAAA,cAACI,EAAAA,GAAK,CACJE,MAAOpC,EAAE,IACTqC,eAAe,aACfN,UAAU,oCACVlH,KAAK,OACLsH,mBAAmB,OACnBvF,MAAOuK,EAAO+E,QACd5J,SAAUC,IACRmW,EAAS,CACP7d,KAAM,eACNke,QAAS,CACP7M,QAAS3J,EAAExH,OAAO6B,QAEpB,IAGNkF,EAAAA,cAACI,EAAAA,GAAK,CACJE,MAAOpC,EAAE,IACTqC,eAAe,aACfN,UAAU,oCACVlH,KAAK,OACLsH,mBAAmB,OACnBvF,MAAOuK,EAAOgF,QACd7J,SAAUC,IACRmW,EAAS,CACP7d,KAAM,eACNke,QAAS,CACP5M,QAAS5J,EAAExH,OAAO6B,QAEpB,OAMZkF,EAAAA,cAAA,UACEA,EAAAA,cAAA,MAAIC,UAAU,yBACZD,EAAAA,cAACsX,EAAAA,GAAK,CACJrX,UAAU,aACVsX,KAAK,QAGTvX,EAAAA,cAAA,UACEA,EAAAA,cAAA,OAAKC,UAAU,wBACbD,EAAAA,cAACI,EAAAA,GAAK,CACJE,MAAOpC,EAAE,IACTqC,eAAe,aACfN,UAAU,oCACVlH,KAAK,OACLsH,mBAAmB,OACnBvF,MAAOuK,EAAO6E,QACd1J,SAAUC,IACRmW,EAAS,CACP7d,KAAM,eACNke,QAAS,CACP/M,QAASzJ,EAAExH,OAAO6B,QAEpB,IAGNkF,EAAAA,cAACI,EAAAA,GAAK,CACJE,MAAOpC,EAAE,IACTqC,eAAe,aACfN,UAAU,oCACVlH,KAAK,OACLsH,mBAAmB,OACnBvF,MAAOuK,EAAO8E,QACd3J,SAAUC,IACRmW,EAAS,CACP7d,KAAM,eACNke,QAAS,CACP9M,QAAS1J,EAAExH,OAAO6B,QAEpB,UAY1B,EChLM0c,GAAmBd,GAEzB,SAASe,GAAQC,EAAOC,GACtB,MAAM,QAAEV,GAAYU,GACd,SAAE1N,EAAQ,QAAEG,EAAO,QAAEC,EAAO,QAAEH,EAAO,QAAEC,EAAO,OAAE5N,GAAW0a,EAEjE,OAAQU,EAAO5e,MACb,IAAK,cACH,MAAO,IACF2e,EACHzN,YAEJ,IAAK,eACH,MAAO,IACFyN,EACHtN,QAASA,GAAoBsN,EAAMtN,QACnCC,QAASA,GAAoBqN,EAAMrN,QACnCH,QAASA,GAAoBwN,EAAMxN,QACnCC,QAASA,GAAoBuN,EAAMvN,SAEvC,IAAK,YACH,MAAO,IACFuN,EACHnb,UAEJ,QACE,OAAOmb,EAEb,CA+FA,SA7FA,UAA6B,gBAAE1Z,EAAe,gBAAEC,IAC9C,MAAM,oBAAE6D,GAAwB9D,EAAgBQ,UACzCoZ,EAAwBC,IAA6BlZ,EAAAA,EAAAA,UAAS,MAE/DW,GAAawY,EAAAA,EAAAA,cACjB,CAACC,EAAaC,EAAiB,CAAC,IACvB/Z,EAAgBqB,WAAWyY,EAAaC,IAEjD,CAAC/Z,KAGIoH,EAAQuR,IAAYqB,EAAAA,EAAAA,YAAWR,GAAS,CAC7CxN,SAAUuN,GACVpN,SAhD+B,KAiD/BC,QAhD+B,KAiD/BH,QAhD+B,IAiD/BC,QAhD+B,IAiD/B5N,OAhDmB,MAmDfoF,GAAwBmW,EAAAA,EAAAA,cAAY,KACxC,MAAMjW,EAAiB+V,EACjBM,EACJC,EAAAA,aAAAA,aAAAA,sBAA0DtW,GAI5DvC,EAAW,0CAA2C,CACpDuC,iBACAwD,SACA9C,aAAc2V,GACd,GACD,CAACN,EAAwBvS,IA0C5B,OAxCA9F,EAAAA,EAAAA,YAAU,KACR,MAAM8D,EAAgBvB,EAAoB8M,iCAE1C,IAAKvL,EAAc3D,OACjB,OAGF,MAAM0Y,EAAW/U,EAAckB,MAAK8T,GAAOA,EAAID,WAC/CP,EAA0BO,EAASxf,GAAG,GACrC,KAKH2G,EAAAA,EAAAA,YAAU,KAER,MAAM+Y,EAAUxW,EAAoBhC,OAAOyY,sBACrCC,EAAgB,GAgBtB,MAdA,CAACF,GAASpZ,SAAQuZ,IAChB,MAAM,YAAE7Y,GAAgBkC,EAAoBjC,UAAU4Y,GAAK,KACzD,MAAMpV,EAAgBvB,EAAoB8M,iCAE1C,IAAKvL,EAAc3D,OACjB,OAGF,MAAM0Y,EAAW/U,EAAckB,MAAK8T,GAAOA,EAAID,WAC/CP,EAA0BO,EAASxf,GAAG,IAExC4f,EAActG,KAAKtS,EAAY,IAG1B,KACL4Y,EAActZ,SAAQwZ,IACpBA,GAAO,GACP,CACH,GACA,IAGD1Y,EAAAA,cAAA,OAAKC,UAAU,4EACbD,EAAAA,cAAC2Y,GAAyB,CACxBtT,OAAQA,EACRuR,SAAUA,EACVtX,WAAYA,IAEc,OAA3BsY,GACC5X,EAAAA,cAACW,EAAAA,GAAM,CACLV,UAAU,2BACVW,QAASe,GACV,OAMT,EC3HA,MAAMiX,GAAgB,CAIpBhgB,GAAE,EACFigB,eAAAA,EAAgB,gBAAE7a,EAAe,gBAAEC,EAAe,iBAAE4G,EAAgB,cAAEC,EAAgB,CAAC,KRE1E,UAAc,gBAAE9G,IAC7B,MAAM,mBAAEuD,EAAkB,kBAAEnD,EAAiB,2BAAEmI,GAC7CvI,EAAgBQ,UAElBsa,EAAAA,EAAAA,SAAQC,EAAAA,oCACRD,EAAAA,EAAAA,SAAQE,EAAAA,gCAER,MAAM,8BAAErR,EAA6B,2BAAEK,GACrCN,EACEnG,EACAnD,EACAmI,GAGE0S,EAAiC1X,EAAmB2X,UACxDjR,EACAC,GAGF3G,EAAmB4X,WACjBF,EACA,gCACAtR,EAA8BE,iBAC9BF,EAA8BzB,aAC9ByB,EAA8BtB,eAGhC9E,EAAmB4X,WACjBF,EACA,6BACAjR,EAA2BH,iBAC3BG,EAA2B9B,aAC3B8B,EAA2B3B,cAE/B,CQnCI+S,CAAK,CAAEpb,kBAAiBC,kBAAiB4G,mBAAkBC,iBAC7D,EACAuU,iBChBa,UAA0B,gBAAEpb,EAAe,gBAAED,IAC1D,MAAO,CACL,CACEpD,KAAM,oCACN0e,iBAAkBA,IAAMC,GAAoB,CAAEtb,kBAAiBD,qBAGrE,EDUEwb,eAAc,EACdC,yBAAwB,EACxBC,kBAAiBA,EAAC,gBAAE1b,EAAe,gBAAEC,EAAe,iBAAE4G,KAC7C8H,GAAe,CACpB3O,kBACAC,kBACA4G,sBAKN,K","sources":["webpack:///../../../extensions/tmtv/src/id.js","webpack:///../../../extensions/tmtv/src/utils/hpViewports.ts","webpack:///../../../extensions/tmtv/src/getHangingProtocolModule.ts","webpack:///../../../extensions/tmtv/src/Panels/PanelPetSUV.tsx","webpack:///../../../extensions/tmtv/src/utils/handleROIThresholding.ts","webpack:///../../../extensions/tmtv/src/Panels/PanelROIThresholdSegmentation/index.ts","webpack:///../../../extensions/tmtv/src/Panels/PanelROIThresholdSegmentation/PanelROIThresholdExport.tsx","webpack:///../../../extensions/tmtv/src/Panels/PanelTMTV.tsx","webpack:///../../../extensions/tmtv/src/getPanelModule.tsx","webpack:///../../../extensions/tmtv/src/utils/measurementServiceMappings/constants/supportedTools.js","webpack:///../../../extensions/tmtv/src/utils/measurementServiceMappings/RectangleROIStartEndThreshold.js","webpack:///../../../extensions/tmtv/src/utils/measurementServiceMappings/CircleROIStartEndThreshold.js","webpack:///../../../extensions/tmtv/src/utils/measurementServiceMappings/measurementServiceMappingsFactory.js","webpack:///../../../extensions/tmtv/src/init.js","webpack:///../../../extensions/tmtv/src/utils/getThresholdValue.ts","webpack:///../../../extensions/tmtv/src/utils/dicomRTAnnotationExport/RTStructureSet/dicomRTAnnotationExport.js","webpack:///../../../extensions/tmtv/src/utils/dicomRTAnnotationExport/RTStructureSet/index.js","webpack:///../../../extensions/tmtv/src/commandsModule.ts","webpack:///../../../extensions/tmtv/src/utils/createAndDownloadTMTVReport.js","webpack:///../../../extensions/tmtv/src/Panels/PanelROIThresholdSegmentation/ROIThresholdConfiguration.tsx","webpack:///../../../extensions/tmtv/src/Panels/RectangleROIOptions.tsx","webpack:///../../../extensions/tmtv/src/index.tsx","webpack:///../../../extensions/tmtv/src/getToolbarModule.tsx"],"sourcesContent":["import packageJson from '../package.json';\n\nconst id = packageJson.name;\n\nexport { id };\n","// Common sync group configurations\nconst cameraPositionSync = (id: string) => ({\n  type: 'cameraPosition',\n  id,\n  source: true,\n  target: true,\n});\n\nconst hydrateSegSync = {\n  type: 'hydrateseg',\n  id: 'sameFORId',\n  source: true,\n  target: true,\n  options: {\n    matchingRules: ['sameFOR'],\n  },\n};\n\nconst ctAXIAL: AppTypes.HangingProtocol.Viewport = {\n  viewportOptions: {\n    viewportId: 'ctAXIAL',\n    viewportType: 'volume',\n    orientation: 'axial',\n    toolGroupId: 'ctToolGroup',\n    initialImageOptions: {\n      // index: 5,\n      preset: 'first', // 'first', 'last', 'middle'\n    },\n    syncGroups: [\n      cameraPositionSync('axialSync'),\n      {\n        type: 'voi',\n        id: 'ctWLSync',\n        source: true,\n        target: true,\n        options: {\n          syncColormap: true,\n        },\n      },\n      hydrateSegSync,\n    ],\n  },\n  displaySets: [\n    {\n      id: 'ctDisplaySet',\n    },\n  ],\n};\n\nconst ctSAGITTAL: AppTypes.HangingProtocol.Viewport = {\n  viewportOptions: {\n    viewportId: 'ctSAGITTAL',\n    viewportType: 'volume',\n    orientation: 'sagittal',\n    toolGroupId: 'ctToolGroup',\n    syncGroups: [\n      cameraPositionSync('sagittalSync'),\n      {\n        type: 'voi',\n        id: 'ctWLSync',\n        source: true,\n        target: true,\n        options: {\n          syncColormap: true,\n        },\n      },\n      hydrateSegSync,\n    ],\n  },\n  displaySets: [\n    {\n      id: 'ctDisplaySet',\n    },\n  ],\n};\n\nconst ctCORONAL: AppTypes.HangingProtocol.Viewport = {\n  viewportOptions: {\n    viewportId: 'ctCORONAL',\n    viewportType: 'volume',\n    orientation: 'coronal',\n    toolGroupId: 'ctToolGroup',\n    syncGroups: [\n      cameraPositionSync('coronalSync'),\n      {\n        type: 'voi',\n        id: 'ctWLSync',\n        source: true,\n        target: true,\n        options: {\n          syncColormap: true,\n        },\n      },\n      hydrateSegSync,\n    ],\n  },\n  displaySets: [\n    {\n      id: 'ctDisplaySet',\n    },\n  ],\n};\n\nconst ptAXIAL: AppTypes.HangingProtocol.Viewport = {\n  viewportOptions: {\n    viewportId: 'ptAXIAL',\n    viewportType: 'volume',\n    background: [1, 1, 1],\n    orientation: 'axial',\n    toolGroupId: 'ptToolGroup',\n    initialImageOptions: {\n      // index: 5,\n      preset: 'first', // 'first', 'last', 'middle'\n    },\n    syncGroups: [\n      cameraPositionSync('axialSync'),\n      {\n        type: 'voi',\n        id: 'ptWLSync',\n        source: true,\n        target: true,\n        options: {\n          syncColormap: true,\n        },\n      },\n      {\n        type: 'voi',\n        id: 'ptFusionWLSync',\n        source: true,\n        target: false,\n        options: {\n          syncColormap: false,\n          syncInvertState: false,\n        },\n      },\n      hydrateSegSync,\n    ],\n  },\n  displaySets: [\n    {\n      options: {\n        voi: {\n          custom: 'getPTVOIRange',\n        },\n        voiInverted: true,\n      },\n      id: 'ptDisplaySet',\n    },\n  ],\n};\n\nconst ptSAGITTAL: AppTypes.HangingProtocol.Viewport = {\n  viewportOptions: {\n    viewportId: 'ptSAGITTAL',\n    viewportType: 'volume',\n    orientation: 'sagittal',\n    background: [1, 1, 1],\n    toolGroupId: 'ptToolGroup',\n    syncGroups: [\n      cameraPositionSync('sagittalSync'),\n      {\n        type: 'voi',\n        id: 'ptWLSync',\n        source: true,\n        target: true,\n        options: {\n          syncColormap: true,\n        },\n      },\n      {\n        type: 'voi',\n        id: 'ptFusionWLSync',\n        source: true,\n        target: false,\n        options: {\n          syncColormap: false,\n          syncInvertState: false,\n        },\n      },\n      hydrateSegSync,\n    ],\n  },\n  displaySets: [\n    {\n      options: {\n        voi: {\n          custom: 'getPTVOIRange',\n        },\n        voiInverted: true,\n      },\n      id: 'ptDisplaySet',\n    },\n  ],\n};\n\nconst ptCORONAL: AppTypes.HangingProtocol.Viewport = {\n  viewportOptions: {\n    viewportId: 'ptCORONAL',\n    viewportType: 'volume',\n    orientation: 'coronal',\n    background: [1, 1, 1],\n    toolGroupId: 'ptToolGroup',\n    syncGroups: [\n      cameraPositionSync('coronalSync'),\n      {\n        type: 'voi',\n        id: 'ptWLSync',\n        source: true,\n        target: true,\n        options: {\n          syncColormap: true,\n        },\n      },\n      {\n        type: 'voi',\n        id: 'ptFusionWLSync',\n        source: true,\n        target: false,\n        options: {\n          syncColormap: false,\n          syncInvertState: false,\n        },\n      },\n      hydrateSegSync,\n    ],\n  },\n  displaySets: [\n    {\n      options: {\n        voi: {\n          custom: 'getPTVOIRange',\n        },\n        voiInverted: true,\n      },\n      id: 'ptDisplaySet',\n    },\n  ],\n};\n\nconst fusionAXIAL: AppTypes.HangingProtocol.Viewport = {\n  viewportOptions: {\n    viewportId: 'fusionAXIAL',\n    viewportType: 'volume',\n    orientation: 'axial',\n    toolGroupId: 'fusionToolGroup',\n    initialImageOptions: {\n      // index: 5,\n      preset: 'first', // 'first', 'last', 'middle'\n    },\n    syncGroups: [\n      cameraPositionSync('axialSync'),\n      {\n        type: 'voi',\n        id: 'ctWLSync',\n        source: false,\n        target: true,\n      },\n      {\n        type: 'voi',\n        id: 'fusionWLSync',\n        source: true,\n        target: true,\n        options: {\n          syncColormap: true,\n        },\n      },\n      {\n        type: 'voi',\n        id: 'ptFusionWLSync',\n        source: false,\n        target: true,\n        options: {\n          syncColormap: false,\n          syncInvertState: false,\n        },\n      },\n      hydrateSegSync,\n    ],\n  },\n  displaySets: [\n    {\n      id: 'ctDisplaySet',\n    },\n    {\n      id: 'ptDisplaySet',\n      options: {\n        colormap: {\n          name: 'hsv',\n          opacity: [\n            { value: 0, opacity: 0 },\n            { value: 0.1, opacity: 0.8 },\n            { value: 1, opacity: 0.9 },\n          ],\n        },\n        voi: {\n          custom: 'getPTVOIRange',\n        },\n      },\n    },\n  ],\n};\n\nconst fusionSAGITTAL = {\n  viewportOptions: {\n    viewportId: 'fusionSAGITTAL',\n    viewportType: 'volume',\n    orientation: 'sagittal',\n    toolGroupId: 'fusionToolGroup',\n    // initialImageOptions: {\n    //   index: 180,\n    //   preset: 'middle', // 'first', 'last', 'middle'\n    // },\n    syncGroups: [\n      cameraPositionSync('sagittalSync'),\n      {\n        type: 'voi',\n        id: 'ctWLSync',\n        source: false,\n        target: true,\n      },\n      {\n        type: 'voi',\n        id: 'fusionWLSync',\n        source: true,\n        target: true,\n        options: {\n          syncColormap: true,\n        },\n      },\n      {\n        type: 'voi',\n        id: 'ptFusionWLSync',\n        source: false,\n        target: true,\n        options: {\n          syncColormap: false,\n          syncInvertState: false,\n        },\n      },\n      hydrateSegSync,\n    ],\n  },\n  displaySets: [\n    {\n      id: 'ctDisplaySet',\n    },\n    {\n      id: 'ptDisplaySet',\n      options: {\n        colormap: {\n          name: 'hsv',\n          opacity: [\n            { value: 0, opacity: 0 },\n            { value: 0.1, opacity: 0.8 },\n            { value: 1, opacity: 0.9 },\n          ],\n        },\n        voi: {\n          custom: 'getPTVOIRange',\n        },\n      },\n    },\n  ],\n};\n\nconst fusionCORONAL = {\n  viewportOptions: {\n    viewportId: 'fusionCoronal',\n    viewportType: 'volume',\n    orientation: 'coronal',\n    toolGroupId: 'fusionToolGroup',\n    // initialImageOptions: {\n    //   index: 180,\n    //   preset: 'middle', // 'first', 'last', 'middle'\n    // },\n    syncGroups: [\n      cameraPositionSync('coronalSync'),\n      {\n        type: 'voi',\n        id: 'ctWLSync',\n        source: false,\n        target: true,\n      },\n      {\n        type: 'voi',\n        id: 'fusionWLSync',\n        source: true,\n        target: true,\n        options: {\n          syncColormap: true,\n        },\n      },\n      {\n        type: 'voi',\n        id: 'ptFusionWLSync',\n        source: false,\n        target: true,\n        options: {\n          syncColormap: false,\n          syncInvertState: false,\n        },\n      },\n      hydrateSegSync,\n    ],\n  },\n  displaySets: [\n    {\n      id: 'ctDisplaySet',\n    },\n    {\n      id: 'ptDisplaySet',\n      options: {\n        colormap: {\n          name: 'hsv',\n          opacity: [\n            { value: 0, opacity: 0 },\n            { value: 0.1, opacity: 0.8 },\n            { value: 1, opacity: 0.9 },\n          ],\n        },\n        voi: {\n          custom: 'getPTVOIRange',\n        },\n      },\n    },\n  ],\n};\n\nconst mipSAGITTAL: AppTypes.HangingProtocol.Viewport = {\n  viewportOptions: {\n    viewportId: 'mipSagittal',\n    viewportType: 'volume',\n    orientation: 'sagittal',\n    background: [1, 1, 1],\n    toolGroupId: 'mipToolGroup',\n    syncGroups: [\n      {\n        type: 'voi',\n        id: 'ptWLSync',\n        source: true,\n        target: true,\n        options: {\n          syncColormap: true,\n        },\n      },\n      {\n        type: 'voi',\n        id: 'ptFusionWLSync',\n        source: true,\n        target: false,\n        options: {\n          syncColormap: false,\n          syncInvertState: false,\n        },\n      },\n      hydrateSegSync,\n    ],\n\n    // Custom props can be used to set custom properties which extensions\n    // can react on.\n    customViewportProps: {\n      // We use viewportDisplay to filter the viewports which are displayed\n      // in mip and we set the scrollbar according to their rotation index\n      // in the cornerstone extension.\n      hideOverlays: true,\n    },\n  },\n  displaySets: [\n    {\n      options: {\n        blendMode: 'MIP',\n        slabThickness: 'fullVolume',\n        voi: {\n          custom: 'getPTVOIRange',\n        },\n        voiInverted: true,\n      },\n      id: 'ptDisplaySet',\n    },\n  ],\n};\n\nexport {\n  ctAXIAL,\n  ctSAGITTAL,\n  ctCORONAL,\n  ptAXIAL,\n  ptSAGITTAL,\n  ptCORONAL,\n  fusionAXIAL,\n  fusionSAGITTAL,\n  fusionCORONAL,\n  mipSAGITTAL,\n};\n","import {\n  ctAXIAL,\n  ctCORONAL,\n  ctSAGITTAL,\n  fusionAXIAL,\n  fusionCORONAL,\n  fusionSAGITTAL,\n  mipSAGITTAL,\n  ptAXIAL,\n  ptCORONAL,\n  ptSAGITTAL,\n} from './utils/hpViewports';\n\n/**\n * represents a 3x4 viewport layout configuration. The layout displays CT axial, sagittal, and coronal\n * images in the first row, PT axial, sagittal, and coronal images in the second row, and fusion axial,\n * sagittal, and coronal images in the third row. The fourth column is fully spanned by a MIP sagittal\n * image, covering all three rows. It has synchronizers for windowLevel for all CT and PT images, and\n * also camera synchronizer for each orientation\n */\nconst stage1: AppTypes.HangingProtocol.ProtocolStage = {\n  name: 'default',\n  id: 'default',\n  viewportStructure: {\n    layoutType: 'grid',\n    properties: {\n      rows: 3,\n      columns: 4,\n      layoutOptions: [\n        {\n          x: 0,\n          y: 0,\n          width: 1 / 4,\n          height: 1 / 3,\n        },\n        {\n          x: 1 / 4,\n          y: 0,\n          width: 1 / 4,\n          height: 1 / 3,\n        },\n        {\n          x: 2 / 4,\n          y: 0,\n          width: 1 / 4,\n          height: 1 / 3,\n        },\n        {\n          x: 0,\n          y: 1 / 3,\n          width: 1 / 4,\n          height: 1 / 3,\n        },\n        {\n          x: 1 / 4,\n          y: 1 / 3,\n          width: 1 / 4,\n          height: 1 / 3,\n        },\n        {\n          x: 2 / 4,\n          y: 1 / 3,\n          width: 1 / 4,\n          height: 1 / 3,\n        },\n        {\n          x: 0,\n          y: 2 / 3,\n          width: 1 / 4,\n          height: 1 / 3,\n        },\n        {\n          x: 1 / 4,\n          y: 2 / 3,\n          width: 1 / 4,\n          height: 1 / 3,\n        },\n        {\n          x: 2 / 4,\n          y: 2 / 3,\n          width: 1 / 4,\n          height: 1 / 3,\n        },\n        {\n          x: 3 / 4,\n          y: 0,\n          width: 1 / 4,\n          height: 1,\n        },\n      ],\n    },\n  },\n  viewports: [\n    ctAXIAL,\n    ctSAGITTAL,\n    ctCORONAL,\n    ptAXIAL,\n    ptSAGITTAL,\n    ptCORONAL,\n    fusionAXIAL,\n    fusionSAGITTAL,\n    fusionCORONAL,\n    mipSAGITTAL,\n  ],\n  createdDate: '2021-02-23T18:32:42.850Z',\n};\n\n/**\n * The layout displays CT axial image in the top-left viewport, fusion axial image\n * in the top-right viewport, PT axial image in the bottom-left viewport, and MIP\n * sagittal image in the bottom-right viewport. The layout follows a simple grid\n * pattern with 2 rows and 2 columns. It includes synchronizers as well.\n */\nconst stage2 = {\n  name: 'Fusion 2x2',\n  id: 'Fusion-2x2',\n  viewportStructure: {\n    layoutType: 'grid',\n    properties: {\n      rows: 2,\n      columns: 2,\n    },\n  },\n  viewports: [ctAXIAL, fusionAXIAL, ptAXIAL, mipSAGITTAL],\n};\n\n/**\n * The top row displays CT images in axial, sagittal, and coronal orientations from\n * left to right, respectively. The bottom row displays PT images in axial, sagittal,\n * and coronal orientations from left to right, respectively.\n * The layout follows a simple grid pattern with 2 rows and 3 columns.\n * It includes synchronizers as well.\n */\nconst stage3: AppTypes.HangingProtocol.ProtocolStage = {\n  name: '2x3-layout',\n  id: '2x3-layout',\n  viewportStructure: {\n    layoutType: 'grid',\n    properties: {\n      rows: 2,\n      columns: 3,\n    },\n  },\n  viewports: [ctAXIAL, ctSAGITTAL, ctCORONAL, ptAXIAL, ptSAGITTAL, ptCORONAL],\n};\n\n/**\n * In this layout, the top row displays PT images in coronal, sagittal, and axial\n * orientations from left to right, respectively, followed by a MIP sagittal image\n * that spans both rows on the rightmost side. The bottom row displays fusion images\n * in coronal, sagittal, and axial orientations from left to right, respectively.\n * There is no viewport in the bottom row's rightmost position, as the MIP sagittal viewport\n * from the top row spans the full height of both rows.\n * It includes synchronizers as well.\n */\nconst stage4: AppTypes.HangingProtocol.ProtocolStage = {\n  name: '2x4-layout',\n  id: '2x4-layout',\n  viewportStructure: {\n    layoutType: 'grid',\n    properties: {\n      rows: 2,\n      columns: 4,\n      layoutOptions: [\n        {\n          x: 0,\n          y: 0,\n          width: 1 / 4,\n          height: 1 / 2,\n        },\n        {\n          x: 1 / 4,\n          y: 0,\n          width: 1 / 4,\n          height: 1 / 2,\n        },\n        {\n          x: 2 / 4,\n          y: 0,\n          width: 1 / 4,\n          height: 1 / 2,\n        },\n        {\n          x: 3 / 4,\n          y: 0,\n          width: 1 / 4,\n          height: 1,\n        },\n        {\n          x: 0,\n          y: 1 / 2,\n          width: 1 / 4,\n          height: 1 / 2,\n        },\n        {\n          x: 1 / 4,\n          y: 1 / 2,\n          width: 1 / 4,\n          height: 1 / 2,\n        },\n        {\n          x: 2 / 4,\n          y: 1 / 2,\n          width: 1 / 4,\n          height: 1 / 2,\n        },\n      ],\n    },\n  },\n  viewports: [\n    ptCORONAL,\n    ptSAGITTAL,\n    ptAXIAL,\n    mipSAGITTAL,\n    fusionCORONAL,\n    fusionSAGITTAL,\n    fusionAXIAL,\n  ],\n};\n\n/**\n * This layout displays three fusion viewports: axial, sagittal, and coronal.\n * It follows a simple grid pattern with 1 row and 3 columns.\n */\n// const stage0: AppTypes.HangingProtocol.ProtocolStage = {\n//   name: 'Fusion 1x3',\n//   viewportStructure: {\n//     layoutType: 'grid',\n//     properties: {\n//       rows: 1,\n//       columns: 3,\n//     },\n//   },\n//   viewports: [fusionAXIAL, fusionSAGITTAL, fusionCORONAL],\n// };\n\nconst ptCT: AppTypes.HangingProtocol.Protocol = {\n  id: '@ohif/extension-tmtv.hangingProtocolModule.ptCT',\n  locked: true,\n  name: 'Default',\n  createdDate: '2021-02-23T19:22:08.894Z',\n  modifiedDate: '2022-10-04T19:22:08.894Z',\n  availableTo: {},\n  editableBy: {},\n  imageLoadStrategy: 'interleaveTopToBottom', // \"default\" , \"interleaveTopToBottom\",  \"interleaveCenter\"\n  protocolMatchingRules: [\n    {\n      attribute: 'ModalitiesInStudy',\n      constraint: {\n        contains: ['CT', 'PT'],\n      },\n    },\n    {\n      attribute: 'StudyDescription',\n      constraint: {\n        contains: 'PETCT',\n      },\n    },\n    {\n      attribute: 'StudyDescription',\n      constraint: {\n        contains: 'PET/CT',\n      },\n    },\n  ],\n  displaySetSelectors: {\n    ctDisplaySet: {\n      seriesMatchingRules: [\n        {\n          attribute: 'Modality',\n          constraint: {\n            equals: {\n              value: 'CT',\n            },\n          },\n          required: true,\n        },\n        {\n          attribute: 'isReconstructable',\n          constraint: {\n            equals: {\n              value: true,\n            },\n          },\n          required: true,\n        },\n        {\n          attribute: 'SeriesDescription',\n          constraint: {\n            contains: 'CT',\n          },\n        },\n        {\n          attribute: 'SeriesDescription',\n          constraint: {\n            contains: 'CT WB',\n          },\n        },\n      ],\n    },\n    ptDisplaySet: {\n      seriesMatchingRules: [\n        {\n          attribute: 'Modality',\n          constraint: {\n            equals: 'PT',\n          },\n          required: true,\n        },\n        {\n          attribute: 'isReconstructable',\n          constraint: {\n            equals: {\n              value: true,\n            },\n          },\n          required: true,\n        },\n        {\n          attribute: 'SeriesDescription',\n          constraint: {\n            contains: 'Corrected',\n          },\n        },\n        {\n          weight: 2,\n          attribute: 'SeriesDescription',\n          constraint: {\n            doesNotContain: {\n              value: 'Uncorrected',\n            },\n          },\n        },\n      ],\n    },\n  },\n  stages: [stage1, stage2, stage3, stage4],\n  numberOfPriorsReferenced: -1,\n};\n\nfunction getHangingProtocolModule() {\n  return [\n    {\n      name: ptCT.id,\n      protocol: ptCT,\n    },\n  ];\n}\n\nexport default getHangingProtocolModule;\n","import React, { useEffect, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { PanelSection, Input, Button } from '@ohif/ui';\nimport { DicomMetadataStore } from '@ohif/core';\nimport { useTranslation } from 'react-i18next';\nimport { Separator } from '@ohif/ui-next';\n\nconst DEFAULT_MEATADATA = {\n  PatientWeight: null,\n  PatientSex: null,\n  SeriesTime: null,\n  RadiopharmaceuticalInformationSequence: {\n    RadionuclideTotalDose: null,\n    RadionuclideHalfLife: null,\n    RadiopharmaceuticalStartTime: null,\n  },\n};\n\n/*\n * PETSUV panel enables the user to modify the patient related information, such as\n * patient sex, patientWeight. This is allowed since\n * sometimes these metadata are missing or wrong. By changing them\n * @param param0\n * @returns\n */\nexport default function PanelPetSUV({ servicesManager, commandsManager }: withAppTypes) {\n  const { t } = useTranslation('PanelSUV');\n  const { displaySetService, toolGroupService, toolbarService, hangingProtocolService } =\n    servicesManager.services;\n  const [metadata, setMetadata] = useState(DEFAULT_MEATADATA);\n  const [ptDisplaySet, setPtDisplaySet] = useState(null);\n\n  const handleMetadataChange = metadata => {\n    setMetadata(prevState => {\n      const newState = { ...prevState };\n      Object.keys(metadata).forEach(key => {\n        if (typeof metadata[key] === 'object') {\n          newState[key] = {\n            ...prevState[key],\n            ...metadata[key],\n          };\n        } else {\n          newState[key] = metadata[key];\n        }\n      });\n      return newState;\n    });\n  };\n\n  const getMatchingPTDisplaySet = viewportMatchDetails => {\n    const ptDisplaySet = commandsManager.runCommand('getMatchingPTDisplaySet', {\n      viewportMatchDetails,\n    });\n\n    if (!ptDisplaySet) {\n      return;\n    }\n\n    const metadata = commandsManager.runCommand('getPTMetadata', {\n      ptDisplaySet,\n    });\n\n    return {\n      ptDisplaySet,\n      metadata,\n    };\n  };\n\n  useEffect(() => {\n    const displaySets = displaySetService.getActiveDisplaySets();\n    const { viewportMatchDetails } = hangingProtocolService.getMatchDetails();\n    if (!displaySets.length) {\n      return;\n    }\n\n    const displaySetInfo = getMatchingPTDisplaySet(viewportMatchDetails);\n\n    if (!displaySetInfo) {\n      return;\n    }\n\n    const { ptDisplaySet, metadata } = displaySetInfo;\n    setPtDisplaySet(ptDisplaySet);\n    setMetadata(metadata);\n  }, []);\n\n  // get the patientMetadata from the StudyInstanceUIDs and update the state\n  useEffect(() => {\n    const { unsubscribe } = hangingProtocolService.subscribe(\n      hangingProtocolService.EVENTS.PROTOCOL_CHANGED,\n      ({ viewportMatchDetails }) => {\n        const displaySetInfo = getMatchingPTDisplaySet(viewportMatchDetails);\n\n        if (!displaySetInfo) {\n          return;\n        }\n        const { ptDisplaySet, metadata } = displaySetInfo;\n        setPtDisplaySet(ptDisplaySet);\n        setMetadata(metadata);\n      }\n    );\n    return () => {\n      unsubscribe();\n    };\n  }, []);\n\n  function updateMetadata() {\n    if (!ptDisplaySet) {\n      throw new Error('No ptDisplaySet found');\n    }\n\n    // metadata should be dcmjs naturalized\n    DicomMetadataStore.updateMetadataForSeries(\n      ptDisplaySet.StudyInstanceUID,\n      ptDisplaySet.SeriesInstanceUID,\n      metadata\n    );\n\n    // update the displaySets\n    displaySetService.setDisplaySetMetadataInvalidated(ptDisplaySet.displaySetInstanceUID);\n\n    // Crosshair position depends on the metadata values such as the positioning interaction\n    // between series, so when the metadata is updated, the crosshairs need to be reset.\n    setTimeout(() => {\n      commandsManager.runCommand('resetCrosshairs');\n    }, 0);\n  }\n  return (\n    <>\n      <div className=\"ohif-scrollbar flex min-h-0 flex-auto select-none flex-col justify-between overflow-auto\">\n        <div className=\"flex min-h-0 flex-1 flex-col bg-black text-[13px] font-[300]\">\n          <PanelSection title={t('Patient Information')}>\n            <div className=\"flex flex-col\">\n              <div className=\"bg-primary-dark flex flex-col gap-4 p-2\">\n                <Input\n                  containerClassName={'!flex-row !justify-between items-center'}\n                  label={t('Patient Sex')}\n                  labelClassName=\"text-[13px] font-inter text-white\"\n                  className=\"!m-0 !h-[26px] !w-[117px]\"\n                  value={metadata.PatientSex || ''}\n                  onChange={e => {\n                    handleMetadataChange({\n                      PatientSex: e.target.value,\n                    });\n                  }}\n                />\n                <Input\n                  containerClassName={'!flex-row !justify-between items-center'}\n                  label={t('Weight')}\n                  labelChildren={<span className=\"text-aqua-pale\"> kg</span>}\n                  labelClassName=\"text-[13px] font-inter text-white\"\n                  className=\"!m-0 !h-[26px] !w-[117px]\"\n                  value={metadata.PatientWeight || ''}\n                  onChange={e => {\n                    handleMetadataChange({\n                      PatientWeight: e.target.value,\n                    });\n                  }}\n                  id=\"weight-input\"\n                />\n                <Input\n                  containerClassName={'!flex-row !justify-between items-center'}\n                  label={t('Total Dose')}\n                  labelChildren={<span className=\"text-aqua-pale\"> bq</span>}\n                  labelClassName=\"text-[13px] font-inter text-white\"\n                  className=\"!m-0 !h-[26px] !w-[117px]\"\n                  value={\n                    metadata.RadiopharmaceuticalInformationSequence.RadionuclideTotalDose || ''\n                  }\n                  onChange={e => {\n                    handleMetadataChange({\n                      RadiopharmaceuticalInformationSequence: {\n                        RadionuclideTotalDose: e.target.value,\n                      },\n                    });\n                  }}\n                />\n                <Input\n                  containerClassName={'!flex-row !justify-between items-center'}\n                  label={t('Half Life')}\n                  labelChildren={<span className=\"text-aqua-pale\"> s</span>}\n                  labelClassName=\"text-[13px] font-inter text-white\"\n                  className=\"!m-0 !h-[26px] !w-[117px]\"\n                  value={metadata.RadiopharmaceuticalInformationSequence.RadionuclideHalfLife || ''}\n                  onChange={e => {\n                    handleMetadataChange({\n                      RadiopharmaceuticalInformationSequence: {\n                        RadionuclideHalfLife: e.target.value,\n                      },\n                    });\n                  }}\n                />\n                <Input\n                  containerClassName={'!flex-row !justify-between items-center'}\n                  label={t('Injection Time')}\n                  labelChildren={<span className=\"text-aqua-pale\"> s</span>}\n                  labelClassName=\"text-[13px] font-inter text-white\"\n                  className=\"!m-0 !h-[26px] !w-[117px]\"\n                  value={\n                    metadata.RadiopharmaceuticalInformationSequence.RadiopharmaceuticalStartTime ||\n                    ''\n                  }\n                  onChange={e => {\n                    handleMetadataChange({\n                      RadiopharmaceuticalInformationSequence: {\n                        RadiopharmaceuticalStartTime: e.target.value,\n                      },\n                    });\n                  }}\n                />\n                <Input\n                  containerClassName={'!flex-row !justify-between items-center'}\n                  label={t('Acquisition Time')}\n                  labelChildren={<span className=\"text-aqua-pale\"> s</span>}\n                  labelClassName=\"text-[13px] font-inter text-white\"\n                  className=\"!m-0 !h-[26px] !w-[117px]\"\n                  value={metadata.SeriesTime || ''}\n                  onChange={() => {}}\n                />\n                <Button\n                  className=\"!h-[26px] !w-[115px] self-end !p-0\"\n                  onClick={updateMetadata}\n                >\n                  Reload Data\n                </Button>\n              </div>\n            </div>\n          </PanelSection>\n        </div>\n      </div>\n    </>\n  );\n}\n\nPanelPetSUV.propTypes = {\n  servicesManager: PropTypes.shape({\n    services: PropTypes.shape({\n      measurementService: PropTypes.shape({\n        getMeasurements: PropTypes.func.isRequired,\n        subscribe: PropTypes.func.isRequired,\n        EVENTS: PropTypes.object.isRequired,\n        VALUE_TYPES: PropTypes.object.isRequired,\n      }).isRequired,\n    }).isRequired,\n  }).isRequired,\n};\n","import { Segment, Segmentation } from '@cornerstonejs/tools/types';\nimport { triggerEvent, eventTarget, Enums } from '@cornerstonejs/core';\n\nexport const handleROIThresholding = async ({\n  segmentationId,\n  commandsManager,\n  segmentationService,\n}: withAppTypes<{\n  segmentationId: string;\n}>) => {\n  const segmentation = segmentationService.getSegmentation(segmentationId);\n\n  triggerEvent(eventTarget, Enums.Events.WEB_WORKER_PROGRESS, {\n    progress: 0,\n    type: 'Calculate Lesion Stats',\n    id: segmentationId,\n  });\n\n  // re-calculating the cached stats for the active segmentation\n  const updatedPerSegmentCachedStats = {};\n  for (const [segmentIndex, segment] of Object.entries(segmentation.segments)) {\n    if (!segment) {\n      continue;\n    }\n\n    const numericSegmentIndex = Number(segmentIndex);\n\n    const lesionStats = await commandsManager.run('getLesionStats', {\n      segmentationId,\n      segmentIndex: numericSegmentIndex,\n    });\n\n    const suvPeak = await commandsManager.run('calculateSuvPeak', {\n      segmentationId,\n      segmentIndex: numericSegmentIndex,\n    });\n\n    const lesionGlyoclysisStats = lesionStats.volume * lesionStats.meanValue;\n\n    // update segDetails with the suv peak for the active segmentation\n    const cachedStats = {\n      lesionStats,\n      suvPeak,\n      lesionGlyoclysisStats,\n    };\n\n    const updatedSegment: Segment = {\n      ...segment,\n      cachedStats: {\n        ...segment.cachedStats,\n        ...cachedStats,\n      },\n    };\n\n    updatedPerSegmentCachedStats[numericSegmentIndex] = cachedStats;\n\n    segmentation.segments[segmentIndex] = updatedSegment;\n  }\n\n  // all available segmentations\n  const segmentations = segmentationService.getSegmentations();\n  const tmtv = await commandsManager.run('calculateTMTV', { segmentations });\n\n  triggerEvent(eventTarget, Enums.Events.WEB_WORKER_PROGRESS, {\n    progress: 100,\n    type: 'Calculate Lesion Stats',\n    id: segmentationId,\n  });\n\n  // add the tmtv to all the segment cachedStats, although it is a global\n  // value but we don't have any other way to display it for now\n  // Update all segmentations with the calculated TMTV\n  segmentations.forEach(segmentation => {\n    segmentation.cachedStats = {\n      ...segmentation.cachedStats,\n      tmtv,\n    };\n\n    // Update each segment within the segmentation\n    Object.keys(segmentation.segments).forEach(segmentIndex => {\n      segmentation.segments[segmentIndex].cachedStats = {\n        ...segmentation.segments[segmentIndex].cachedStats,\n        tmtv,\n      };\n    });\n\n    // Update the segmentation object\n    const updatedSegmentation: Segmentation = {\n      ...segmentation,\n      segments: {\n        ...segmentation.segments,\n      },\n    };\n\n    segmentationService.addOrUpdateSegmentation(updatedSegmentation);\n  });\n};\n","import PanelROIThresholdExport from './PanelROIThresholdExport';\n\nexport default PanelROIThresholdExport;\n","import React, { useEffect } from 'react';\nimport { useActiveViewportSegmentationRepresentations } from '@ohif/extension-cornerstone';\nimport { handleROIThresholding } from '../../utils/handleROIThresholding';\nimport { debounce } from '@ohif/core/src/utils';\n\nexport default function PanelRoiThresholdSegmentation({\n  servicesManager,\n  commandsManager,\n}: withAppTypes) {\n  const { segmentationService } = servicesManager.services;\n  const { segmentationsWithRepresentations: segmentationsInfo } =\n    useActiveViewportSegmentationRepresentations({ servicesManager });\n\n  useEffect(() => {\n    const segmentationIds = segmentationsInfo.map(\n      segmentationInfo => segmentationInfo.segmentation.segmentationId\n    );\n\n    const initialRun = async () => {\n      for (const segmentationId of segmentationIds) {\n        await handleROIThresholding({\n          segmentationId,\n          commandsManager,\n          segmentationService,\n        });\n      }\n    };\n\n    initialRun();\n  }, []);\n\n  useEffect(() => {\n    const debouncedHandleROIThresholding = debounce(async eventDetail => {\n      const { segmentationId } = eventDetail;\n      await handleROIThresholding({\n        segmentationId,\n        commandsManager,\n        segmentationService,\n      });\n    }, 100);\n\n    const dataModifiedCallback = eventDetail => {\n      debouncedHandleROIThresholding(eventDetail);\n    };\n\n    const dataModifiedSubscription = segmentationService.subscribe(\n      segmentationService.EVENTS.SEGMENTATION_DATA_MODIFIED,\n      dataModifiedCallback\n    );\n\n    return () => {\n      dataModifiedSubscription.unsubscribe();\n    };\n  }, [commandsManager, segmentationService]);\n\n  // Find the first segmentation with a TMTV value since all of them have the same value\n  const tmtvSegmentation = segmentationsInfo.find(\n    info => info.segmentation.cachedStats?.tmtv !== undefined\n  );\n  const tmtvValue = tmtvSegmentation?.segmentation.cachedStats?.tmtv;\n\n  return (\n    <div className=\"mt-2 mb-10 flex flex-col\">\n      <div className=\"invisible-scrollbar overflow-y-auto overflow-x-hidden\">\n        {tmtvValue !== null && tmtvValue !== undefined ? (\n          <div className=\"bg-secondary-dark flex items-baseline justify-between px-2 py-1\">\n            <span className=\"text-base font-bold uppercase tracking-widest text-white\">\n              {'TMTV:'}\n            </span>\n            <div className=\"text-white\">{`${tmtvValue.toFixed(3)} mL`}</div>\n          </div>\n        ) : null}\n      </div>\n    </div>\n  );\n}\n","import React from 'react';\nimport {\n  PanelSegmentation,\n  useActiveViewportSegmentationRepresentations,\n} from '@ohif/extension-cornerstone';\nimport { Button, Icons } from '@ohif/ui-next';\n\nexport default function PanelTMTV({\n  servicesManager,\n  commandsManager,\n  extensionManager,\n  configuration,\n}: withAppTypes) {\n  return (\n    <>\n      <PanelSegmentation\n        servicesManager={servicesManager}\n        commandsManager={commandsManager}\n        extensionManager={extensionManager}\n        configuration={configuration}\n      >\n        <ExportCSV\n          servicesManager={servicesManager}\n          commandsManager={commandsManager}\n        />\n      </PanelSegmentation>\n    </>\n  );\n}\n\nconst ExportCSV = ({ servicesManager, commandsManager }: withAppTypes) => {\n  const { segmentationsWithRepresentations: representations } =\n    useActiveViewportSegmentationRepresentations({ servicesManager });\n\n  const tmtv = representations[0]?.segmentation.cachedStats?.tmtv;\n\n  const segmentations = representations.map(representation => representation.segmentation);\n\n  if (!segmentations.length) {\n    return null;\n  }\n\n  return (\n    <div className=\"flex h-8 w-full items-center rounded pr-0.5\">\n      <Button\n        size=\"sm\"\n        variant=\"ghost\"\n        className=\"pl-1.5\"\n        onClick={() => {\n          commandsManager.runCommand('exportTMTVReportCSV', {\n            segmentations,\n            tmtv,\n            config: {},\n          });\n        }}\n      >\n        <Icons.Download />\n        <span className=\"pl-1\">CSV</span>\n      </Button>\n    </div>\n  );\n};\n","import React from 'react';\nimport { PanelPetSUV, PanelROIThresholdExport } from './Panels';\nimport { Toolbox } from '@ohif/ui-next';\nimport PanelTMTV from './Panels/PanelTMTV';\n\nfunction getPanelModule({ commandsManager, extensionManager, servicesManager }) {\n  const wrappedPanelPetSuv = () => {\n    return (\n      <PanelPetSUV\n        commandsManager={commandsManager}\n        servicesManager={servicesManager}\n        extensionManager={extensionManager}\n      />\n    );\n  };\n\n  const wrappedROIThresholdToolbox = () => {\n    return (\n      <Toolbox\n        commandsManager={commandsManager}\n        servicesManager={servicesManager}\n        extensionManager={extensionManager}\n        buttonSectionId=\"ROIThresholdToolbox\"\n        title=\"Threshold Tools\"\n      />\n    );\n  };\n\n  const wrappedROIThresholdExport = () => {\n    return (\n      <PanelROIThresholdExport\n        commandsManager={commandsManager}\n        servicesManager={servicesManager}\n      />\n    );\n  };\n\n  const wrappedPanelTMTV = () => {\n    return (\n      <>\n        <Toolbox\n          commandsManager={commandsManager}\n          servicesManager={servicesManager}\n          extensionManager={extensionManager}\n          buttonSectionId=\"ROIThresholdToolbox\"\n          title=\"Threshold Tools\"\n        />\n        <PanelTMTV\n          commandsManager={commandsManager}\n          servicesManager={servicesManager}\n        />\n        <PanelROIThresholdExport\n          commandsManager={commandsManager}\n          servicesManager={servicesManager}\n        />\n      </>\n    );\n  };\n\n  return [\n    {\n      name: 'petSUV',\n      iconName: 'tab-patient-info',\n      iconLabel: 'Patient Info',\n      label: 'Patient Info',\n      component: wrappedPanelPetSuv,\n    },\n    {\n      name: 'tmtv',\n      iconName: 'tab-segmentation',\n      iconLabel: 'Segmentation',\n      component: wrappedPanelTMTV,\n    },\n    {\n      name: 'tmtvBox',\n      iconName: 'tab-segmentation',\n      iconLabel: 'Segmentation',\n      label: 'Segmentation Toolbox',\n      component: wrappedROIThresholdToolbox,\n    },\n    {\n      name: 'tmtvExport',\n      iconName: 'tab-segmentation',\n      iconLabel: 'Segmentation',\n      label: 'Segmentation Export',\n      component: wrappedROIThresholdExport,\n    },\n  ];\n}\n\nexport default getPanelModule;\n","export default ['RectangleROIStartEndThreshold'];\n","import SUPPORTED_TOOLS from './constants/supportedTools';\nimport { getSOPInstanceAttributes } from '@ohif/extension-cornerstone';\n\nconst RectangleROIStartEndThreshold = {\n  toAnnotation: (measurement, definition) => {},\n\n  /**\n   * Maps cornerstone annotation event data to measurement service format.\n   *\n   * @param {Object} cornerstone Cornerstone event data\n   * @return {Measurement} Measurement instance\n   */\n  toMeasurement: (csToolsEventDetail, displaySetService, cornerstoneViewportService) => {\n    const { annotation, viewportId } = csToolsEventDetail;\n    const { metadata, data, annotationUID } = annotation;\n\n    if (!metadata || !data) {\n      console.warn('Length tool: Missing metadata or data');\n      return null;\n    }\n\n    const { toolName, referencedImageId, FrameOfReferenceUID } = metadata;\n    const validToolType = SUPPORTED_TOOLS.includes(toolName);\n\n    if (!validToolType) {\n      throw new Error('Tool not supported');\n    }\n\n    const { SOPInstanceUID, SeriesInstanceUID, StudyInstanceUID } = getSOPInstanceAttributes(\n      referencedImageId,\n      cornerstoneViewportService,\n      viewportId\n    );\n\n    let displaySet;\n\n    if (SOPInstanceUID) {\n      displaySet = displaySetService.getDisplaySetForSOPInstanceUID(\n        SOPInstanceUID,\n        SeriesInstanceUID\n      );\n    } else {\n      displaySet = displaySetService.getDisplaySetsForSeries(SeriesInstanceUID);\n    }\n\n    return {\n      uid: annotationUID,\n      SOPInstanceUID,\n      FrameOfReferenceUID,\n      // points,\n      metadata,\n      referenceSeriesUID: SeriesInstanceUID,\n      referenceStudyUID: StudyInstanceUID,\n      toolName: metadata.toolName,\n      displaySetInstanceUID: displaySet.displaySetInstanceUID,\n      label: metadata.label,\n      data: data.cachedStats,\n      type: 'RectangleROIStartEndThreshold',\n    };\n  },\n};\n\nexport default RectangleROIStartEndThreshold;\n","import SUPPORTED_TOOLS from './constants/supportedTools';\nimport { getSOPInstanceAttributes } from '@ohif/extension-cornerstone';\n\nconst CircleROIStartEndThreshold = {\n  toAnnotation: (measurement, definition) => {},\n\n  /**\n   * Maps cornerstone annotation event data to measurement service format.\n   *\n   * @param {Object} cornerstone Cornerstone event data\n   * @return {Measurement} Measurement instance\n   */\n  toMeasurement: (csToolsEventDetail, displaySetService, cornerstoneViewportService) => {\n    const { annotation, viewportId } = csToolsEventDetail;\n    const { metadata, data, annotationUID } = annotation;\n\n    if (!metadata || !data) {\n      console.warn('Length tool: Missing metadata or data');\n      return null;\n    }\n\n    const { toolName, referencedImageId, FrameOfReferenceUID } = metadata;\n    const validToolType = SUPPORTED_TOOLS.includes(toolName);\n\n    if (!validToolType) {\n      throw new Error('Tool not supported');\n    }\n\n    const { SOPInstanceUID, SeriesInstanceUID, StudyInstanceUID } = getSOPInstanceAttributes(\n      referencedImageId,\n      cornerstoneViewportService,\n      viewportId\n    );\n\n    let displaySet;\n\n    if (SOPInstanceUID) {\n      displaySet = displaySetService.getDisplaySetForSOPInstanceUID(\n        SOPInstanceUID,\n        SeriesInstanceUID\n      );\n    } else {\n      displaySet = displaySetService.getDisplaySetsForSeries(SeriesInstanceUID);\n    }\n\n    const { cachedStats } = data;\n\n    return {\n      uid: annotationUID,\n      SOPInstanceUID,\n      FrameOfReferenceUID,\n      // points,\n      metadata,\n      referenceSeriesUID: SeriesInstanceUID,\n      referenceStudyUID: StudyInstanceUID,\n      toolName: metadata.toolName,\n      displaySetInstanceUID: displaySet.displaySetInstanceUID,\n      label: metadata.label,\n      // displayText: displayText,\n      data: data.cachedStats,\n      type: 'CircleROIStartEndThreshold',\n      // getReport,\n    };\n  },\n};\n\nexport default CircleROIStartEndThreshold;\n","import RectangleROIStartEndThreshold from './RectangleROIStartEndThreshold';\nimport CircleROIStartEndThreshold from './CircleROIStartEndThreshold';\n\nconst measurementServiceMappingsFactory = (\n  measurementService,\n  displaySetService,\n  cornerstoneViewportService\n) => {\n  return {\n    RectangleROIStartEndThreshold: {\n      toAnnotation: RectangleROIStartEndThreshold.toAnnotation,\n      toMeasurement: csToolsAnnotation =>\n        RectangleROIStartEndThreshold.toMeasurement(\n          csToolsAnnotation,\n          displaySetService,\n          cornerstoneViewportService\n        ),\n      matchingCriteria: [\n        {\n          valueType: measurementService.VALUE_TYPES.ROI_THRESHOLD_MANUAL,\n        },\n      ],\n    },\n    CircleROIStartEndThreshold: {\n      toAnnotation: CircleROIStartEndThreshold.toAnnotation,\n      toMeasurement: csToolsAnnotation =>\n        CircleROIStartEndThreshold.toMeasurement(\n          csToolsAnnotation,\n          displaySetService,\n          cornerstoneViewportService\n        ),\n      matchingCriteria: [\n        {\n          valueType: measurementService.VALUE_TYPES.ROI_THRESHOLD_MANUAL,\n        },\n      ],\n    },\n  };\n};\n\nexport default measurementServiceMappingsFactory;\n","import {\n  addTool,\n  RectangleROIStartEndThresholdTool,\n  CircleROIStartEndThresholdTool,\n} from '@cornerstonejs/tools';\nimport { Enums as CSExtensionEnums } from '@ohif/extension-cornerstone';\n\nimport measurementServiceMappingsFactory from './utils/measurementServiceMappings/measurementServiceMappingsFactory';\n\nconst { CORNERSTONE_3D_TOOLS_SOURCE_NAME, CORNERSTONE_3D_TOOLS_SOURCE_VERSION } = CSExtensionEnums;\n\n/**\n *\n * @param {Object} servicesManager\n * @param {Object} configuration\n * @param {Object|Array} configuration.csToolsConfig\n */\nexport default function init({ servicesManager }) {\n  const { measurementService, displaySetService, cornerstoneViewportService } =\n    servicesManager.services;\n\n  addTool(RectangleROIStartEndThresholdTool);\n  addTool(CircleROIStartEndThresholdTool);\n\n  const { RectangleROIStartEndThreshold, CircleROIStartEndThreshold } =\n    measurementServiceMappingsFactory(\n      measurementService,\n      displaySetService,\n      cornerstoneViewportService\n    );\n\n  const csTools3DVer1MeasurementSource = measurementService.getSource(\n    CORNERSTONE_3D_TOOLS_SOURCE_NAME,\n    CORNERSTONE_3D_TOOLS_SOURCE_VERSION\n  );\n\n  measurementService.addMapping(\n    csTools3DVer1MeasurementSource,\n    'RectangleROIStartEndThreshold',\n    RectangleROIStartEndThreshold.matchingCriteria,\n    RectangleROIStartEndThreshold.toAnnotation,\n    RectangleROIStartEndThreshold.toMeasurement\n  );\n\n  measurementService.addMapping(\n    csTools3DVer1MeasurementSource,\n    'CircleROIStartEndThreshold',\n    CircleROIStartEndThreshold.matchingCriteria,\n    CircleROIStartEndThreshold.toAnnotation,\n    CircleROIStartEndThreshold.toMeasurement\n  );\n}\n","import * as csTools from '@cornerstonejs/tools';\n\nfunction getRoiStats(referencedVolume, annotations) {\n  // roiStats\n  const { imageData } = referencedVolume;\n  const values = imageData.getPointData().getScalars().getData();\n\n  // Todo: add support for other strategies\n  const { fn, baseValue } = _getStrategyFn('max');\n  let value = baseValue;\n\n  const boundsIJK = csTools.utilities.rectangleROITool.getBoundsIJKFromRectangleAnnotations(\n    annotations,\n    referencedVolume\n  );\n\n  const [[iMin, iMax], [jMin, jMax], [kMin, kMax]] = boundsIJK;\n\n  for (let i = iMin; i <= iMax; i++) {\n    for (let j = jMin; j <= jMax; j++) {\n      for (let k = kMin; k <= kMax; k++) {\n        const offset = imageData.computeOffsetIndex([i, j, k]);\n        value = fn(values[offset], value);\n      }\n    }\n  }\n  return value;\n}\n\nfunction getThresholdValues(\n  annotationUIDs,\n  referencedVolumes,\n  config\n): { ptLower: number; ptUpper: number; ctLower: number; ctUpper: number } {\n  if (config.strategy === 'range') {\n    return {\n      ptLower: Number(config.ptLower),\n      ptUpper: Number(config.ptUpper),\n      ctLower: Number(config.ctLower),\n      ctUpper: Number(config.ctUpper),\n    };\n  }\n\n  const { weight } = config;\n  const annotations = annotationUIDs.map(annotationUID =>\n    csTools.annotation.state.getAnnotation(annotationUID)\n  );\n\n  const ptValue = getRoiStats(referencedVolumes[0], annotations);\n\n  return {\n    ctLower: -Infinity,\n    ctUpper: +Infinity,\n    ptLower: weight * ptValue,\n    ptUpper: +Infinity,\n  };\n}\n\nfunction _getStrategyFn(statistic): {\n  fn: (a: number, b: number) => number;\n  baseValue: number;\n} {\n  const baseValue = -Infinity;\n  const fn = (number, maxValue) => {\n    if (number > maxValue) {\n      maxValue = number;\n    }\n    return maxValue;\n  };\n  return { fn, baseValue };\n}\n\nexport default getThresholdValues;\n","import dcmjs from 'dcmjs';\nimport { classes, DicomMetadataStore } from '@ohif/core';\nimport { adaptersRT } from '@cornerstonejs/adapters';\n\nconst { datasetToBlob } = dcmjs.data;\nconst metadataProvider = classes.MetadataProvider;\n\nexport default function dicomRTAnnotationExport(annotations) {\n  const dataset = adaptersRT.Cornerstone3D.RTSS.generateRTSSFromAnnotations(\n    annotations,\n    metadataProvider,\n    DicomMetadataStore\n  );\n  const reportBlob = datasetToBlob(dataset);\n\n  //Create a URL for the binary.\n  var objectUrl = URL.createObjectURL(reportBlob);\n  window.location.assign(objectUrl);\n}\n","import dicomRTAnnotationExport from './dicomRTAnnotationExport';\n\nexport default dicomRTAnnotationExport;\n","import OHIF from '@ohif/core';\nimport * as cs from '@cornerstonejs/core';\nimport * as csTools from '@cornerstonejs/tools';\nimport { classes } from '@ohif/core';\nimport getThresholdValues from './utils/getThresholdValue';\nimport createAndDownloadTMTVReport from './utils/createAndDownloadTMTVReport';\n\nimport dicomRTAnnotationExport from './utils/dicomRTAnnotationExport/RTStructureSet';\n\nimport { getWebWorkerManager } from '@cornerstonejs/core';\nimport { Enums } from '@cornerstonejs/tools';\n\nconst { SegmentationRepresentations } = Enums;\n\nconst metadataProvider = classes.MetadataProvider;\nconst ROI_THRESHOLD_MANUAL_TOOL_IDS = [\n  'RectangleROIStartEndThreshold',\n  'RectangleROIThreshold',\n  'CircleROIStartEndThreshold',\n];\n\nconst workerManager = getWebWorkerManager();\n\nconst options = {\n  maxWorkerInstances: 1,\n  autoTerminateOnIdle: {\n    enabled: true,\n    idleTimeThreshold: 3000,\n  },\n};\n\n// Register the task\nconst workerFn = () => {\n  return new Worker(new URL('./utils/calculateSUVPeakWorker.js', import.meta.url), {\n    name: 'suv-peak-worker', // name used by the browser to name the worker\n  });\n};\n\nfunction getVolumesFromSegmentation(segmentationId) {\n  const csSegmentation = csTools.segmentation.state.getSegmentation(segmentationId);\n  const labelmapData = csSegmentation.representationData[\n    SegmentationRepresentations.Labelmap\n  ] as csTools.Types.LabelmapToolOperationDataVolume;\n\n  const { volumeId, referencedVolumeId } = labelmapData;\n  const labelmapVolume = cs.cache.getVolume(volumeId);\n  const referencedVolume = cs.cache.getVolume(referencedVolumeId);\n\n  return { labelmapVolume, referencedVolume };\n}\n\nfunction getLabelmapVolumeFromSegmentation(segmentation) {\n  const { representationData } = segmentation;\n  const { volumeId } = representationData[\n    SegmentationRepresentations.Labelmap\n  ] as csTools.Types.LabelmapToolOperationDataVolume;\n\n  return cs.cache.getVolume(volumeId);\n}\n\nconst commandsModule = ({ servicesManager, commandsManager, extensionManager }: withAppTypes) => {\n  const {\n    viewportGridService,\n    uiNotificationService,\n    displaySetService,\n    hangingProtocolService,\n    toolGroupService,\n    cornerstoneViewportService,\n    segmentationService,\n  } = servicesManager.services;\n\n  const utilityModule = extensionManager.getModuleEntry(\n    '@ohif/extension-cornerstone.utilityModule.common'\n  );\n\n  const { getEnabledElement } = utilityModule.exports;\n\n  function _getActiveViewportsEnabledElement() {\n    const { activeViewportId } = viewportGridService.getState();\n    const { element } = getEnabledElement(activeViewportId) || {};\n    const enabledElement = cs.getEnabledElement(element);\n    return enabledElement;\n  }\n\n  function _getAnnotationsSelectedByToolNames(toolNames) {\n    return toolNames.reduce((allAnnotationUIDs, toolName) => {\n      const annotationUIDs =\n        csTools.annotation.selection.getAnnotationsSelectedByToolName(toolName);\n\n      return allAnnotationUIDs.concat(annotationUIDs);\n    }, []);\n  }\n\n  const actions = {\n    getMatchingPTDisplaySet: ({ viewportMatchDetails }) => {\n      // Todo: this is assuming that the hanging protocol has successfully matched\n      // the correct PT. For future, we should have a way to filter out the PTs\n      // that are in the viewer layout (but then we have the problem of the attenuation\n      // corrected PT vs the non-attenuation correct PT)\n\n      let ptDisplaySet = null;\n      for (const [viewportId, viewportDetails] of viewportMatchDetails) {\n        const { displaySetsInfo } = viewportDetails;\n        const displaySets = displaySetsInfo.map(({ displaySetInstanceUID }) =>\n          displaySetService.getDisplaySetByUID(displaySetInstanceUID)\n        );\n\n        if (!displaySets || displaySets.length === 0) {\n          continue;\n        }\n\n        ptDisplaySet = displaySets.find(displaySet => displaySet.Modality === 'PT');\n        if (ptDisplaySet) {\n          break;\n        }\n      }\n\n      return ptDisplaySet;\n    },\n    getPTMetadata: ({ ptDisplaySet }) => {\n      const dataSource = extensionManager.getDataSources()[0];\n      const imageIds = dataSource.getImageIdsForDisplaySet(ptDisplaySet);\n\n      const firstImageId = imageIds[0];\n      const instance = metadataProvider.get('instance', firstImageId);\n      if (instance.Modality !== 'PT') {\n        return;\n      }\n\n      const metadata = {\n        SeriesTime: instance.SeriesTime,\n        Modality: instance.Modality,\n        PatientSex: instance.PatientSex,\n        PatientWeight: instance.PatientWeight,\n        RadiopharmaceuticalInformationSequence: {\n          RadionuclideTotalDose:\n            instance.RadiopharmaceuticalInformationSequence[0].RadionuclideTotalDose,\n          RadionuclideHalfLife:\n            instance.RadiopharmaceuticalInformationSequence[0].RadionuclideHalfLife,\n          RadiopharmaceuticalStartTime:\n            instance.RadiopharmaceuticalInformationSequence[0].RadiopharmaceuticalStartTime,\n          RadiopharmaceuticalStartDateTime:\n            instance.RadiopharmaceuticalInformationSequence[0].RadiopharmaceuticalStartDateTime,\n        },\n      };\n\n      return metadata;\n    },\n    createNewLabelmapFromPT: async ({ label }) => {\n      // Create a segmentation of the same resolution as the source data\n      // using volumeLoader.createAndCacheDerivedVolume.\n\n      const { viewportMatchDetails } = hangingProtocolService.getMatchDetails();\n\n      const ptDisplaySet = actions.getMatchingPTDisplaySet({\n        viewportMatchDetails,\n      });\n\n      let withPTViewportId = null;\n\n      for (const [viewportId, { displaySetsInfo }] of viewportMatchDetails.entries()) {\n        const isPT = displaySetsInfo.some(\n          ({ displaySetInstanceUID }) =>\n            displaySetInstanceUID === ptDisplaySet.displaySetInstanceUID\n        );\n\n        if (isPT) {\n          withPTViewportId = viewportId;\n          break;\n        }\n      }\n\n      if (!ptDisplaySet) {\n        uiNotificationService.error('No matching PT display set found');\n        return;\n      }\n\n      const currentSegmentations =\n        segmentationService.getSegmentationRepresentations(withPTViewportId);\n\n      const displaySet = displaySetService.getDisplaySetByUID(ptDisplaySet.displaySetInstanceUID);\n\n      const segmentationId = await segmentationService.createLabelmapForDisplaySet(displaySet, {\n        label: `Segmentation ${currentSegmentations.length + 1}`,\n        segments: { 1: { label: 'Segment 1', active: true } },\n      });\n\n      segmentationService.addSegmentationRepresentation(withPTViewportId, {\n        segmentationId,\n      });\n\n      return segmentationId;\n    },\n    thresholdSegmentationByRectangleROITool: ({ segmentationId, config, segmentIndex }) => {\n      const segmentation = csTools.segmentation.state.getSegmentation(segmentationId);\n\n      const { representationData } = segmentation;\n      const { displaySetMatchDetails: matchDetails } = hangingProtocolService.getMatchDetails();\n      const volumeLoaderScheme = 'cornerstoneStreamingImageVolume'; // Loader id which defines which volume loader to use\n\n      const ctDisplaySet = matchDetails.get('ctDisplaySet');\n      const ctVolumeId = `${volumeLoaderScheme}:${ctDisplaySet.displaySetInstanceUID}`; // VolumeId with loader id + volume id\n\n      const { volumeId: segVolumeId } = representationData[\n        SegmentationRepresentations.Labelmap\n      ] as csTools.Types.LabelmapToolOperationDataVolume;\n      const { referencedVolumeId } = cs.cache.getVolume(segVolumeId);\n\n      const annotationUIDs = _getAnnotationsSelectedByToolNames(ROI_THRESHOLD_MANUAL_TOOL_IDS);\n\n      if (annotationUIDs.length === 0) {\n        uiNotificationService.show({\n          title: 'Commands Module',\n          message: 'No ROIThreshold Tool is Selected',\n          type: 'error',\n        });\n        return;\n      }\n\n      const labelmapVolume = cs.cache.getVolume(segmentationId);\n      let referencedVolume = cs.cache.getVolume(referencedVolumeId);\n      const ctReferencedVolume = cs.cache.getVolume(ctVolumeId);\n\n      // check if viewport is\n\n      if (!referencedVolume) {\n        throw new Error('No Reference volume found');\n      }\n\n      if (!labelmapVolume) {\n        throw new Error('No Reference labelmap found');\n      }\n\n      const annotation = csTools.annotation.state.getAnnotation(annotationUIDs[0]);\n\n      const {\n        metadata: {\n          enabledElement: { viewport },\n        },\n      } = annotation;\n\n      const showingReferenceVolume = viewport.hasVolumeId(referencedVolumeId);\n\n      if (!showingReferenceVolume) {\n        // if the reference volume is not being displayed, we can't\n        // rely on it for thresholding, we have couple of options here\n        // 1. We choose whatever volume is being displayed\n        // 2. We check if it is a fusion viewport, we pick the volume\n        // that matches the size and dimensions of the labelmap. This might\n        // happen if the 4D PT is converted to a computed volume and displayed\n        // and wants to threshold the labelmap\n        // 3. We throw an error\n        const displaySetInstanceUIDs = viewportGridService.getDisplaySetsUIDsForViewport(\n          viewport.id\n        );\n\n        displaySetInstanceUIDs.forEach(displaySetInstanceUID => {\n          const volume = cs.cache\n            .getVolumes()\n            .find(volume => volume.volumeId.includes(displaySetInstanceUID));\n\n          if (\n            cs.utilities.isEqual(volume.dimensions, labelmapVolume.dimensions) &&\n            cs.utilities.isEqual(volume.spacing, labelmapVolume.spacing)\n          ) {\n            referencedVolume = volume;\n          }\n        });\n      }\n\n      const { ptLower, ptUpper, ctLower, ctUpper } = getThresholdValues(\n        annotationUIDs,\n        [referencedVolume, ctReferencedVolume],\n        config\n      );\n\n      return csTools.utilities.segmentation.rectangleROIThresholdVolumeByRange(\n        annotationUIDs,\n        labelmapVolume,\n        [\n          { volume: referencedVolume, lower: ptLower, upper: ptUpper },\n          { volume: ctReferencedVolume, lower: ctLower, upper: ctUpper },\n        ],\n        { overwrite: true, segmentIndex }\n      );\n    },\n    calculateSuvPeak: async ({ segmentationId, segmentIndex }) => {\n      const segmentation = segmentationService.getSegmentation(segmentationId);\n\n      const { representationData } = segmentation;\n      const { volumeId, referencedVolumeId } = representationData[\n        SegmentationRepresentations.Labelmap\n      ] as csTools.Types.LabelmapToolOperationDataVolume;\n\n      const labelmap = cs.cache.getVolume(volumeId);\n      const referencedVolume = cs.cache.getVolume(referencedVolumeId);\n\n      // if we put it in the top, it will appear in other modes\n      workerManager.registerWorker('suv-peak-worker', workerFn, options);\n\n      const annotationUIDs = _getAnnotationsSelectedByToolNames(ROI_THRESHOLD_MANUAL_TOOL_IDS);\n\n      const annotations = annotationUIDs.map(annotationUID =>\n        csTools.annotation.state.getAnnotation(annotationUID)\n      );\n\n      const labelmapProps = {\n        dimensions: labelmap.dimensions,\n        origin: labelmap.origin,\n        direction: labelmap.direction,\n        spacing: labelmap.spacing,\n        metadata: labelmap.metadata,\n        scalarData: labelmap.voxelManager.getCompleteScalarDataArray(),\n      };\n\n      const referenceVolumeProps = {\n        dimensions: referencedVolume.dimensions,\n        origin: referencedVolume.origin,\n        direction: referencedVolume.direction,\n        spacing: referencedVolume.spacing,\n        metadata: referencedVolume.metadata,\n        scalarData: referencedVolume.voxelManager.getCompleteScalarDataArray(),\n      };\n\n      // metadata in annotations has enabledElement which is not serializable\n      // we need to remove it\n      // Todo: we should probably have a sanitization function for this\n      const annotationsToSend = annotations.map(annotation => {\n        return {\n          ...annotation,\n          metadata: {\n            ...annotation.metadata,\n            enabledElement: {\n              ...annotation.metadata.enabledElement,\n              viewport: null,\n              renderingEngine: null,\n              element: null,\n            },\n          },\n        };\n      });\n\n      const suvPeak =\n        (await workerManager.executeTask('suv-peak-worker', 'calculateSuvPeak', {\n          labelmapProps,\n          referenceVolumeProps,\n          annotations: annotationsToSend,\n          segmentIndex,\n        })) || {};\n\n      return {\n        suvPeak: suvPeak.mean,\n        suvMax: suvPeak.max,\n        suvMaxIJK: suvPeak.maxIJK,\n        suvMaxLPS: suvPeak.maxLPS,\n      };\n    },\n    getLesionStats: ({ segmentationId, segmentIndex = 1 }) => {\n      const { labelmapVolume, referencedVolume } = getVolumesFromSegmentation(segmentationId);\n      const { voxelManager: segVoxelManager, imageData, spacing } = labelmapVolume;\n      const { voxelManager: refVoxelManager } = referencedVolume;\n\n      let segmentationMax = -Infinity;\n      let segmentationMin = Infinity;\n      const segmentationValues = [];\n      let voxelCount = 0;\n\n      const callback = ({ value, index }) => {\n        if (value === segmentIndex) {\n          const refValue = refVoxelManager.getAtIndex(index) as number;\n          segmentationValues.push(refValue);\n          if (refValue > segmentationMax) {\n            segmentationMax = refValue;\n          }\n          if (refValue < segmentationMin) {\n            segmentationMin = refValue;\n          }\n          voxelCount++;\n        }\n      };\n\n      segVoxelManager.forEach(callback, { imageData });\n      const mean = segmentationValues.reduce((a, b) => a + b, 0) / voxelCount;\n      const stats = {\n        minValue: segmentationMin,\n        maxValue: segmentationMax,\n        meanValue: mean,\n        stdValue: Math.sqrt(\n          segmentationValues.map(k => (k - mean) ** 2).reduce((acc, curr) => acc + curr, 0) /\n            voxelCount\n        ),\n        volume: voxelCount * spacing[0] * spacing[1] * spacing[2] * 1e-3,\n      };\n\n      return stats;\n    },\n    calculateLesionGlycolysis: ({ lesionStats }) => {\n      const { meanValue, volume } = lesionStats;\n\n      return {\n        lesionGlyoclysisStats: volume * meanValue,\n      };\n    },\n    calculateTMTV: async ({ segmentations }) => {\n      const labelmapProps = segmentations.map(segmentation => {\n        const labelmap = getLabelmapVolumeFromSegmentation(segmentation);\n        return {\n          dimensions: labelmap.dimensions,\n          spacing: labelmap.spacing,\n          scalarData: labelmap.voxelManager.getCompleteScalarDataArray(),\n          origin: labelmap.origin,\n          direction: labelmap.direction,\n        };\n      });\n\n      if (!labelmapProps.length) {\n        return;\n      }\n\n      return await workerManager.executeTask('suv-peak-worker', 'calculateTMTV', labelmapProps);\n    },\n    exportTMTVReportCSV: async ({ segmentations, tmtv, config, options }) => {\n      const segReport = commandsManager.runCommand('getSegmentationCSVReport', {\n        segmentations,\n      });\n\n      const tlg = await actions.getTotalLesionGlycolysis({ segmentations });\n      const additionalReportRows = [\n        { key: 'Total Lesion Glycolysis', value: { tlg: tlg.toFixed(4) } },\n        { key: 'Threshold Configuration', value: { ...config } },\n      ];\n\n      if (tmtv !== undefined) {\n        additionalReportRows.unshift({\n          key: 'Total Metabolic Tumor Volume',\n          value: { tmtv },\n        });\n      }\n\n      createAndDownloadTMTVReport(segReport, additionalReportRows, options);\n    },\n    getTotalLesionGlycolysis: async ({ segmentations }) => {\n      const labelmapProps = segmentations.map(segmentation => {\n        const labelmap = getLabelmapVolumeFromSegmentation(segmentation);\n        return {\n          dimensions: labelmap.dimensions,\n          spacing: labelmap.spacing,\n          scalarData: labelmap.voxelManager.getCompleteScalarDataArray(),\n          origin: labelmap.origin,\n          direction: labelmap.direction,\n        };\n      });\n\n      const { referencedVolume: ptVolume } = getVolumesFromSegmentation(\n        segmentations[0].segmentationId\n      );\n\n      const ptVolumeProps = {\n        dimensions: ptVolume.dimensions,\n        spacing: ptVolume.spacing,\n        scalarData: ptVolume.voxelManager.getCompleteScalarDataArray(),\n        origin: ptVolume.origin,\n        direction: ptVolume.direction,\n      };\n\n      return await workerManager.executeTask('suv-peak-worker', 'getTotalLesionGlycolysis', {\n        labelmapProps,\n        referenceVolumeProps: ptVolumeProps,\n      });\n    },\n    setStartSliceForROIThresholdTool: () => {\n      const { viewport } = _getActiveViewportsEnabledElement();\n      const { focalPoint } = viewport.getCamera();\n\n      const selectedAnnotationUIDs = _getAnnotationsSelectedByToolNames(\n        ROI_THRESHOLD_MANUAL_TOOL_IDS\n      );\n\n      const annotationUID = selectedAnnotationUIDs[0];\n\n      const annotation = csTools.annotation.state.getAnnotation(annotationUID);\n\n      // set the current focal point\n      annotation.data.startCoordinate = focalPoint;\n      // IMPORTANT: invalidate the toolData for the cached stat to get updated\n      // and re-calculate the projection points\n      annotation.invalidated = true;\n      viewport.render();\n    },\n    setEndSliceForROIThresholdTool: () => {\n      const { viewport } = _getActiveViewportsEnabledElement();\n\n      const selectedAnnotationUIDs = _getAnnotationsSelectedByToolNames(\n        ROI_THRESHOLD_MANUAL_TOOL_IDS\n      );\n\n      const annotationUID = selectedAnnotationUIDs[0];\n\n      const annotation = csTools.annotation.state.getAnnotation(annotationUID);\n\n      // get the current focal point\n      const focalPointToEnd = viewport.getCamera().focalPoint;\n      annotation.data.endCoordinate = focalPointToEnd;\n\n      // IMPORTANT: invalidate the toolData for the cached stat to get updated\n      // and re-calculate the projection points\n      annotation.invalidated = true;\n\n      viewport.render();\n    },\n    createTMTVRTReport: () => {\n      // get all Rectangle ROI annotation\n      const stateManager = csTools.annotation.state.getAnnotationManager();\n\n      const annotations = [];\n\n      Object.keys(stateManager.annotations).forEach(frameOfReferenceUID => {\n        const forAnnotations = stateManager.annotations[frameOfReferenceUID];\n        const ROIAnnotations = ROI_THRESHOLD_MANUAL_TOOL_IDS.reduce(\n          (annotations, toolName) => [...annotations, ...(forAnnotations[toolName] ?? [])],\n          []\n        );\n\n        annotations.push(...ROIAnnotations);\n      });\n\n      commandsManager.runCommand('exportRTReportForAnnotations', {\n        annotations,\n      });\n    },\n    getSegmentationCSVReport: ({ segmentations }) => {\n      if (!segmentations || !segmentations.length) {\n        segmentations = segmentationService.getSegmentations();\n      }\n\n      const report = {};\n\n      for (const segmentation of segmentations) {\n        const { label, segmentationId, representationData } =\n          segmentation as csTools.Types.Segmentation;\n        const id = segmentationId;\n\n        const segReport = { id, label };\n\n        if (!representationData) {\n          report[id] = segReport;\n          continue;\n        }\n\n        const { cachedStats } = segmentation.segments[1] || {}; // Assuming we want stats from the first segment\n\n        if (cachedStats) {\n          Object.entries(cachedStats).forEach(([key, value]) => {\n            if (typeof value !== 'object') {\n              segReport[key] = value;\n            } else {\n              Object.entries(value).forEach(([subKey, subValue]) => {\n                const newKey = `${key}_${subKey}`;\n                segReport[newKey] = subValue;\n              });\n            }\n          });\n        }\n\n        const labelmapVolume =\n          segmentation.representationData[SegmentationRepresentations.Labelmap];\n\n        if (!labelmapVolume) {\n          report[id] = segReport;\n          continue;\n        }\n\n        const referencedVolumeId = labelmapVolume.referencedVolumeId;\n\n        const referencedVolume = cs.cache.getVolume(referencedVolumeId);\n\n        if (!referencedVolume) {\n          report[id] = segReport;\n          continue;\n        }\n\n        if (!referencedVolume.imageIds || !referencedVolume.imageIds.length) {\n          report[id] = segReport;\n          continue;\n        }\n\n        const firstImageId = referencedVolume.imageIds[0];\n        const instance = OHIF.classes.MetadataProvider.get('instance', firstImageId);\n\n        if (!instance) {\n          report[id] = segReport;\n          continue;\n        }\n\n        report[id] = {\n          ...segReport,\n          PatientID: instance.PatientID ?? '000000',\n          PatientName: instance.PatientName.Alphabetic,\n          StudyInstanceUID: instance.StudyInstanceUID,\n          SeriesInstanceUID: instance.SeriesInstanceUID,\n          StudyDate: instance.StudyDate,\n        };\n      }\n\n      return report;\n    },\n    exportRTReportForAnnotations: ({ annotations }) => {\n      dicomRTAnnotationExport(annotations);\n    },\n    setFusionPTColormap: ({ toolGroupId, colormap }) => {\n      const toolGroup = toolGroupService.getToolGroup(toolGroupId);\n\n      if (!toolGroup) {\n        return;\n      }\n\n      const { viewportMatchDetails } = hangingProtocolService.getMatchDetails();\n\n      const ptDisplaySet = actions.getMatchingPTDisplaySet({\n        viewportMatchDetails,\n      });\n\n      if (!ptDisplaySet) {\n        return;\n      }\n\n      const fusionViewportIds = toolGroup.getViewportIds();\n\n      const viewports = [];\n      fusionViewportIds.forEach(viewportId => {\n        commandsManager.runCommand('setViewportColormap', {\n          viewportId,\n          displaySetInstanceUID: ptDisplaySet.displaySetInstanceUID,\n          colormap: {\n            name: colormap,\n          },\n        });\n\n        viewports.push(cornerstoneViewportService.getCornerstoneViewport(viewportId));\n      });\n\n      viewports.forEach(viewport => {\n        viewport.render();\n      });\n    },\n  };\n\n  const definitions = {\n    setEndSliceForROIThresholdTool: {\n      commandFn: actions.setEndSliceForROIThresholdTool,\n    },\n    setStartSliceForROIThresholdTool: {\n      commandFn: actions.setStartSliceForROIThresholdTool,\n    },\n    getMatchingPTDisplaySet: {\n      commandFn: actions.getMatchingPTDisplaySet,\n    },\n    getPTMetadata: {\n      commandFn: actions.getPTMetadata,\n    },\n    createNewLabelmapFromPT: {\n      commandFn: actions.createNewLabelmapFromPT,\n    },\n    thresholdSegmentationByRectangleROITool: {\n      commandFn: actions.thresholdSegmentationByRectangleROITool,\n    },\n    getTotalLesionGlycolysis: {\n      commandFn: actions.getTotalLesionGlycolysis,\n    },\n    calculateSuvPeak: {\n      commandFn: actions.calculateSuvPeak,\n    },\n    getLesionStats: {\n      commandFn: actions.getLesionStats,\n    },\n    calculateTMTV: {\n      commandFn: actions.calculateTMTV,\n    },\n    exportTMTVReportCSV: {\n      commandFn: actions.exportTMTVReportCSV,\n    },\n    createTMTVRTReport: {\n      commandFn: actions.createTMTVRTReport,\n    },\n    getSegmentationCSVReport: {\n      commandFn: actions.getSegmentationCSVReport,\n    },\n    exportRTReportForAnnotations: {\n      commandFn: actions.exportRTReportForAnnotations,\n    },\n    setFusionPTColormap: {\n      commandFn: actions.setFusionPTColormap,\n    },\n  };\n\n  return {\n    actions,\n    definitions,\n    defaultContext: 'TMTV:CORNERSTONE',\n  };\n};\n\nexport default commandsModule;\n","export default function createAndDownloadTMTVReport(segReport, additionalReportRows, options = {}) {\n  const firstReport = segReport[Object.keys(segReport)[0]];\n  const columns = Object.keys(firstReport);\n  const csv = [columns.join(',')];\n\n  Object.values(segReport).forEach(segmentation => {\n    const row = [];\n    columns.forEach(column => {\n      // if it is array then we need to replace , with space to avoid csv parsing error\n      row.push(\n        Array.isArray(segmentation[column]) ? segmentation[column].join(' ') : segmentation[column]\n      );\n    });\n    csv.push(row.join(','));\n  });\n\n  csv.push('');\n  csv.push('');\n  csv.push('');\n\n  csv.push(`Patient ID,${firstReport.PatientID}`);\n  csv.push(`Study Date,${firstReport.StudyDate}`);\n  csv.push('');\n  additionalReportRows.forEach(({ key, value: values }) => {\n    const temp = [];\n    temp.push(`${key}`);\n    Object.keys(values).forEach(k => {\n      temp.push(`${k}`);\n      temp.push(`${values[k]}`);\n    });\n\n    csv.push(temp.join(','));\n  });\n\n  const blob = new Blob([csv.join('\\n')], {\n    type: 'text/csv;charset=utf-8',\n  });\n\n  const url = URL.createObjectURL(blob);\n\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = options.filename ?? `${firstReport.PatientID}_tmtv.csv`;\n  a.click();\n}\n","import React from 'react';\nimport { Input, Label, Select, LegacyButton, LegacyButtonGroup } from '@ohif/ui';\nimport { useTranslation } from 'react-i18next';\n\nexport const ROI_STAT = 'roi_stat';\nconst RANGE = 'range';\n\nconst options = [\n  { value: ROI_STAT, label: 'Max', placeHolder: 'Max' },\n  { value: RANGE, label: 'Range', placeHolder: 'Range' },\n];\n\nfunction ROIThresholdConfiguration({ config, dispatch, runCommand }) {\n  const { t } = useTranslation('ROIThresholdConfiguration');\n\n  return (\n    <div className=\"bg-primary-dark flex flex-col space-y-4\">\n      <div className=\"flex items-end space-x-2\">\n        <div className=\"flex w-1/2 flex-col\">\n          <Select\n            label={t('Strategy')}\n            closeMenuOnSelect={true}\n            className=\"border-primary-main mr-2 bg-black text-white \"\n            options={options}\n            placeholder={options.find(option => option.value === config.strategy).placeHolder}\n            value={config.strategy}\n            onChange={({ value }) => {\n              dispatch({\n                type: 'setStrategy',\n                payload: {\n                  strategy: value,\n                },\n              });\n            }}\n          />\n        </div>\n        <div className=\"w-1/2\">\n          {/* TODO Revisit design of LegacyButtonGroup later - for now use LegacyButton for its children.*/}\n          <LegacyButtonGroup>\n            <LegacyButton\n              size=\"initial\"\n              className=\"px-2 py-2 text-base text-white\"\n              color=\"primaryLight\"\n              variant=\"outlined\"\n              onClick={() => runCommand('setStartSliceForROIThresholdTool')}\n            >\n              {t('Start')}\n            </LegacyButton>\n            <LegacyButton\n              size=\"initial\"\n              color=\"primaryLight\"\n              variant=\"outlined\"\n              className=\"px-2 py-2 text-base text-white\"\n              onClick={() => runCommand('setEndSliceForROIThresholdTool')}\n            >\n              {t('End')}\n            </LegacyButton>\n          </LegacyButtonGroup>\n        </div>\n      </div>\n\n      {config.strategy === ROI_STAT && (\n        <Input\n          label={t('Percentage of Max SUV')}\n          labelClassName=\"text-[13px] font-inter text-white\"\n          className=\"border-primary-main bg-black\"\n          type=\"text\"\n          containerClassName=\"mr-2\"\n          value={config.weight}\n          onChange={e => {\n            dispatch({\n              type: 'setWeight',\n              payload: {\n                weight: e.target.value,\n              },\n            });\n          }}\n        />\n      )}\n      {config.strategy !== ROI_STAT && (\n        <div className=\"mr-2 text-sm\">\n          <table>\n            <tbody>\n              <tr className=\"mt-2\">\n                <td\n                  className=\"pr-4\"\n                  colSpan=\"3\"\n                >\n                  <Label\n                    className=\"font-inter text-[13px] text-white\"\n                    text=\"Lower & Upper Ranges\"\n                  ></Label>\n                </td>\n              </tr>\n              <tr className=\"mt-2\">\n                <td className=\"pr-4 pt-2 text-center\">\n                  <Label\n                    className=\"text-white\"\n                    text=\"CT\"\n                  ></Label>\n                </td>\n                <td>\n                  <div className=\"flex justify-between\">\n                    <Input\n                      label={t('')}\n                      labelClassName=\"text-white\"\n                      className=\"border-primary-main mt-2 bg-black\"\n                      type=\"text\"\n                      containerClassName=\"mr-2\"\n                      value={config.ctLower}\n                      onChange={e => {\n                        dispatch({\n                          type: 'setThreshold',\n                          payload: {\n                            ctLower: e.target.value,\n                          },\n                        });\n                      }}\n                    />\n                    <Input\n                      label={t('')}\n                      labelClassName=\"text-white\"\n                      className=\"border-primary-main mt-2 bg-black\"\n                      type=\"text\"\n                      containerClassName=\"mr-2\"\n                      value={config.ctUpper}\n                      onChange={e => {\n                        dispatch({\n                          type: 'setThreshold',\n                          payload: {\n                            ctUpper: e.target.value,\n                          },\n                        });\n                      }}\n                    />\n                  </div>\n                </td>\n              </tr>\n              <tr>\n                <td className=\"pr-4 pt-2 text-center\">\n                  <Label\n                    className=\"text-white\"\n                    text=\"PT\"\n                  ></Label>\n                </td>\n                <td>\n                  <div className=\"flex justify-between\">\n                    <Input\n                      label={t('')}\n                      labelClassName=\"text-white\"\n                      className=\"border-primary-main mt-2 bg-black\"\n                      type=\"text\"\n                      containerClassName=\"mr-2\"\n                      value={config.ptLower}\n                      onChange={e => {\n                        dispatch({\n                          type: 'setThreshold',\n                          payload: {\n                            ptLower: e.target.value,\n                          },\n                        });\n                      }}\n                    />\n                    <Input\n                      label={t('')}\n                      labelClassName=\"text-white\"\n                      className=\"border-primary-main mt-2 bg-black\"\n                      type=\"text\"\n                      containerClassName=\"mr-2\"\n                      value={config.ptUpper}\n                      onChange={e => {\n                        dispatch({\n                          type: 'setThreshold',\n                          payload: {\n                            ptUpper: e.target.value,\n                          },\n                        });\n                      }}\n                    />\n                  </div>\n                </td>\n              </tr>\n            </tbody>\n          </table>\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default ROIThresholdConfiguration;\n","import React, { useState, useCallback, useReducer, useEffect } from 'react';\nimport { Button } from '@ohif/ui';\nimport ROIThresholdConfiguration, {\n  ROI_STAT,\n} from './PanelROIThresholdSegmentation/ROIThresholdConfiguration';\nimport * as cs3dTools from '@cornerstonejs/tools';\n\nconst LOWER_CT_THRESHOLD_DEFAULT = -1024;\nconst UPPER_CT_THRESHOLD_DEFAULT = 1024;\nconst LOWER_PT_THRESHOLD_DEFAULT = 2.5;\nconst UPPER_PT_THRESHOLD_DEFAULT = 100;\nconst WEIGHT_DEFAULT = 0.41; // a default weight for suv max often used in the literature\nconst DEFAULT_STRATEGY = ROI_STAT;\n\nfunction reducer(state, action) {\n  const { payload } = action;\n  const { strategy, ctLower, ctUpper, ptLower, ptUpper, weight } = payload;\n\n  switch (action.type) {\n    case 'setStrategy':\n      return {\n        ...state,\n        strategy,\n      };\n    case 'setThreshold':\n      return {\n        ...state,\n        ctLower: ctLower ? ctLower : state.ctLower,\n        ctUpper: ctUpper ? ctUpper : state.ctUpper,\n        ptLower: ptLower ? ptLower : state.ptLower,\n        ptUpper: ptUpper ? ptUpper : state.ptUpper,\n      };\n    case 'setWeight':\n      return {\n        ...state,\n        weight,\n      };\n    default:\n      return state;\n  }\n}\n\nfunction RectangleROIOptions({ servicesManager, commandsManager }: withAppTypes) {\n  const { segmentationService } = servicesManager.services;\n  const [selectedSegmentationId, setSelectedSegmentationId] = useState(null);\n\n  const runCommand = useCallback(\n    (commandName, commandOptions = {}) => {\n      return commandsManager.runCommand(commandName, commandOptions);\n    },\n    [commandsManager]\n  );\n\n  const [config, dispatch] = useReducer(reducer, {\n    strategy: DEFAULT_STRATEGY,\n    ctLower: LOWER_CT_THRESHOLD_DEFAULT,\n    ctUpper: UPPER_CT_THRESHOLD_DEFAULT,\n    ptLower: LOWER_PT_THRESHOLD_DEFAULT,\n    ptUpper: UPPER_PT_THRESHOLD_DEFAULT,\n    weight: WEIGHT_DEFAULT,\n  });\n\n  const handleROIThresholding = useCallback(() => {\n    const segmentationId = selectedSegmentationId;\n    const activeSegmentIndex =\n      cs3dTools.segmentation.segmentIndex.getActiveSegmentIndex(segmentationId);\n\n    // run the threshold based on the active segment index\n    // Todo: later find a way to associate each rectangle with a segment (e.g., maybe with color?)\n    runCommand('thresholdSegmentationByRectangleROITool', {\n      segmentationId,\n      config,\n      segmentIndex: activeSegmentIndex,\n    });\n  }, [selectedSegmentationId, config]);\n\n  useEffect(() => {\n    const segmentations = segmentationService.getSegmentationRepresentations();\n\n    if (!segmentations.length) {\n      return;\n    }\n\n    const isActive = segmentations.find(seg => seg.isActive);\n    setSelectedSegmentationId(isActive.id);\n  }, []);\n\n  /**\n   * Update UI based on segmentation changes (added, removed, updated)\n   */\n  useEffect(() => {\n    // ~~ Subscription\n    const updated = segmentationService.EVENTS.SEGMENTATION_MODIFIED;\n    const subscriptions = [];\n\n    [updated].forEach(evt => {\n      const { unsubscribe } = segmentationService.subscribe(evt, () => {\n        const segmentations = segmentationService.getSegmentationRepresentations();\n\n        if (!segmentations.length) {\n          return;\n        }\n\n        const isActive = segmentations.find(seg => seg.isActive);\n        setSelectedSegmentationId(isActive.id);\n      });\n      subscriptions.push(unsubscribe);\n    });\n\n    return () => {\n      subscriptions.forEach(unsub => {\n        unsub();\n      });\n    };\n  }, []);\n\n  return (\n    <div className=\"invisible-scrollbar mb-2 flex flex-col overflow-y-auto overflow-x-hidden\">\n      <ROIThresholdConfiguration\n        config={config}\n        dispatch={dispatch}\n        runCommand={runCommand}\n      />\n      {selectedSegmentationId !== null && (\n        <Button\n          className=\"mt-2 !h-[26px] !w-[75px]\"\n          onClick={handleROIThresholding}\n        >\n          Run\n        </Button>\n      )}\n    </div>\n  );\n}\n\nexport default RectangleROIOptions;\n","import { id } from './id';\nimport getHangingProtocolModule from './getHangingProtocolModule';\nimport getPanelModule from './getPanelModule';\nimport init from './init';\nimport commandsModule from './commandsModule';\nimport getToolbarModule from './getToolbarModule';\n\n/**\n *\n */\nconst tmtvExtension = {\n  /**\n   * Only required property. Should be a unique value across all extensions.\n   */\n  id,\n  preRegistration({ servicesManager, commandsManager, extensionManager, configuration = {} }) {\n    init({ servicesManager, commandsManager, extensionManager, configuration });\n  },\n  getToolbarModule,\n  getPanelModule,\n  getHangingProtocolModule,\n  getCommandsModule({ servicesManager, commandsManager, extensionManager }) {\n    return commandsModule({\n      servicesManager,\n      commandsManager,\n      extensionManager,\n    });\n  },\n};\n\nexport default tmtvExtension;\n","import RectangleROIOptions from './Panels/RectangleROIOptions';\n\nexport default function getToolbarModule({ commandsManager, servicesManager }) {\n  return [\n    {\n      name: 'tmtv.RectangleROIThresholdOptions',\n      defaultComponent: () => RectangleROIOptions({ commandsManager, servicesManager }),\n    },\n  ];\n}\n"],"names":["id","packageJson","cameraPositionSync","type","source","target","hydrateSegSync","options","matchingRules","ctAXIAL","viewportOptions","viewportId","viewportType","orientation","toolGroupId","initialImageOptions","preset","syncGroups","syncColormap","displaySets","ctSAGITTAL","ctCORONAL","ptAXIAL","background","syncInvertState","voi","custom","voiInverted","ptSAGITTAL","ptCORONAL","fusionAXIAL","colormap","name","opacity","value","fusionSAGITTAL","fusionCORONAL","mipSAGITTAL","customViewportProps","hideOverlays","blendMode","slabThickness","ptCT","locked","createdDate","modifiedDate","availableTo","editableBy","imageLoadStrategy","protocolMatchingRules","attribute","constraint","contains","displaySetSelectors","ctDisplaySet","seriesMatchingRules","equals","required","ptDisplaySet","weight","doesNotContain","stages","viewportStructure","layoutType","properties","rows","columns","layoutOptions","x","y","width","height","viewports","numberOfPriorsReferenced","protocol","DEFAULT_MEATADATA","PatientWeight","PatientSex","SeriesTime","RadiopharmaceuticalInformationSequence","RadionuclideTotalDose","RadionuclideHalfLife","RadiopharmaceuticalStartTime","PanelPetSUV","servicesManager","commandsManager","t","useTranslation","displaySetService","toolGroupService","toolbarService","hangingProtocolService","services","metadata","setMetadata","useState","setPtDisplaySet","handleMetadataChange","prevState","newState","Object","keys","forEach","key","getMatchingPTDisplaySet","viewportMatchDetails","runCommand","useEffect","getActiveDisplaySets","getMatchDetails","length","displaySetInfo","unsubscribe","subscribe","EVENTS","PROTOCOL_CHANGED","React","className","PanelSection","title","Input","containerClassName","label","labelClassName","onChange","e","labelChildren","Button","onClick","Error","DicomMetadataStore","updateMetadataForSeries","StudyInstanceUID","SeriesInstanceUID","setDisplaySetMetadataInvalidated","displaySetInstanceUID","setTimeout","propTypes","PropTypes","measurementService","getMeasurements","isRequired","VALUE_TYPES","handleROIThresholding","async","segmentationId","segmentationService","segmentation","getSegmentation","triggerEvent","eventTarget","Enums","WEB_WORKER_PROGRESS","progress","updatedPerSegmentCachedStats","segmentIndex","segment","entries","segments","numericSegmentIndex","Number","lesionStats","run","cachedStats","suvPeak","lesionGlyoclysisStats","volume","meanValue","updatedSegment","segmentations","getSegmentations","tmtv","updatedSegmentation","addOrUpdateSegmentation","segmentationsWithRepresentations","segmentationsInfo","useActiveViewportSegmentationRepresentations","segmentationIds","map","segmentationInfo","initialRun","debouncedHandleROIThresholding","debounce","eventDetail","dataModifiedSubscription","SEGMENTATION_DATA_MODIFIED","tmtvSegmentation","find","info","undefined","tmtvValue","toFixed","PanelTMTV","extensionManager","configuration","PanelSegmentation","ExportCSV","representations","representation","size","variant","config","Icons","Download","iconName","iconLabel","component","wrappedPanelPetSuv","wrappedPanelTMTV","Toolbox","buttonSectionId","PanelROIThresholdExport","wrappedROIThresholdToolbox","wrappedROIThresholdExport","toAnnotation","measurement","definition","toMeasurement","csToolsEventDetail","cornerstoneViewportService","annotation","data","annotationUID","console","warn","toolName","referencedImageId","FrameOfReferenceUID","SUPPORTED_TOOLS","includes","SOPInstanceUID","getSOPInstanceAttributes","displaySet","getDisplaySetForSOPInstanceUID","getDisplaySetsForSeries","uid","referenceSeriesUID","referenceStudyUID","measurementServiceMappingsFactory","RectangleROIStartEndThreshold","csToolsAnnotation","matchingCriteria","valueType","ROI_THRESHOLD_MANUAL","CircleROIStartEndThreshold","CORNERSTONE_3D_TOOLS_SOURCE_NAME","CORNERSTONE_3D_TOOLS_SOURCE_VERSION","CSExtensionEnums","getRoiStats","referencedVolume","annotations","imageData","values","getPointData","getScalars","getData","fn","baseValue","statistic","Infinity","number","maxValue","_getStrategyFn","boundsIJK","csTools","iMin","iMax","jMin","jMax","kMin","kMax","i","j","k","computeOffsetIndex","annotationUIDs","referencedVolumes","strategy","ptLower","ptUpper","ctLower","ctUpper","datasetToBlob","dcmjs","metadataProvider","classes","MetadataProvider","dataset","adaptersRT","Cornerstone3D","RTSS","generateRTSSFromAnnotations","reportBlob","objectUrl","URL","createObjectURL","window","location","assign","SegmentationRepresentations","ROI_THRESHOLD_MANUAL_TOOL_IDS","workerManager","getWebWorkerManager","maxWorkerInstances","autoTerminateOnIdle","enabled","idleTimeThreshold","workerFn","Worker","getVolumesFromSegmentation","labelmapData","representationData","Labelmap","volumeId","referencedVolumeId","labelmapVolume","cs","getVolume","getLabelmapVolumeFromSegmentation","commandsModule","viewportGridService","uiNotificationService","utilityModule","getModuleEntry","getEnabledElement","exports","_getActiveViewportsEnabledElement","activeViewportId","getState","element","_getAnnotationsSelectedByToolNames","toolNames","reduce","allAnnotationUIDs","concat","actions","viewportDetails","displaySetsInfo","getDisplaySetByUID","Modality","getPTMetadata","firstImageId","getDataSources","getImageIdsForDisplaySet","instance","get","RadiopharmaceuticalStartDateTime","createNewLabelmapFromPT","withPTViewportId","some","error","currentSegmentations","getSegmentationRepresentations","createLabelmapForDisplaySet","active","addSegmentationRepresentation","thresholdSegmentationByRectangleROITool","displaySetMatchDetails","matchDetails","ctVolumeId","segVolumeId","show","message","ctReferencedVolume","enabledElement","viewport","hasVolumeId","getDisplaySetsUIDsForViewport","getVolumes","dimensions","spacing","getThresholdValues","lower","upper","overwrite","calculateSuvPeak","labelmap","registerWorker","labelmapProps","origin","direction","scalarData","voxelManager","getCompleteScalarDataArray","referenceVolumeProps","annotationsToSend","renderingEngine","executeTask","mean","suvMax","max","suvMaxIJK","maxIJK","suvMaxLPS","maxLPS","getLesionStats","segVoxelManager","refVoxelManager","segmentationMax","segmentationMin","segmentationValues","voxelCount","callback","index","refValue","getAtIndex","push","a","b","minValue","stdValue","Math","sqrt","acc","curr","calculateLesionGlycolysis","calculateTMTV","exportTMTVReportCSV","segReport","additionalReportRows","tlg","getTotalLesionGlycolysis","unshift","firstReport","csv","join","row","column","Array","isArray","PatientID","StudyDate","temp","blob","Blob","url","document","createElement","href","download","filename","click","createAndDownloadTMTVReport","ptVolume","ptVolumeProps","setStartSliceForROIThresholdTool","focalPoint","getCamera","startCoordinate","invalidated","render","setEndSliceForROIThresholdTool","focalPointToEnd","endCoordinate","createTMTVRTReport","stateManager","frameOfReferenceUID","forAnnotations","ROIAnnotations","getSegmentationCSVReport","report","subKey","subValue","imageIds","OHIF","PatientName","Alphabetic","exportRTReportForAnnotations","dicomRTAnnotationExport","setFusionPTColormap","toolGroup","getToolGroup","fusionViewportIds","getViewportIds","getCornerstoneViewport","definitions","commandFn","defaultContext","ROI_STAT","placeHolder","dispatch","Select","closeMenuOnSelect","placeholder","option","payload","LegacyButtonGroup","LegacyButton","color","colSpan","Label","text","DEFAULT_STRATEGY","reducer","state","action","selectedSegmentationId","setSelectedSegmentationId","useCallback","commandName","commandOptions","useReducer","activeSegmentIndex","cs3dTools","isActive","seg","updated","SEGMENTATION_MODIFIED","subscriptions","evt","unsub","ROIThresholdConfiguration","tmtvExtension","preRegistration","addTool","RectangleROIStartEndThresholdTool","CircleROIStartEndThresholdTool","csTools3DVer1MeasurementSource","getSource","addMapping","init","getToolbarModule","defaultComponent","RectangleROIOptions","getPanelModule","getHangingProtocolModule","getCommandsModule"],"sourceRoot":""}