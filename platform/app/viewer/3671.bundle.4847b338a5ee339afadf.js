/*! For license information please see 3671.bundle.4847b338a5ee339afadf.js.LICENSE.txt */
(self.webpackChunk=self.webpackChunk||[]).push([[3671],{48405:(e,t,n)=>{"use strict";n.d(t,{C:()=>c});class o{constructor(e){this.fullDate=e}getTimeInSec(){const e=this.fullDate.substring(0,10),t=this.fullDate.substring(11,28),n=parseInt(e.substring(0,4),10),o=e.length>=7?parseInt(e.substring(5,7),10):void 0,i=e.length>=10?parseInt(e.substring(8,10),10):void 0;if(isNaN(n)||void 0!==o&&isNaN(o)||void 0!==i&&isNaN(i)||n>3e3||o&&(o<1||o>12)||i&&(i<1||i>31))throw new Error(`invalid date '${e}'`);const a=new Date(`${e}T00:00:00.000000Z`),r=parseInt(t.substring(0,2),10),s=t.length>=5?parseInt(t.substring(3,5),10):void 0,l=t.length>=8?parseInt(t.substring(6,8),10):void 0,d=t.substring(9,15),c=d?parseInt(d,10)*Math.pow(10,-d.length):void 0;if(isNaN(r)||void 0!==s&&isNaN(s)||void 0!==l&&isNaN(l)||void 0!==c&&isNaN(c)||r<0||r>23||s&&(s<0||s>59)||l&&(l<0||l>59)||c&&(c<0||c>999999))throw new Error(`invalid time '${t}'`);let h=a.getTime()/1e3;return h+=3600*r,void 0!==s&&(h+=60*s),void 0!==l&&(h+=l),void 0!==c&&(h+=c),h}getTimeInMicroSec(){return 1e6*this.getTimeInSec()}}function i(e,t){const n=`${t.hours||"00"}`.padStart(2,"0"),i=`${t.minutes||"00"}`.padStart(2,"0"),a=`${t.seconds||"00"}`.padStart(2,"0"),r=`${e.month}`.padStart(2,"0"),s=`${e.day}`.padStart(2,"0"),l=`${t.fractionalSeconds||"000000"}`.padEnd(6,"0"),d=`${e.year}-${r}-${s}`;return new o(`${d}${`T${n}:${i}:${a}.${l}Z`}`)}function a(e){if(null==e||8!==e.length||"string"!=typeof e)throw new Error(`invalid DA '${e}'`);const t=parseInt(e.substring(0,4),10),n=parseInt(e.substring(4,6),10),o=parseInt(e.substring(6,8),10);if(!0!=(i=o,a=n,r=t,!isNaN(r)&&a>0&&a<=12&&i>0&&i<=function(e,t){switch(e){case 2:return t%4==0&&t%100||t%400==0?29:28;case 9:case 4:case 6:case 11:return 30;default:return 31}}(a,r)))throw new Error(`invalid DA '${e}'`);var i,a,r;return{year:t,month:n,day:o}}function r(e){if(null==e||e.length<2||"string"!=typeof e)throw new Error(`invalid TM '${e}'`);const t=parseInt(e.substring(0,2),10),n=e.length>=4?parseInt(e.substring(2,4),10):void 0,o=e.length>=6?parseInt(e.substring(4,6),10):void 0,i=e.length>=8?e.substring(7,13):void 0,a=i?parseInt(i,10)*Math.pow(10,6-i.length):void 0;if(isNaN(t)||void 0!==n&&isNaN(n)||void 0!==o&&isNaN(o)||void 0!==a&&isNaN(a)||t<0||t>23||n&&(n<0||n>59)||o&&(o<0||o>59)||a&&(a<0||a>999999))throw new Error(`invalid TM '${e}'`);return{hours:t,minutes:n,seconds:o,fractionalSeconds:a}}function s(e){if(null==e)throw new Error("dateTimeToFullDateInterface : dateTime not defined.");return i(a(e.substring(0,8)),r(e.substring(8)))}function l(e){const{RadionuclideTotalDose:t,RadionuclideHalfLife:n,RadiopharmaceuticalStartDateTime:l,RadiopharmaceuticalStartTime:d,SeriesDate:c}=e[0];if(null==t)throw new Error("calculateDecayCorrection : RadionuclideTotalDose value not found.");if(null==n)throw new Error("calculateDecayCorrection : RadionuclideHalfLife value not found.");const h=function(e){const{SeriesDate:t,SeriesTime:n,GEPrivatePostInjectionDateTime:l}=e[0],d=new Array(e.length),c=i(a(t),r(n));let h=new o("3000-01-01T00:00:00.000000Z"),u=h.getTimeInSec();if(e.forEach((e=>{const{AcquisitionDate:t,AcquisitionTime:n}=e,o=i(a(t),r(n));h=h.getTimeInSec()>=u||o.getTimeInSec()<h.getTimeInSec()?o:h})),h.getTimeInSec()>=u)throw new Error("Earliest acquisition time or date could not be parsed.");return c.getTimeInSec()<=h.getTimeInSec()?d.fill(c):l?d.fill(s(l)):d.fill(h)}(e),u=function(e){const{RadiopharmaceuticalStartDateTime:t,RadiopharmaceuticalStartTime:n,SeriesDate:o}=e;let l,d;if(t)return s(t);if(n&&o)return l=r(n),d=a(o),i(d,l);throw new Error(`Invalid input: ${e}`)}({RadiopharmaceuticalStartDateTime:l,RadiopharmaceuticalStartTime:d,SeriesDate:c});return e.map(((e,o)=>{const i=h[o].getTimeInSec()-u.getTimeInSec();if(i<0)throw new Error("Decay time cannot be less than zero");return 1/(t*Math.pow(2,-i/n))}))}const d=(e,t)=>e===t||Array.isArray(e)&&Array.isArray(t)&&e.length===t.length&&e.every(((e,n)=>e===t[n]));function c(e){const{CorrectedImage:t,Units:n,PhilipsPETPrivateGroup:o,PatientWeight:i,PatientSex:a,PatientSize:r}=e[0];if(!t.includes("ATTN")||!t.includes("DECY"))throw new Error(`CorrectedImage must contain "ATTN" and "DECY": ${t}`);if(!e.every((o=>o.Units===n&&d(o.CorrectedImage,t)&&o.PatientWeight===i&&o.PatientSex===a&&o.PatientSize===r&&o.RadionuclideHalfLife===e[0].RadionuclideHalfLife&&o.RadionuclideTotalDose===e[0].RadionuclideTotalDose&&o.DecayCorrection===e[0].DecayCorrection&&o.SeriesDate===e[0].SeriesDate&&o.SeriesTime===e[0].SeriesTime)))throw new Error("The set of instances does not appear to come from one Series. Every instance must have identical values for series-level metadata properties");if(!i)throw new Error("PatientWeight value is missing. It is not possible to calculate the SUV factors");let s=new Array(e.length);s=l(e);let c=new Array(e.length);const h=1e3*i;if("BQML"===n)c=s.map((function(e){return e*h}));else if("CNTS"===n){const t=e.every((e=>{var t,n,o;return e.PhilipsPETPrivateGroup&&null!==(null===(t=e.PhilipsPETPrivateGroup)||void 0===t?void 0:t.SUVScaleFactor)&&void 0!==(null===(n=e.PhilipsPETPrivateGroup)||void 0===n?void 0:n.SUVScaleFactor)&&0!==(null===(o=e.PhilipsPETPrivateGroup)||void 0===o?void 0:o.SUVScaleFactor)})),n=e.every((e=>{var t,n,o;return e.PhilipsPETPrivateGroup&&!(null!==(t=e.PhilipsPETPrivateGroup)&&void 0!==t&&t.SUVScaleFactor)&&void 0!==(null===(n=e.PhilipsPETPrivateGroup)||void 0===n?void 0:n.ActivityConcentrationScaleFactor)&&0!==(null===(o=e.PhilipsPETPrivateGroup)||void 0===o?void 0:o.ActivityConcentrationScaleFactor)}));if(t)c=e.map((e=>e.PhilipsPETPrivateGroup.SUVScaleFactor));else{if(!n)throw new Error(`Units are in CNTS, but PhilipsPETPrivateGroup has invalid values: ${JSON.stringify(o)}`);c=e.map(((e,t)=>e.PhilipsPETPrivateGroup.ActivityConcentrationScaleFactor*s[t]*h))}}else{if("GML"!==n)throw new Error(`Units has an invalid value: ${n}`);c.fill(1)}let u,g,p;if(null==r)console.warn("PatientSize value is missing. It is not possible to calculate the SUV bsa factors");else{u=function(e){const{PatientWeight:t,PatientSize:n}=e;return Math.pow(t,.425)*Math.pow(100*n,.725)*71.84}({PatientWeight:i,PatientSize:r})}if(null==r)console.warn("PatientSize value is missing. It is not possible to calculate the SUV lbm factors");else if(null==a)console.warn("PatientSex value is missing. It is not possible to calculate the SUV lbm factors");else{const e={PatientWeight:i,PatientSex:a,PatientSize:r};g=function(e){const{PatientSex:t,PatientWeight:n,PatientSize:o}=e;let i;const a=Math.pow(n/(100*o),2);if("F"===t)i=1.07*n-148*a;else{if("M"!==t)throw new Error(`PatientSex is an invalid value: ${t}`);i=1.1*n-120*a}return 1e3*i}(e),p=function(e){const{PatientSex:t,PatientWeight:n,PatientSize:o}=e;let i;const a=n/Math.pow(o,2);if("F"===t)i=9270*n/(8780+244*a);else{if("M"!==t)throw new Error(`PatientSex is an invalid value: ${t}`);i=9270*n/(6680+216*a)}return 1e3*i}(e)}return c.map((function(e,t){const n={suvbw:e};return u&&(n.suvbsa=s[t]*u),g&&(n.suvlbm=s[t]*g),p&&(n.suvlbmJanma=s[t]*p),n}))}},93952:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});const o=[[0,0,0,0],[221,84,84,255],[77,228,121,255],[166,70,235,255],[189,180,116,255],[109,182,196,255],[204,101,157,255],[123,211,94,255],[93,87,218,255],[225,128,80,255],[73,232,172,255],[181,119,186,255],[176,193,112,255],[105,153,200,255],[208,97,120,255],[90,215,101,255],[135,83,222,255],[229,178,76,255],[122,183,181,255],[190,115,171,255],[149,197,108,255],[100,118,205,255],[212,108,93,255],[86,219,141,255],[183,79,226,255],[233,233,72,255],[118,167,187,255],[194,111,146,255],[116,201,104,255],[115,96,209,255],[216,147,89,255],[82,223,188,255],[230,75,224,255],[163,184,121,255],[114,143,191,255],[198,107,114,255],[99,206,122,255],[153,92,213,255],[220,192,85,255],[78,215,227,255],[234,71,173,255],[141,188,117,255],[110,113,195,255],[202,128,103,255],[95,210,157,255],[195,88,217,255],[206,224,81,255],[74,166,231,255],[185,120,139,255],[113,192,113,255],[133,106,199,255],[207,162,98,255],[91,214,198,255],[221,84,198,255],[159,228,77,255],[70,111,235,255],[189,119,116,255],[109,196,138,255],[165,101,204,255],[211,201,94,255],[87,191,218,255],[225,80,153,255],[106,232,73,255],[124,119,186,255],[193,142,112,255],[105,200,168,255],[203,97,208,255],[184,215,90,255],[83,147,222,255],[229,76,101,255],[122,183,130,255],[146,115,190,255],[197,171,108,255],[100,205,205,255],[212,93,177,255],[141,219,86,255],[79,97,226,255],[233,99,72,255],[118,187,150,255],[173,111,194,255],[197,201,104,255],[96,171,209,255],[216,89,137,255],[94,223,82,255],[107,75,230,255],[184,153,121,255],[114,191,175,255],[198,107,191,255],[166,206,99,255],[92,132,213,255],[220,85,91,255],[78,227,115,255],[159,71,234,255],[188,176,117,255],[110,185,195,255],[202,103,161,255],[129,210,95,255],[88,88,217,255],[224,123,81,255],[74,231,166,255],[177,120,185,255],[179,192,113,255],[106,156,199,255],[207,98,125,255],[91,214,96,255],[130,84,221,255],[228,171,77,255],[70,235,221,255],[189,116,174,255],[153,196,109,255],[101,123,204,255],[211,104,94,255],[87,218,136,255],[177,80,225,255],[232,225,73,255],[119,169,186,255],[193,112,149,255],[121,200,105,255],[111,97,208,255],[215,142,90,255],[83,222,181,255],[229,76,229,255],[165,183,122,255],[115,146,190,255],[197,108,119,255],[100,205,118,255],[148,93,212,255],[219,186,86,255],[79,220,226,255],[233,72,179,255],[144,187,118,255],[111,118,194,255],[201,124,104,255],[96,209,153,255],[189,89,216,255],[211,223,82,255],[75,172,230,255],[184,121,142,255],[117,191,114,255],[130,107,198,255],[206,157,99,255],[92,213,193,255],[220,85,203,255],[165,227,78,255],[71,118,234,255],[188,117,117,255],[110,195,135,255],[161,103,202,255],[210,195,95,255],[88,195,217,255],[224,81,158,255],[113,231,74,255],[123,120,185,255],[192,139,113,255],[106,199,164,255],[198,98,207,255],[188,214,91,255],[84,153,221,255],[228,77,108,255],[70,235,84,255],[143,116,189,255],[196,167,109,255],[101,204,199,255],[211,94,182,255],[147,218,87,255],[80,104,225,255],[232,93,73,255],[119,186,147,255],[170,112,193,255],[200,200,105,255],[97,175,208,255],[215,90,142,255],[100,222,83,255],[101,76,229,255],[183,150,122,255],[115,190,171,255],[197,108,194,255],[170,205,100,255],[93,138,212,255],[219,86,97,255],[79,226,110,255],[153,72,233,255],[187,173,118,255],[111,187,194,255],[201,104,165,255],[134,209,96,255],[89,95,216,255],[223,117,82,255],[75,230,159,255],[174,121,184,255],[182,191,114,255],[107,160,198,255],[206,99,130,255],[92,213,92,255],[124,85,220,255],[227,165,78,255],[71,234,214,255],[188,117,176,255],[156,195,110,255],[103,128,202,255],[210,100,95,255],[88,217,131,255],[170,81,224,255],[231,218,74,255],[120,172,185,255],[192,113,153,255],[125,199,106,255],[107,98,207,255],[214,137,91,255],[84,221,175,255],[222,77,228,255],[194,235,70,255],[116,149,189,255],[196,109,123,255],[101,204,114,255],[143,94,211,255],[218,180,87,255],[80,225,225,255],[232,73,186,255],[147,186,119,255],[112,122,193,255],[200,121,105,255],[97,208,148,255],[184,90,215,255],[216,222,83,255],[76,178,229,255],[183,122,145,255],[121,190,115,255],[126,108,197,255],[205,153,100,255],[93,212,187,255],[219,86,208,255],[171,226,79,255],[72,126,233,255],[187,118,121,255],[111,194,132,255],[157,104,201,255],[209,190,96,255],[89,200,216,255],[223,82,164,255],[120,230,75,255],[121,121,184,255],[191,136,114,255],[107,198,160,255],[192,99,206,255],[193,213,92,255],[85,158,220,255],[227,78,115,255],[71,234,78,255],[141,117,188,255],[195,163,110,255],[103,202,194,255],[210,95,186,255],[153,217,88,255],[81,111,224,255]]},94430:(e,t,n)=>{"use strict";n.d(t,{A:()=>a,i:()=>s});const o=Symbol("DefinedCursors"),i=new Set(["alias","all-scroll","auto","cell","col-resize","context-menu","copy","crosshair","default","e-resize","ew-resize","grab","grabbing","help","move","ne-resize","nesw-resize","no-drop","none","not-allowed","n-resize","ns-resize","nw-resize","nwse-resize","pointer","progress","row-resize","se-resize","s-resize","sw-resize","text","vertical-text","wait","w-resize","zoom-in","zoom-out"]);class a{constructor(e,t){this.name=e+"",this.fallback=t}getName(){return this.name+""}addFallbackStyleProperty(e){const{fallback:t}=this;return t instanceof a?`${e}, ${t.getStyleProperty()}`:e+""}getStyleProperty(){return this.addFallbackStyleProperty(this.name)+""}static getDefinedCursor(e){const t=r(a,o);let n=t.get(e);return n instanceof a?n:i.has(e)?(n=new a(e),t.set(e,n),n):void 0}static setDefinedCursor(e,t){if(t instanceof a){return r(a,o).set(e,t),!0}return!1}}function r(e,t){let n=e[t];return n instanceof Map||(n=new Map,Object.defineProperty(e,t,{value:n})),n}const s=i.values()},7001:(e,t,n)=>{"use strict";n.r(t),n.d(t,{hideElementCursor:()=>l,initElementCursor:()=>a,resetElementCursor:()=>s,setElementCursor:()=>r});var o=n(94430);const i=Symbol("ElementCursorsMap");function a(e,t){d(e)[0]=t,r(e,t)}function r(e,t){const n=d(e);n[1]=n[0],n[0]=t,e.style.cursor=(t instanceof o.A?t:o.A.getDefinedCursor("auto")).getStyleProperty()}function s(e){r(e,d(e)[1])}function l(e){r(e,o.A.getDefinedCursor("none"))}function d(e){let t=d[i];t instanceof WeakMap||(t=new WeakMap,Object.defineProperty(d,i,{value:t}));let n=t.get(e);return n||(n=[null,null],t.set(e,n)),n}},79475:(e,t,n)=>{"use strict";n.r(t),n.d(t,{CursorNames:()=>x,CursorSVG:()=>p,ImageMouseCursor:()=>a,MouseCursor:()=>o.A,SVGMouseCursor:()=>y,elementCursor:()=>T,registerCursor:()=>f,setCursorForElement:()=>S});var o=n(94430),i=n(81985);class a extends o.A{constructor(e,t,n,o,i){super(o||a.getUniqueInstanceName("image-cursor"),i),this.url=e,this.x=Number(t)||0,this.y=Number(n)||0}getStyleProperty(){const{url:e,x:t,y:n}=this;let o=`url('${e}')`;return t>=0&&n>=0&&(t>0||n>0)&&(o+=` ${t} ${n}`),this.addFallbackStyleProperty(o)}static getUniqueInstanceName(e){return`${e}-${i.utilities.getRuntimeId(a)}`}}var r=n(99737);const s={iconContent:"",iconSize:16,viewBox:{x:16,y:16},mousePoint:{x:8,y:8},mousePointerGroupString:'\n    <path stroke="{{color}}" d="M8 16L8 0"></path>\n    <path stroke="{{color}}" d="M16 8L0 8"></path>\n  '},l={x:127,y:60},d='\n<rect fill="{{color}}" x="80.19" y="25.03" width="47.14" height="15.85"/>\n',c='\n<rect fill="{{color}}" x="80.19" y="25.03" width="47.14" height="15.85"/>\n<rect fill="{{color}}" x="95.84" y="9.38" width="15.85" height="47.14"/>\n',h='<path fill="{{color}}" d="M82.89,10a12.09,12.09,0,0,0-16.8-2.5l-27.5,20.4-8.5-6.3a2.93,2.93,0,0,1-1.1-3,14.66,14.66,0,0,0,.1-6.6,14.08,14.08,0,1,0-6.5,15.2,2.87,2.87,0,0,1,3.2.2l8.2,6.1-8.2,6.1a2.87,2.87,0,0,1-3.2.2,14.16,14.16,0,1,0,6.7,14.4,14,14,0,0,0-.3-5.8,2.93,2.93,0,0,1,1.1-3l8.5-6.3,27.5,20.4A11.91,11.91,0,0,0,82.89,57l-31.7-23.5ZM15.29,21a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,21Zm0,36.8a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,57.77Zm28.3-21.5a2.8,2.8,0,1,1,2.8-2.8A2.8,2.8,0,0,1,43.59,36.27Z" transform="translate(-1.17 -0.96)"/>',u='<path fill="{{color}}" d="M8.86,2.25V66.08H72.69V2.25H8.86ZM65.28,58.67h-49v-49h49v49Z" transform="translate(-8.86 -2.25)"/>',g='<path fill="{{color}}" d="M40.77,2.25A31.92,31.92,0,1,0,72.69,34.16,31.92,31.92,0,0,0,40.77,2.25Zm0,57.63A25.71,25.71,0,1,1,66.48,34.16,25.71,25.71,0,0,1,40.77,59.87Z" transform="translate(-8.86 -2.25)"/>',p={Angle:v(s,{name:"Angle",iconContent:'<path fill="{{color}}" d="M1203 544q0 13-10 23l-393 393 393 393q10 10 10 23t-10 23l-50\n    50q-10 10-23 10t-23-10l-466-466q-10-10-10-23t10-23l466-466q10-10 23-10t23\n    10l50 50q10 10 10 23z" />',viewBox:{x:1792,y:1792}}),ArrowAnnotate:v(s,{name:"ArrowAnnotate",iconContent:'<g id="arrowAnnotate-group" fill="none" stroke-width="1" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">\n    <path id="arrowAnnotate-arrow" d="M23,7 l-15,15 M7,17 l0,6 6,0" stroke-width="2" />\n  </g>',viewBox:{x:24,y:24}}),Bidirectional:v(s,{name:"Bidirectional",iconContent:'<g fill="{{color}}" stroke-width="3" stroke="{{color}}">\n    <path d="M27.63 3.21L3.12 28.81"></path>\n    <path d="M27.63 15.75L15.27 4.43"></path>\n    <path d="M16.5 4.28C16.5 4.96 15.95 5.51 15.27 5.51C14.59 5.51 14.03 4.96 14.03 4.28C14.03 3.59 14.59 3.04 15.27 3.04C15.95 3.04 16.5 3.59 16.5 4.28Z" ></path>\n    <path d="M28.87 3.19C28.87 3.87 28.31 4.43 27.63 4.43C26.95 4.43 26.4 3.87 26.4 3.19C26.4 2.51 26.95 1.95 27.63 1.95C28.31 1.95 28.87 2.51 28.87 3.19Z"></path>\n    <path d="M28.87 15.75C28.87 16.43 28.31 16.99 27.63 16.99C26.95 16.99 26.4 16.43 26.4 15.75C26.4 15.07 26.95 14.51 27.63 14.51C28.31 14.51 28.87 15.07 28.87 15.75Z"></path>\n    <path d="M4.73 28.44C4.73 29.12 4.17 29.68 3.49 29.68C2.81 29.68 2.25 29.12 2.25 28.44C2.25 27.76 2.81 27.2 3.49 27.2C4.17 27.2 4.73 27.76 4.73 28.44Z"></path>\n  </g>',viewBox:{x:48,y:48}}),CobbAngle:v(s,{name:"CobbAngle",iconContent:'<g stroke="{{color}}" stroke-width="3">\n    <path d="M28.59 2.34L3.82 12.32"></path>\n    <path d="M28.59 29.66L3.82 19.68"></path>\n    <path stroke-dasharray="2" fill-opacity="0" d="M12.37\n      23.06C12.67 22.36 12.85 21.93 12.92 21.76C14.6 17.8 14.68 13.35 13.15\n      9.33C13.11 9.24 13.02 9 12.88 8.63">\n    </path>\n  </g>',viewBox:{x:32,y:32}}),CircleROI:v(s,{name:"CircleROI",iconContent:'<circle stroke="{{color}}" fill="none" stroke-width="3" cx="16" cy="16" r="14" />',viewBox:{x:32,y:32}}),EllipticalROI:v(s,{name:"EllipticalROI",iconContent:'<path stroke="{{color}}" fill="none" stroke-width="3" d="M30.74 15.76C30.74 20.99 24.14 25.23 16\n    25.23C7.86 25.23 1.26 20.99 1.26 15.76C1.26 10.54 7.86 6.3 16 6.3C24.14\n    6.3 30.74 10.54 30.74 15.76Z" />',viewBox:{x:32,y:32}}),FreehandROI:v(s,{name:"FreehandROI",iconContent:'<g fill="{{color}}" stroke="{{color}}" stroke-width="2">\n    <ellipse ry="1" rx="1" id="svg_3" cy="4.240343" cx="14.306499"/>\n    <line id="svg_4" y2="3.58462" x2="12.242186" y1="3.997482" x1="13.432202"/>\n    <line id="svg_5" y2="3.268901" x2="10.857882" y1="3.608906" x1="12.387902"/>\n    <line id="svg_6" y2="3.147471" x2="9.740724" y1="3.293187" x1="10.955026"/>\n    <line id="svg_7" y2="3.147471" x2="8.089274" y1="3.196043" x1="9.983585"/>\n    <line id="svg_8" y2="3.268901" x2="6.874972" y1="3.123185" x1="8.307848"/>\n    <line id="svg_9" y2="3.657478" x2="5.587812" y1="3.220329" x1="7.020688"/>\n    <line id="svg_10" y2="4.046054" x2="4.737801" y1="3.560334" x1="5.854959"/>\n    <line id="svg_11" y2="4.337487" x2="4.300652" y1="3.997482" x1="4.834945"/>\n    <line id="svg_12" y2="4.726063" x2="3.88779" y1="4.191771" x1="4.470655"/>\n    <line id="svg_15" y2="5.3575" x2="3.377783" y1="4.604633" x1="3.960648"/>\n    <line id="svg_16" y2="6.183226" x2="2.916348" y1="5.138926" x1="3.547785"/>\n    <line id="svg_17" y2="6.960379" x2="2.770632" y1="5.867507" x1="3.037779"/>\n    <line id="svg_18" y2="7.713246" x2="2.673488" y1="6.741804" x1="2.819204"/>\n    <line id="svg_19" y2="8.684687" x2="2.697774" y1="7.616102" x1="2.673488"/>\n    <line id="svg_20" y2="9.753273" x2="2.892062" y1="8.611829" x1="2.697774"/>\n    <line id="svg_21" y2="10.724714" x2="3.134923" y1="9.534698" x1="2.84349"/>\n    <line id="svg_23" y2="11.647583" x2="3.596357" y1="10.578998" x1="3.086351"/>\n    <line id="svg_25" y2="12.521881" x2="4.276366" y1="11.501867" x1="3.499213"/>\n    <line id="svg_26" y2="13.930471" x2="5.830673" y1="12.376165" x1="4.13065"/>\n    <line id="svg_28" y2="14.707624" x2="7.263549" y1="13.881899" x1="5.733528"/>\n    <line id="svg_29" y2="15.339061" x2="8.963571" y1="14.61048" x1="7.06926"/>\n    <line id="svg_30" y2="15.581921" x2="10.882168" y1="15.314775" x1="8.817855"/>\n    <line id="svg_31" y2="15.460491" x2="12.023612" y1="15.581921" x1="10.785024"/>\n    <line id="svg_33" y2="15.120487" x2="13.092197" y1="15.484777" x1="11.877895"/>\n    <line id="svg_34" y2="14.586194" x2="13.86935" y1="15.217631" x1="12.897909"/>\n    <line id="svg_35" y2="13.833327" x2="14.597931" y1="14.756196" x1="13.699348"/>\n    <line id="svg_37" y2="12.716169" x2="15.180796" y1="13.881899" x1="14.549359"/>\n    <line id="svg_39" y2="11.429009" x2="15.520801" y1="12.813313" x1="15.15651"/>\n    <ellipse ry="1" rx="1" id="svg_40" cy="10.967574" cx="15.520801"/>\n  </g>',viewBox:{x:18,y:18}}),FreehandROISculptor:v(s,{name:"FreehandROISculptor",iconContent:'<g id="icon-freehand-sculpt" fill="none" stroke-width="1.5" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">\n    <line id="svg_1" y2="2.559367" x2="10.184807" y1="4.467781" x1="8.81711"/>\n    <line id="svg_4" y2="1.493836" x2="11.727442" y1="2.766112" x1="10.089386"/>\n    <line id="svg_7" y2="1.080346" x2="13.047428" y1="1.748291" x1="11.345759"/>\n    <line id="svg_8" y2="1.000829" x2="14.351511" y1="1.112153" x1="12.77707"/>\n    <line id="svg_9" y2="1.350705" x2="15.242104" y1="0.905408" x1="13.969828"/>\n    <line id="svg_10" y2="2.098167" x2="15.862339" y1="1.14396" x1="14.955842"/>\n    <line id="svg_11" y2="3.195505" x2="16.41896" y1="1.939133" x1="15.766918"/>\n    <line id="svg_12" y2="4.292843" x2="16.530284" y1="2.925147" x1="16.387153"/>\n    <line id="svg_16" y2="5.644637" x2="16.196311" y1="3.831643" x1="16.593898"/>\n    <line id="svg_18" y2="7.266789" x2="15.623787" y1="5.19934" x1="16.275829"/>\n    <line id="svg_19" y2="10.813258" x2="14.526449" y1="6.726071" x1="15.766918"/>\n    <line id="svg_20" y2="5.056209" x2="8.085552" y1="4.181519" x1="8.976145"/>\n    <line id="svg_23" y2="5.326568" x2="7.481221" y1="4.78585" x1="8.403621"/>\n    <line id="svg_24" y2="5.565119" x2="6.749662" y1="5.294761" x1="7.624352"/>\n    <line id="svg_25" y2="5.994512" x2="5.429675" y1="5.533312" x1="6.956407"/>\n    <line id="svg_27" y2="6.551133" x2="4.284627" y1="5.962706" x1="5.572807"/>\n    <line id="svg_28" y2="7.584858" x2="3.044158" y1="6.392099" x1="4.427758"/>\n    <line id="svg_29" y2="8.84123" x2="2.185372" y1="7.489437" x1="3.219096"/>\n    <line id="svg_31" y2="10.606513" x2="1.644654" y1="8.602678" x1="2.280792"/>\n    <line id="svg_32" y2="13.214679" x2="1.48562" y1="10.352058" x1="1.724171"/>\n    <line id="svg_33" y2="14.375631" x2="1.676461" y1="12.992031" x1="1.453813"/>\n    <line id="svg_34" y2="15.298031" x2="2.264889" y1="14.152983" x1="1.517427"/>\n    <line id="svg_35" y2="16.172721" x2="3.521261" y1="14.948155" x1="1.915013"/>\n    <line id="svg_36" y2="16.824762" x2="5.207027" y1="15.997783" x1="3.28271"/>\n    <line id="svg_38" y2="17.063314" x2="7.035924" y1="16.745245" x1="4.968475"/>\n    <line id="svg_39" y2="16.888376" x2="9.278311" y1="17.047411" x1="6.733758"/>\n    <line id="svg_40" y2="16.284045" x2="10.661911" y1="16.983797" x1="8.992048"/>\n    <line id="svg_41" y2="15.313934" x2="11.647925" y1="16.395369" x1="10.455166"/>\n    <line id="svg_44" y2="13.898527" x2="12.82478" y1="15.425259" x1="11.504794"/>\n    <line id="svg_45" y2="12.037824" x2="14.144766" y1="14.312017" x1="12.522614"/>\n    <line id="svg_47" y2="10.59061" x2="14.605966" y1="12.228665" x1="13.953925"/>\n    <ellipse ry="1" rx="1" id="svg_48" cy="3.982726" cx="13.460918"/>\n  </g>',viewBox:{x:18,y:18}}),Length:v(s,{name:"Length",iconContent:'<g id="length-group" fill="none" stroke-width="1" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">\n    <path id="length-dashes" d="m22.5,6 -16.5,16.5" stroke-width="3" stroke-dasharray="0.6666,5" />\n  </g>',viewBox:{x:24,y:24}}),Height:v(s,{name:"Height",iconContent:'<path d="m 6 22 l 8.5 0 v -16 h 8" stroke-width="3" fill="none" stroke="{{color}}" />',viewBox:{x:24,y:24}}),Probe:v(s,{name:"Probe",iconContent:'<path fill="{{color}}" d="M1152 896q0 106-75 181t-181 75-181-75-75-181 75-181 181-75 181 75\n    75 181zm-256-544q-148 0-273 73t-198 198-73 273 73 273 198 198 273 73 273-73\n    198-198 73-273-73-273-198-198-273-73zm768 544q0 209-103 385.5t-279.5\n    279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5\n    385.5-103 385.5 103 279.5 279.5 103 385.5z" />',viewBox:{x:1792,y:1792}}),RectangleROI:v(s,{name:"RectangleROI",iconContent:'<path fill="{{color}}" d="M1312 256h-832q-66 0-113 47t-47 113v832q0 66 47\n    113t113 47h832q66 0 113-47t47-113v-832q0-66-47-113t-113-47zm288 160v832q0\n    119-84.5 203.5t-203.5 84.5h-832q-119 0-203.5-84.5t-84.5-203.5v-832q0-119\n    84.5-203.5t203.5-84.5h832q119 0 203.5 84.5t84.5 203.5z" />',viewBox:{x:1792,y:1792}}),TextMarker:v(s,{name:"TextMarker",iconContent:'<path fill="{{color}}" d="M789 559l-170 450q33 0 136.5 2t160.5 2q19 0\n    57-2-87-253-184-452zm-725 1105l2-79q23-7 56-12.5t57-10.5 49.5-14.5 44.5-29\n    31-50.5l237-616 280-724h128q8 14 11 21l205 480q33 78 106 257.5t114 274.5q15\n    34 58 144.5t72 168.5q20 45 35 57 19 15 88 29.5t84 20.5q6 38 6 57 0 5-.5\n    13.5t-.5 12.5q-63 0-190-8t-191-8q-76 0-215 7t-178 8q0-43 4-78l131-28q1 0\n    12.5-2.5t15.5-3.5 14.5-4.5 15-6.5 11-8 9-11\n    2.5-14q0-16-31-96.5t-72-177.5-42-100l-450-2q-26 58-76.5 195.5t-50.5 162.5q0\n    22 14 37.5t43.5 24.5 48.5 13.5 57 8.5 41 4q1 19 1 58 0 9-2 27-58\n    0-174.5-10t-174.5-10q-8 0-26.5 4t-21.5 4q-80 14-188 14z" />',viewBox:{x:1792,y:1792}}),Crosshairs:v(s,{name:"Crosshairs",iconContent:'<path fill="{{color}}" d="M1325 1024h-109q-26 0-45-19t-19-45v-128q0-26\n    19-45t45-19h109q-32-108-112.5-188.5t-188.5-112.5v109q0 26-19 45t-45\n    19h-128q-26 0-45-19t-19-45v-109q-108 32-188.5 112.5t-112.5 188.5h109q26\n    0 45 19t19 45v128q0 26-19 45t-45 19h-109q32 108 112.5 188.5t188.5\n    112.5v-109q0-26 19-45t45-19h128q26 0 45 19t19 45v109q108-32\n    188.5-112.5t112.5-188.5zm339-192v128q0 26-19 45t-45 19h-143q-37 161-154.5\n    278.5t-278.5 154.5v143q0 26-19 45t-45 19h-128q-26\n    0-45-19t-19-45v-143q-161-37-278.5-154.5t-154.5-278.5h-143q-26\n    0-45-19t-19-45v-128q0-26 19-45t45-19h143q37-161\n    154.5-278.5t278.5-154.5v-143q0-26 19-45t45-19h128q26 0 45 19t19 45v143q161\n    37 278.5 154.5t154.5 278.5h143q26 0 45 19t19 45z" />',viewBox:{x:1792,y:1792}}),Eraser:v(s,{name:"Eraser",iconContent:'<path transform="translate(0,1792) scale(1,-1)" fill="{{color}}" d="M960 1408l336-384h-768l-336 384h768zm1013-1077q15\n    34 9.5 71.5t-30.5 65.5l-896 1024q-38 44-96 44h-768q-38\n    0-69.5-20.5t-47.5-54.5q-15-34-9.5-71.5t30.5-65.5l896-1024q38-44 96-44h768q38\n    0 69.5 20.5t47.5 54.5z" />',viewBox:{x:2048,y:1792}}),Magnify:v(s,{name:"Magnify",iconContent:'<path fill="{{color}}" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395\n    312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5\n    0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17\n    0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208\n    32s176 78.7 176 176-78.7 176-176 176z" />',viewBox:{x:512,y:512}}),Pan:v(s,{name:"Pan",iconContent:'<path fill="{{color}}" d="M1411 541l-355 355 355 355 144-144q29-31 70-14 39 17\n    39 59v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39 14-69l144-144-355-355-355\n    355 144 144q31 30 14 69-17 40-59 40h-448q-26 0-45-19t-19-45v-448q0-42 40-59\n    39-17 69 14l144 144 355-355-355-355-144 144q-19 19-45 19-12\n    0-24-5-40-17-40-59v-448q0-26 19-45t45-19h448q42 0 59 40 17 39-14 69l-144\n    144 355 355 355-355-144-144q-31-30-14-69 17-40 59-40h448q26 0 45 19t19\n    45v448q0 42-39 59-13 5-25 5-26 0-45-19z" />',viewBox:{x:1792,y:1792}}),Rotate:v(s,{name:"Rotate",iconContent:'<path fill="{{color}}" d="M1664 256v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39\n    14-69l138-138q-148-137-349-137-104 0-198.5 40.5t-163.5 109.5-109.5\n    163.5-40.5 198.5 40.5 198.5 109.5 163.5 163.5 109.5 198.5 40.5q119 0\n    225-52t179-147q7-10 23-12 15 0 25 9l137 138q9 8 9.5 20.5t-7.5 22.5q-109\n    132-264 204.5t-327 72.5q-156 0-298-61t-245-164-164-245-61-298 61-298\n    164-245 245-164 298-61q147 0 284.5 55.5t244.5 156.5l130-129q29-31 70-14\n    39 17 39 59z" />',viewBox:{x:1792,y:1792}}),StackScroll:v(s,{name:"StackScroll",iconContent:'<path fill="{{color}}" d="M24 21v2c0 0.547-0.453 1-1 1h-22c-0.547\n    0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1zM24 13v2c0\n    0.547-0.453 1-1 1h-22c-0.547 0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547\n    0 1 0.453 1 1zM24 5v2c0 0.547-0.453 1-1 1h-22c-0.547\n    0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1z" />',viewBox:{x:24,y:28}}),WindowLevelRegion:v(s,{name:"WindowLevelRegion",iconContent:'<path fill="{{color}}" d="M1664 416v960q0 119-84.5 203.5t-203.5 84.5h-960q-119\n    0-203.5-84.5t-84.5-203.5v-960q0-119 84.5-203.5t203.5-84.5h960q119 0 203.5\n    84.5t84.5 203.5z" />',viewBox:{x:1792,y:1792}}),WindowLevel:v(s,{name:"WindowLevel",iconContent:'\n    <path fill="{{color}}" d="M14.5,3.5 a1 1 0 0 1 -11,11 Z" stroke="none" opacity="0.8" />\n    <circle cx="9" cy="9" r="8" fill="none" stroke-width="2" stroke="{{color}}" />',viewBox:{x:18,y:18}}),Zoom:v(s,{name:"Zoom",iconContent:'\n  <path fill="{{color}}" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395\n    312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5\n    0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17\n    0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208\n    32s176 78.7 176 176-78.7 176-176 176z" />\n  <path fill="{{color}}" transform="scale(0.22,0.22) translate(1400,0)" d="M1216\n    320q0 26-19 45t-45 19h-128v1024h128q26 0 45 19t19 45-19 45l-256 256q-19\n    19-45 19t-45-19l-256-256q-19-19-19-45t19-45 45-19h128v-1024h-128q-26\n    0-45-19t-19-45 19-45l256-256q19-19 45-19t45 19l256 256q19 19 19 45z" />',viewBox:{x:640,y:512}}),SegmentationFreeHandEraseInside:v(s,{name:"SegmentationFreeHandEraseInside",iconContent:`${h} ${d}`,viewBox:l}),SegmentationFreeHandFillInside:v(s,{name:"SegmentationFreeHandFillInside",iconContent:`${h} ${c}`,viewBox:l}),SegmentationFreeHandEraseOutside:v(s,{name:"SegmentationFreeHandEraseOutside",iconContent:`${h} ${d}`,viewBox:l}),SegmentationFreeHandFillOutside:v(s,{name:"SegmentationFreeHandFillOutside",iconContent:`${h} ${c}`,viewBox:l}),SegmentationRectangleEraseInside:v(s,{name:"SegmentationRectangleEraseInside",iconContent:`${u} ${d}`,viewBox:l}),RectangleScissor:v(s,{name:"RectangleScissor",iconContent:`${u} ${c}`,viewBox:l}),"RectangleScissor.FILL_INSIDE":v(s,{name:"RectangleScissor.FILL_INSIDE",iconContent:`${u} ${c}`,viewBox:l}),"RectangleScissor.FILL_OUTSIDE":v(s,{name:"RectangleScissor.FILL_OUTSIDE",iconContent:`${u} ${c}`,viewBox:l}),"RectangleScissor.ERASE_OUTSIDE":v(s,{name:"RectangleScissor.ERASE_OUTSIDE",iconContent:`${u} ${d}`,viewBox:l}),"RectangleScissor.ERASE_INSIDE":v(s,{name:"RectangleScissor.ERASE_INSIDE",iconContent:`${u} ${d}`,viewBox:l}),CircleScissor:v(s,{name:"CircleScissor",iconContent:`${g} ${c}`,viewBox:l}),"CircleScissor.FILL_INSIDE":v(s,{name:"CircleScissor.FILL_INSIDE",iconContent:`${g} ${c}`,viewBox:l}),"CircleScissor.ERASE_OUTSIDE":v(s,{name:"CircleScissor.ERASE_OUTSIDE",iconContent:`${g} ${d}`,viewBox:l}),"CircleScissor.FILL_OUTSIDE":v(s,{name:"CircleScissor.FILL_OUTSIDE",iconContent:`${g} ${c}`,viewBox:l})};function v(e,t){return Object.assign(Object.create(e),{...t,name:t.name||e.name})}function f(e,t,n){p[e]=v(s,{iconContent:t,viewBox:n})}const m=Object.keys(p);var w=n(76712);const E=r.AnnotationStyleStates.Highlighted,b=r.ToolModes.Active;class y extends a{constructor(e,t,n,o,i){super(e,t,n,o,i)}static getDefinedCursor(e,t=!1,n){n||(n=(0,w.h)("color",{},E,b));const o=function(e,t,n){const o=t?"pointer":"cursor";return`${o}:${e}/${n}`}(e,t,n);let i=super.getDefinedCursor(o);if(!i){const a=function(e){return p[e]}(e);a&&(i=function(e,t,n,o,i){const{x:a,y:r}=e.mousePoint;return new y(function(e,t,n){const o=function(e,t,n){const o=(t?C:_)(e,n);return new Blob([o],{type:"image/svg+xml"})}(e,t,n),i=`${URL.createObjectURL(o)}#${e.name||"unknown"}-${t?"pointer":"cursor"}`;return i}(e,n,{color:o}),a,r,t,i)}(a,o,t,n,super.getDefinedCursor("default")),super.setDefinedCursor(o,i))}return i}}function I(e,t){const n=Object(t),o=Object.prototype.hasOwnProperty.bind(n);return(e+"").replace(/\{\{(\w+)\}\}/g,((e,t)=>o(t)?n[t]+"":""))}function _(e,t){const{iconContent:n,iconSize:o,viewBox:i}=e;return I(`\n    <svg data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"\n      width="${o}" height="${o}" viewBox="0 0\n      ${i.x} ${i.y}">\n      ${n}\n    </svg>`,t)}function C(e,t){const{iconContent:n,iconSize:o,viewBox:i,mousePointerGroupString:a}=e,r=16+o;return I(`\n    <svg data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"\n      width="${r}" height="${r}" viewBox="0 0 ${r} ${r}">\n      <g>${a}</g>\n      <g transform="translate(16, 16) scale(${o/Math.max(i.x,i.y,1)})">${n}</g>\n    </svg>`,t)}var T=n(7001);const S=function(e,t){let n=y.getDefinedCursor(t,!0);n||(n=o.A.getDefinedCursor(t)),n||(console.log(`Cursor ${t} is not defined either as SVG or as a standard cursor.`),n=o.A.getDefinedCursor(t)),(0,T.setElementCursor)(e,n)},x=[...m,...o.i]},89578:(e,t,n)=>{"use strict";n.r(t),n.d(t,{draw:()=>h,drawArrow:()=>R,drawCircle:()=>v,drawEllipse:()=>m,drawEllipseByCoordinates:()=>f,drawHandle:()=>w,drawHandles:()=>E,drawHeight:()=>y,drawLine:()=>b,drawLinkedTextBox:()=>A,drawPath:()=>_,drawPolyline:()=>I,drawRect:()=>M,drawRectByCoordinates:()=>O,drawRedactionRect:()=>k,drawTextBox:()=>S,setAttributesIfNecessary:()=>g,setNewAttributesIfValid:()=>p});var o=n(85204),i=n(81985);const a="viewport-element";function r(e,t){if(o.wk.svgNodeCache[e])return o.wk.svgNodeCache[e][t]?o.wk.svgNodeCache[e][t].domRef:void 0}function s(e,t,n,i){if(!o.wk.svgNodeCache[t])return null;o.wk.svgNodeCache[t][i]={touched:!0,domRef:n},e.appendChild(n)}function l(e,t){o.wk.svgNodeCache[e]&&o.wk.svgNodeCache[e][t]&&(o.wk.svgNodeCache[e][t].touched=!0)}function d(e,t){o.wk.svgNodeCache[t]&&Object.keys(o.wk.svgNodeCache[t]).forEach((n=>{const i=o.wk.svgNodeCache[t][n];!i.touched&&i.domRef&&(e.removeChild(i.domRef),delete o.wk.svgNodeCache[t][n])}))}const c=function(e){const t=(0,i.getEnabledElement)(e),{viewportId:n,renderingEngineId:c}=t,h=`${n}:${c}`,u=function(e){const t=`.${a}`,n=e.querySelector(t),o=n?.querySelector(":scope > .svg-layer");return o}(e);return Object.keys(o.wk.svgNodeCache[h]).forEach((e=>{o.wk.svgNodeCache[h][e].touched=!1})),{svgLayerElement:u,svgNodeCacheForCanvas:o.wk.svgNodeCache,getSvgNode:r.bind(this,h),appendNode:s.bind(this,u,h),setNodeTouched:l.bind(this,h),clearUntouched:d.bind(this,u,h)}};const h=function(e,t){const n=c(e);t(n),n.clearUntouched()};var u=n(97181);const g=function(e,t){Object.keys(e).forEach((n=>{const o=t.getAttribute(n),i=e[n];void 0===i||""===i?t.removeAttribute(n):o!==i&&t.setAttribute(n,i)}))};const p=function(e,t){Object.keys(e).forEach((n=>{const o=e[n];void 0!==o&&""!==o&&t.setAttribute(n,o)}))};const v=function(e,t,n,o,i,a={},r=""){const{color:s,fill:l,width:d,lineWidth:c,lineDash:h,fillOpacity:v,strokeOpacity:f}=Object.assign({color:"rgb(0, 255, 0)",fill:"transparent",width:"2",lineDash:void 0,lineWidth:void 0,strokeOpacity:1,fillOpacity:1},a),m=c||d,w=(0,u.A)(t,"circle",n),E=e.getSvgNode(w),b={cx:`${o[0]}`,cy:`${o[1]}`,r:`${i}`,stroke:s,fill:l,"stroke-width":m,"stroke-dasharray":h,"fill-opacity":v,"stroke-opacity":f};if(E)g(b,E),e.setNodeTouched(w);else{const t=document.createElementNS("http://www.w3.org/2000/svg","circle");""!==r&&t.setAttribute("data-id",r),p(b,t),e.appendNode(t,w)}};const f=function(e,t,n,o,i={},a=""){const{color:r,width:s,lineWidth:l,lineDash:d}=Object.assign({color:"rgb(0, 255, 0)",width:"2",lineWidth:void 0,lineDash:void 0},i),c=l||s,h=(0,u.A)(t,"ellipse",n),v=e.getSvgNode(h),[f,m,w,E]=o,b=Math.hypot(w[0]-E[0],w[1]-E[1]),y=Math.hypot(m[0]-f[0],m[1]-f[1]),I=180*Math.atan2(w[1]-E[1],w[0]-E[0])/Math.PI,_=[(w[0]+E[0])/2,(m[1]+f[1])/2],C={cx:`${_[0]}`,cy:`${_[1]}`,rx:`${b/2}`,ry:`${y/2}`,stroke:r,fill:"transparent",transform:`rotate(${I} ${_[0]} ${_[1]})`,"stroke-width":c,"stroke-dasharray":d};if(v)g(C,v),e.setNodeTouched(h);else{const t=document.createElementNS("http://www.w3.org/2000/svg","ellipse");""!==a&&t.setAttribute("data-id",a),p(C,t),e.appendNode(t,h)}};const m=function(e,t,n,o,i,a={},r=""){const s=[(o[0]+i[0])/2,o[1]],l=[(o[0]+i[0])/2,i[1]],d=[o[0],(o[1]+i[1])/2],c=[i[0],(o[1]+i[1])/2];f(e,t,n,[l,s,d,c],{},"")};const w=function(e,t,n,o,i={},a){const{color:r,handleRadius:s,width:l,lineWidth:d,fill:c,type:h,opacity:v}=Object.assign({color:"rgb(0, 255, 0)",handleRadius:"6",width:"2",lineWidth:void 0,fill:"transparent",type:"circle",opacity:1},i),f=d||l,m=(0,u.A)(t,"handle",`hg-${n}-index-${a}`);let w;if("circle"===h)w={cx:`${o[0]}`,cy:`${o[1]}`,r:s,stroke:r,fill:c,"stroke-width":f,opacity:v};else{if("rect"!==h)throw new Error(`Unsupported handle type: ${h}`);{const e=1.5*parseFloat(s);w={x:`${o[0]-.5*e}`,y:`${o[1]-.5*e}`,width:`${e}`,height:`${e}`,stroke:r,fill:c,"stroke-width":f,rx:""+.1*e,opacity:v}}}const E=e.getSvgNode(m);if(E)g(w,E),e.setNodeTouched(m);else{const t=document.createElementNS("http://www.w3.org/2000/svg",h);p(w,t),e.appendNode(t,m)}};const E=function(e,t,n,o,i={}){o.forEach(((o,a)=>{w(e,t,n,o,i,a)}))};function b(e,t,n,o,i,a={},r=""){if(isNaN(o[0])||isNaN(o[1])||isNaN(i[0])||isNaN(i[1]))return;const{color:s,width:l,lineWidth:d,lineDash:c,shadow:h}=Object.assign({color:"rgb(0, 255, 0)",width:"2",lineWidth:void 0,lineDash:void 0,shadow:void 0},a),v=d||l,f=(0,u.A)(t,"line",n),m=e.getSvgNode(f),w=h?`filter:url(#shadow-${e.svgLayerElement.id});`:"",E={x1:`${o[0]}`,y1:`${o[1]}`,x2:`${i[0]}`,y2:`${i[1]}`,stroke:s,style:w,"stroke-width":v,"stroke-dasharray":c};if(m)g(E,m),e.setNodeTouched(f);else{const t=document.createElementNS("http://www.w3.org/2000/svg","line");""!==r&&t.setAttribute("data-id",r),p(E,t),e.appendNode(t,f)}}function y(e,t,n,o,i,a={}){if(isNaN(o[0])||isNaN(o[1])||isNaN(i[0])||isNaN(i[1]))return;const{color:r,width:s,lineWidth:l,lineDash:d}=Object.assign({color:"rgb(0, 255, 0)",width:"2",lineWidth:void 0,lineDash:void 0},a),c=i[0]+(o[0]-i[0])/2,h=[c,o[1]],u=[c,i[1]],g={start:o,end:h},p={start:h,end:u},v={start:u,end:i};b(e,t,"1",g.start,g.end,{color:r,width:s,lineWidth:l}),b(e,t,"2",p.start,p.end,{color:r,width:s,lineWidth:l}),b(e,t,"3",v.start,v.end,{color:r,width:s,lineWidth:l})}function I(e,t,n,o,i){if(o.length<2)return;const{color:a="rgb(0, 255, 0)",width:r=10,fillColor:s="none",fillOpacity:l=0,lineWidth:d,lineDash:c,closePath:h=!1}=i,v=d||r,f=(0,u.A)(t,"polyline",n),m=e.getSvgNode(f);let w="";for(const e of o)w+=`${e[0].toFixed(1)}, ${e[1].toFixed(1)} `;if(h){const e=o[0];w+=`${e[0]}, ${e[1]}`}const E={points:w,stroke:a,fill:s,"fill-opacity":l,"stroke-width":v,"stroke-dasharray":c};if(m)g(E,m),e.setNodeTouched(f);else{const t=document.createElementNS("http://www.w3.org/2000/svg","polyline");p(E,t),e.appendNode(t,f)}}function _(e,t,n,o,i){const a=o.length&&o[0].length&&Array.isArray(o[0][0])?o:[o],{color:r="rgb(0, 255, 0)",width:s=10,fillColor:l="none",fillOpacity:d=0,lineWidth:c,lineDash:h,closePath:v=!1}=i,f=c||s,m=(0,u.A)(t,"path",n),w=e.getSvgNode(m);let E="";for(let e=0,t=a.length;e<t;e++){const t=a[e],n=t.length;if(!(n<2)){for(let e=0;e<n;e++){const n=t[e];E+=`${e?"L":"M"} ${n[0].toFixed(1)}, ${n[1].toFixed(1)} `}v&&(E+="Z ")}}if(!E)return;const b={d:E,stroke:r,fill:l,"fill-opacity":d,"stroke-width":f,"stroke-dasharray":h};if(w)g(b,w),e.setNodeTouched(m);else{const t=document.createElementNS("http://www.w3.org/2000/svg","path");p(b,t),e.appendNode(t,m)}}function C(e){const t=document.createElementNS("http://www.w3.org/2000/svg","tspan");return t.setAttribute("x","0"),t.setAttribute("dy","1.2em"),t.textContent=e,t}function T(e,t){let n=e.querySelector("rect.background");if(!t)return n&&e.removeChild(n),e.getBBox();n||(n=document.createElementNS("http://www.w3.org/2000/svg","rect"),n.setAttribute("class","background"),e.insertBefore(n,e.firstChild));const o=e.getBBox(),i={x:`${o.x}`,y:`${o.y}`,width:`${o.width}`,height:`${o.height}`,fill:t};return g(i,n),o}const S=function(e,t,n,o,i,a={}){return function(e,t,n,o=[""],i,a){const{padding:r,color:s,fontFamily:l,fontSize:d,background:c}=a;let h;const[p,v]=[i[0]+r,i[1]+r],f="http://www.w3.org/2000/svg",m=(0,u.A)(t,"text",n),w=e.getSvgNode(m);if(w){const t=w.querySelector("text"),n=Array.from(t.children);for(let e=0;e<n.length;e++){const t=n[e],i=o[e]||"";t.textContent=i}if(o.length>n.length){for(let e=0;e<o.length-n.length;e++){const i=C(o[e+n.length]);t.appendChild(i)}w.appendChild(t),e.appendNode(w,m)}const i={transform:`translate(${p} ${v})`};g({fill:s,"font-size":d,"font-family":l},t),g(i,w),h=T(w,c),e.setNodeTouched(m)}else{const t=document.createElementNS(f,"g");t.setAttribute("transform",`translate(${p} ${v})`);const n=function(e,t){const{color:n,fontFamily:o,fontSize:i}=t,a="http://www.w3.org/2000/svg",r=document.createElementNS(a,"text"),s="user-select: none; pointer-events: none; -webkit-tap-highlight-color:  rgba(255, 255, 255, 0);",l=`filter:url(#shadow-${e.svgLayerElement.id});`,d=`${s}${l}`;return r.setAttribute("x","0"),r.setAttribute("y","0"),r.setAttribute("fill",n),r.setAttribute("font-family",o),r.setAttribute("font-size",i),r.setAttribute("style",d),r}(e,a);for(let e=0;e<o.length;e++){const t=C(o[e]);n.appendChild(t)}t.appendChild(n),e.appendNode(t,m),h=T(t,c)}return Object.assign({},h,{x:p,y:v,height:h.height+r,width:h.width+r})}(e,t,n,o,i,Object.assign({fontFamily:"Helvetica, Arial, sans-serif",fontSize:"14px",color:"rgb(255, 255, 0)",background:"",padding:25,centerX:!1,centerY:!0},a))};var x=n(90554);const D=function(e,t,n,o,i,a,r={}){const s=o.length>0?(0,x.A)(o,i):i,l=function(e){const{x:t,y:n,height:o,width:i}=e,a=i/2,r=o/2;return[[t+a,n],[t,n+r],[t+a,n+o],[t+i,n+r]]}(a);b(e,t,`link-${n}`,s,(0,x.A)(l,s),Object.assign({color:"rgb(255, 255, 0)",lineWidth:"1",lineDash:"2,3"},r))};const A=function(e,t,n,o,i,a,r,s={}){const l=Object.assign({handleRadius:"6",centering:{x:!1,y:!0}},s),d=S(e,t,n,o,i,l);return D(e,t,n,a,i,d,l),d};function O(e,t,n,o,i={},a=""){const{color:r,width:s,lineWidth:l,lineDash:d}=Object.assign({color:"rgb(0, 255, 0)",width:"2",lineWidth:void 0,lineDash:void 0},i),c=l||s,h=(0,u.A)(t,"rect",n),v=e.getSvgNode(h),[f,m,w,E]=o,b=Math.hypot(f[0]-m[0],f[1]-m[1]),y=Math.hypot(f[0]-w[0],f[1]-w[1]),I=[(E[0]+f[0])/2,(E[1]+f[1])/2],_=[(w[0]+f[0])/2,(w[1]+f[1])/2],C=180*Math.atan2(I[1]-_[1],I[0]-_[0])/Math.PI,T={x:""+(I[0]-b/2),y:""+(I[1]-y/2),width:`${b}`,height:`${y}`,stroke:r,fill:"transparent",transform:`rotate(${C} ${I[0]} ${I[1]})`,"stroke-width":c,"stroke-dasharray":d};if(v)g(T,v),e.setNodeTouched(h);else{const t=document.createElementNS("http://www.w3.org/2000/svg","rect");""!==a&&t.setAttribute("data-id",a),p(T,t),e.appendNode(t,h)}}function M(e,t,n,o,i,a={},r=""){O(e,t,n,[[o[0],o[1]],[i[0],o[1]],[o[0],i[1]],[i[0],i[1]]],a,r)}function R(e,t,n,o,i,a={}){if(isNaN(o[0])||isNaN(o[1])||isNaN(i[0])||isNaN(i[1]))return;const{color:r,width:s,lineWidth:l,lineDash:d}=Object.assign({color:"rgb(0, 255, 0)",width:"2",lineWidth:void 0,lineDash:void 0},a);b(e,t,n,o,i,{color:r,width:s,lineWidth:l,lineDash:d});const c=Math.atan2(i[1]-o[1],i[0]-o[0]),h={start:[i[0]-10*Math.cos(c-Math.PI/7),i[1]-10*Math.sin(c-Math.PI/7)],end:i},u={start:[i[0]-10*Math.cos(c+Math.PI/7),i[1]-10*Math.sin(c+Math.PI/7)],end:i};b(e,t,"2",h.start,h.end,{color:r,width:s,lineWidth:l}),b(e,t,"3",u.start,u.end,{color:r,width:s,lineWidth:l})}function k(e,t,n,o,i,a={}){const{color:r,width:s,lineWidth:l,lineDash:d}=Object.assign({color:"rgb(0, 255, 0)",width:"2",lineWidth:void 0,lineDash:void 0},a),c=l||s,h=(0,u.A)(t,"rect",n),v=e.getSvgNode(h),f=[Math.min(o[0],i[0]),Math.min(o[1],i[1])],m=Math.abs(o[0]-i[0]),w=Math.abs(o[1]-i[1]),E={x:`${f[0]}`,y:`${f[1]}`,width:`${m}`,height:`${w}`,stroke:r,fill:"black","stroke-width":c,"stroke-dasharray":d};if(v)g(E,v),e.setNodeTouched(h);else{const t=document.createElementNS("http://www.w3.org/2000/svg","rect");p(E,t),e.appendNode(t,h)}}},75183:(e,t,n)=>{"use strict";var o;n.d(t,{A:()=>i}),function(e){e.Interaction="Interaction",e.HandlesUpdated="HandlesUpdated",e.StatsUpdated="StatsUpdated",e.InitialSetup="InitialSetup",e.Completed="Completed",e.InterpolationUpdated="InterpolationUpdated"}(o||(o={}));const i=o},94021:(e,t,n)=>{"use strict";var o;n.d(t,{A:()=>i}),function(e){e.TOOL_ACTIVATED="CORNERSTONE_TOOLS_TOOL_ACTIVATED",e.TOOLGROUP_VIEWPORT_ADDED="CORNERSTONE_TOOLS_TOOLGROUP_VIEWPORT_ADDED",e.TOOLGROUP_VIEWPORT_REMOVED="CORNERSTONE_TOOLS_TOOLGROUP_VIEWPORT_REMOVED",e.TOOL_MODE_CHANGED="CORNERSTONE_TOOLS_TOOL_MODE_CHANGED",e.ANNOTATION_ADDED="CORNERSTONE_TOOLS_ANNOTATION_ADDED",e.ANNOTATION_COMPLETED="CORNERSTONE_TOOLS_ANNOTATION_COMPLETED",e.ANNOTATION_MODIFIED="CORNERSTONE_TOOLS_ANNOTATION_MODIFIED",e.ANNOTATION_REMOVED="CORNERSTONE_TOOLS_ANNOTATION_REMOVED",e.ANNOTATION_SELECTION_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_SELECTION_CHANGE",e.ANNOTATION_LOCK_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_LOCK_CHANGE",e.ANNOTATION_VISIBILITY_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_VISIBILITY_CHANGE",e.ANNOTATION_RENDERED="CORNERSTONE_TOOLS_ANNOTATION_RENDERED",e.ANNOTATION_INTERPOLATION_PROCESS_COMPLETED="CORNERSTONE_TOOLS_ANNOTATION_INTERPOLATION_PROCESS_COMPLETED",e.INTERPOLATED_ANNOTATIONS_REMOVED="CORNERSTONE_TOOLS_INTERPOLATED_ANNOTATIONS_REMOVED",e.SEGMENTATION_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_MODIFIED",e.SEGMENTATION_RENDERED="CORNERSTONE_TOOLS_SEGMENTATION_RENDERED",e.SEGMENTATION_REPRESENTATION_ADDED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_ADDED",e.SEGMENTATION_ADDED="CORNERSTONE_TOOLS_SEGMENTATION_ADDED",e.SEGMENTATION_REPRESENTATION_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_MODIFIED",e.SEGMENTATION_REMOVED="CORNERSTONE_TOOLS_SEGMENTATION_REMOVED",e.SEGMENTATION_REPRESENTATION_REMOVED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_REMOVED",e.SEGMENTATION_DATA_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_DATA_MODIFIED",e.KEY_DOWN="CORNERSTONE_TOOLS_KEY_DOWN",e.KEY_UP="CORNERSTONE_TOOLS_KEY_UP",e.MOUSE_DOWN="CORNERSTONE_TOOLS_MOUSE_DOWN",e.MOUSE_UP="CORNERSTONE_TOOLS_MOUSE_UP",e.MOUSE_DOWN_ACTIVATE="CORNERSTONE_TOOLS_MOUSE_DOWN_ACTIVATE",e.MOUSE_DRAG="CORNERSTONE_TOOLS_MOUSE_DRAG",e.MOUSE_MOVE="CORNERSTONE_TOOLS_MOUSE_MOVE",e.MOUSE_CLICK="CORNERSTONE_TOOLS_MOUSE_CLICK",e.MOUSE_DOUBLE_CLICK="CORNERSTONE_TOOLS_MOUSE_DOUBLE_CLICK",e.MOUSE_WHEEL="CORNERSTONE_TOOLS_MOUSE_WHEEL",e.TOUCH_START="CORNERSTONE_TOOLS_TOUCH_START",e.TOUCH_START_ACTIVATE="CORNERSTONE_TOOLS_TOUCH_START_ACTIVATE",e.TOUCH_PRESS="CORNERSTONE_TOOLS_TOUCH_PRESS",e.TOUCH_DRAG="CORNERSTONE_TOOLS_TOUCH_DRAG",e.TOUCH_END="CORNERSTONE_TOOLS_TOUCH_END",e.TOUCH_TAP="CORNERSTONE_TOOLS_TAP",e.TOUCH_SWIPE="CORNERSTONE_TOOLS_SWIPE"}(o||(o={}));const i=o},84093:(e,t,n)=>{"use strict";var o;n.d(t,{A:()=>i}),function(e){e.OnInteractionStart="onInteractionStart",e.OnInteractionEnd="onInteractionEnd",e.Preview="preview",e.RejectPreview="rejectPreview",e.AcceptPreview="acceptPreview",e.Fill="fill",e.StrategyFunction="strategyFunction",e.CreateIsInThreshold="createIsInThreshold",e.Initialize="initialize",e.INTERNAL_setValue="setValue",e.ComputeInnerCircleRadius="computeInnerCircleRadius"}(o||(o={}));const i=o},49892:(e,t,n)=>{"use strict";var o;n.d(t,{A:()=>i}),function(e){e.Active="Active",e.Passive="Passive",e.Enabled="Enabled",e.Disabled="Disabled"}(o||(o={}));const i=o},10401:(e,t,n)=>{"use strict";var o;n.d(t,{H:()=>o}),function(e){e.UP="UP",e.DOWN="DOWN",e.LEFT="LEFT",e.RIGHT="RIGHT"}(o||(o={}))},99737:(e,t,n)=>{"use strict";n.r(t),n.d(t,{AnnotationStyleStates:()=>r,ChangeTypes:()=>u.A,Events:()=>l.A,KeyboardBindings:()=>i.q,MouseBindings:()=>i.i,SegmentationRepresentations:()=>d.A,StrategyCallbacks:()=>h.A,Swipe:()=>c.H,ToolModes:()=>a.A,WorkerTypes:()=>g});var o,i=n(66452),a=n(49892);!function(e){e.Default="",e.Highlighted="Highlighted",e.Selected="Selected",e.Locked="Locked",e.AutoGenerated="AutoGenerated"}(o||(o={}));const r=o;var s,l=n(94021),d=n(18682),c=n(10401),h=n(84093),u=n(75183);!function(e){e.POLYSEG_CONTOUR_TO_LABELMAP="Converting Contour to Labelmap",e.POLYSEG_SURFACE_TO_LABELMAP="Converting Surfaces to Labelmap",e.POLYSEG_CONTOUR_TO_SURFACE="Converting Contour to Surface",e.POLYSEG_LABELMAP_TO_SURFACE="Converting Labelmap to Surface",e.SURFACE_CLIPPING="Clipping Surfaces"}(s||(s={}));const g=s},50986:(e,t,n)=>{"use strict";n.d(t,{A:()=>f,r:()=>E});var o=n(81985),i=n(15295),a=n(95527),r=n(58640),s=n(8056),l=n(82056),d=n(93126),c=n(44049),h=n(72967),u=n(64843),g=n(7754),p=n(68040);const v="PlanarFreehandContourSegmentationTool";async function f(e){const t=e.detail.annotation;if(!(0,u.isContourSegmentationAnnotation)(t))return;const n=function(e){const t=(0,i.A)(e),n=t.find((e=>m(e,!0)));return n??t[0]}(t),g=function(e,t){const{annotationUID:n}=t;return(0,l.getAllAnnotations)().filter((o=>o.annotationUID&&o.annotationUID!==n&&(0,u.isContourSegmentationAnnotation)(o)&&(0,u.areSameSegment)(o,t)&&e.isReferenceViewable(o.metadata)))}(n,t);if(!g.length)return;const f=w(t.data.contour.polyline,n),b=function(e,t,n){const o=a.polyline.getAABB(t);for(let i=0;i<n.length;i++){const r=n[i],s=w(r.data.contour.polyline,e),l=a.polyline.getAABB(s),d=a.aabb.intersectAABB(o,l),c=d&&a.polyline.intersectPolyline(t,s),h=d&&!c&&a.polyline.containsPoints(s,t);if(c||h)return{targetAnnotation:r,targetPolyline:s,isContourHole:h}}}(n,f,g);if(!b)return;const{targetAnnotation:y,targetPolyline:I,isContourHole:_}=b;if(_){const{contourHoleProcessingEnabled:o=!1}=e.detail;if(!o)return;E(n,y,t)}else!function(e,t,n,i,g){if(!(0,p.l$)(v))return void console.warn(`${v} is not registered in cornerstone`);if(!m(e))return;const f=g[0],E=a.polyline.containsPoint(n,f),b=function(e,t){return(0,l.getChildAnnotations)(t).map((t=>({annotation:t,polyline:w(t.data.contour.polyline,e)})))}(e,t),y=new Set(b),I=new Map,_=(e,t)=>{let n=I.get(e);n||(n=[],I.set(e,n)),n.push(t),y.delete(t)},C=[];if(E){const e=a.polyline.mergePolylines(n,g);C.push(e),Array.from(y.keys()).forEach((t=>_(e,t)))}else{a.polyline.subtractPolylines(n,g).forEach((e=>{C.push(e),Array.from(y.keys()).forEach((t=>{a.polyline.containsPoints(e,t.polyline)&&(_(e,t),y.delete(t))}))}))}Array.from(I.values()).forEach((e=>e.forEach((e=>(0,l.clearParentAnnotation)(e.annotation)))));const{element:T}=e,S=(0,o.getEnabledElement)(T),{metadata:x,data:D}=t,{handles:A,segmentation:O}=D,{textBox:M}=A;(0,l.removeAnnotation)(i.annotationUID),(0,l.removeAnnotation)(t.annotationUID);for(let n=0;n<C.length;n++){const i=C[n],a=e.canvasToWorld(i[0]),r=e.canvasToWorld(i[i.length-1]),s={metadata:{...x,toolName:v,originalToolName:x.originalToolName||x.toolName},data:{cachedStats:{},handles:{points:[a,r],textBox:M?{...M}:void 0},contour:{polyline:[],closed:!0},spline:t.data.spline,segmentation:{...O}},annotationUID:o.utilities.uuidv4(),highlighted:!0,invalidated:!0,isLocked:!1,isVisible:void 0,interpolationUID:t.interpolationUID,interpolationCompleted:t.interpolationCompleted};(0,h.A)(s,{points:i,closed:!0,targetWindingDirection:d.W.Clockwise},e),(0,l.addAnnotation)(s,T),(0,u.addContourSegmentationAnnotation)(s),(0,c.XF)(s,e.element),I.get(i)?.forEach((e=>(0,l.addChildAnnotation)(s,e.annotation)))}!function(e,t,n){const{viewport:o}=e,{element:i}=o,a=new Set([v,t.metadata.toolName,n.metadata.toolName]);for(const e of a.values()){const t=(0,s.getViewportIdsWithToolToRender)(i,e);(0,r.A)(t)}new Promise((e=>window.requestAnimationFrame(e)))}(S,t,i)}(n,y,I,t,f)}function m(e,t=!1){const n="PlanarFreehandContourSegmentationTool",o=(0,g.getToolGroupForViewport)(e.id,e.renderingEngineId);let i;return o.hasTool(n)?o.getToolOptions(n)||(i=`Tool ${n} must be in active/passive state`):i=`Tool ${n} not added to ${o.id} toolGroup`,i&&!t&&console.warn(i),!i}function w(e,t){const n=e.length,o=new Array(n);for(let i=0;i<n;i++)o[i]=t.worldToCanvas(e[i]);return o}function E(e,t,n){const{windingDirection:o}=t.data.contour,{windingDirection:i}=n.data.contour;(0,l.addChildAnnotation)(t,n),(0,u.removeContourSegmentationAnnotation)(n);const{contour:a}=n.data,d=w(a.polyline,e);(0,h.A)(n,{points:d,closed:a.closed},e);const{element:c}=e,g=new Set([v,t.metadata.toolName,n.metadata.toolName]);for(const e of g.values()){const t=(0,s.getViewportIdsWithToolToRender)(c,e);(0,r.A)(t)}}},59718:(e,t,n)=>{"use strict";n.d(t,{tQ:()=>L,nm:()=>U,Gg:()=>V,ge:()=>N,_9:()=>M,kt:()=>v.A,bH:()=>s,qI:()=>_,sp:()=>C,F_:()=>h,CG:()=>p});var o=n(91099),i=n(68014),a=n(41343);function r(e){e.removeEventListener("dblclick",o.A),e.removeEventListener("mousedown",i.Ay),e.removeEventListener("mousemove",a.A),e.removeEventListener("dblclick",i.DF,{capture:!0})}const s={enable:function(e){r(e),e.addEventListener("dblclick",o.A),e.addEventListener("mousedown",i.Ay),e.addEventListener("mousemove",a.A),e.addEventListener("dblclick",i.DF,{capture:!0})},disable:r};var l=n(41666),d=n(82603);function c(e){l.A.disable(e),e.removeEventListener("touchstart",d.A)}const h={enable:function(e){c(e),l.A.enable(e),e.addEventListener("touchstart",d.A,{passive:!1})},disable:c};var u=n(17806);function g(e){e.removeEventListener("wheel",u.A)}const p={enable:function(e){g(e),e.addEventListener("wheel",u.A,{passive:!1})},disable:g};var v=n(39595),f=n(24917),m=n(81985),w=n(98870),E=n(99737),b=n(59452);const y=function(e){const{segmentationId:t,modifiedSlicesToUse:n}=e.detail,{representationData:o}=w.getSegmentation(t),i=w.getViewportIdsWithSegmentation(t),a=i.some((e=>{const{viewport:t}=(0,m.getEnabledElementByViewportId)(e);return t instanceof m.VolumeViewport})),r=i.some((e=>{const{viewport:t}=(0,m.getEnabledElementByViewportId)(e);return t instanceof m.StackViewport})),s=a&&r;i.forEach((e=>{const{viewport:a}=(0,m.getEnabledElementByViewportId)(e);a instanceof m.VolumeViewport&&function({modifiedSlicesToUse:e,representationData:t,type:n}){const o=m.cache.getVolume(t[n].volumeId);if(!o)return void console.warn("segmentation not found in cache");const{imageData:i,vtkOpenGLTexture:a}=o;let r;if(e?.length>0)r=e;else{const e=i.getDimensions()[2];r=[...Array(e).keys()]}r.forEach((e=>{a.setUpdatedFrame(e)})),i.modified()}({modifiedSlicesToUse:s?[]:n,representationData:o,type:E.SegmentationRepresentations.Labelmap}),a instanceof m.StackViewport&&function({viewportIds:e,segmentationId:t}){e.forEach((e=>{let n=w.getSegmentationRepresentations(e,{segmentationId:t});n=n.filter((e=>e.type===E.SegmentationRepresentations.Labelmap)),n.forEach((n=>{if(n.segmentationId!==t)return;const o=(0,m.getEnabledElementByViewportId)(e);if(!o)return;const{viewport:i}=o;if(i instanceof m.VolumeViewport)return;const a=(0,b.wV)(e,t);if(!a)return;const r=a.actor.getMapper().getInputData(),s=w.getCurrentLabelmapImageIdForViewport(e,t),l=m.cache.getImage(s);r.modified(),m.utilities.updateVTKImageDataWithCornerstoneImage(r,l)}))}))}({viewportIds:i,segmentationId:t})}))};var I=n(33283);const _=function(e){const{segmentationId:t}=e.detail,{representationData:n}=(0,I.T)(t);n.Labelmap&&y(e),(0,f.fy)(t)},C=function(e){const{segmentationId:t}=e.detail;(0,f.fy)(t)};var T=n(42008),S=n(58498),x=n(78231),D=n(97577),A=n(93210);new Map;function O(e){const t=e.detail,{viewportId:n,renderingEngineId:o}=t,{viewport:i}=(0,m.getEnabledElementByIds)(n,o),a=(0,A.r$)(n);if(!a?.length)return;const r=a.filter((e=>e.type===E.SegmentationRepresentations.Labelmap)),s=i.getActors();r.forEach((e=>{const{segmentationId:t}=e;(0,x.t)(n,t)}));const l=r.map((e=>(0,b.wV)(n,e.segmentationId))).filter((e=>void 0!==e));l.length&&(l.forEach((e=>{r.find((t=>(0,D.v)(n,t.segmentationId)===e.referencedId))||i.removeActors([e.uid])})),r.forEach((t=>{const{segmentationId:o}=t,a=i.getCurrentImageId(),r=(0,D.v)(n,o);if(!r)return;const l=m.cache.getImage(r);if(!l)return void console.warn("No derived image found in the cache for segmentation representation",t);const d=s.find((e=>e.referencedId===r));if(!d){const{dimensions:e,spacing:t,direction:s}=i.getImageDataMetadata(l),d=m.cache.getImage(a)||{imageId:a},{origin:c}=i.getImageDataMetadata(d),h=c,u=l.voxelManager.getConstructor(),g=l.voxelManager.getScalarData(),p=T.Ay.newInstance({name:"Pixels",numberOfComponents:1,values:new u(g)}),v=S.Ay.newInstance();return v.setDimensions(e[0],e[1],1),v.setSpacing(t),v.setDirection(s),v.setOrigin(h),v.getPointData().setScalars(p),v.modified(),i.addImages([{imageId:r,representationUID:`${o}-${E.SegmentationRepresentations.Labelmap}`,callback:({imageActor:e})=>{e.getMapper().setInputData(v)}}]),void(0,f.h6)(n)}{const e=d.actor.getMapper().getInputData();e.setDerivedImage?e.setDerivedImage(l):m.utilities.updateVTKImageDataWithCornerstoneImage(e,l)}i.render(),e.type===m.Enums.Events.IMAGE_RENDERED&&i.element.removeEventListener(m.Enums.Events.IMAGE_RENDERED,O)})))}const M={enable:function(e){const{viewport:t}=(0,m.getEnabledElement)(e);t instanceof m.BaseVolumeViewport||(e.addEventListener(m.Enums.Events.STACK_NEW_IMAGE,O),e.addEventListener(m.Enums.Events.IMAGE_RENDERED,O))},disable:function(e){e.removeEventListener(m.Enums.Events.STACK_NEW_IMAGE,O),e.removeEventListener(m.Enums.Events.IMAGE_RENDERED,O)}};var R=n(64843),k=n(50986);function L(e){const t=e.detail.annotation;R.isContourSegmentationAnnotation(t)&&(0,k.A)(e)}var P=n(58640);const N=function(e){if(!e.detail.removed.length)return;(0,m.getRenderingEngines)().forEach((e=>{const t=e.getViewports().map((e=>e.id));(0,P.t)(t)}))};const U=function(e){const{viewportId:t}=e.detail;(0,P.A)([t])};function V(e){const t=e.detail.annotation;R.isContourSegmentationAnnotation(t)&&function(e){const t=e.detail.annotation;(0,R.removeContourSegmentationAnnotation)(t)}(e)}},55139:(e,t,n)=>{"use strict";n.r(t),n.d(t,{AdvancedMagnifyTool:()=>Ht,AngleTool:()=>Oo,AnnotationDisplayTool:()=>Ge.wh,AnnotationTool:()=>Ge.EC,ArrowAnnotateTool:()=>xo,BaseTool:()=>Ge.oS,BidirectionalTool:()=>mn.A,BrushTool:()=>hi.A,CONSTANTS:()=>i,CircleROIStartEndThresholdTool:()=>ci,CircleROITool:()=>Kn,CircleScissorsTool:()=>ei,CobbAngleTool:()=>Lo,CrosshairsTool:()=>Dt,DragProbeTool:()=>Un,ETDRSGridTool:()=>Xn,EllipticalROITool:()=>$n,Enums:()=>l,EraserTool:()=>$o,HeightTool:()=>Dn,KeyImageTool:()=>Fo,LengthTool:()=>Cn,LivewireContourSegmentationTool:()=>_o,LivewireContourTool:()=>bo,MIPJumpToClickTool:()=>pt,MagnifyTool:()=>Mt,OrientationMarkerTool:()=>xi,OverlayGridTool:()=>Kt,PaintFillTool:()=>mi,PanTool:()=>ze,PlanarFreehandContourSegmentationTool:()=>vo.A,PlanarFreehandROITool:()=>po.A,PlanarRotateTool:()=>dt,ProbeTool:()=>Ln,RectangleROIStartEndThresholdTool:()=>ri.A,RectangleROIThresholdTool:()=>ai.A,RectangleROITool:()=>Vn.A,RectangleScissorsTool:()=>Yo,ReferenceCursors:()=>nn,ReferenceLinesTool:()=>zt,ScaleOverlayTool:()=>rn,SculptorTool:()=>gn,SegmentSelectTool:()=>Ri,SegmentationIntersectionTool:()=>en,SphereScissorsTool:()=>ii,SplineContourSegmentationTool:()=>go,SplineROITool:()=>ho,StackScrollTool:()=>rt,Synchronizer:()=>te,SynchronizerManager:()=>o,ToolGroupManager:()=>ne,TrackballRotateTool:()=>Ke,Types:()=>We,UltrasoundDirectionalTool:()=>Vo,VideoRedactionTool:()=>Pi,VolumeRotateTool:()=>fn,WindowLevelRegionTool:()=>it,WindowLevelTool:()=>Xe,ZoomTool:()=>ht,addTool:()=>d.Gx,annotation:()=>Fe,cancelActiveManipulations:()=>J,cursors:()=>He,destroy:()=>ge,drawing:()=>Ve,init:()=>ue,removeTool:()=>d.Bl,segmentation:()=>je,state:()=>B.wk,synchronizers:()=>a,utilities:()=>Be});var o={};n.r(o),n.d(o,{createSynchronizer:()=>oe,destroy:()=>ie,destroySynchronizer:()=>se,getAllSynchronizers:()=>re,getSynchronizer:()=>ae,getSynchronizersForViewport:()=>$});var i={};n.r(i),n.d(i,{COLOR_LUT:()=>fe.A});var a={};n.r(a),n.d(a,{createCameraPositionSynchronizer:()=>Ee,createImageSliceSynchronizer:()=>ke,createPresentationViewSynchronizer:()=>Ie,createSlabThicknessSynchronizer:()=>Ne,createStackImageSynchronizer:()=>Ue,createVOISynchronizer:()=>Ce,createZoomPanSynchronizer:()=>xe});var r=n(81985),s=n(82056),l=n(99737),d=n(68040),c=n(59718),h=n(56069);const u=function(e){(0,h.A)(e.detail.element)},g={enable:function(e){e.addEventListener(r.Enums.Events.IMAGE_RENDERED,u)},disable:function(e){e.removeEventListener(r.Enums.Events.IMAGE_RENDERED,u)}};var p=n(94021),v=n(40100);const f={enable:function(e){e.addEventListener(p.A.MOUSE_CLICK,v.q_),e.addEventListener(p.A.MOUSE_DOWN,v.cT),e.addEventListener(p.A.MOUSE_DOWN_ACTIVATE,v.Xd),e.addEventListener(p.A.MOUSE_DOUBLE_CLICK,v.LM),e.addEventListener(p.A.MOUSE_DRAG,v.al),e.addEventListener(p.A.MOUSE_MOVE,v.tG),e.addEventListener(p.A.MOUSE_UP,v.Je),e.addEventListener(p.A.MOUSE_WHEEL,v.rO)},disable:function(e){e.removeEventListener(p.A.MOUSE_CLICK,v.q_),e.removeEventListener(p.A.MOUSE_DOWN,v.cT),e.removeEventListener(p.A.MOUSE_DOWN_ACTIVATE,v.Xd),e.removeEventListener(p.A.MOUSE_DOUBLE_CLICK,v.LM),e.removeEventListener(p.A.MOUSE_DRAG,v.al),e.removeEventListener(p.A.MOUSE_MOVE,v.tG),e.removeEventListener(p.A.MOUSE_UP,v.Je),e.removeEventListener(p.A.MOUSE_WHEEL,v.rO)}};var m=n(74690);const w={enable:function(e){e.addEventListener(p.A.KEY_DOWN,m.u),e.addEventListener(p.A.KEY_UP,m.L)},disable:function(e){e.removeEventListener(p.A.KEY_DOWN,m.u),e.removeEventListener(p.A.KEY_UP,m.L)}};var E=n(70333);const{Active:b,Passive:y,Enabled:I}=l.ToolModes,_=function(e){(0,E.A)(e,[b,y,I]).forEach((t=>{t.onCameraModified&&t.onCameraModified(e)}))},C={enable:function(e){e.addEventListener(r.Enums.Events.CAMERA_MODIFIED,_)},disable:function(e){e.removeEventListener(r.Enums.Events.CAMERA_MODIFIED,_)}},{Active:T,Passive:S,Enabled:x}=l.ToolModes,D=function(e){(0,E.A)(e,[T,S,x]).forEach((t=>{t.onImageSpacingCalibrated&&t.onImageSpacingCalibrated(e)}))},A={enable:function(e){e.addEventListener(r.Enums.Events.IMAGE_SPACING_CALIBRATED,D)},disable:function(e){e.removeEventListener(r.Enums.Events.IMAGE_SPACING_CALIBRATED,D)}};var O=n(84971);const M={enable:function(e){e.addEventListener(p.A.TOUCH_START,O.gX),e.addEventListener(p.A.TOUCH_START_ACTIVATE,O.$F),e.addEventListener(p.A.TOUCH_DRAG,O.Oz),e.addEventListener(p.A.TOUCH_END,O.ls),e.addEventListener(p.A.TOUCH_TAP,O.lI),e.addEventListener(p.A.TOUCH_PRESS,O.x5)},disable:function(e){e.removeEventListener(p.A.TOUCH_START,O.gX),e.removeEventListener(p.A.TOUCH_START_ACTIVATE,O.$F),e.removeEventListener(p.A.TOUCH_DRAG,O.Oz),e.removeEventListener(p.A.TOUCH_END,O.ls),e.removeEventListener(p.A.TOUCH_PRESS,O.x5)}};var R=n(15773);const k={enable:function(){r.eventTarget.addEventListener(p.A.ANNOTATION_COMPLETED,R.A.handleAnnotationCompleted),r.eventTarget.addEventListener(p.A.ANNOTATION_MODIFIED,R.A.handleAnnotationUpdate),r.eventTarget.addEventListener(p.A.ANNOTATION_REMOVED,R.A.handleAnnotationDelete)},disable:function(){r.eventTarget.removeEventListener(p.A.ANNOTATION_COMPLETED,R.A.handleAnnotationCompleted),r.eventTarget.removeEventListener(p.A.ANNOTATION_MODIFIED,R.A.handleAnnotationUpdate),r.eventTarget.removeEventListener(p.A.ANNOTATION_REMOVED,R.A.handleAnnotationDelete)}},{Active:L,Passive:P,Enabled:N}=l.ToolModes,U=function(e){(0,E.A)(e,[L,P,N]).forEach((t=>{t.onResetCamera&&t.onResetCamera(e)}))},V={enable:function(e){e.addEventListener(r.Enums.Events.CAMERA_RESET,U)},disable:function(e){e.removeEventListener(r.Enums.Events.CAMERA_RESET,U)}};var B=n(85204),H=n(39011);function W(e){const{element:t,viewportId:n}=e.detail,o=function(e){const t="http://www.w3.org/2000/svg",n=document.createElementNS(t,"svg"),o=`svg-layer-${e}`;n.classList.add("svg-layer"),n.setAttribute("id",o),n.setAttribute("xmlns","http://www.w3.org/2000/svg"),n.style.width="100%",n.style.height="100%",n.style.pointerEvents="none",n.style.position="absolute";const i=document.createElementNS(t,"defs"),a=document.createElementNS(t,"filter"),r=document.createElementNS(t,"feOffset"),s=document.createElementNS(t,"feColorMatrix"),l=document.createElementNS(t,"feBlend");return a.setAttribute("id",`shadow-${o}`),a.setAttribute("filterUnits","userSpaceOnUse"),r.setAttribute("result","offOut"),r.setAttribute("in","SourceGraphic"),r.setAttribute("dx","0.5"),r.setAttribute("dy","0.5"),s.setAttribute("result","matrixOut"),s.setAttribute("in","offOut"),s.setAttribute("in2","matrix"),s.setAttribute("values","0.2 0 0 0 0 0 0.2 0 0 0 0 0 0.2 0 0 0 0 0 1 0"),l.setAttribute("in","SourceGraphic"),l.setAttribute("in2","matrixOut"),l.setAttribute("mode","normal"),a.appendChild(r),a.appendChild(s),a.appendChild(l),i.appendChild(a),n.appendChild(i),n}(n);var i;!function(e){const{viewportUid:t,renderingEngineUid:n}=e.dataset,o=`${t}:${n}`;B.wk.svgNodeCache[o]={}}(t),i=o,t.querySelector("div.viewport-element").appendChild(i),H.o.addViewportElement(n,t),c.bH.enable(t),c.CG.enable(t),c.F_.enable(t),c.kt.enable(t),c._9.enable(t),g.enable(t),C.enable(t),A.enable(t),V.enable(t),f.enable(t),w.enable(t),M.enable(t),B.wk.enabledElements.push(t)}var F=n(57725),j=n(39848),G=n(6802);const $=function(e,t){const n=[];if(!t&&!e)throw new Error("At least one of renderingEngineId or viewportId should be given");for(let o=0;o<B.wk.synchronizers.length;o++){const i=B.wk.synchronizers[o],a=!i.isDisabled(),r=i.hasSourceViewport(t,e),s=i.hasTargetViewport(t,e);a&&(r||s)&&n.push(i)}return n};var z=n(65136);const q="viewport-element";const Z=e=>{const t=(0,r.getEnabledElement)(e);$(t.viewportId,t.renderingEngineId).forEach((e=>{e.remove(t)}))},K=e=>{const{renderingEngineId:t,viewportId:n}=(0,r.getEnabledElement)(e),o=(0,z.A)(n,t);o&&o.removeViewports(t,n)};const Y=function(e){const t=B.wk.enabledElements.findIndex((t=>t===e));t>-1&&B.wk.enabledElements.splice(t,1)},X=function(e){const{element:t,viewportId:n}=e.detail;!function(e){const{viewportUid:t,renderingEngineUid:n}=e.dataset,o=`${t}:${n}`;delete B.wk.svgNodeCache[o]}(t),function(e){const t=e.querySelector(`div.${q}`),n=t.querySelector("svg");n&&t.removeChild(n)}(t),H.o.removeViewportElement(n,t),c.bH.disable(t),c.CG.disable(t),c.F_.disable(t),c.kt.disable(t),c._9.disable(t),g.disable(t),C.disable(t),A.disable(t),V.disable(t),f.disable(t),w.disable(t),M.disable(t),Z(t),K(t),Y(t)};function J(e){const t=(0,j.A)(e,[l.ToolModes.Active,l.ToolModes.Passive]),n=(0,F.A)(e,t);for(const{tool:t}of n){const n=t.cancel(e);if(n)return n}}function Q(e,t){return e.findIndex((e=>t.renderingEngineId===e.renderingEngineId&&t.viewportId===e.viewportId))}function ee(e,t){return e.some((e=>e.renderingEngineId===t.renderingEngineId&&e.viewportId===t.viewportId))}const te=class{constructor(e,t,n,o){this._viewportOptions={},this._onEvent=e=>{if(!0===this._ignoreFiredEvents)return;if(!this._targetViewports.length)return;const t="element"===this._eventSource?(0,r.getEnabledElement)(e.currentTarget):(0,r.getEnabledElementByViewportId)(e.detail?.viewportId);if(!t)return;const{renderingEngineId:n,viewportId:o}=t;this._sourceViewports.find((e=>e.viewportId===o))&&this.fireEvent({renderingEngineId:n,viewportId:o},e)},this._enabled=!0,this._eventName=t,this._eventHandler=n,this._ignoreFiredEvents=!1,this._sourceViewports=[],this._targetViewports=[],this._options=o||{},this._eventSource=this._options.eventSource||"element",this._auxiliaryEvents=this._options.auxiliaryEvents||[],this.id=e}isDisabled(){return!this._enabled||!this._hasSourceElements()}setOptions(e,t={}){this._viewportOptions[e]=t}setEnabled(e){this._enabled=e}getOptions(e){return this._viewportOptions[e]}add(e){this.addTarget(e),this.addSource(e)}addSource(e){if(ee(this._sourceViewports,e))return;const{renderingEngineId:t,viewportId:n}=e,o=(0,r.getRenderingEngine)(t).getViewport(n);if(!o)return void console.warn(`Synchronizer.addSource: No viewport for ${t} ${n}`);("element"===this._eventSource?o.element:r.eventTarget).addEventListener(this._eventName,this._onEvent.bind(this)),this._auxiliaryEvents.forEach((({name:e,source:t})=>{("element"===t?o.element:r.eventTarget).addEventListener(e,this._onEvent.bind(this))})),this._updateDisableHandlers(),this._sourceViewports.push(e)}addTarget(e){ee(this._targetViewports,e)||(this._targetViewports.push(e),this._updateDisableHandlers())}getSourceViewports(){return this._sourceViewports}getTargetViewports(){return this._targetViewports}destroy(){this._sourceViewports.forEach((e=>this.removeSource(e))),this._targetViewports.forEach((e=>this.removeTarget(e)))}remove(e){this.removeTarget(e),this.removeSource(e)}removeSource(e){const t=Q(this._sourceViewports,e);if(-1===t)return;const n="element"===this._eventSource?this.getViewportElement(e):r.eventTarget;this._sourceViewports.splice(t,1),n.removeEventListener(this._eventName,this._eventHandler),this._auxiliaryEvents.forEach((({name:t,source:n})=>{("element"===n?this.getViewportElement(e):r.eventTarget).removeEventListener(t,this._eventHandler)})),this._updateDisableHandlers()}removeTarget(e){const t=Q(this._targetViewports,e);-1!==t&&(this._targetViewports.splice(t,1),this._updateDisableHandlers())}hasSourceViewport(e,t){return ee(this._sourceViewports,{renderingEngineId:e,viewportId:t})}hasTargetViewport(e,t){return ee(this._targetViewports,{renderingEngineId:e,viewportId:t})}fireEvent(e,t){if(this.isDisabled()||this._ignoreFiredEvents)return;this._ignoreFiredEvents=!0;const n=[];try{for(let o=0;o<this._targetViewports.length;o++){const i=this._targetViewports[o];if(e.viewportId===i.viewportId)continue;const a=this._eventHandler(this,e,i,t,this._options);a instanceof Promise&&n.push(a)}}catch(e){console.warn(`Synchronizer, for: ${this._eventName}`,e)}finally{n.length?Promise.allSettled(n).then((()=>{this._ignoreFiredEvents=!1})):this._ignoreFiredEvents=!1}}_hasSourceElements(){return 0!==this._sourceViewports.length}_updateDisableHandlers(){const e=function(e,t){const n=[],o=e.concat(t);for(let e=0;e<o.length;e++){const t=o[e];n.some((e=>t.renderingEngineId===e.renderingEngineId&&t.viewportId===e.viewportId))||n.push(t)}return n}(this._sourceViewports,this._targetViewports),t=this.remove.bind(this),n=e=>{t(e.detail.element)};e.forEach((e=>{const t=this.getEventSource(e);t.removeEventListener(r.Enums.Events.ELEMENT_DISABLED,n),t.addEventListener(r.Enums.Events.ELEMENT_DISABLED,n)}))}getEventSource(e){return"element"===this._eventSource?this.getViewportElement(e):r.eventTarget}getViewportElement(e){const{renderingEngineId:t,viewportId:n}=e,o=(0,r.getRenderingEngine)(t);if(!o)throw new Error(`No RenderingEngine for Id: ${t}`);return o.getViewport(n).element}};n(48145);var ne=n(7754);const oe=function(e,t,n,o){if(B.wk.synchronizers.some((t=>t.id===e)))throw new Error(`Synchronizer with id '${e}' already exists.`);const i=new te(e,t,n,o);return B.wk.synchronizers.push(i),i};const ie=function(){for(;B.wk.synchronizers.length>0;){B.wk.synchronizers.pop().destroy()}};const ae=function(e){return B.wk.synchronizers.find((t=>t.id===e))};const re=function(){return B.wk.synchronizers};const se=function(e){const t=B.wk.synchronizers.findIndex((t=>t.id===e));if(t>-1){B.wk.synchronizers[t].destroy(),B.wk.synchronizers.splice(t,1)}};var le=n(59475),de=n(24917);const ce=function(e){const{viewportId:t}=e.detail;(0,de.h6)(t)};let he=!1;function ue(e={}){he||(!function(){pe();const e=r.Enums.Events.ELEMENT_ENABLED,t=r.Enums.Events.ELEMENT_DISABLED;r.eventTarget.addEventListener(e,W),r.eventTarget.addEventListener(t,X),k.enable()}(),ve(),r.eventTarget.addEventListener(l.Events.ANNOTATION_COMPLETED,c.tQ),r.eventTarget.addEventListener(l.Events.ANNOTATION_MODIFIED,c.nm),r.eventTarget.addEventListener(l.Events.ANNOTATION_SELECTION_CHANGE,c.ge),r.eventTarget.addEventListener(l.Events.ANNOTATION_SELECTION_CHANGE,c.ge),r.eventTarget.addEventListener(l.Events.ANNOTATION_REMOVED,c.Gg),r.eventTarget.addEventListener(l.Events.SEGMENTATION_MODIFIED,c.sp),r.eventTarget.addEventListener(l.Events.SEGMENTATION_DATA_MODIFIED,c.qI),r.eventTarget.addEventListener(l.Events.SEGMENTATION_REPRESENTATION_MODIFIED,ce),r.eventTarget.addEventListener(l.Events.SEGMENTATION_REPRESENTATION_ADDED,ce),he=!0)}function ge(){pe(),ve(),ne.destroy(),(0,B.qh)();const e=(0,s.getAnnotationManager)(),t=le._6;e.restoreAnnotations({}),t.resetState(),he=!1}function pe(){const e=r.Enums.Events.ELEMENT_ENABLED,t=r.Enums.Events.ELEMENT_DISABLED;r.eventTarget.removeEventListener(e,W),r.eventTarget.removeEventListener(t,X),k.disable()}function ve(){r.eventTarget.removeEventListener(l.Events.ANNOTATION_COMPLETED,c.tQ),r.eventTarget.removeEventListener(l.Events.ANNOTATION_MODIFIED,c.nm),r.eventTarget.removeEventListener(l.Events.ANNOTATION_SELECTION_CHANGE,c.ge),r.eventTarget.removeEventListener(l.Events.ANNOTATION_SELECTION_CHANGE,c.ge),r.eventTarget.removeEventListener(l.Events.SEGMENTATION_MODIFIED,c.sp),r.eventTarget.removeEventListener(l.Events.SEGMENTATION_DATA_MODIFIED,c.qI),r.eventTarget.removeEventListener(l.Events.SEGMENTATION_REPRESENTATION_MODIFIED,ce),r.eventTarget.removeEventListener(l.Events.SEGMENTATION_REPRESENTATION_ADDED,ce)}var fe=n(93952);function me(e,t,n,o){const{camera:i}=o.detail,a=(0,r.getRenderingEngine)(n.renderingEngineId);if(!a)throw new Error(`No RenderingEngine for Id: ${n.renderingEngineId}`);const s=a.getViewport(n.viewportId);s.setCamera(i),s.render()}const{CAMERA_MODIFIED:we}=r.Enums.Events;function Ee(e){return oe(e,we,me)}function be(e,t,n,o,i){const a=(0,r.getRenderingEngine)(n.renderingEngineId);if(!a)throw new Error(`No RenderingEngine for Id: ${n.renderingEngineId}`);const s=a.getViewport(n.viewportId),l=a.getViewport(t.viewportId).getViewPresentation(i);s.setViewPresentation(l),s.render()}const{CAMERA_MODIFIED:ye}=r.Enums.Events;function Ie(e,t){return oe(e,ye,be,{viewPresentation:t})}function _e(e,t,n,o,i){const a=o.detail,{volumeId:s,range:l,invertStateChanged:d,invert:c,colormap:h}=a,u=(0,r.getRenderingEngine)(n.renderingEngineId);if(!u)throw new Error(`Rendering Engine does not exist: ${n.renderingEngineId}`);const g=u.getViewport(n.viewportId),p={voiRange:l};if(i?.syncInvertState&&d&&(p.invert=c),i?.syncColormap&&h&&(p.colormap=h),g instanceof r.BaseVolumeViewport){g._actors&&g._actors.size>1?g.setProperties(p,s):g.setProperties(p)}else{if(!(g instanceof r.StackViewport))throw new Error("Viewport type not supported.");g.setProperties(p)}g.render()}function Ce(e,t){t=Object.assign({syncInvertState:!0,syncColormap:!0},t);return oe(e,r.Enums.Events.VOI_MODIFIED,_e,{auxiliaryEvents:[{name:r.Enums.Events.COLORMAP_MODIFIED}],...t})}function Te(e,t,n){const o=(0,r.getRenderingEngine)(n.renderingEngineId);if(!o)throw new Error(`No RenderingEngine for Id: ${n.renderingEngineId}`);const i=e.getOptions(n.viewportId),a=o.getViewport(n.viewportId),s=o.getViewport(t.viewportId);if(!1!==i?.syncZoom){const e=s.getZoom();a.setZoom(e)}if(!1!==i?.syncPan){const e=s.getPan();a.setPan(e)}a.render()}const{CAMERA_MODIFIED:Se}=r.Enums.Events;function xe(e){return oe(e,Se,Te)}var De=n(3823);const Ae=(e,t)=>r.utilities.spatialRegistrationMetadataProvider.get("spatialRegistrationModule",e,t);async function Oe(e,t,n){const o=(0,r.getRenderingEngine)(n.renderingEngineId);if(!o)throw new Error(`No RenderingEngine for Id: ${n.renderingEngineId}`);const i=o.getViewport(t.viewportId),a=e.getOptions(n.viewportId);if(a?.disabled)return;const s=o.getViewport(n.viewportId),l=i.getCurrentImageId(),d=r.metaData.get("imagePlaneModule",l).imagePositionPatient,c=s.getImageIds();if(!function(e,t){const{viewPlaneNormal:n}=e.getCamera(),{viewPlaneNormal:o}=t.getCamera(),i=De.eR.dot(n,o);return Math.abs(i)>.9}(i,s))return;let h=Ae(n.viewportId,t.viewportId);if(!h){if(i.getFrameOfReferenceUID()===s.getFrameOfReferenceUID()&&!1!==a?.useInitialPosition?h=De.pB.identity(De.pB.create()):(r.utilities.calculateViewportsSpatialRegistration(i,s),h=Ae(n.viewportId,t.viewportId)),!h)return}const u=De.eR.transformMat4(De.eR.create(),d,h),g=(p=u,c.reduce(((e,t,n)=>{const{imagePositionPatient:o}=r.metaData.get("imagePlaneModule",t),i=De.eR.distance(o,p);return i<e.distance?{distance:i,index:n}:e}),{distance:1/0,index:-1}));var p;let v=g.index;s instanceof r.VolumeViewport&&(v=c.length-g.index-1),-1!==g.index&&s.getCurrentImageIdIndex()!==g.index&&await r.utilities.jumpToSlice(s.element,{imageIndex:v})}const{STACK_NEW_IMAGE:Me,VOLUME_NEW_IMAGE:Re}=r.Enums.Events;function ke(e){return oe(e,Me,Oe,{auxiliaryEvents:[{name:"VOLUME_NEW_IMAGE"}]})}function Le(e,t,n){const o=(0,r.getRenderingEngine)(n.renderingEngineId);if(!o)throw new Error(`No RenderingEngine for Id: ${n.renderingEngineId}`);const i=o.getViewport(n.viewportId),a=o.getViewport(t.viewportId),s=a.getSlabThickness?.();s&&(i.setSlabThickness?.(s),i.render())}const{CAMERA_MODIFIED:Pe}=r.Enums.Events;function Ne(e){return oe(e,Pe,Le)}const Ue=ke;var Ve=n(89578),Be=n(23566),He=n(79475),We=n(13369),Fe=n(47807),je=n(1300),Ge=n(85817);class $e extends Ge.oS{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"]}){super(e,t)}touchDragCallback(e){this._dragCallback(e)}mouseDragCallback(e){this._dragCallback(e)}_dragCallback(e){const{element:t,deltaPoints:n}=e.detail,o=(0,r.getEnabledElement)(t),i=n.world;if(0===i[0]&&0===i[1]&&0===i[2])return;const a=o.viewport.getCamera(),{focalPoint:s,position:l}=a,d=[l[0]-i[0],l[1]-i[1],l[2]-i[2]],c=[s[0]-i[0],s[1]-i[1],s[2]-i[2]];o.viewport.setCamera({focalPoint:c,position:d}),o.viewport.render()}}$e.toolName="Pan";const ze=$e;var qe=n(84607);class Ze extends Ge.oS{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{rotateIncrementDegrees:2}}){super(e,t),this._resizeObservers=new Map,this._hasResolutionChanged=!1,this.preMouseDownCallback=e=>{const t=e.detail,{element:n}=t,o=(0,r.getEnabledElement)(n),{viewport:i}=o,a=i.getDefaultActor().actor.getMapper();if(!("getSampleDistance"in a||"getCurrentSampleDistance"in a))return!0;const s=a.getSampleDistance();return this._hasResolutionChanged||(a.setSampleDistance(2*s),this._hasResolutionChanged=!0,null!==this.cleanUp&&document.removeEventListener("mouseup",this.cleanUp),this.cleanUp=()=>{a.setSampleDistance(s),i.render(),this._hasResolutionChanged=!1},document.addEventListener("mouseup",this.cleanUp,{once:!0})),!0},this._getViewportsInfo=()=>(0,ne.getToolGroup)(this.toolGroupId).viewportsInfo,this.onSetToolActive=()=>{const e=()=>{this._getViewportsInfo().forEach((({viewportId:e,renderingEngineId:t})=>{if(!this._resizeObservers.has(e)){const{viewport:n}=(0,r.getEnabledElementByIds)(e,t)||{viewport:null};if(!n)return;const{element:o}=n,i=new ResizeObserver((()=>{const n=(0,r.getEnabledElementByIds)(e,t);if(!n)return;const{viewport:o}=n;o.resetCamera(),o.render()}));i.observe(o),this._resizeObservers.set(e,i)}}))};e(),this._viewportAddedListener=t=>{t.detail.toolGroupId===this.toolGroupId&&e()},r.eventTarget.addEventListener(l.Events.TOOLGROUP_VIEWPORT_ADDED,this._viewportAddedListener)},this.onSetToolDisabled=()=>{this._resizeObservers.forEach(((e,t)=>{e.disconnect(),this._resizeObservers.delete(t)})),this._viewportAddedListener&&(r.eventTarget.removeEventListener(l.Events.TOOLGROUP_VIEWPORT_ADDED,this._viewportAddedListener),this._viewportAddedListener=null)},this.rotateCamera=(e,t,n,o)=>{const i=e.getVtkActiveCamera(),a=i.getViewUp(),r=i.getFocalPoint(),s=i.getPosition(),l=[0,0,0],d=[0,0,0],c=[0,0,0],h=De.pB.identity(new Float32Array(16));De.pB.translate(h,h,t),De.pB.rotate(h,h,o,n),De.pB.translate(h,h,[-t[0],-t[1],-t[2]]),De.eR.transformMat4(l,s,h),De.eR.transformMat4(d,r,h),De.pB.identity(h),De.pB.rotate(h,h,o,n),De.eR.transformMat4(c,a,h),e.setCamera({position:l,viewUp:c,focalPoint:d})},this.touchDragCallback=this._dragCallback.bind(this),this.mouseDragCallback=this._dragCallback.bind(this)}_dragCallback(e){const{element:t,currentPoints:n,lastPoints:o}=e.detail,i=n.canvas,a=o.canvas,{rotateIncrementDegrees:s}=this.configuration,l=(0,r.getEnabledElement)(t),{viewport:d}=l,c=d.getCamera(),h=t.clientWidth,u=t.clientHeight,g=[i[0]/h,i[1]/u],p=[a[0]/h,a[1]/u],v=[.5*h,.5*u],f=d.canvasToWorld(v),m=(1+Math.abs(.5))**2,w=[p[0],0,0],E=[g[0],0,0],b=w[0]**2,y=E[0]**2,I=b>m?0:Math.sqrt(m-b),_=y>m?0:Math.sqrt(m-y),C=[w[0],0,I];qe.Ay.normalize(C);const T=[E[0],0,_];qe.Ay.normalize(T);const S=qe.Ay.dot(C,T);if(Math.abs(S)>1e-4){const e=-2*Math.acos(qe.Ay.clampValue(S,-1,1))*Math.sign(g[0]-p[0])*s,t=c.viewUp,n=c.viewPlaneNormal,o=[0,0,0],i=[0,0,0];qe.Ay.cross(t,n,o),qe.Ay.normalize(o),qe.Ay.cross(n,o,i),qe.Ay.normalize(i),qe.Ay.normalize(t),this.rotateCamera(d,f,i,e);const a=(p[1]-g[1])*s;this.rotateCamera(d,f,o,a),d.render()}}}Ze.toolName="TrackballRotate";const Ke=Ze;class Ye extends Ge.oS{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"]}){super(e,t),this._getImageDynamicRangeFromMiddleSlice=(e,t)=>{const n=Math.floor(t[2]/2),o=t[0]*t[1];let i,a;e instanceof Float32Array?(i=4,a=Float32Array):e instanceof Uint8Array?(i=1,a=Uint8Array):e instanceof Uint16Array?(i=2,a=Uint16Array):e instanceof Int16Array&&(i=2,a=Int16Array);const r=new a(e.buffer,n*o*i,o),{max:s,min:l}=this._getMinMax(r,o);return s-l}}touchDragCallback(e){this.mouseDragCallback(e)}mouseDragCallback(e){const{element:t,deltaPoints:n}=e.detail,o=(0,r.getEnabledElement)(t),{viewport:i}=o;let a,s,l,d,c,h,u=!1;const g=i.getProperties();if(i instanceof r.VolumeViewport){a=i.getVolumeId(),h=r.utilities.getViewportsWithVolumeId(a),({lower:s,upper:l}=g.voiRange);const e=r.cache.getVolume(a);if(!e)throw new Error("Volume not found "+a);d=e.metadata.Modality,u=e.scaling&&Object.keys(e.scaling).length>0}else{if(!g.voiRange)throw new Error("Viewport is not a valid type");{d=i.modality,({lower:s,upper:l}=g.voiRange);const{preScale:e={scaled:!1}}=i.getImageData?.()||{};u=e.scaled&&void 0!==e.scalingParameters?.suvbw}}c="PT"===d&&u?this.getPTScaledNewRange({deltaPointsCanvas:n.canvas,lower:s,upper:l,clientHeight:t.clientHeight,isPreScaled:u,viewport:i,volumeId:a}):this.getNewRange({viewport:i,deltaPointsCanvas:n.canvas,volumeId:a,lower:s,upper:l}),c.lower>=c.upper||(i.setProperties({voiRange:c}),i.render(),i instanceof r.VolumeViewport&&h.forEach((e=>{i!==e&&e.render()})))}getPTScaledNewRange({deltaPointsCanvas:e,lower:t,upper:n,clientHeight:o,viewport:i,volumeId:a,isPreScaled:r}){let s=4;s=r?5/o:this._getMultiplierFromDynamicRange(i,a)||4;return n-=e[1]*s,{lower:t,upper:n=r?Math.max(n,.1):n}}getNewRange({viewport:e,deltaPointsCanvas:t,volumeId:n,lower:o,upper:i}){const a=this._getMultiplierFromDynamicRange(e,n)||4,s=t[0]*a,l=t[1]*a;let{windowWidth:d,windowCenter:c}=r.utilities.windowLevel.toWindowLevel(o,i);return d+=s,c+=l,d=Math.max(d,1),r.utilities.windowLevel.toLowHighRange(d,c)}_getMultiplierFromDynamicRange(e,t){let n;if(t){const o=r.cache.getVolume(t),{voxelManager:i}=e.getImageData(),a=i.getMiddleSliceData().reduce(((e,t)=>[Math.min(e[0],t),Math.max(e[1],t)]),[1/0,-1/0]),s=o?.metadata?.BitsStored,l=s?2**s:1/0;n=Math.min(a,l)}else n=this._getImageDynamicRangeFromViewport(e);const o=n/1024;return o>1?Math.round(o):o}_getImageDynamicRangeFromViewport(e){const{imageData:t,voxelManager:n}=e.getImageData();if(n?.getRange){const e=n.getRange();return e[1]-e[0]}const o=t.getDimensions();if(t.getRange){const e=t.getRange();return e[1]-e[0]}let i,a;if(i=t.getScalarData?t.getScalarData():t.getPointData().getScalars().getData(),1!==o[2])return this._getImageDynamicRangeFromMiddleSlice(i,o);if(i.getRange)a=i.getRange();else{const{min:e,max:t}=this._getMinMax(i,i.length);a=[e,t]}return a[1]-a[0]}_getMinMax(e,t){let n=1/0,o=-1/0;for(let i=0;i<t;i++){const t=e[i];t<n&&(n=t),t>o&&(o=t)}return{max:o,min:n}}}Ye.toolName="WindowLevel";const Xe=Ye;var Je=n(44049),Qe=n(8056),et=n(7001),tt=n(58640),nt=n(93575);class ot extends Ge.EC{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{minWindowWidth:10}}){super(e,t),this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:o}=t,i=n.world,a=(0,r.getEnabledElement)(o),{viewport:s}=a;this.isDrawing=!0;const l=s.getCamera(),{viewPlaneNormal:d,viewUp:c}=l,h=this.getReferencedImageId(s,i,d,c),u=s.getFrameOfReferenceUID(),g={invalidated:!0,highlighted:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...d],viewUp:[...c],FrameOfReferenceUID:u,referencedImageId:h},data:{handles:{points:[[...i],[...i],[...i],[...i]]},cachedStats:{}}};(0,G.lC)(g,o);const p=(0,Qe.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:g,viewportIdsToRender:p},this._activateDraw(o),(0,et.hideElementCursor)(o),e.preventDefault(),(0,tt.A)(p),g},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:i}=this.editData;this._deactivateDraw(n),(0,et.resetElementCursor)(n),this.editData=null,this.isDrawing=!1,(0,G.O8)(o.annotationUID),(0,tt.A)(i),(0,Je.dZ)(o),this.applyWindowLevelRegion(o,n)},this._dragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:i}=this.editData,{data:a}=o,{currentPoints:s}=t,l=(0,r.getEnabledElement)(n),{worldToCanvas:d,canvasToWorld:c}=l.viewport,h=s.world,{points:u}=a.handles;u[3]=[...h];const g=d(u[0]),p=d(u[3]),v=[p[0],g[1]],f=[g[0],p[1]],m=c(v),w=c(f);u[1]=m,u[2]=w,o.invalidated=!0,(0,tt.A)(i)},this._activateDraw=e=>{B.wk.isInteractingWithTool=!0,e.addEventListener(l.Events.MOUSE_UP,this._endCallback),e.addEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(l.Events.MOUSE_MOVE,this._dragCallback),e.addEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(l.Events.TOUCH_END,this._endCallback),e.addEventListener(l.Events.TOUCH_DRAG,this._dragCallback),e.addEventListener(l.Events.TOUCH_TAP,this._endCallback)},this._deactivateDraw=e=>{B.wk.isInteractingWithTool=!1,e.removeEventListener(l.Events.MOUSE_UP,this._endCallback),e.removeEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(l.Events.MOUSE_MOVE,this._dragCallback),e.removeEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(l.Events.TOUCH_END,this._endCallback),e.removeEventListener(l.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(l.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:o}=e,{element:i}=o;let a=(0,G.Rh)(this.getToolName(),i);if(!a?.length)return n;if(a=this.filterInteractableAnnotationsForElement(i,a),!a?.length)return n;const r={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let e=0;e<a.length;e++){const i=a[e],{annotationUID:s,data:l}=i,{points:d}=l.handles,c=d.map((e=>o.worldToCanvas(e)));r.annotationUID=s;const{color:h,lineWidth:u,lineDash:g}=this.getAnnotationStyle({annotation:i,styleSpecifier:r});if(!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;const p=`${s}-rect`,v="0";(0,Ve.drawRect)(t,s,v,c[0],c[3],{color:h,lineDash:g,lineWidth:u},p),n=!0}return n},this.applyWindowLevelRegion=(e,t)=>{const n=(0,r.getEnabledElement)(t),{viewport:o}=n,i=nt.windowLevel.extractWindowLevelRegionToolData(o),{data:a}=e,{points:s}=a.handles,l=s.map((e=>o.worldToCanvas(e))),d=l[0],c=l[3];let h=Math.min(d[0],c[0]),u=Math.min(d[1],c[1]),g=Math.abs(d[0]-c[0]),p=Math.abs(d[1]-c[1]);h=r.utilities.clip(h,0,i.width),u=r.utilities.clip(u,0,i.height),g=Math.floor(Math.min(g,Math.abs(i.width-h))),p=Math.floor(Math.min(p,Math.abs(i.height-u)));const v=nt.windowLevel.getLuminanceFromRegion(i,Math.round(h),Math.round(u),g,p),f=nt.windowLevel.calculateMinMaxMean(v,i.minPixelValue,i.maxPixelValue);void 0===this.configuration.minWindowWidth&&(this.configuration.minWindowWidth=10);const m=Math.max(Math.abs(f.max-f.min),this.configuration.minWindowWidth),w=f.mean,E=r.utilities.windowLevel.toLowHighRange(m,w);o.setProperties({voiRange:E}),o.render()},this.cancel=()=>null,this.isPointNearTool=()=>null,this.toolSelectedCallback=()=>null,this.handleSelectedCallback=()=>null,this._activateModify=()=>null,this._deactivateModify=()=>null}}ot.toolName="WindowLevelRegion";const it=ot;class at extends Ge.oS{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{invert:!1,debounceIfNotLoaded:!0,loop:!1}}){super(e,t),this.deltaY=1}mouseWheelCallback(e){this._scroll(e)}mouseDragCallback(e){this._dragCallback(e)}touchDragCallback(e){this._dragCallback(e)}_dragCallback(e){this._scrollDrag(e)}_scrollDrag(e){const{deltaPoints:t,viewportId:n,renderingEngineId:o}=e.detail,{viewport:i}=(0,r.getEnabledElementByIds)(n,o),{debounceIfNotLoaded:a,invert:s,loop:l}=this.configuration,d=t.canvas[1];let c;i instanceof r.VolumeViewport&&(c=i.getVolumeId());const h=this._getPixelPerImage(i),u=d+this.deltaY;if(h)if(Math.abs(u)>=h){const e=Math.round(u/h);r.utilities.scroll(i,{delta:s?-e:e,volumeId:c,debounceLoading:a,loop:l}),this.deltaY=u%h}else this.deltaY=u}_scroll(e){const{wheel:t,element:n}=e.detail,{direction:o}=t,{invert:i}=this.configuration,{viewport:a}=(0,r.getEnabledElement)(n),s=o*(i?-1:1);r.utilities.scroll(a,{delta:s,debounceLoading:this.configuration.debounceIfNotLoaded,loop:this.configuration.loop,volumeId:a instanceof r.BaseVolumeViewport?a.getVolumeId():void 0,scrollSlabs:this.configuration.scrollSlabs})}_getPixelPerImage(e){const{element:t}=e,n=e.getNumberOfSlices();return Math.max(2,t.offsetHeight/Math.max(n,8))}}at.toolName="StackScroll";const rt=at;var st=n(25963);class lt extends Ge.oS{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"]}){super(e,t),this.mouseWheelCallback=e=>{const{element:t,wheel:n}=e.detail,o=(0,r.getEnabledElement)(t),{viewport:i}=o,{invert:a}=this.configuration,s=10*n.direction*(a?-1:1);this.setAngle(i,s)},this.touchDragCallback=this._dragCallback.bind(this),this.mouseDragCallback=this._dragCallback.bind(this)}_dragCallback(e){const{element:t,currentPoints:n,startPoints:o}=e.detail,i=n.world,a=o.world,s=(0,r.getEnabledElement)(t),{viewport:l}=s,d=l.getCamera(),c=[.5*t.clientWidth,.5*t.clientHeight],h=l.canvasToWorld(c);let u=(0,st.A)([a,h],[h,i]);const{viewPlaneNormal:g}=d,p=De.eR.sub(De.eR.create(),h,a),v=De.eR.sub(De.eR.create(),h,i),f=De.eR.cross(De.eR.create(),p,v);De.eR.dot(g,f)>0&&(u=-u),Number.isNaN(u)||this.setAngle(l,u)}setAngle(e,t){const{viewPlaneNormal:n,viewUp:o}=e.getCamera();if(e instanceof r.BaseVolumeViewport){const i=(t+360)%360*Math.PI/180,a=De.pB.identity(new Float32Array(16));De.pB.rotate(a,a,i,n);const r=De.eR.transformMat4(De.eR.create(),o,a);e.setCamera({viewUp:r})}else{const{rotation:n}=e.getViewPresentation();e.setViewPresentation({rotation:(n+t+360)%360})}e.render()}}lt.toolName="PlanarRotate";const dt=lt;class ct extends Ge.oS{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{zoomToCenter:!1,minZoomScale:.001,maxZoomScale:3e3,pinchToZoom:!0,pan:!0,invert:!1}}){super(e,t),this.preMouseDownCallback=e=>{const t=e.detail,{element:n,currentPoints:o}=t,i=o.world,a=(0,r.getEnabledElement)(n).viewport.getCamera(),{focalPoint:s}=a;this.initialMousePosWorld=i;let l=De.eR.fromValues(s[0]-i[0],s[1]-i[1],s[2]-i[2]);return l=De.eR.normalize(De.eR.create(),l),this.dirVec=l,!1},this.preTouchStartCallback=e=>{if(!this.configuration.pinchToZoom)return this.preMouseDownCallback(e)},this._dragParallelProjection=(e,t,n,o=!1)=>{const{element:i,deltaPoints:a}=e.detail,r=o?e.detail.deltaDistance.canvas:a.canvas[1],s=[i.clientWidth,i.clientHeight],{parallelScale:l,focalPoint:d,position:c}=n,h=r*(5/s[1])*(this.configuration.invert?-1:1),u=(1-h)*l;let g=d,p=c;if(!this.configuration.zoomToCenter){const e=De.eR.distance(d,this.initialMousePosWorld);p=De.eR.scaleAndAdd(De.eR.create(),c,this.dirVec,-e*h),g=De.eR.scaleAndAdd(De.eR.create(),d,this.dirVec,-e*h)}const v=t.getImageData();let f=[1,1,1];v&&(f=v.spacing);const{minZoomScale:m,maxZoomScale:w}=this.configuration,E=i.clientHeight*f[1]*.5,b=E/u;let y=u,I=!1;v&&(b<m?(y=E/m,I=!0):b>=w&&(y=E/w,I=!0)),t.setCamera({parallelScale:y,focalPoint:I?d:g,position:I?c:p})},this._dragPerspectiveProjection=(e,t,n,o=!1)=>{const{element:i,deltaPoints:a}=e.detail,r=o?e.detail.deltaDistance.canvas:a.canvas[1],s=[i.clientWidth,i.clientHeight],{position:l,focalPoint:d,viewPlaneNormal:c}=n,h=qe.Ay.distance2BetweenPoints(l,d),u=Math.sqrt(h)/s[1],g=[-c[0],-c[1],-c[2]],p=this.configuration.invert?r/u:r*u;let v=p*g[0];l[0]+=v,d[0]+=v,v=p*g[1],l[1]+=v,d[1]+=v,v=p*g[2],l[2]+=v,d[2]+=v,t.setCamera({position:l,focalPoint:d})},this.initialMousePosWorld=[0,0,0],this.dirVec=[0,0,0],this.configuration.pinchToZoom?this.touchDragCallback=this._pinchCallback.bind(this):this.touchDragCallback=this._dragCallback.bind(this),this.mouseDragCallback=this._dragCallback.bind(this)}_pinchCallback(e){if(e.detail.currentPointsList.length>1){const{element:t,currentPoints:n}=e.detail,o=(0,r.getEnabledElement)(t),{viewport:i}=o,a=i.getCamera(),s=n.world,{focalPoint:l}=a;this.initialMousePosWorld=s;let d=De.eR.fromValues(l[0]-s[0],l[1]-s[1],l[2]-s[2]);d=De.eR.normalize(De.eR.create(),d),this.dirVec=d,a.parallelProjection?this._dragParallelProjection(e,i,a,!0):this._dragPerspectiveProjection(e,i,a,!0),i.render()}this.configuration.pan&&this._panCallback(e)}_dragCallback(e){const{element:t}=e.detail,n=(0,r.getEnabledElement)(t),{viewport:o}=n,i=o.getCamera();i.parallelProjection?this._dragParallelProjection(e,o,i):this._dragPerspectiveProjection(e,o,i),o.render()}_panCallback(e){const{element:t,deltaPoints:n}=e.detail,o=(0,r.getEnabledElement)(t),i=n.world,a=o.viewport.getCamera(),{focalPoint:s,position:l}=a,d=[l[0]-i[0],l[1]-i[1],l[2]-i[2]],c=[s[0]-i[0],s[1]-i[1],s[2]-i[2]];o.viewport.setCamera({focalPoint:c,position:d}),o.viewport.render()}}ct.toolName="Zoom";const ht=ct;var ut=n(13165);class gt extends Ge.oS{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{targetViewportIds:[]}}){super(e,t)}mouseClickCallback(e){const{element:t,currentPoints:n}=e.detail,o=(0,r.getEnabledElement)(t),{viewport:i,renderingEngine:a}=o,s=i.getVolumeId();if(!s)throw new Error("MIPJumpToClickTool: targetId is not a volumeId, you should only use MIPJumpToClickTool with a volumeId as the targetId");let l=-1/0;const d=(0,ut.getPointInLineOfSightWithCriteria)(i,n.world,s,((e,t)=>{if(e>l)return l=e,t}));if(!d||!d.length)return;const{targetViewportIds:c,toolGroupId:h}=this.configuration;a.getViewports().filter((e=>{if(c?.indexOf(e.id)>=0)return!0;const t=(0,ne.getToolGroupForViewport)(e.id,a.id);return!(!h||h!==t?.id)})).forEach((e=>{e instanceof r.VolumeViewport?e.jumpToWorld(d):console.warn("Cannot jump to specified world coordinates for a viewport that is not a VolumeViewport")}))}}gt.toolName="MIPJumpToClickTool";const pt=gt;var vt=n(89265),ft=n(35381),mt=n(93258),wt=n(2076);const{RENDERING_DEFAULTS:Et}=r.CONSTANTS;function bt(){return"rgb(0, 200, 0)"}function yt(){return!0}function It(){return!0}function _t(){return!0}const Ct=1,Tt=2,St=3;class xt extends Ge.EC{constructor(e={},t={supportedInteractionTypes:["Mouse"],configuration:{shadow:!0,viewportIndicators:!1,viewportIndicatorsConfig:{radius:5,x:null,y:null},autoPan:{enabled:!1,panSize:10},referenceLinesCenterGapRadius:20,filterActorUIDsToSetSlabThickness:[],slabThicknessBlendMode:r.Enums.BlendModes.MAXIMUM_INTENSITY_BLEND,mobile:{enabled:!1,opacity:.8,handleRadius:9}}}){super(e,t),this.toolCenter=[0,0,0],this.initializeViewport=({renderingEngineId:e,viewportId:t})=>{const n=(0,r.getEnabledElementByIds)(t,e),{FrameOfReferenceUID:o,viewport:i}=n,{element:a}=i,{position:l,focalPoint:d,viewPlaneNormal:c}=i.getCamera();let h=this._getAnnotations(n);h=this.filterInteractableAnnotationsForElement(a,h),h.length&&(0,s.removeAnnotation)(h[0].annotationUID);const u={highlighted:!1,metadata:{cameraPosition:[...l],cameraFocalPoint:[...d],FrameOfReferenceUID:o,toolName:this.getToolName()},data:{handles:{rotationPoints:[],slabThicknessPoints:[],toolCenter:this.toolCenter},activeOperation:null,activeViewportIds:[],viewportId:t}};return(0,s.addAnnotation)(u,a),{normal:c,point:i.canvasToWorld([i.canvas.clientWidth/2,i.canvas.clientHeight/2])}},this._getViewportsInfo=()=>(0,ne.getToolGroup)(this.toolGroupId).viewportsInfo,this.resetCrosshairs=()=>{const e=this._getViewportsInfo();for(const t of e){const{viewportId:e,renderingEngineId:n}=t,o=(0,r.getEnabledElementByIds)(e,n),i=o.viewport,a=!0,l=!0,d=!0,c=!0,h=!0;i.resetCamera({resetPan:a,resetZoom:l,resetToCenter:d,resetRotation:c,suppressEvents:h}),i.resetSlabThickness();const{element:u}=i;let g=this._getAnnotations(o);g=this.filterInteractableAnnotationsForElement(u,g),g.length&&(0,s.removeAnnotation)(g[0].annotationUID),i.render()}this._computeToolCenter(e)},this.computeToolCenter=()=>{const e=this._getViewportsInfo();this._computeToolCenter(e)},this._computeToolCenter=e=>{if(!e.length||1===e.length)return void console.warn("For crosshairs to operate, at least two viewports must be given.");const[t,n,o]=e,{normal:i,point:a}=this.initializeViewport(t),{normal:s,point:l}=this.initializeViewport(n);let d=[0,0,0],c=De.eR.create();o?({normal:d,point:c}=this.initializeViewport(o)):(De.eR.add(c,a,l),De.eR.scale(c,c,.5),De.eR.cross(d,i,s));const h=r.utilities.planar.planeEquation(i,a),u=r.utilities.planar.planeEquation(s,l),g=r.utilities.planar.planeEquation(d,c);this.toolCenter=r.utilities.planar.threePlaneIntersection(h,u,g),(0,tt.A)(e.map((({viewportId:e})=>e)))},this.addNewAnnotation=e=>{const t=e.detail,{element:n}=t,{currentPoints:o}=t,i=o.world,a=(0,r.getEnabledElement)(n),{viewport:s}=a;this._jump(a,i);const l=this._getAnnotations(a),d=this.filterInteractableAnnotationsForElement(s.element,l),{data:c}=d[0],{rotationPoints:h}=c.handles,u=[];for(let e=0;e<h.length-1;++e){const t=h[e][1],n=this._getReferenceLineControllable(t.id),o=this._getReferenceLineDraggableRotatable(t.id);n&&o&&(u.push(t.id),e++)}return c.activeViewportIds=[...u],c.handles.activeOperation=Ct,e.preventDefault(),(0,et.hideElementCursor)(n),this._activateModify(n),d[0]},this.cancel=()=>{console.log("Not implemented yet")},this.handleSelectedCallback=(e,t)=>{const n=e.detail,{element:o}=n;t.highlighted=!0,this._activateModify(o),(0,et.hideElementCursor)(o),e.preventDefault()},this.isPointNearTool=(e,t,n,o)=>!!this._pointNearTool(e,t,n,6),this.toolSelectedCallback=(e,t,n)=>{const o=e.detail,{element:i}=o;t.highlighted=!0,this._activateModify(i),(0,et.hideElementCursor)(i),e.preventDefault()},this.onCameraModified=e=>{const t=e.detail,{element:n}=t,o=(0,r.getEnabledElement)(n),{renderingEngine:i}=o,a=o.viewport,s=this._getAnnotations(o),l=this.filterInteractableAnnotationsForElement(n,s)[0];if(!l)return;const d=a.getCamera(),c=l.metadata.cameraPosition,h=[0,0,0];qe.Ay.subtract(d.position,c,h);const u=l.metadata.cameraFocalPoint,g=[0,0,0];qe.Ay.subtract(d.focalPoint,u,g),l.metadata.cameraPosition=[...d.position],l.metadata.cameraFocalPoint=[...d.focalPoint];const p=this._getReferenceLineControllable(a.id),v=this._getReferenceLineDraggableRotatable(a.id);if(!r.utilities.isEqual(d.position,c,.001)&&p&&v){let e=!1;r.utilities.isEqual(h,g,.001)||(e=!0);const t=Math.abs(qe.Ay.dot(h,d.viewPlaneNormal))<.01;e||t||(this.toolCenter[0]+=h[0],this.toolCenter[1]+=h[1],this.toolCenter[2]+=h[2])}if(this.configuration.autoPan?.enabled){(0,ne.getToolGroupForViewport)(a.id,i.id).getViewportIds().filter((e=>e!==a.id)).forEach((e=>{this._autoPanViewportIfNecessary(e,i)}))}const f=(0,Qe.getViewportIdsWithToolToRender)(n,this.getToolName(),!1);(0,tt.A)(f)},this.onResetCamera=e=>{this.resetCrosshairs()},this.mouseMoveCallback=(e,t)=>{const{element:n,currentPoints:o}=e.detail,i=o.canvas;let a=!1;for(let e=0;e<t.length;e++){const o=t[e];if((0,wt.isAnnotationLocked)(o.annotationUID))continue;const{data:r,highlighted:s}=o;if(!r.handles)continue;const l=r.handles.activeOperation,d=r.activeViewportIds&&r.activeViewportIds.length>0?[...r.activeViewportIds]:[];r.activeViewportIds=[],r.handles.activeOperation=null;let c=!1;c=!!this.getHandleNearImagePoint(n,o,i,6)||this._pointNearTool(n,o,i,6);c&&!s||!c&&s?(o.highlighted=!s,a=!0):r.handles.activeOperation===l&&this._areViewportIdArraysEqual(r.activeViewportIds,d)||(a=!0)}return a},this.filterInteractableAnnotationsForElement=(e,t)=>{if(!t||!t.length)return[];const n=(0,r.getEnabledElement)(e),{viewportId:o}=n,i=t.filter((e=>e.data.viewportId===o));return i},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:o,renderingEngine:i}=e,{element:a}=o,r=this._getAnnotations(e),s=o.getCamera(),l=this.filterInteractableAnnotationsForElement(a,r)[0];if(!r?.length||!l?.data)return n;const d=l.annotationUID,{clientWidth:c,clientHeight:h}=o.canvas,u=Math.sqrt(c*c+h*h),g=Math.min(c,h),p=l.data,v=o.worldToCanvas(this.toolCenter),f=this._filterAnnotationsByUniqueViewportOrientations(e,r),m=[],w=[0,0,c,h];f.forEach((e=>{const{data:t}=e;t.handles.toolCenter=this.toolCenter;const n=i.getViewport(t.viewportId),a=n.getCamera(),r=this._getReferenceLineControllable(n.id),l=this._getReferenceLineDraggableRotatable(n.id),d=this._getReferenceLineSlabThicknessControlsOn(n.id),{clientWidth:c,clientHeight:h}=n.canvas,p=Math.sqrt(c*c+h*h),E=[.5*c,.5*h],b=n.canvasToWorld(E),y=[0,0,0];qe.Ay.cross(s.viewPlaneNormal,a.viewPlaneNormal,y),qe.Ay.normalize(y),qe.Ay.multiplyScalar(y,p);const I=[0,0,0];qe.Ay.add(b,y,I);const _=[0,0,0];qe.Ay.subtract(b,y,_);const C=o.worldToCanvas(I),T=o.worldToCanvas(b),S=De.Zc.create();De.Zc.subtract(S,C,T),De.Zc.normalize(S,S);const x=De.Zc.create();De.Zc.scale(x,S,100*u);const D=De.Zc.create();De.Zc.scale(D,S,.4*g);const A=De.Zc.create();De.Zc.scale(A,S,.2*g);const O=De.Zc.create(),M=this.configuration.referenceLinesCenterGapRadius;De.Zc.scale(O,S,2===f.length?M:0);const R=De.Zc.create(),k=De.Zc.create(),L=De.Zc.create(),P=De.Zc.create();let N=De.Zc.clone(v);l&&r||(N=De.Zc.clone(T)),De.Zc.add(R,N,O),De.Zc.add(k,N,x),De.Zc.subtract(L,N,O),De.Zc.subtract(P,N,x),(0,ft.A)(R,k,w),(0,ft.A)(L,P,w);const U=De.Zc.create();De.Zc.subtract(U,v,D);const V=De.Zc.create();De.Zc.add(V,v,D);let B=De.Zc.clone(v);!l&&d&&(B=De.Zc.clone(T));let H=[...this.toolCenter];!l&&d&&(H=[...b]);const W=[0,0,0];qe.Ay.subtract(I,_,W),qe.Ay.normalize(W);const{viewPlaneNormal:F}=s,{matrix:j}=vt.A.buildFromDegree().rotate(90,F),G=[0,0,0];De.eR.transformMat4(G,W,j);const $=n.getSlabThickness(),z=[...G];qe.Ay.multiplyScalar(z,$);const q=[0,0,0];qe.Ay.add(H,z,q);const Z=o.worldToCanvas(q),K=De.Zc.create();De.Zc.subtract(K,B,Z);const Y=De.Zc.create();De.Zc.subtract(Y,B,x),De.Zc.add(Y,Y,K);const X=De.Zc.create();De.Zc.add(X,B,x),De.Zc.add(X,X,K),(0,ft.A)(Y,X,w);const J=De.Zc.create();De.Zc.add(J,B,x),De.Zc.subtract(J,J,K);const Q=De.Zc.create();De.Zc.subtract(Q,B,x),De.Zc.subtract(Q,Q,K),(0,ft.A)(J,Q,w);const ee=De.Zc.create(),te=De.Zc.create(),ne=De.Zc.create(),oe=De.Zc.create();De.Zc.subtract(ee,B,A),De.Zc.add(ee,ee,K),De.Zc.add(te,B,A),De.Zc.add(te,te,K),De.Zc.subtract(ne,B,A),De.Zc.subtract(ne,ne,K),De.Zc.add(oe,B,A),De.Zc.subtract(oe,oe,K),m.push([n,R,k,L,P,Y,X,J,Q,U,V,ee,te,ne,oe])}));const E=[],b=[],y=this._getReferenceLineColor(o.id),I=void 0!==y?y:"rgb(200, 200, 200)";if(m.forEach(((e,n)=>{const i=e[0],a=this._getReferenceLineColor(i.id),r=this._getReferenceLineControllable(i.id),s=this._getReferenceLineDraggableRotatable(i.id)||this.configuration.mobile?.enabled,l=this._getReferenceLineSlabThicknessControlsOn(i.id)||this.configuration.mobile?.enabled,c=p.activeViewportIds.find((e=>e===i.id));let h=void 0!==a?a:"rgb(200, 200, 200)",u=1;const g=null!==p.handles.activeOperation&&p.handles.activeOperation===Ct&&c;g&&(u=2.5);let v=`${n}`;if(r&&s?(v=`${n}One`,(0,Ve.drawLine)(t,d,v,e[1],e[2],{color:h,lineWidth:u}),v=`${n}Two`,(0,Ve.drawLine)(t,d,v,e[3],e[4],{color:h,lineWidth:u})):(0,Ve.drawLine)(t,d,v,e[2],e[4],{color:h,lineWidth:u}),r){h=void 0!==a?a:"rgb(200, 200, 200)";const r=p.handles.activeOperation===Tt,u=[e[9],e[10]],f=[o.canvasToWorld(e[9]),i,e[1],e[2]],m=[o.canvasToWorld(e[10]),i,e[3],e[4]];E.push(f,m);const w=p.handles.activeOperation===St,y=[e[11],e[12],e[13],e[14]],I=[o.canvasToWorld(e[11]),i,e[5],e[6]],_=[o.canvasToWorld(e[12]),i,e[5],e[6]],C=[o.canvasToWorld(e[13]),i,e[7],e[8]],T=[o.canvasToWorld(e[14]),i,e[7],e[8]];if(b.push(I,_,C,T),(g||this.configuration.mobile?.enabled)&&!r&&!w&&s&&l){let e=`${n}One`;(0,Ve.drawHandles)(t,d,e,u,{color:h,handleRadius:this.configuration.mobile?.enabled?this.configuration.mobile?.handleRadius:3,opacity:this.configuration.mobile?.enabled?this.configuration.mobile?.opacity:1,type:"circle"}),e=`${n}Two`,(0,Ve.drawHandles)(t,d,e,y,{color:h,handleRadius:this.configuration.mobile?.enabled?this.configuration.mobile?.handleRadius:3,opacity:this.configuration.mobile?.enabled?this.configuration.mobile?.opacity:1,type:"rect"})}else if(g&&!r&&!w&&s){const e=`${n}`;(0,Ve.drawHandles)(t,d,e,u,{color:h,handleRadius:this.configuration.mobile?.enabled?this.configuration.mobile?.handleRadius:3,opacity:this.configuration.mobile?.enabled?this.configuration.mobile?.opacity:1,type:"circle"})}else if(c&&!r&&!w&&l){const e=`${n}`;(0,Ve.drawHandles)(t,d,e,y,{color:h,handleRadius:this.configuration.mobile?.enabled?this.configuration.mobile?.handleRadius:3,opacity:this.configuration.mobile?.enabled?this.configuration.mobile?.opacity:1,type:"rect"})}else if(r&&s){const e=`${n}`;(0,Ve.drawHandles)(t,d,e,u,{color:h,handleRadius:2,fill:h,type:"circle"})}else w&&c&&l&&(0,Ve.drawHandles)(t,d,v,y,{color:h,handleRadius:2,fill:h,type:"rect"});i.getSlabThickness()>.5&&l&&(v=`${n}STOne`,(0,Ve.drawLine)(t,d,v,e[5],e[6],{color:h,width:1,lineDash:[2,3]}),v=`${n}STTwo`,(0,Ve.drawLine)(t,d,v,e[7],e[8],{color:h,width:e,lineDash:[2,3]}))}})),n=!0,p.handles.rotationPoints=E,p.handles.slabThicknessPoints=b,this.configuration.viewportIndicators){const{viewportIndicatorsConfig:e}=this.configuration,n=[c*(e?.xOffset||.95),h*(e?.yOffset||.05)],o=e?.circleRadius||.01*u,i="0";(0,Ve.drawCircle)(t,d,i,n,o,{color:I,fill:I})}return n},this._getAnnotations=e=>{const{viewport:t}=e,n=(0,s.getAnnotations)(this.getToolName(),t.element)||[],o=this._getViewportsInfo().map((({viewportId:e})=>e)),i=n.filter((e=>{const{data:t}=e;return o.includes(t.viewportId)}));return i},this._onNewVolume=()=>{const e=this._getViewportsInfo();this._computeToolCenter(e)},this._areViewportIdArraysEqual=(e,t)=>e.length===t.length&&(e.forEach((e=>{let n=!1;for(let o=0;o<t.length;++o)if(e===t[o]){n=!0;break}if(!1===n)return!1})),!0),this._getAnnotationsForViewportsWithDifferentCameras=(e,t)=>{const{viewportId:n,renderingEngine:o,viewport:i}=e,a=t.filter((e=>e.data.viewportId!==n));if(!a||!a.length)return[];const s=i.getCamera(),{viewPlaneNormal:l,position:d}=s,c=a.filter((e=>{const{viewportId:t}=e.data,n=o.getViewport(t).getCamera();return!(r.utilities.isEqual(n.viewPlaneNormal,l,.01)&&r.utilities.isEqual(n.position,d,1))}));return c},this._filterViewportWithSameOrientation=(e,t,n)=>{const{renderingEngine:o}=e,{data:i}=t,a=o.getViewport(i.viewportId),s=n.filter((e=>{const{data:t}=e,n=o.getViewport(t.viewportId);return!0===this._getReferenceLineControllable(n.id)}));if(!s||!s.length)return[];const l=a.getCamera(),d=l.viewPlaneNormal;qe.Ay.normalize(d);const c=s.filter((e=>{const{viewportId:t}=e.data,n=o.getViewport(t).getCamera(),i=n.viewPlaneNormal;return qe.Ay.normalize(i),r.utilities.isEqual(d,i,.01)&&r.utilities.isEqual(l.viewUp,n.viewUp,.01)}));return c},this._filterAnnotationsByUniqueViewportOrientations=(e,t)=>{const{renderingEngine:n,viewport:o}=e,i=o.getCamera().viewPlaneNormal;qe.Ay.normalize(i);const a=t.filter((e=>{const{data:t}=e,i=n.getViewport(t.viewportId),a=this._getReferenceLineControllable(i.id);return o!==i&&!0===a})),s=[];for(let e=0;e<a.length;++e){const t=a[e],{viewportId:o}=t.data,l=n.getViewport(o).getCamera(),d=l.viewPlaneNormal;if(qe.Ay.normalize(d),r.utilities.isEqual(i,d,.01)||r.utilities.isOpposite(i,d,.01))continue;let c=!1;for(let e=0;e<s.length;++e){const t=s[e],{viewportId:o}=t.data,i=n.getViewport(o).getCamera();r.utilities.isEqual(i.viewPlaneNormal,l.viewPlaneNormal,.01)&&r.utilities.isEqual(i.position,l.position,1)&&(c=!0)}c||s.push(t)}const l=t.filter((e=>{const{data:t}=e,i=n.getViewport(t.viewportId),a=this._getReferenceLineControllable(i.id);return o!==i&&!0!==a}));for(let e=0;e<l.length;++e){const t=l[e],{viewportId:o}=t.data,a=n.getViewport(o).getCamera(),d=a.viewPlaneNormal;if(qe.Ay.normalize(d),r.utilities.isEqual(i,d,.01)||r.utilities.isOpposite(i,d,.01))continue;let c=!1;for(let e=0;e<s.length;++e){const t=s[e],{viewportId:o}=t.data,i=n.getViewport(o).getCamera();r.utilities.isEqual(i.viewPlaneNormal,a.viewPlaneNormal,.01)&&r.utilities.isEqual(i.position,a.position,1)&&(c=!0)}c||s.push(t)}const d=this._getAnnotationsForViewportsWithDifferentCameras(e,t);for(let e=0;e<d.length;++e){const t=d[e];if(s.some((e=>e===t)))continue;const{viewportId:o}=t.data,a=n.getViewport(o).getCamera(),l=a.viewPlaneNormal;if(qe.Ay.normalize(l),r.utilities.isEqual(i,l,.01)||r.utilities.isOpposite(i,l,.01))continue;let c=!1;for(let e=0;e<s.length;++e){const t=s[e],{viewportId:o}=t.data,i=n.getViewport(o).getCamera();r.utilities.isEqual(i.viewPlaneNormal,a.viewPlaneNormal,.01)&&r.utilities.isEqual(i.position,a.position,1)&&(c=!0)}c||s.push(t)}return s},this._checkIfViewportsRenderingSameScene=(e,t)=>{const n=e.getActors(),o=t.getActors();let i=!0;return n.forEach((e=>{n.length===o.length&&void 0!==o.find((({uid:t})=>t===e.uid))||(i=!1)})),i},this._jump=(e,t)=>{B.wk.isInteractingWithTool=!0;const{viewport:n,renderingEngine:o}=e,i=this._getAnnotations(e),a=[0,0,0];qe.Ay.subtract(t,this.toolCenter,a);const r=this._getAnnotationsForViewportsWithDifferentCameras(e,i).filter((e=>{const{data:t}=e,i=o.getViewport(t.viewportId),a=this._checkIfViewportsRenderingSameScene(n,i);return this._getReferenceLineControllable(i.id)&&this._getReferenceLineDraggableRotatable(i.id)&&a}));return 0===r.length?(B.wk.isInteractingWithTool=!1,!1):(this._applyDeltaShiftToSelectedViewportCameras(o,r,a),B.wk.isInteractingWithTool=!1,!0)},this._activateModify=e=>{B.wk.isInteractingWithTool=!this.configuration.mobile?.enabled,e.addEventListener(l.Events.MOUSE_UP,this._endCallback),e.addEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(l.Events.TOUCH_END,this._endCallback),e.addEventListener(l.Events.TOUCH_DRAG,this._dragCallback),e.addEventListener(l.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{B.wk.isInteractingWithTool=!1,e.removeEventListener(l.Events.MOUSE_UP,this._endCallback),e.removeEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(l.Events.TOUCH_END,this._endCallback),e.removeEventListener(l.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(l.Events.TOUCH_TAP,this._endCallback)},this._endCallback=e=>{const t=e.detail,{element:n}=t;this.editData.annotation.data.handles.activeOperation=null,this.editData.annotation.data.activeViewportIds=[],this._deactivateModify(n),(0,et.resetElementCursor)(n),this.editData=null;const o=(0,Qe.getViewportIdsWithToolToRender)(n,this.getToolName(),!1);(0,tt.A)(o)},this._dragCallback=e=>{const t=e.detail,n=t.deltaPoints.world;if(Math.abs(n[0])<.001&&Math.abs(n[1])<.001&&Math.abs(n[2])<.001)return;const{element:o}=t,i=(0,r.getEnabledElement)(o),{renderingEngine:a,viewport:s}=i,l=this._getAnnotations(i),d=this.filterInteractableAnnotationsForElement(o,l)[0];if(!d)return;const{handles:c}=d.data,{currentPoints:h}=e.detail,u=h.canvas;if(c.activeOperation===Ct){const e=this._getAnnotationsForViewportsWithDifferentCameras(i,l).filter((e=>{const{data:t}=e,n=a.getViewport(t.viewportId),o=this._getReferenceLineControllable(n.id),i=this._getReferenceLineDraggableRotatable(n.id);return!0===o&&!0===i&&d.data.activeViewportIds.find((e=>e===n.id))}));this._applyDeltaShiftToSelectedViewportCameras(a,e,n)}else if(c.activeOperation===Tt){const e=this._getAnnotationsForViewportsWithDifferentCameras(i,l).filter((e=>{const{data:t}=e,n=a.getViewport(t.viewportId),o=this._getReferenceLineControllable(n.id),i=this._getReferenceLineDraggableRotatable(n.id);return!0===o&&!0===i})),n=De.Zc.create(),o=De.Zc.create(),r=[this.toolCenter[0],this.toolCenter[1],this.toolCenter[2]],d=s.worldToCanvas(r),c=t.currentPoints.canvas,h=De.Zc.create();De.Zc.sub(h,c,t.deltaPoints.canvas),De.Zc.sub(n,h,d),De.Zc.sub(o,c,d);let u=De.Zc.angle(n,o);this._isClockWise(d,h,c)&&(u*=-1),u=Math.round(100*u)/100;const g=s.getCamera().viewPlaneNormal,{matrix:p}=vt.A.buildFromRadian().translate(r[0],r[1],r[2]).rotate(u,g).translate(-r[0],-r[1],-r[2]),v=[];e.forEach((e=>{const{data:t}=e;t.handles.toolCenter=r;const n=a.getViewport(t.viewportId),o=n.getCamera(),{viewUp:i,position:s,focalPoint:l}=o;i[0]+=s[0],i[1]+=s[1],i[2]+=s[2],De.eR.transformMat4(l,l,p),De.eR.transformMat4(s,s,p),De.eR.transformMat4(i,i,p),i[0]-=s[0],i[1]-=s[1],i[2]-=s[2],n.setCamera({position:s,viewUp:i,focalPoint:l}),v.push(n.id)})),a.renderViewports(v)}else if(c.activeOperation===St){const e=this._getAnnotationsForViewportsWithDifferentCameras(i,l).filter((e=>{const{data:t}=e,n=a.getViewport(t.viewportId),o=this._getReferenceLineControllable(n.id),i=this._getReferenceLineSlabThicknessControlsOn(n.id);return!0===o&&!0===i&&d.data.activeViewportIds.find((e=>e===n.id))}));if(0===e.length)return;const o=this._filterViewportWithSameOrientation(i,e[0],l),c=[];c.push(s.id),o.forEach((e=>{const{data:o}=e,i=a.getViewport(o.viewportId),l=i.getCamera().viewPlaneNormal,h=qe.Ay.dot(n,l),g=[...l];if(qe.Ay.multiplyScalar(g,h),Math.abs(g[0])>.001||Math.abs(g[1])>.001||Math.abs(g[2])>.001){const e=Math.sqrt(g[0]*g[0]+g[1]*g[1]+g[2]*g[2]),n=t.lastPoints.world,o=[0,0,0],h=[this.toolCenter[0],this.toolCenter[1],this.toolCenter[2]];if(!this._getReferenceLineDraggableRotatable(i.id)){const{rotationPoints:e}=this.editData.annotation.data.handles,t=e.filter((e=>e[1].uid===i.id));if(2===t.length){const e=s.canvasToWorld(t[0][3]),n=s.canvasToWorld(t[1][3]);qe.Ay.add(e,n,h),qe.Ay.multiplyScalar(h,.5)}}qe.Ay.subtract(n,h,o);const p=qe.Ay.dot(o,l),v=[...l];qe.Ay.multiplyScalar(v,p);const f=[v[0],v[1],v[2]];De.eR.normalize(f,f);const m=[g[0],g[1],g[2]];De.eR.normalize(m,m);let w=i.getSlabThickness();r.utilities.isOpposite(f,m,.001)?w-=e:w+=e,w=Math.abs(w),w=Math.max(Et.MINIMUM_SLAB_THICKNESS,w);this._pointNearReferenceLine(d,u,6,i)&&(w=Et.MINIMUM_SLAB_THICKNESS);(0,ne.getToolGroupForViewport)(i.id,a.id).getToolInstance(this.getToolName()).setSlabThickness(i,w),c.push(i.id)}})),a.renderViewports(c)}},this._pointNearReferenceLine=(e,t,n,o)=>{const{data:i}=e,{rotationPoints:a}=i.handles;for(let e=0;e<a.length-1;++e){const i=a[e][1];if(i.id!==o.id)continue;if(!this._getReferenceLineControllable(i.id))continue;const r={start:{x:a[e][2][0],y:a[e][2][1]},end:{x:a[e][3][0],y:a[e][3][1]}},s=mt.distanceToPoint([r.start.x,r.start.y],[r.end.x,r.end.y],[t[0],t[1]]),l={start:{x:a[e+1][2][0],y:a[e+1][2][1]},end:{x:a[e+1][3][0],y:a[e+1][3][1]}},d=mt.distanceToPoint([l.start.x,l.start.y],[l.end.x,l.end.y],[t[0],t[1]]);if(s<=n||d<=n)return!0;e++}return!1},this._getReferenceLineColor=e.configuration?.getReferenceLineColor||bt,this._getReferenceLineControllable=e.configuration?.getReferenceLineControllable||yt,this._getReferenceLineDraggableRotatable=e.configuration?.getReferenceLineDraggableRotatable||It,this._getReferenceLineSlabThicknessControlsOn=e.configuration?.getReferenceLineSlabThicknessControlsOn||_t}onSetToolActive(){const e=this._getViewportsInfo();this._unsubscribeToViewportNewVolumeSet(e),this._subscribeToViewportNewVolumeSet(e),this._computeToolCenter(e)}onSetToolPassive(){const e=this._getViewportsInfo();this._computeToolCenter(e)}onSetToolEnabled(){const e=this._getViewportsInfo();this._computeToolCenter(e)}onSetToolDisabled(){const e=this._getViewportsInfo();this._unsubscribeToViewportNewVolumeSet(e),e.forEach((({renderingEngineId:e,viewportId:t})=>{const n=(0,r.getEnabledElementByIds)(t,e);if(!n)return;const o=this._getAnnotations(n);o?.length&&o.forEach((e=>{(0,s.removeAnnotation)(e.annotationUID)}))}))}getHandleNearImagePoint(e,t,n,o){const i=(0,r.getEnabledElement)(e),{viewport:a}=i;let s=this._getRotationHandleNearImagePoint(a,t,n,o);return null!==s?s:(s=this._getSlabThicknessHandleNearImagePoint(a,t,n,o),null!==s?s:void 0)}_unsubscribeToViewportNewVolumeSet(e){e.forEach((({viewportId:e,renderingEngineId:t})=>{const{viewport:n}=(0,r.getEnabledElementByIds)(e,t),{element:o}=n;o.removeEventListener(r.Enums.Events.VOLUME_VIEWPORT_NEW_VOLUME,this._onNewVolume)}))}_subscribeToViewportNewVolumeSet(e){e.forEach((({viewportId:e,renderingEngineId:t})=>{const{viewport:n}=(0,r.getEnabledElementByIds)(e,t),{element:o}=n;o.addEventListener(r.Enums.Events.VOLUME_VIEWPORT_NEW_VOLUME,this._onNewVolume)}))}_autoPanViewportIfNecessary(e,t){const n=t.getViewport(e),{clientWidth:o,clientHeight:i}=n.canvas,a=n.worldToCanvas(this.toolCenter),r=this.configuration.autoPan.panSize,s=[a[0],a[1]];if(a[0]<0?s[0]=r:a[0]>o&&(s[0]=o-r),a[1]<0?s[1]=r:a[1]>i&&(s[1]=i-r),s[0]===a[0]&&s[1]===a[1])return;const l=n.canvasToWorld(s),d=[l[0]-this.toolCenter[0],l[1]-this.toolCenter[1],l[2]-this.toolCenter[2]],c=n.getCamera(),{focalPoint:h,position:u}=c,g=[u[0]-d[0],u[1]-d[1],u[2]-d[2]],p=[h[0]-d[0],h[1]-d[1],h[2]-d[2]];n.setCamera({focalPoint:p,position:g}),n.render()}setSlabThickness(e,t){let n;const{filterActorUIDsToSetSlabThickness:o}=this.configuration;o&&o.length>0&&(n=o);let i=this.configuration.slabThicknessBlendMode;t===Et.MINIMUM_SLAB_THICKNESS&&(i=r.Enums.BlendModes.COMPOSITE);e.setBlendMode(i,n,!1),e.setSlabThickness(t,n)}_isClockWise(e,t,n){return(t[0]-e[0])*(n[1]-e[1])-(t[1]-e[1])*(n[0]-e[0])>0}_applyDeltaShiftToSelectedViewportCameras(e,t,n){t.forEach((t=>{this._applyDeltaShiftToViewportCamera(e,t,n)}))}_applyDeltaShiftToViewportCamera(e,t,n){const{data:o}=t,i=e.getViewport(o.viewportId),a=i.getCamera(),r=a.viewPlaneNormal,s=qe.Ay.dot(n,r),l=[...r];if(qe.Ay.multiplyScalar(l,s),Math.abs(l[0])>.001||Math.abs(l[1])>.001||Math.abs(l[2])>.001){const e=[0,0,0],t=[0,0,0];qe.Ay.add(a.focalPoint,l,e),qe.Ay.add(a.position,l,t),i.setCamera({focalPoint:e,position:t}),i.render()}}_getRotationHandleNearImagePoint(e,t,n,o){const{data:i}=t,{rotationPoints:a}=i.handles;for(let r=0;r<a.length;r++){const s=a[r][0],l=a[r][1];if(!this._getReferenceLineControllable(l.id))continue;if(!this._getReferenceLineDraggableRotatable(l.id))continue;const d=e.worldToCanvas(s);if(De.Zc.distance(n,d)<o)return i.handles.activeOperation=Tt,this.editData={annotation:t},s}return null}_getSlabThicknessHandleNearImagePoint(e,t,n,o){const{data:i}=t,{slabThicknessPoints:a}=i.handles;for(let r=0;r<a.length;r++){const s=a[r][0],l=a[r][1];if(!this._getReferenceLineControllable(l.id))continue;if(!this._getReferenceLineSlabThicknessControlsOn(l.id))continue;const d=e.worldToCanvas(s);if(De.Zc.distance(n,d)<o)return i.handles.activeOperation=St,i.activeViewportIds=[l.id],this.editData={annotation:t},s}return null}_pointNearTool(e,t,n,o){const i=(0,r.getEnabledElement)(e),{viewport:a}=i,{clientWidth:s,clientHeight:l}=a.canvas,d=Math.sqrt(s*s+l*l),{data:c}=t,{rotationPoints:h}=c.handles,{slabThicknessPoints:u}=c.handles,g=[];for(let e=0;e<h.length-1;++e){const t=h[e][1],i=this._getReferenceLineControllable(t.id),a=this._getReferenceLineDraggableRotatable(t.id);if(!i||!a)continue;const r={start:{x:h[e][2][0],y:h[e][2][1]},end:{x:h[e][3][0],y:h[e][3][1]}},s=mt.distanceToPoint([r.start.x,r.start.y],[r.end.x,r.end.y],[n[0],n[1]]),l={start:{x:h[e+1][2][0],y:h[e+1][2][1]},end:{x:h[e+1][3][0],y:h[e+1][3][1]}},d=mt.distanceToPoint([l.start.x,l.start.y],[l.end.x,l.end.y],[n[0],n[1]]);(s<=o||d<=o)&&(g.push(t.id),c.handles.activeOperation=Ct),e++}for(let e=0;e<u.length-1;++e){const t=u[e][1];if(g.find((e=>e===t.id)))continue;const i=this._getReferenceLineControllable(t.id),a=this._getReferenceLineSlabThicknessControlsOn(t.id);if(!i||!a)continue;const r=u[e][2],s=u[e][3],l=De.Zc.create();De.Zc.add(l,r,s),De.Zc.scale(l,l,.5);const h=De.Zc.create();De.Zc.subtract(h,r,l),De.Zc.normalize(h,h);const p=De.Zc.create();De.Zc.scale(p,h,.05*d);const v=De.Zc.create(),f=De.Zc.create();De.Zc.add(v,l,p),De.Zc.subtract(f,l,p);const m={start:{x:v[0],y:v[1]},end:{x:r[0],y:r[1]}},w=mt.distanceToPoint([m.start.x,m.start.y],[m.end.x,m.end.y],[n[0],n[1]]),E={start:{x:f[0],y:f[1]},end:{x:s[0],y:s[1]}},b=mt.distanceToPoint([E.start.x,E.start.y],[E.end.x,E.end.y],[n[0],n[1]]);(w<=o||b<=o)&&(g.push(t.id),c.handles.activeOperation=null),e++}return c.activeViewportIds=[...g],this.editData={annotation:t},c.handles.activeOperation===Ct}}xt.toolName="Crosshairs";const Dt=xt,At="magnify-viewport";class Ot extends Ge.oS{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{magnifySize:10,magnifyWidth:250,magnifyHeight:250}}){super(e,t),this._hasBeenRemoved=!1,this.preMouseDownCallback=e=>{const t=e.detail,{element:n,currentPoints:o}=t,i=(0,r.getEnabledElement)(n),{viewport:a,renderingEngine:s}=i;if(!(a instanceof r.StackViewport))throw new Error("MagnifyTool only works on StackViewports");const l=this._getReferencedImageId(a);if(!l)throw new Error("MagnifyTool: No referenced image id found, reconstructed planes not supported yet");const d=(0,Qe.getViewportIdsWithToolToRender)(n,this.getToolName());return this.editData={referencedImageId:l,viewportIdsToRender:d,enabledElement:i,renderingEngine:s,currentPoints:o},this._createMagnificationViewport(),this._activateDraw(n),(0,et.hideElementCursor)(n),e.preventDefault(),(0,tt.A)(d),!0},this.preTouchStartCallback=e=>{this.preMouseDownCallback(e)},this._createMagnificationViewport=()=>{const{enabledElement:e,referencedImageId:t,viewportIdsToRender:n,renderingEngine:o,currentPoints:i}=this.editData,{viewport:a}=e,{element:s}=a,l=a.getProperties(),{canvas:d,world:c}=i;let h;if(h=s.querySelector(".magnifyTool"),null===h){const e=document.createElement("div");e.classList.add("magnifyTool"),e.style.display="block",e.style.width=`${this.configuration.magnifyWidth}px`,e.style.height=`${this.configuration.magnifyHeight}px`,e.style.position="absolute",h=e;s.querySelector(".viewport-element").appendChild(e);const t={viewportId:At,type:r.Enums.ViewportType.STACK,element:h};o.enableElement(t)}h.style.top=d[1]-this.configuration.magnifyHeight/2+"px",h.style.left=d[0]-this.configuration.magnifyWidth/2+"px";const u=o.getViewport(At);u.setStack([t]).then((()=>{if(this._hasBeenRemoved)return;u.setProperties(l);const{parallelScale:e}=a.getCamera(),{focalPoint:t,position:n,viewPlaneNormal:o}=u.getCamera(),i=Math.sqrt(Math.pow(t[0]-n[0],2)+Math.pow(t[1]-n[1],2)+Math.pow(t[2]-n[2],2)),r=[c[0],c[1],c[2]],s=[r[0]+i*o[0],r[1]+i*o[1],r[2]+i*o[2]];u.setCamera({parallelScale:e*(1/this.configuration.magnifySize),focalPoint:r,position:s}),u.render()})),h.style.display="block",(0,tt.A)(n)},this._dragCallback=e=>{const t=e.detail,{deltaPoints:n,element:o,currentPoints:i}=t,a=n.world,s=i.canvas,l=(0,r.getEnabledElement)(o),{renderingEngine:d}=l,c=d.getViewport(At),h=o.querySelector(".magnifyTool");if(!h)return;h.style.top=s[1]-this.configuration.magnifyHeight/2+"px",h.style.left=s[0]-this.configuration.magnifyWidth/2+"px";const{focalPoint:u,position:g}=c.getCamera(),p=[g[0]+a[0],g[1]+a[1],g[2]+a[2]],v=[u[0]+a[0],u[1]+a[1],u[2]+a[2]];c.setCamera({focalPoint:v,position:p}),c.render()},this._dragEndCallback=e=>{const{element:t}=e.detail,n=(0,r.getEnabledElement)(t),{renderingEngine:o}=n;o.disableElement(At);const i=t.querySelector(".viewport-element"),a=i.querySelector(".magnifyTool");i.removeChild(a),this._deactivateDraw(t),(0,et.resetElementCursor)(t),this._hasBeenRemoved=!0},this._activateDraw=e=>{B.wk.isInteractingWithTool=!0,this._hasBeenRemoved=!1,e.addEventListener(l.Events.MOUSE_UP,this._dragEndCallback),e.addEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(l.Events.MOUSE_CLICK,this._dragEndCallback),e.addEventListener(l.Events.TOUCH_END,this._dragEndCallback),e.addEventListener(l.Events.TOUCH_DRAG,this._dragCallback)},this._deactivateDraw=e=>{B.wk.isInteractingWithTool=!1,e.removeEventListener(l.Events.MOUSE_UP,this._dragEndCallback),e.removeEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(l.Events.MOUSE_CLICK,this._dragEndCallback),e.removeEventListener(l.Events.TOUCH_END,this._dragEndCallback),e.removeEventListener(l.Events.TOUCH_DRAG,this._dragCallback)}}_getReferencedImageId(e){const t=this.getTargetId(e);let n;return e instanceof r.StackViewport&&(n=t.split("imageId:")[1]),n}}Ot.toolName="Magnify";const Mt=Ot;var Rt=n(29601),kt=n(77081),Lt=n(52905),Pt=n(29614);const{Events:Nt}=r.Enums,Ut=e=>e.uid!==e.referencedId;var Vt;!function(e){e.ShowZoomFactorsList="showZoomFactorsList"}(Vt||(Vt={}));const Bt=1-r.CONSTANTS.EPSILON;class Ht extends Ge.EC{static{this.Actions=Vt}constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,magnifyingGlass:{radius:125,zoomFactor:3,zoomFactorList:[1.5,2,2.5,3,3.5,4,4.5,5],autoPan:{enabled:!0,padding:10}},actions:{showZoomFactorsList:{method:"showZoomFactorsList",bindings:[{mouseButton:l.MouseBindings.Secondary,modifierKey:l.KeyboardBindings.Shift}]}}}}){super(e,t),this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:o}=t,i=(0,r.getEnabledElement)(o),{viewport:a,renderingEngine:l}=i,d=n.world,c=n.canvas,{magnifyingGlass:h}=this.configuration,{radius:u,zoomFactor:g,autoPan:p}=h,v=this._getCanvasHandlePoints(c,u),f=a.getCamera(),{viewPlaneNormal:m,viewUp:w}=f,E=this.getReferencedImageId(a,d,m,w),b=r.utilities.uuidv4(),y=r.utilities.uuidv4(),I=a.getFrameOfReferenceUID(),_={annotationUID:b,highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...m],viewUp:[...w],FrameOfReferenceUID:I,referencedImageId:E},data:{sourceViewportId:a.id,magnifyViewportId:y,zoomFactor:g,isCanvasAnnotation:!0,handles:{points:v,activeHandleIndex:null}}};this.magnifyViewportManager.createViewport(_,{magnifyViewportId:y,sourceEnabledElement:i,position:c,radius:u,zoomFactor:g,autoPan:{enabled:p.enabled,padding:p.padding,callback:e=>{const t=_.data.handles.points,{canvas:n}=e.delta;for(let e=0,o=t.length;e<o;e++){const o=t[e];o[0]+=n[0],o[1]+=n[1],_.invalidated=!0}}}}),(0,s.addAnnotation)(_,o);const C=(0,Qe.getViewportIdsWithToolToRender)(o,this.getToolName());return e.preventDefault(),(0,tt.A)(C),_},this.onSetToolDisabled=()=>{this.magnifyViewportManager.dispose();(0,s.getAllAnnotations)().forEach((e=>{e.metadata.toolName===this.getToolName()&&(0,s.removeAnnotation)(e.annotationUID)}))},this.isPointNearTool=(e,t,n,o)=>{const{data:i}=t,{points:a}=i.handles,r=a,s=r[0],l=r[2],d=r[3],c=.5*Math.abs(l[1]-s[1]),h=[d[0]+c,s[1]+c],u=(0,kt.r)([h,n]);return Math.abs(u-c)<2*o},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:o}=n;t.highlighted=!0;const i=(0,Qe.getViewportIdsWithToolToRender)(o,this.getToolName());this.editData={annotation:t,viewportIdsToRender:i},(0,et.hideElementCursor)(o),this._activateModify(o),(0,tt.A)(i),e.preventDefault()},this.handleSelectedCallback=(e,t,n)=>{const o=e.detail,{element:i}=o,{data:a}=t;t.highlighted=!0;const{points:r}=a.handles,s=r.findIndex((e=>e===n)),l=(0,Qe.getViewportIdsWithToolToRender)(i,this.getToolName());this.editData={annotation:t,viewportIdsToRender:l,handleIndex:s},this._activateModify(i),(0,et.hideElementCursor)(i),(0,tt.A)(l),e.preventDefault()},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:i,newAnnotation:a}=this.editData,{data:r}=o;r.handles.activeHandleIndex=null,this._deactivateModify(n),(0,et.resetElementCursor)(n),this.editData=null,this.isDrawing=!1,(0,tt.A)(i),a&&(0,Je.dZ)(o)},this._dragDrawCallback=e=>{this.isDrawing=!0;const t=e.detail,{deltaPoints:n}=t,o=n?.canvas??[0,0,0],{annotation:i,viewportIdsToRender:a}=this.editData,{points:r}=i.data.handles;r.forEach((e=>{e[0]+=o[0],e[1]+=o[1]})),i.invalidated=!0,this.editData.hasMoved=!0,(0,tt.A)(a)},this._dragModifyCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:i,handleIndex:a}=this.editData,{data:r}=o;if(void 0===a){const{deltaPoints:e}=t,n=e.canvas;r.handles.points.forEach((e=>{e[0]+=n[0],e[1]+=n[1]})),o.invalidated=!0}else this._dragHandle(e),o.invalidated=!0;(0,tt.A)(i)},this._dragHandle=e=>{const t=e.detail,{annotation:n}=this.editData,{data:o}=n,{points:i}=o.handles,a=i,r=a[0],s=a[2],l=a[3],d=.5*Math.abs(s[1]-r[1]),c=[l[0]+d,r[1]+d],{currentPoints:h}=t,u=h.canvas,g=(0,kt.r)([c,u]),p=this._getCanvasHandlePoints(c,g);i[0]=p[0],i[1]=p[1],i[2]=p[2],i[3]=p[3]},this.cancel=e=>{if(!this.isDrawing)return;this.isDrawing=!1,this._deactivateModify(e),(0,et.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:o}=this.editData,{data:i}=t;return t.highlighted=!1,i.handles.activeHandleIndex=null,(0,tt.A)(n),o&&(0,Je.dZ)(t),this.editData=null,t.annotationUID},this._activateModify=e=>{B.wk.isInteractingWithTool=!0,e.addEventListener(l.Events.MOUSE_UP,this._endCallback),e.addEventListener(l.Events.MOUSE_DRAG,this._dragModifyCallback),e.addEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(l.Events.TOUCH_END,this._endCallback),e.addEventListener(l.Events.TOUCH_DRAG,this._dragModifyCallback),e.addEventListener(l.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{B.wk.isInteractingWithTool=!1,e.removeEventListener(l.Events.MOUSE_UP,this._endCallback),e.removeEventListener(l.Events.MOUSE_DRAG,this._dragModifyCallback),e.removeEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(l.Events.TOUCH_END,this._endCallback),e.removeEventListener(l.Events.TOUCH_DRAG,this._dragModifyCallback),e.removeEventListener(l.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:o}=e,{element:i}=o;let a=(0,s.getAnnotations)(this.getToolName(),i);if(!a?.length)return n;a=a?.filter((e=>e.data.sourceViewportId===o.id));const r=this.filterInteractableAnnotationsForElement(i,a);if(!r?.length)return n;const l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let e=0;e<r.length;e++){const i=r[e],{annotationUID:a,data:s}=i,{magnifyViewportId:d,zoomFactor:c,handles:h}=s,{points:u,activeHandleIndex:g}=h;l.annotationUID=a;this.getStyle("lineWidth",l,i),this.getStyle("lineDash",l,i);const p=this.getStyle("color",l,i),v=u,f=v[0],m=v[2],w=v[3],E=.5*Math.abs(m[1]-f[1]),b=[w[0]+E,f[1]+E];if(!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;let y;if(!(0,Rt.isAnnotationVisible)(a))continue;if((0,wt.isAnnotationLocked)(a)||this.editData||null===g||(y=[v[g]]),y){const e="0";(0,Ve.drawHandles)(t,a,e,y,{color:p})}const I=`${a}-advancedMagnify`,_="0";(0,Ve.drawCircle)(t,a,_,b,E,{color:p,lineWidth:5},I);const C=this.magnifyViewportManager.getViewport(d);C.position=b,C.radius=E,C.zoomFactor=c,C.update(),n=!0}return n},this._getCanvasHandlePoints=(e,t)=>[[e[0],e[1]-t,0],[e[0]+t,e[1],0],[e[0],e[1]+t,0],[e[0]-t,e[1],0]],this.magnifyViewportManager=Wt.getInstance()}showZoomFactorsList(e,t){const{element:n,currentPoints:o}=e.detail,i=(0,r.getEnabledElement)(n),{viewport:a}=i,{canvas:s}=o,l=n.querySelector(":scope .viewport-element"),d=t.data.zoomFactor,c=this._getZoomFactorsListDropdown(d,(e=>{void 0!==e&&(t.data.zoomFactor=Number.parseFloat(e),t.invalidated=!0),c.parentElement.removeChild(c),a.render()}));Object.assign(c.style,{left:`${s[0]}px`,top:`${s[1]}px`}),l.appendChild(c),c.focus()}_getZoomFactorsListDropdown(e,t){const{zoomFactorList:n}=this.configuration.magnifyingGlass,o=document.createElement("select");return o.size=5,Object.assign(o.style,{width:"50px",position:"absolute"}),["mousedown","mouseup","mousemove","click"].forEach((e=>{o.addEventListener(e,(e=>e.stopPropagation()))})),o.addEventListener("change",(e=>{e.stopPropagation(),t(o.value)})),o.addEventListener("keydown",(e=>{((e.keyCode??27===e.which)||"escape"===e.key?.toLowerCase())&&(e.stopPropagation(),t())})),n.forEach((t=>{const n=document.createElement("option");n.label=t,n.title=`Zoom factor ${t.toFixed(1)}`,n.value=t,n.defaultSelected=t===e,o.add(n)})),o}}class Wt{constructor(){this.createViewport=(e,t)=>{const{magnifyViewportId:n,sourceEnabledElement:o,position:i,radius:a,zoomFactor:r,autoPan:s}=t,{viewport:l}=o,{element:d}=l,c=new Ft({magnifyViewportId:n,sourceEnabledElement:o,radius:a,position:i,zoomFactor:r,autoPan:s});return this._addSourceElementEventListener(d),this._magnifyViewportsMap.set(c.viewportId,{annotation:e,magnifyViewport:c,magnifyViewportInfo:t}),c},this._annotationRemovedCallback=e=>{const{annotation:t}=e.detail;"AdvancedMagnify"===t.metadata.toolName&&this.destroyViewport(t.data.magnifyViewportId)},this._newStackImageCallback=e=>{const{viewportId:t,imageId:n}=e.detail,o=this._getMagnifyViewportsMapEntriesBySourceViewportId(t),{viewport:i}=(0,r.getEnabledElementByViewportId)(t);i.stackActorReInitialized&&this._reset(t),o.forEach((({annotation:e})=>{e.metadata.referencedImageId=n,e.invalidated=!0}))},this._newVolumeImageCallback=e=>{const{renderingEngineId:t,viewportId:n}=e.detail,o=(0,r.getRenderingEngine)(t).getViewport(n),{viewPlaneNormal:i}=o.getCamera();this._getMagnifyViewportsMapEntriesBySourceViewportId(n).forEach((({annotation:e})=>{const{viewPlaneNormal:t}=e.metadata;if(!(Math.abs(De.eR.dot(t,i))>Bt))return;const{handles:n}=e.data,a=o.canvasToWorld([0,0]),r=De.eR.sub(De.eR.create(),a,n.points[0]),s=De.eR.dot(r,i),l=De.eR.scale(De.eR.create(),i,s);for(let e=0,t=n.points.length;e<t;e++){const t=n.points[e];t[0]+=l[0],t[1]+=l[1],t[2]+=l[2]}e.invalidated=!0}))},this._magnifyViewportsMap=new Map,this._initialize()}static getInstance(){return Wt._singleton=Wt._singleton??new Wt,Wt._singleton}getViewport(e){return this._magnifyViewportsMap.get(e)?.magnifyViewport}dispose(){this._removeEventListeners(),this._destroyViewports()}destroyViewport(e){const t=this._magnifyViewportsMap.get(e);if(t){const{magnifyViewport:n}=t,{viewport:o}=n.sourceEnabledElement,{element:i}=o;this._removeSourceElementEventListener(i),n.dispose(),this._magnifyViewportsMap.delete(e)}}_destroyViewports(){Array.from(this._magnifyViewportsMap.keys()).forEach((e=>this.destroyViewport(e)))}_getMagnifyViewportsMapEntriesBySourceViewportId(e){return Array.from(this._magnifyViewportsMap.values()).filter((({magnifyViewport:t})=>{const{viewport:n}=t.sourceEnabledElement;return n.id===e}))}_reset(e){this._getMagnifyViewportsMapEntriesBySourceViewportId(e).forEach((({magnifyViewport:t,annotation:n,magnifyViewportInfo:o})=>{this.destroyViewport(t.viewportId);const i=(0,r.getEnabledElementByViewportId)(e);this.createViewport(n,{...o,sourceEnabledElement:{...i}})}))}_addEventListeners(){r.eventTarget.addEventListener(l.Events.ANNOTATION_REMOVED,this._annotationRemovedCallback)}_removeEventListeners(){r.eventTarget.removeEventListener(l.Events.ANNOTATION_REMOVED,this._annotationRemovedCallback)}_addSourceElementEventListener(e){e.addEventListener(Nt.STACK_NEW_IMAGE,this._newStackImageCallback);const t=e=>{const{viewportId:t}=e.detail;this._reset(t)};e.addEventListener(Nt.VIEWPORT_NEW_IMAGE_SET,t);const n=e=>{const{viewportId:t}=e.detail;this._reset(t)};e.addEventListener(Nt.VOLUME_VIEWPORT_NEW_VOLUME,n),e.addEventListener(Nt.VOLUME_NEW_IMAGE,this._newVolumeImageCallback),e.newStackHandler=t,e.newVolumeHandler=n}_removeSourceElementEventListener(e){e.removeEventListener(Nt.STACK_NEW_IMAGE,this._newStackImageCallback),e.removeEventListener(Nt.VOLUME_NEW_IMAGE,this._newVolumeImageCallback),e.removeEventListener(Nt.VIEWPORT_NEW_IMAGE_SET,e.newStackHandler),e.removeEventListener(Nt.VOLUME_VIEWPORT_NEW_VOLUME,e.newVolumeHandler),delete e.newStackHandler,delete e.newVolumeHandler}_initialize(){this._addEventListeners()}}class Ft{constructor({magnifyViewportId:e,sourceEnabledElement:t,radius:n=125,position:o=[0,0],zoomFactor:i,autoPan:a}){this._enabledElement=null,this._sourceToolGroup=null,this._magnifyToolGroup=null,this._isViewportReady=!1,this._radius=0,this._resized=!1,this._canAutoPan=!1,this._viewportId=e??r.utilities.uuidv4(),this._sourceEnabledElement=t,this._autoPan=a,this.radius=n,this.position=o,this.zoomFactor=i,this.visible=!0,this._browserMouseDownCallback=this._browserMouseDownCallback.bind(this),this._browserMouseUpCallback=this._browserMouseUpCallback.bind(this),this._handleToolModeChanged=this._handleToolModeChanged.bind(this),this._mouseDragCallback=this._mouseDragCallback.bind(this),this._resizeViewportAsync=(0,Lt.A)(this._resizeViewport.bind(this),1),this._initialize()}get sourceEnabledElement(){return this._sourceEnabledElement}get viewportId(){return this._viewportId}get radius(){return this._radius}set radius(e){Math.abs(this._radius-e)>1e-5&&(this._radius=e,this._resized=!0)}update(){const{radius:e,position:t,visible:n}=this,{viewport:o}=this._enabledElement,{element:i}=o,a=2*e,[r,s]=t;this._resized&&(this._resizeViewportAsync(),this._resized=!1),Object.assign(i.style,{display:n?"block":"hidden",width:`${a}px`,height:`${a}px`,left:-e+"px",top:-e+"px",transform:`translate(${r}px, ${s}px)`}),this._isViewportReady&&(this._syncViewports(),o.render())}dispose(){const{viewport:e}=this._enabledElement,{element:t}=e,n=e.getRenderingEngine();this._removeEventListeners(t),n.disableElement(e.id),t.parentNode&&t.parentNode.removeChild(t)}_handleToolModeChanged(e){const{_magnifyToolGroup:t}=this,{toolGroupId:n,toolName:o,mode:i,toolBindingsOptions:a}=e.detail;if(this._sourceToolGroup?.id===n)switch(i){case l.ToolModes.Active:t.setToolActive(o,a);break;case l.ToolModes.Passive:t.setToolPassive(o);break;case l.ToolModes.Enabled:t.setToolEnabled(o);break;case l.ToolModes.Disabled:t.setToolDisabled(o);break;default:throw new Error(`Unknow tool mode (${i})`)}}_inheritBorderRadius(e){const t=e.querySelector(".viewport-element"),n=e.querySelector(".cornerstone-canvas");t.style.borderRadius="inherit",n.style.borderRadius="inherit"}_createViewportNode(){const e=document.createElement("div"),{radius:t}=this,n=2*t;return e.classList.add("advancedMagnifyTool"),Object.assign(e.style,{display:"block",width:`${n}px`,height:`${n}px`,position:"absolute",overflow:"hidden",borderRadius:"50%",boxSizing:"border-box",left:-t+"px",top:-t+"px",transform:"translate(-1000px, -1000px)"}),e}_convertZoomFactorToParallelScale(e,t,n){const{parallelScale:o}=e.getCamera();return o*(1/n)*(t.canvas.offsetWidth/e.canvas.offsetWidth)}_isStackViewport(e){return"setStack"in e}_isVolumeViewport(e){return"addVolumes"in e}_cloneToolGroups(e,t){const n=e.getActors(),o=`${t.id}-toolGroup`,i=(0,ne.getToolGroupForViewport)(e.id,e.renderingEngineId),a=i.clone(o,(e=>{const t=i.getToolInstance(e);return t instanceof Ge.EC&&!(t instanceof Ht)}));return a.addViewport(t.id,t.renderingEngineId),n.filter(Ut).forEach((e=>{(0,je.addSegmentationRepresentations)(this.viewportId,[{segmentationId:e.referencedId,type:l.SegmentationRepresentations.Labelmap}])})),{sourceToolGroup:i,magnifyToolGroup:a}}_cloneStack(e,t){const n=e.getImageIds();t.setStack(n).then((()=>{this._isViewportReady=!0,this.update()}))}_cloneVolumes(e,t){const n=e.getActors().filter((e=>!Ut(e))).map((e=>({volumeId:e.uid})));return t.setVolumes(n).then((()=>{this._isViewportReady=!0,this.update()})),t}_cloneViewport(e,t){const{viewportId:n}=this,o=e.getRenderingEngine(),{options:i}=e,a={element:t,viewportId:n,type:e.type,defaultOptions:{...i}};o.enableElement(a);const r=o.getViewport(n);this._isStackViewport(e)?this._cloneStack(e,r):this._isVolumeViewport(e)&&this._cloneVolumes(e,r),this._inheritBorderRadius(t);const s=this._cloneToolGroups(e,r);this._sourceToolGroup=s.sourceToolGroup,this._magnifyToolGroup=s.magnifyToolGroup}_cancelMouseEventCallback(e){e.stopPropagation(),e.preventDefault()}_browserMouseUpCallback(e){const{element:t}=this._enabledElement.viewport;document.removeEventListener("mouseup",this._browserMouseUpCallback),t.addEventListener("mouseup",this._cancelMouseEventCallback),t.addEventListener("mousemove",this._cancelMouseEventCallback)}_browserMouseDownCallback(e){const{element:t}=this._enabledElement.viewport;this._canAutoPan=!!e.target?.closest(".advancedMagnifyTool"),document.addEventListener("mouseup",this._browserMouseUpCallback),t.removeEventListener("mouseup",this._cancelMouseEventCallback),t.removeEventListener("mousemove",this._cancelMouseEventCallback)}_mouseDragCallback(e){if(!B.wk.isInteractingWithTool)return;const{_autoPan:t}=this;if(!t.enabled||!this._canAutoPan)return;const{currentPoints:n}=e.detail,{viewport:o}=this._enabledElement,{canvasToWorld:i}=o,{canvas:a}=n,{radius:r}=this,s=[r,r],l=(0,Pt.distanceToPoint)(s,a),d=r-t.padding;if(l<=d)return;const c=l-d,h=De.Zc.sub(De.Zc.create(),a,s);De.Zc.normalize(h,h),De.Zc.scale(h,h,c);const u=De.Zc.add(De.Zc.create(),this.position,h),g=i(this.position),p=i(u),v=De.eR.sub(De.eR.create(),p,g),f={points:{currentPosition:{canvas:this.position,world:g},newPosition:{canvas:u,world:p}},delta:{canvas:h,world:v}};t.callback(f)}_addBrowserEventListeners(e){document.addEventListener("mousedown",this._browserMouseDownCallback,!0),e.addEventListener("mousedown",this._cancelMouseEventCallback),e.addEventListener("mouseup",this._cancelMouseEventCallback),e.addEventListener("mousemove",this._cancelMouseEventCallback),e.addEventListener("dblclick",this._cancelMouseEventCallback)}_removeBrowserEventListeners(e){document.removeEventListener("mousedown",this._browserMouseDownCallback,!0),document.removeEventListener("mouseup",this._browserMouseUpCallback),e.removeEventListener("mousedown",this._cancelMouseEventCallback),e.removeEventListener("mouseup",this._cancelMouseEventCallback),e.removeEventListener("mousemove",this._cancelMouseEventCallback),e.removeEventListener("dblclick",this._cancelMouseEventCallback)}_addEventListeners(e){r.eventTarget.addEventListener(l.Events.TOOL_MODE_CHANGED,this._handleToolModeChanged),e.addEventListener(l.Events.MOUSE_MOVE,this._mouseDragCallback),e.addEventListener(l.Events.MOUSE_DRAG,this._mouseDragCallback),this._addBrowserEventListeners(e)}_removeEventListeners(e){r.eventTarget.removeEventListener(l.Events.TOOL_MODE_CHANGED,this._handleToolModeChanged),e.addEventListener(l.Events.MOUSE_MOVE,this._mouseDragCallback),e.addEventListener(l.Events.MOUSE_DRAG,this._mouseDragCallback),this._removeBrowserEventListeners(e)}_initialize(){const{_sourceEnabledElement:e}=this,{viewport:t}=e,{canvas:n}=t,o=this._createViewportNode();n.parentNode.appendChild(o),this._addEventListeners(o),this._cloneViewport(t,o),this._enabledElement=(0,r.getEnabledElement)(o)}_syncViewportsCameras(e,t){const n=e.canvasToWorld(this.position),o=this._convertZoomFactorToParallelScale(e,t,this.zoomFactor),{focalPoint:i,position:a,viewPlaneNormal:r}=t.getCamera(),s=Math.sqrt(Math.pow(i[0]-a[0],2)+Math.pow(i[1]-a[1],2)+Math.pow(i[2]-a[2],2)),l=[n[0],n[1],n[2]],d=[l[0]+s*r[0],l[1]+s*r[1],l[2]+s*r[2]];t.setCamera({parallelScale:o,focalPoint:l,position:d})}_syncStackViewports(e,t){t.setImageIdIndex(e.getCurrentImageIdIndex())}_syncViewports(){const{viewport:e}=this._sourceEnabledElement,{viewport:t}=this._enabledElement,n=e.getProperties();t.getImageData()&&(t.setProperties(n),this._syncViewportsCameras(e,t),this._isStackViewport(e)&&this._syncStackViewports(e,t),this._syncViewportsCameras(e,t),t.render())}_resizeViewport(){const{viewport:e}=this._enabledElement;e.getRenderingEngine().resize()}}Ht.toolName="AdvancedMagnify";var jt=n(6030);const{EPSILON:Gt}=r.CONSTANTS;class $t extends jt.A{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{sourceViewportId:"",enforceSameFrameOfReference:!0,showFullDimension:!1}}){super(e,t),this.editData=null,this._init=()=>{const e=(0,r.getRenderingEngines)()[0];if(!e)return;let t=e.getViewports();t=(0,Qe.filterViewportsWithToolEnabled)(t,this.getToolName());const n=e.getViewport(this.configuration.sourceViewportId);if(!n?.getImageData())return;const{element:o}=n,{viewUp:i,viewPlaneNormal:a}=n.getCamera(),l=r.utilities.getViewportImageCornersInWorld(n);let d=this.editData?.annotation;const c=n.getFrameOfReferenceUID();if(d)this.editData.annotation.data.handles.points=l;else{const e={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...a],viewUp:[...i],FrameOfReferenceUID:c,referencedImageId:null},data:{handles:{points:l}}};(0,s.addAnnotation)(e,o),d=e}this.editData={sourceViewportId:n.id,renderingEngine:e,annotation:d},(0,tt.A)(t.filter((e=>e.id!==n.id)).map((e=>e.id)))},this.onSetToolEnabled=()=>{this._init()},this.onSetToolConfiguration=()=>{this._init()},this.onCameraModified=e=>{this._init()},this.renderAnnotation=(e,t)=>{const{viewport:n}=e;if(!this.editData)return!1;const{annotation:o,sourceViewportId:i}=this.editData;let a=!1;const{viewport:s}=(0,r.getEnabledElementByViewportId)(i)||{};if(!s)return a;if(s.id===n.id)return a;if(!o||!o?.data?.handles?.points)return a;if(this.configuration.enforceSameFrameOfReference&&s.getFrameOfReferenceUID()!==n.getFrameOfReferenceUID())return a;const l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id},d=o.data.handles.points[0],c=o.data.handles.points[1],h=o.data.handles.points[2],u=o.data.handles.points[3],{focalPoint:g,viewPlaneNormal:p,viewUp:v}=n.getCamera(),{viewPlaneNormal:f}=s.getCamera();if(this.isParallel(p,f))return a;const m=r.utilities.planar.planeEquation(p,g),w=[d,h,c,u],E=[d,c,h,u];let b=w,y=De.eR.subtract(De.eR.create(),w[0],w[1]);y=De.eR.normalize(De.eR.create(),y);let I=De.eR.subtract(De.eR.create(),w[2],w[0]);I=De.eR.normalize(De.eR.create(),I);const _=De.eR.cross(De.eR.create(),y,I);if(this.isParallel(_,p))return a;this.isPerpendicular(y,p)&&(b=E);const C=r.utilities.planar.linePlaneIntersection(b[0],b[1],m),T=r.utilities.planar.linePlaneIntersection(b[2],b[3],m),{annotationUID:S}=o;l.annotationUID=S;const x=this.getStyle("lineWidth",l,o),D=this.getStyle("lineDash",l,o),A=this.getStyle("color",l,o),O=this.getStyle("shadow",l,o);let M=[C,T].map((e=>n.worldToCanvas(e)));if(this.configuration.showFullDimension&&(M=this.handleFullDimension(n,C,p,v,T,M)),M.length<2)return a;const R=`${S}-line`;return(0,Ve.drawLine)(t,S,"1",M[0],M[1],{color:A,width:x,lineDash:D,shadow:O},R),a=!0,a},this.isPerpendicular=(e,t)=>{const n=De.eR.dot(e,t);return Math.abs(n)<Gt}}handleFullDimension(e,t,n,o,i,a){e.getRenderingEngine();const s=this.getTargetId(e),l=this.getTargetImageData(s),d=this.getReferencedImageId(e,t,n,o);if(d&&l)try{const{imageData:n,dimensions:o}=l,[s,c,h,u]=[n.indexToWorld([0,0,0]),n.indexToWorld([o[0]-1,0,0]),n.indexToWorld([o[0]-1,o[1]-1,0]),n.indexToWorld([0,o[1]-1,0])].map((e=>r.utilities.worldToImageCoords(d,e))),[g,p]=[t,i].map((e=>r.utilities.worldToImageCoords(d,e)));a=[[s,c],[c,h],[u,h],[s,u]].map((([e,t])=>this.intersectInfiniteLines(e,t,g,p))).filter((e=>e&&this.isInBound(e,o))).map((t=>{const n=r.utilities.imageToWorldCoords(d,t);return e.worldToCanvas(n)}))}catch(e){console.log(e)}return a}intersectInfiniteLines(e,t,n,o){const[i,a]=e,[r,s]=t,[l,d]=n,[c,h]=o,u=s-a,g=i-r,p=r*a-i*s,v=h-d,f=l-c,m=c*d-l*h;if(Math.abs(u*f-v*g)<Gt)return;return[(g*m-f*p)/(u*f-v*g),(v*p-u*m)/(u*f-v*g)]}isParallel(e,t){return Math.abs(De.eR.dot(e,t))>1-Gt}isInBound(e,t){return e[0]>=0&&e[0]<=t[0]&&e[1]>=0&&e[1]<=t[1]}}$t.toolName="ReferenceLines";const zt=$t,{EPSILON:qt}=r.CONSTANTS;class Zt extends jt.A{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{sourceImageIds:[]}}){super(e,t),this.onSetToolEnabled=()=>{this._init()},this.onSetToolActive=()=>{this._init()},this._init=()=>{const e=this.configuration.sourceImageIds;if(!e?.length)return void console.warn("OverlayGridTool: No sourceImageIds provided in configuration");const t=r.metaData.get("imagePlaneModule",e[0]);if(!t)return void console.warn("OverlayGridTool: No imagePlaneModule found for sourceImageIds");const{frameOfReferenceUID:n}=t,o=(0,ne.getToolGroup)(this.toolGroupId).viewportsInfo;if(!o?.length)return void console.warn("OverlayGridTool: No viewports found");const i=(0,s.getAnnotations)(this.getToolName(),n);if(!i?.length){const t=e.map((e=>this.calculateImageIdPointSets(e))),o={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),FrameOfReferenceUID:n,referencedImageId:null},data:{viewportData:new Map,pointSets:t}};(0,s.addAnnotation)(o,n)}(0,tt.A)(o.map((({viewportId:e})=>e)))},this.calculateImageIdPointSets=e=>{const{imagePositionPatient:t,rows:n,columns:o,rowCosines:i,columnCosines:a,rowPixelSpacing:s,columnPixelSpacing:l}=r.metaData.get("imagePlaneModule",e),d=[...t],c=[...t],h=[...t],u=[...t];De.eR.scaleAndAdd(c,t,a,o*l),De.eR.scaleAndAdd(h,t,i,n*s),De.eR.scaleAndAdd(u,h,a,o*l);return{pointSet1:[d,h,c,u],pointSet2:[d,c,h,u]}},this.renderAnnotation=(e,t)=>{const n=this.configuration.sourceImageIds;let o=!1;if(!n?.length)return o;const{viewport:i,FrameOfReferenceUID:a}=e;if(i.getImageIds().length<2)return o;const l=(0,s.getAnnotations)(this.getToolName(),a);if(!l?.length)return o;const d=l[0],{annotationUID:c}=d,{focalPoint:h,viewPlaneNormal:u}=i.getCamera(),g={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id},p=this.getImageIdNormal(n[0]);if(this.isParallel(u,p))return o;const v=r.utilities.planar.planeEquation(u,h),f=d.data.pointSets,m=d.data.viewportData;for(let e=0;e<n.length;e++){const{pointSet1:n,pointSet2:o}=f[e],a=m.get(i.id)||this.initializeViewportData(m,i.id);if(!a.pointSetsToUse[e]){let t=n,i=De.eR.subtract(De.eR.create(),n[0],n[1]);i=De.eR.normalize(De.eR.create(),i),this.isPerpendicular(i,u)&&(t=o),a.pointSetsToUse[e]=t,a.lineStartsWorld[e]=r.utilities.planar.linePlaneIntersection(t[0],t[1],v),a.lineEndsWorld[e]=r.utilities.planar.linePlaneIntersection(t[2],t[3],v)}const s=a.lineStartsWorld[e],l=a.lineEndsWorld[e];g.annotationUID=c;const h=this.getStyle("lineWidth",g,d),p=this.getStyle("lineDash",g,d),w=this.getStyle("color",g,d),E=this.getStyle("shadow",g,d),b=[s,l].map((e=>i.worldToCanvas(e))),y=`${c}-line`,I=`${e}`;(0,Ve.drawLine)(t,c,I,b[0],b[1],{color:w,width:h,lineDash:p,shadow:E},y)}return o=!0,o},this.initializeViewportData=(e,t)=>(e.set(t,{pointSetsToUse:[],lineStartsWorld:[],lineEndsWorld:[]}),e.get(t)),this.isPerpendicular=(e,t)=>{const n=De.eR.dot(e,t);return Math.abs(n)<qt}}isParallel(e,t){return Math.abs(De.eR.dot(e,t))>1-qt}getImageIdNormal(e){const{imageOrientationPatient:t}=r.metaData.get("imagePlaneModule",e),n=De.eR.fromValues(t[0],t[1],t[2]),o=De.eR.fromValues(t[3],t[4],t[5]);return De.eR.cross(De.eR.create(),n,o)}}Zt.toolName="OverlayGrid";const Kt=Zt;var Yt=n(38726);class Xt extends jt.A{constructor(e={},t={configuration:{opacity:.5}}){super(e,t),this._init=()=>{const e=(0,ne.getToolGroup)(this.toolGroupId).viewportsInfo;if(!e?.length)return void console.warn(this.getToolName()+"Tool: No viewports found");const t=(0,r.getRenderingEngine)(e[0].renderingEngineId)?.getViewport(e[0].viewportId);if(!t)return;const n=t.getFrameOfReferenceUID(),o=(0,s.getAnnotations)(this.getToolName(),n);if(!o?.length){const t=new Map;!function(e,t){t.forEach((({viewportId:t,renderingEngineId:n})=>{const o=(0,r.getRenderingEngine)(n)?.getViewport(t);Jt(e,o)}))}(t,e);const o={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),FrameOfReferenceUID:n,referencedImageId:null},data:{actorsWorldPointsMap:t}};(0,s.addAnnotation)(o,n)}(0,tt.A)(e.map((({viewportId:e})=>e)))},this.onSetToolEnabled=()=>{this._init()},this.onCameraModified=e=>{this._init()},this.renderAnnotation=(e,t)=>{const{viewport:n,FrameOfReferenceUID:o}=e;let i=!1;const a=(0,s.getAnnotations)(this.getToolName(),o);if(!a?.length)return i;const r=a[0],{annotationUID:l}=r,d=r.data.actorsWorldPointsMap;Jt(d,n);const c=n.getActors(),h=Qt(n);return c.forEach((e=>{if(!e?.clippingFilter)return;const o=d.get(e.uid);if(!o)return;if(!o.get(h))return;let i=1;const{worldPointsSet:a,color:r}=o.get(h);for(let o=0;o<a.length;o++){const s=a[o].map((e=>n.worldToCanvas(e))),d={color:r,fillColor:r,fillOpacity:this.configuration.opacity,closePath:!0,lineWidth:2},c=e.uid+"#"+i;(0,Ve.drawPath)(t,l,c,s,d),i++}})),i=!0,i}}}function Jt(e,t){const n=t.getActors(),o=Qt(t);n.forEach((t=>{if(!t?.clippingFilter)return;let n=e.get(t.uid);if(n||(n=new Map,e.set(t.uid,n)),!n.get(o)){const e=t.clippingFilter.getOutputData(),i=Be.polyDataUtils.getPolyDataPoints(e);if(!i)return;const a=function(e){function t(e){let t=Math.floor(255*e).toString(16);return 1===t.length&&(t="0"+t),t}return"#"+t(e[0])+t(e[1])+t(e[2])}(t.actor.getProperty().getColor());n.set(o,{worldPointsSet:i,color:a})}}))}function Qt(e){const{viewPlaneNormal:t}=e.getCamera(),n=e.getCurrentImageIdIndex();return`${e.id}-${(0,Yt.l)(t)}-${n}`}Xt.toolName="SegmentationIntersection";const en=Xt;class tn extends jt.A{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,displayThreshold:5,positionSync:!0,disableCursor:!1}}){super(e,t),this.isDrawing=!1,this.isHandleOutsideImage=!1,this._elementWithCursor=null,this._currentCursorWorldPosition=null,this._currentCanvasPosition=null,this._disableCursorEnabled=!1,this.mouseMoveCallback=e=>{const{detail:t}=e,{element:n,currentPoints:o}=t;this._currentCursorWorldPosition=o.world,this._currentCanvasPosition=o.canvas,this._elementWithCursor=n;const i=this.getActiveAnnotation(n);return null===i?(this.createInitialAnnotation(o.world,n),!1):(this.updateAnnotationPosition(n,i),!1)},this.createInitialAnnotation=(e,t)=>{const n=(0,r.getEnabledElement)(t);if(!n)throw new Error("No enabled element found");const{viewport:o,renderingEngine:i}=n;this.isDrawing=!0;const a=o.getCamera(),{viewPlaneNormal:l,viewUp:d}=a;if(!l||!d)throw new Error("Camera not found");const c=this.getReferencedImageId(o,e,l,d),h=o.getFrameOfReferenceUID(),u={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...l],viewUp:[...d],FrameOfReferenceUID:h,referencedImageId:c},data:{label:"",handles:{points:[[...e]],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}}}};if((0,s.getAnnotations)(this.getToolName(),t).length>0)return null;if(null===(0,s.addAnnotation)(u,t))return;const g=(0,Qe.getViewportIdsWithToolToRender)(t,this.getToolName(),!1);(0,tt.A)(g)},this.onCameraModified=e=>{const t=e.detail,{element:n,previousCamera:o,camera:i}=t,a=(0,r.getEnabledElement)(n).viewport;if(n!==this._elementWithCursor)return;const s=o.focalPoint,l=i.viewPlaneNormal,d=i.focalPoint,c=[0,0,0];if(qe.Ay.subtract(d,s,c),0===c.reduce(((e,t)=>e+t),0))return;const h=qe.Ay.dot(c,l);if(Math.abs(h)<.01)return;if(!this._currentCanvasPosition)return;const u=a.canvasToWorld(this._currentCanvasPosition);this._currentCursorWorldPosition=u,this.updateAnnotationPosition(n,this.getActiveAnnotation(n))},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:o,FrameOfReferenceUID:i}=e,a=this._elementWithCursor===o.element;this.configuration.positionSync&&!a&&this.updateViewportImage(o);const{element:r}=o;let l=(0,s.getAnnotations)(this.getToolName(),r);if(!l?.length)return n;if(l=this.filterInteractableAnnotationsForElement(r,l),!l?.length)return n;const d={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let e=0;e<l.length;e++){const i=l[e],{annotationUID:r,data:s}=i,{handles:c}=s,{points:h}=c;if(!r)return n;d.annotationUID=r;const u=parseFloat(this.getStyle("lineWidth",d,i)),g=u,p=this.getStyle("lineDash",d,i),v=this.getStyle("color",d,i);if(h[0].some((e=>isNaN(e))))return n;const f=h.map((e=>o.worldToCanvas(e)));if(!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;if(!(0,Rt.isAnnotationVisible)(r))continue;const m={upper:"upper",right:"right",lower:"lower",left:"left"},[w,E]=f[0],b=a?20:7,y=a?5:7;(0,Ve.drawLine)(t,r,m.upper,[w,E-(b/2+y)],[w,E-b/2],{color:v,lineDash:p,lineWidth:g}),(0,Ve.drawLine)(t,r,m.lower,[w,E+(b/2+y)],[w,E+b/2],{color:v,lineDash:p,lineWidth:g}),(0,Ve.drawLine)(t,r,m.right,[w+(b/2+y),E],[w+b/2,E],{color:v,lineDash:p,lineWidth:g}),(0,Ve.drawLine)(t,r,m.left,[w-(b/2+y),E],[w-b/2,E],{color:v,lineDash:p,lineWidth:g}),n=!0}return n},this._disableCursorEnabled=this.configuration.disableCursor}onSetToolActive(){if(this._disableCursorEnabled=this.configuration.disableCursor,!this._disableCursorEnabled)return;const e=(0,ne.getToolGroup)(this.toolGroupId).viewportsInfo;if(!e)return;e.map((e=>(0,r.getEnabledElementByIds)(e.viewportId,e.renderingEngineId))).forEach((e=>{e&&(0,et.hideElementCursor)(e.viewport.element)}))}onSetToolDisabled(){if(!this._disableCursorEnabled)return;const e=(0,ne.getToolGroup)(this.toolGroupId).viewportsInfo;if(!e)return;e.map((e=>(0,r.getEnabledElementByIds)(e.viewportId,e.renderingEngineId))).forEach((e=>{e&&(0,et.resetElementCursor)(e.viewport.element)}))}getActiveAnnotation(e){const t=(0,s.getAnnotations)(this.getToolName(),e);if(!t.length)return null;return t[0]}updateAnnotationPosition(e,t){const n=this._currentCursorWorldPosition;if(!n)return;if(!t.data?.handles?.points)return;t.data.handles.points=[[...n]],t.invalidated=!0;const o=(0,Qe.getViewportIdsWithToolToRender)(e,this.getToolName(),!1);(0,r.getEnabledElement)(e)&&(0,tt.A)(o)}filterInteractableAnnotationsForElement(e,t){if(!(t instanceof Array)||0===t.length)return[];const n=t[0],o=(0,r.getEnabledElement)(e)?.viewport;if(!o)return[];const i=o.getCamera(),{viewPlaneNormal:a,focalPoint:s}=i;if(!a||!s)return[];const l=n.data?.handles?.points;if(!(l instanceof Array)||1!==l.length)return[];const d=l[0],c=r.utilities.planar.planeEquation(a,s);return r.utilities.planar.planeDistanceToPoint(c,d)<this.configuration.displayThreshold?[n]:[]}updateViewportImage(e){const t=this._currentCursorWorldPosition;if(t&&!t.some((e=>isNaN(e))))if(e instanceof r.StackViewport){const n=r.utilities.getClosestStackImageIndexForPoint(t,e);if(null===n)return;n!==e.getCurrentImageIdIndex()&&e.setImageIdIndex(n)}else if(e instanceof r.VolumeViewport){const{focalPoint:n,viewPlaneNormal:o}=e.getCamera();if(!n||!o)return;const i=r.utilities.planar.planeEquation(o,n),a=r.utilities.planar.planeDistanceToPoint(i,t,!0);if(Math.abs(a)<.5)return;const s=De.eR.normalize(De.eR.create(),De.eR.fromValues(...o)),l=De.eR.scale(De.eR.create(),s,a),d=De.eR.add(De.eR.create(),De.eR.fromValues(...n),l);if(!0){e.setCamera({focalPoint:d});const t=e.getRenderingEngine();t&&t.renderViewport(e.id)}}}}tn.toolName="ReferenceCursors";const nn=tn,on=[];class an extends jt.A{constructor(e={},t={configuration:{viewportId:"",scaleLocation:"bottom"}}){super(e,t),this.editData=null,this._init=()=>{const e=(0,r.getRenderingEngines)()[0];if(!e)return;const t=(0,ne.getToolGroup)(this.toolGroupId).viewportsInfo;if(!t)return;const n=t.map((e=>(0,r.getEnabledElementByIds)(e.viewportId,e.renderingEngineId)));let{viewport:o}=n[0];const{FrameOfReferenceUID:i}=n[0];if(this.configuration.viewportId&&n.forEach((e=>{e.viewport.id==this.configuration.viewportId&&(o=e.viewport)})),!o)return;const{viewUp:a,viewPlaneNormal:l}=o.getCamera(),d=r.utilities.getViewportImageCornersInWorld(o);let c=this.editData.annotation;const h=(0,s.getAnnotations)(this.getToolName(),o.element);h.length&&(c=h.filter((e=>e.data.viewportId==o.id))[0]),n.forEach((e=>{const{viewport:t}=e;if(!on.includes(t.id)){const e={metadata:{toolName:this.getToolName(),viewPlaneNormal:[...l],viewUp:[...a],FrameOfReferenceUID:i,referencedImageId:null},data:{handles:{points:r.utilities.getViewportImageCornersInWorld(t)},viewportId:t.id}};on.push(t.id),(0,s.addAnnotation)(e,t.element),c=e}})),this.editData.annotation&&this.editData.annotation.data.viewportId==o.id&&(this.editData.annotation.data.handles.points=d,this.editData.annotation.data.viewportId=o.id),this.editData={viewport:o,renderingEngine:e,annotation:c}},this.onSetToolEnabled=()=>{this._init()},this.onCameraModified=e=>{this.configuration.viewportId=e.detail.viewportId,this._init()},this.computeScaleSize=(e,t,n)=>{const o=[16e3,8e3,4e3,2e3,1e3,500,250,100,50,25,10,5,2];let i;return i="top"==n||"bottom"==n?o.filter((t=>t<.6*e&&t>.2*e)):o.filter((e=>e<.6*t&&e>.2*t)),i[0]},this.computeEndScaleTicks=(e,t)=>{const n={bottom:[[0,-10],[0,-10]],top:[[0,10],[0,10]],left:[[0,0],[10,0]],right:[[0,0],[-10,0]]};return{endTick1:[[e[1][0]+n[t][0][0],e[1][1]+n[t][0][0]],[e[1][0]+n[t][1][0],e[1][1]+n[t][1][1]]],endTick2:[[e[0][0]+n[t][0][0],e[0][1]+n[t][0][0]],[e[0][0]+n[t][1][0],e[0][1]+n[t][1][1]]]}},this.computeInnerScaleTicks=(e,t,n,o,i)=>{let a;"bottom"==t||"top"==t?a=i[0][0]-o[0][0]:"left"!=t&&"right"!=t||(a=i[0][1]-o[0][1]);const r=[],s=[],l=[];let d=e;e>=50&&(d=e/10);const c=a/d;for(let e=0;e<d-1;e++){const i={bottom:[[c*(e+1),0],[c*(e+1),5]],top:[[c*(e+1),0],[c*(e+1),-5]],left:[[0,c*(e+1)],[-5,c*(e+1)]],right:[[0,c*(e+1)],[5,c*(e+1)]]};r.push(`${n}-tick${e}`),s.push(`tick${e}`),(e+1)%5==0?l.push([[o[0][0]+i[t][0][0],o[0][1]+i[t][0][1]],[o[1][0]+i[t][0][0],o[1][1]+i[t][0][1]]]):l.push([[o[0][0]+i[t][0][0],o[0][1]+i[t][0][1]],[o[1][0]+i[t][1][0],o[1][1]+i[t][1][1]]])}return{tickIds:r,tickUIDs:s,tickCoordinates:l}},this.computeWorldScaleCoordinates=(e,t,n)=>{let o,i=De.eR.subtract(De.eR.create(),n[0],n[1]);i=De.eR.normalize(De.eR.create(),i);let a=De.eR.subtract(De.eR.create(),n[2],n[0]);a=De.eR.normalize(De.eR.create(),a);const r={bottom:[n[1],n[2]],top:[n[0],n[3]],right:[n[2],n[3]],left:[n[0],n[1]]},s=De.eR.add(De.eR.create(),r[t][0],r[t][0]).map((e=>e/2)),l=e/2/Math.sqrt(Math.pow(i[0],2)+Math.pow(i[1],2)+Math.pow(i[2],2));return"top"==t||"bottom"==t?o=[De.eR.subtract(De.eR.create(),s,a.map((e=>e*l))),De.eR.add(De.eR.create(),s,a.map((e=>e*l)))]:"left"!=t&&"right"!=t||(o=[De.eR.add(De.eR.create(),s,i.map((e=>e*l))),De.eR.subtract(De.eR.create(),s,i.map((e=>e*l)))]),o},this.computeCanvasScaleCoordinates=(e,t,n,o,i)=>{let a;if("top"==i||"bottom"==i){const o=t[0][0]-t[1][0];a=[[e.width/2-o/2,n.height],[e.width/2+o/2,n.height]]}else if("left"==i||"right"==i){const n=t[0][1]-t[1][1];a=[[o.width,e.height/2-n/2],[o.width,e.height/2+n/2]]}return a},this.computeScaleBounds=(e,t,n,o)=>{const i=t*Math.min(1e3,e.width),a=n*Math.min(1e3,e.height),r={bottom:[-a,-i],top:[a,i],left:[a,i],right:[-a,-i]},s={bottom:[e.height,e.width],top:[0,e.width],left:[e.height,0],right:[e.height,e.width]};return{height:s[o][0]+r[o][0],width:s[o][1]+r[o][1]}}}renderAnnotation(e,t){if(!this.editData.viewport)return;const n=this.configuration.scaleLocation,{viewport:o}=e,i=(0,s.getAnnotations)(this.getToolName(),o.element).filter((e=>e.data.viewportId==o.id))[0],a=e.viewport.canvas,r=!1;if(!o)return r;const l={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id},d={width:a.width/window.devicePixelRatio||1,height:a.height/window.devicePixelRatio||1},c=i.data.handles.points[0],h=i.data.handles.points[1],u=i.data.handles.points[2],g=i.data.handles.points[3],p=[c,u,h,g],v=De.eR.distance(u,g),f=De.eR.distance(c,u),m=this.computeScaleBounds(d,.05,.05,n),w=this.computeScaleBounds(d,.05,.05,n),E=this.computeScaleSize(v,f,n),b=this.computeWorldScaleCoordinates(E,n,p).map((e=>o.worldToCanvas(e))),y=this.computeCanvasScaleCoordinates(d,b,w,m,n),I=this.computeEndScaleTicks(y,n),{annotationUID:_}=i;l.annotationUID=_;const C=this.getStyle("lineWidth",l,i),T=this.getStyle("lineDash",l,i),S=this.getStyle("color",l,i),x=this.getStyle("shadow",l,i),D=`${_}-scaleline`;(0,Ve.drawLine)(t,_,"1",y[0],y[1],{color:S,width:C,lineDash:T,shadow:x},D);const A=`${_}-left`;(0,Ve.drawLine)(t,_,"2",I.endTick1[0],I.endTick1[1],{color:S,width:C,lineDash:T,shadow:x},A);const O=`${_}-right`;(0,Ve.drawLine)(t,_,"3",I.endTick2[0],I.endTick2[1],{color:S,width:C,lineDash:T,shadow:x},O);const M={bottom:[-10,-42],top:[-12,-35],left:[-40,-20],right:[-50,-20]},R=[y[0][0]+M[n][0],y[0][1]+M[n][1]],k=this._getTextLines(E),{tickIds:L,tickUIDs:P,tickCoordinates:N}=this.computeInnerScaleTicks(E,n,_,I.endTick1,I.endTick2);for(let e=0;e<P.length;e++)(0,Ve.drawLine)(t,_,P[e],N[e][0],N[e][1],{color:S,width:C,lineDash:T,shadow:x},L[e]);return(0,Ve.drawTextBox)(t,_,"text0",k,[R[0],R[1]],{fontFamily:"Helvetica Neue, Helvetica, Arial, sans-serif",fontSize:"14px",lineDash:"2,3",lineWidth:"1",shadow:!0,color:S}),r}_getTextLines(e){let t,n;e>=50?(t=e/10,n=" cm"):(t=e,n=" mm");return[t.toString().concat(n)]}}an.toolName="ScaleOverlay";const rn=an;var sn=n(95527),ln=n(76712),dn=n(16175),cn=n(13271);class hn extends Ge.oS{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{minSpacing:1,referencedToolNames:["PlanarFreehandROI","PlanarFreehandContourSegmentationTool"],toolShape:"circle",referencedToolName:"PlanarFreehandROI"}}){super(e,t),this.registeredShapes=new Map,this.isActive=!1,this.commonData={activeAnnotationUID:null,viewportIdsToRender:[],isEditingOpenContour:!1,canvasLocation:void 0},this.preMouseDownCallback=e=>{const t=e.detail,n=t.element;if(this.configureToolSize(e),this.selectFreehandTool(t),null!==this.commonData.activeAnnotationUID)return this.isActive=!0,(0,et.hideElementCursor)(n),this.activateModify(n),!0},this.mouseMoveCallback=e=>{this.mode===l.ToolModes.Active?(this.configureToolSize(e),this.updateCursor(e)):this.commonData.canvasLocation=void 0},this.endCallback=e=>{const t=e.detail,{element:n}=t,o=this.configuration,i=(0,r.getEnabledElement)(n);this.isActive=!1,this.deactivateModify(n),(0,et.resetElementCursor)(n);const{renderingEngineId:a,viewportId:s}=i,l=(0,ne.getToolGroupForViewport)(s,a).getToolInstance(o.referencedToolName),d=this.filterSculptableAnnotationsForElement(n).find((e=>e.annotationUID===this.commonData.activeAnnotationUID));l.configuration.calculateStats&&(d.invalidated=!0),(0,Je.XF)(d,n)},this.dragCallback=e=>{const t=e.detail,n=t.element;this.updateCursor(e);const o=this.filterSculptableAnnotationsForElement(n),i=o.find((e=>e.annotationUID===this.commonData.activeAnnotationUID));if(!o?.length||!this.isActive)return;const a=i.data.contour.polyline;this.sculpt(t,a)},this.registerShapes(dn.A.shapeName,dn.A),this.setToolShape(this.configuration.toolShape)}registerShapes(e,t){const n=new t;this.registeredShapes.set(e,n)}sculpt(e,t){const n=this.configuration,o=e.element,i=(0,r.getEnabledElement)(o),{viewport:a}=i,s=this.registeredShapes.get(this.selectedShape);this.sculptData={mousePoint:e.currentPoints.world,mouseCanvasPoint:e.currentPoints.canvas,points:t,maxSpacing:s.getMaxSpacing(n.minSpacing),element:o};const l=s.pushHandles(a,this.sculptData);void 0!==l.first&&this.insertNewHandles(l)}interpolatePointsWithinMaxSpacing(e,t,n,o){const{element:i}=this.sculptData,a=(0,r.getEnabledElement)(i),{viewport:s}=a,l=un(e+1,t.length),d=s.worldToCanvas(t[e]),c=s.worldToCanvas(t[l]);sn.point.distanceToPoint(d,c)>o&&n.push(e)}updateCursor(e){const t=e.detail,n=t.element,o=(0,r.getEnabledElement)(n),{renderingEngine:i,viewport:a}=o;this.commonData.viewportIdsToRender=[a.id];const s=this.filterSculptableAnnotationsForElement(n);if(!s?.length)return;const l=s.find((e=>e.annotationUID===this.commonData.activeAnnotationUID));if(this.commonData.canvasLocation=t.currentPoints.canvas,this.isActive)l.highlighted=!0;else{const e=this.registeredShapes.get(this.selectedShape),n=t.currentPoints.canvas;e.updateToolSize(n,a,l)}(0,tt.t)(this.commonData.viewportIdsToRender)}filterSculptableAnnotationsForElement(e){const t=this.configuration,n=(0,r.getEnabledElement)(e),{renderingEngineId:o,viewportId:i}=n,a=[],s=(0,ne.getToolGroupForViewport)(i,o).getToolInstance(t.referencedToolName);return t.referencedToolNames.forEach((t=>{const n=(0,G.Rh)(t,e);n&&a.push(...n)})),s.filterInteractableAnnotationsForElement(e,a)}configureToolSize(e){this.registeredShapes.get(this.selectedShape).configureToolSize(e)}insertNewHandles(e){const t=this.findNewHandleIndices(e);let n=0;for(let e=0;e<t?.length;e++){const o=t[e]+1+n;this.insertHandleRadially(o),n++}}findNewHandleIndices(e){const{points:t,maxSpacing:n}=this.sculptData,o=[];for(let i=e.first;i<=e.last;i++)this.interpolatePointsWithinMaxSpacing(i,t,o,n);return o}insertHandleRadially(e){const{points:t}=this.sculptData;if(e>t.length-1&&this.commonData.isEditingOpenContour)return;const n=this.registeredShapes.get(this.selectedShape),o=e-1,i=un(e,t.length),a=n.getInsertPosition(o,i,this.sculptData);t.splice(e,0,a)}selectFreehandTool(e){const t=this.getClosestFreehandToolOnElement(e);void 0!==t&&(this.commonData.activeAnnotationUID=t)}getClosestFreehandToolOnElement(e){const{element:t}=e,n=(0,r.getEnabledElement)(t),{viewport:o}=n,i=this.configuration,a=this.filterSculptableAnnotationsForElement(t);if(!a?.length)return;const s=e.currentPoints.canvas,l={distance:1/0,toolIndex:void 0,annotationUID:void 0};for(let e=0;e<a?.length;e++){if(a[e].isLocked||!a[e].isVisible)continue;const t=(0,cn.X)(o,a[e],s);-1!==t&&(t<l.distance&&(l.distance=t,l.toolIndex=e,l.annotationUID=a[e].annotationUID))}return this.commonData.isEditingOpenContour=!a[l.toolIndex].data.contour.closed,i.referencedToolName=a[l.toolIndex].metadata.toolName,l.annotationUID}activateModify(e){e.addEventListener(l.Events.MOUSE_UP,this.endCallback),e.addEventListener(l.Events.MOUSE_CLICK,this.endCallback),e.addEventListener(l.Events.MOUSE_DRAG,this.dragCallback),e.addEventListener(l.Events.TOUCH_TAP,this.endCallback),e.addEventListener(l.Events.TOUCH_END,this.endCallback),e.addEventListener(l.Events.TOUCH_DRAG,this.dragCallback)}deactivateModify(e){e.removeEventListener(l.Events.MOUSE_UP,this.endCallback),e.removeEventListener(l.Events.MOUSE_CLICK,this.endCallback),e.removeEventListener(l.Events.MOUSE_DRAG,this.dragCallback),e.removeEventListener(l.Events.TOUCH_TAP,this.endCallback),e.removeEventListener(l.Events.TOUCH_END,this.endCallback),e.removeEventListener(l.Events.TOUCH_DRAG,this.dragCallback)}setToolShape(e){this.selectedShape=this.registeredShapes.get(e)??dn.A.shapeName}renderAnnotation(e,t){const{viewport:n}=e,{element:o}=n,i=this.commonData.viewportIdsToRender;if(!this.commonData.canvasLocation||this.mode!==l.ToolModes.Active||!i.includes(n.id))return;const a=this.filterSculptableAnnotationsForElement(o);if(!a?.length)return;const r={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};let s=(0,ln.h)("color",r,l.AnnotationStyleStates.Default,this.mode);this.isActive&&(s=(0,ln.h)("color",r,l.AnnotationStyleStates.Highlighted,this.mode));this.registeredShapes.get(this.selectedShape).renderShape(t,this.commonData.canvasLocation,{color:s})}}const un=(e,t)=>(e+t)%t;hn.toolName="SculptorTool";const gn=hn,pn=[0,0,1];class vn extends Ge.oS{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{direction:pn,rotateIncrementDegrees:30}}){super(e,t)}mouseWheelCallback(e){const{element:t,wheel:n}=e.detail,o=(0,r.getEnabledElement)(t),{viewport:i}=o,{direction:a,rotateIncrementDegrees:s}=this.configuration,l=i.getCamera(),{viewUp:d,position:c,focalPoint:h}=l,{direction:u}=n,[g,p,v]=h,[f,m,w]=a,E=u*(s*Math.PI)/180,b=[0,0,0],y=[0,0,0],I=[0,0,0],_=De.pB.identity(new Float32Array(16));De.pB.translate(_,_,[g,p,v]),De.pB.rotate(_,_,E,[f,m,w]),De.pB.translate(_,_,[-g,-p,-v]),De.eR.transformMat4(b,c,_),De.eR.transformMat4(y,h,_),De.pB.identity(_),De.pB.rotate(_,_,E,[f,m,w]),De.eR.transformMat4(I,d,_),i.setCamera({position:b,viewUp:I,focalPoint:y}),i.render()}}vn.toolName="VolumeRotateMouseWheel";const fn=vn;var mn=n(25072),wn=n(4096),En=n(27730),bn=n(66990);const{transformWorldToIndex:yn}=r.utilities;class In extends Ge.EC{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{preventHandleOutsideImage:!1,getTextLines:_n}}){super(e,t),this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:o}=t,i=n.world,a=(0,r.getEnabledElement)(o),{viewport:l,renderingEngine:d}=a;(0,et.hideElementCursor)(o),this.isDrawing=!0;const{viewPlaneNormal:c,viewUp:h,position:u}=l.getCamera(),g=this.getReferencedImageId(l,i,c,h),p={highlighted:!0,invalidated:!0,metadata:{...l.getViewReference({points:[i]}),toolName:this.getToolName(),referencedImageId:g,viewUp:h,cameraPosition:u},data:{handles:{points:[[...i],[...i]],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:"",cachedStats:{}}};(0,s.addAnnotation)(p,o);const v=(0,Qe.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:p,viewportIdsToRender:v,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),e.preventDefault(),(0,tt.A)(v),p},this.isPointNearTool=(e,t,n,o)=>{const i=(0,r.getEnabledElement)(e),{viewport:a}=i,{data:s}=t,[l,d]=s.handles.points,c=a.worldToCanvas(l),h=a.worldToCanvas(d),u={start:{x:c[0],y:c[1]},end:{x:h[0],y:h[1]}};return mt.distanceToPoint([u.start.x,u.start.y],[u.end.x,u.end.y],[n[0],n[1]])<=o},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:o}=n;t.highlighted=!0;const i=(0,Qe.getViewportIdsWithToolToRender)(o,this.getToolName());this.editData={annotation:t,viewportIdsToRender:i,movingTextBox:!1},this._activateModify(o),(0,et.hideElementCursor)(o);const a=(0,r.getEnabledElement)(o),{renderingEngine:s}=a;(0,tt.A)(i),e.preventDefault()},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:i,newAnnotation:a,hasMoved:l}=this.editData,{data:d}=o;if(a&&!l)return;d.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,et.resetElementCursor)(n);const c=(0,r.getEnabledElement)(n),{renderingEngine:h}=c;this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,s.removeAnnotation)(o.annotationUID),(0,tt.A)(i),a&&(0,Je.dZ)(o),this.editData=null,this.isDrawing=!1},this._dragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:i,handleIndex:a,movingTextBox:r}=this.editData,{data:s}=o;if(r){const{deltaPoints:e}=t,n=e.world,{textBox:o}=s.handles,{worldPosition:i}=o;i[0]+=n[0],i[1]+=n[1],i[2]+=n[2],o.hasMoved=!0}else if(void 0===a){const{deltaPoints:e}=t,n=e.world;s.handles.points.forEach((e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]})),o.invalidated=!0}else{const{currentPoints:e}=t,n=e.world;s.handles.points[a]=[...n],o.invalidated=!0}this.editData.hasMoved=!0,(0,tt.A)(i)},this.cancel=e=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,et.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:o}=this.editData,{data:i}=t;return t.highlighted=!1,i.handles.activeHandleIndex=null,(0,tt.A)(n),o&&(0,Je.dZ)(t),this.editData=null,t.annotationUID}},this._activateModify=e=>{B.wk.isInteractingWithTool=!0,e.addEventListener(l.Events.MOUSE_UP,this._endCallback),e.addEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(l.Events.TOUCH_END,this._endCallback),e.addEventListener(l.Events.TOUCH_DRAG,this._dragCallback),e.addEventListener(l.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{B.wk.isInteractingWithTool=!1,e.removeEventListener(l.Events.MOUSE_UP,this._endCallback),e.removeEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(l.Events.TOUCH_END,this._endCallback),e.removeEventListener(l.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(l.Events.TOUCH_TAP,this._endCallback)},this._activateDraw=e=>{B.wk.isInteractingWithTool=!0,e.addEventListener(l.Events.MOUSE_UP,this._endCallback),e.addEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(l.Events.MOUSE_MOVE,this._dragCallback),e.addEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(l.Events.TOUCH_END,this._endCallback),e.addEventListener(l.Events.TOUCH_DRAG,this._dragCallback),e.addEventListener(l.Events.TOUCH_TAP,this._endCallback)},this._deactivateDraw=e=>{B.wk.isInteractingWithTool=!1,e.removeEventListener(l.Events.MOUSE_UP,this._endCallback),e.removeEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(l.Events.MOUSE_MOVE,this._dragCallback),e.removeEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(l.Events.TOUCH_END,this._endCallback),e.removeEventListener(l.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(l.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:o}=e,{element:i}=o;let a=(0,s.getAnnotations)(this.getToolName(),i);if(!a?.length)return n;if(a=this.filterInteractableAnnotationsForElement(i,a),!a?.length)return n;const r=this.getTargetId(o),l=o.getRenderingEngine(),d={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let i=0;i<a.length;i++){const s=a[i],{annotationUID:c,data:h}=s,{points:u,activeHandleIndex:g}=h.handles;d.annotationUID=c;const{color:p,lineWidth:v,lineDash:f,shadow:m}=this.getAnnotationStyle({annotation:s,styleSpecifier:d}),w=u.map((e=>o.worldToCanvas(e)));if(h.cachedStats[r]&&null!=h.cachedStats[r].unit?s.invalidated&&this._throttledCalculateCachedStats(s,l,e):(h.cachedStats[r]={length:null,unit:null},this._calculateCachedStats(s,l,e)),!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;let E;if(!(0,Rt.isAnnotationVisible)(c))continue;if((0,wt.isAnnotationLocked)(c)||this.editData||null===g||(E=[w[g]]),E){const e="0";(0,Ve.drawHandles)(t,c,e,w,{color:p,lineDash:f,lineWidth:v})}const b=`${c}-line`,y="1";if((0,Ve.drawLine)(t,c,y,w[0],w[1],{color:p,width:v,lineDash:f,shadow:m},b),n=!0,!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;const I=this.getLinkedTextBoxStyle(d,s);if(!I.visibility){h.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const _=this.configuration.getTextLines(h,r);if(!h.handles.textBox.hasMoved){const e=(0,bn.getTextBoxCoordsCanvas)(w);h.handles.textBox.worldPosition=o.canvasToWorld(e)}const C=o.worldToCanvas(h.handles.textBox.worldPosition),T="1",S=(0,Ve.drawLinkedTextBox)(t,c,T,_,C,w,{},I),{x,y:D,width:A,height:O}=S;h.handles.textBox.worldBoundingBox={topLeft:o.canvasToWorld([x,D]),topRight:o.canvasToWorld([x+A,D]),bottomLeft:o.canvasToWorld([x,D+O]),bottomRight:o.canvasToWorld([x+A,D+O])}}return n},this._throttledCalculateCachedStats=(0,En.A)(this._calculateCachedStats,100,{trailing:!0})}handleSelectedCallback(e,t,n){const o=e.detail,{element:i}=o,{data:a}=t;t.highlighted=!0;let s,l=!1;n.worldPosition?l=!0:s=a.handles.points.findIndex((e=>e===n));const d=(0,Qe.getViewportIdsWithToolToRender)(i,this.getToolName());this.editData={annotation:t,viewportIdsToRender:d,handleIndex:s,movingTextBox:l},this._activateModify(i),(0,et.hideElementCursor)(i);const c=(0,r.getEnabledElement)(i),{renderingEngine:h}=c;(0,tt.A)(d),e.preventDefault()}_calculateLength(e,t){const n=e[0]-t[0],o=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(n*n+o*o+i*i)}_calculateCachedStats(e,t,n){const o=e.data,{element:i}=n.viewport,a=o.handles.points[0],r=o.handles.points[1],{cachedStats:s}=o,l=Object.keys(s);for(let e=0;e<l.length;e++){const t=l[e],n=this.getTargetImageData(t);if(!n)continue;const{imageData:o,dimensions:i}=n,d=yn(o,a),c=yn(o,r),h=[d,c],{scale:u,unit:g}=(0,wn.Op)(n,h),p=this._calculateLength(a,r)/u;this._isInsideVolume(d,c,i)?this.isHandleOutsideImage=!1:this.isHandleOutsideImage=!0,s[t]={length:p,unit:g}}return e.invalidated=!1,(0,Je.XF)(e,i),s}_isInsideVolume(e,t,n){return r.utilities.indexWithinDimensions(e,n)&&r.utilities.indexWithinDimensions(t,n)}}function _n(e,t){const n=e.cachedStats[t],{length:o,unit:i}=n;if(null==o||isNaN(o))return;return[`${r.utilities.roundNumber(o)} ${i}`]}In.toolName="Length";const Cn=In,{transformWorldToIndex:Tn}=r.utilities;class Sn extends Ge.EC{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{preventHandleOutsideImage:!1,getTextLines:xn}}){super(e,t),this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:o}=t,i=n.world,a=(0,r.getEnabledElement)(o),{viewport:l,renderingEngine:d}=a;(0,et.hideElementCursor)(o),this.isDrawing=!0;const{viewPlaneNormal:c,viewUp:h,position:u}=l.getCamera(),g=this.getReferencedImageId(l,i,c,h),p={highlighted:!0,invalidated:!0,metadata:{...l.getViewReference({points:[i]}),toolName:this.getToolName(),referencedImageId:g,viewUp:h,cameraPosition:u},data:{handles:{points:[[...i],[...i]],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:"",cachedStats:{}}};(0,s.addAnnotation)(p,o);const v=(0,Qe.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:p,viewportIdsToRender:v,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),e.preventDefault(),(0,tt.A)(v),p},this.isPointNearTool=(e,t,n,o)=>{const i=(0,r.getEnabledElement)(e),{viewport:a}=i,{data:s}=t,[l,d]=s.handles.points,c=a.worldToCanvas(l),h=a.worldToCanvas(d),u={start:{x:c[0],y:c[1]},end:{x:h[0],y:h[1]}};return mt.distanceToPoint([u.start.x,u.start.y],[u.end.x,u.end.y],[n[0],n[1]])<=o},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:o}=n;t.highlighted=!0;const i=(0,Qe.getViewportIdsWithToolToRender)(o,this.getToolName());this.editData={annotation:t,viewportIdsToRender:i,movingTextBox:!1},this._activateModify(o),(0,et.hideElementCursor)(o);(0,r.getEnabledElement)(o);(0,tt.A)(i),e.preventDefault()},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:i,newAnnotation:a,hasMoved:l}=this.editData,{data:d}=o;if(a&&!l)return;d.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,et.resetElementCursor)(n);const c=(0,r.getEnabledElement)(n),{renderingEngine:h}=c;this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,s.removeAnnotation)(o.annotationUID),(0,tt.A)(i),a&&(0,Je.dZ)(o),this.editData=null,this.isDrawing=!1},this._dragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:i,handleIndex:a,movingTextBox:s}=this.editData,{data:l}=o;if(s){const{deltaPoints:e}=t,n=e.world,{textBox:o}=l.handles,{worldPosition:i}=o;i[0]+=n[0],i[1]+=n[1],i[2]+=n[2],o.hasMoved=!0}else if(void 0===a){const{deltaPoints:e}=t,n=e.world;l.handles.points.forEach((e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]})),o.invalidated=!0}else{const{currentPoints:e}=t,n=e.world;l.handles.points[a]=[...n],o.invalidated=!0}this.editData.hasMoved=!0;const d=(0,r.getEnabledElement)(n),{renderingEngine:c}=d;(0,tt.A)(i)},this.cancel=e=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,et.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:o}=this.editData,{data:i}=t;t.highlighted=!1,i.handles.activeHandleIndex=null;(0,r.getEnabledElement)(e);return(0,tt.A)(n),o&&(0,Je.dZ)(t),this.editData=null,t.annotationUID}},this._activateModify=e=>{B.wk.isInteractingWithTool=!0,e.addEventListener(l.Events.MOUSE_UP,this._endCallback),e.addEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(l.Events.TOUCH_END,this._endCallback),e.addEventListener(l.Events.TOUCH_DRAG,this._dragCallback),e.addEventListener(l.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{B.wk.isInteractingWithTool=!1,e.removeEventListener(l.Events.MOUSE_UP,this._endCallback),e.removeEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(l.Events.TOUCH_END,this._endCallback),e.removeEventListener(l.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(l.Events.TOUCH_TAP,this._endCallback)},this._activateDraw=e=>{B.wk.isInteractingWithTool=!0,e.addEventListener(l.Events.MOUSE_UP,this._endCallback),e.addEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(l.Events.MOUSE_MOVE,this._dragCallback),e.addEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(l.Events.TOUCH_END,this._endCallback),e.addEventListener(l.Events.TOUCH_DRAG,this._dragCallback),e.addEventListener(l.Events.TOUCH_TAP,this._endCallback)},this._deactivateDraw=e=>{B.wk.isInteractingWithTool=!1,e.removeEventListener(l.Events.MOUSE_UP,this._endCallback),e.removeEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(l.Events.MOUSE_MOVE,this._dragCallback),e.removeEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(l.Events.TOUCH_END,this._endCallback),e.removeEventListener(l.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(l.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:o}=e,{element:i}=o;let a=(0,s.getAnnotations)(this.getToolName(),i);if(!a?.length)return n;if(a=this.filterInteractableAnnotationsForElement(i,a),!a?.length)return n;const r=this.getTargetId(o),l=o.getRenderingEngine(),d={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let i=0;i<a.length;i++){const s=a[i],{annotationUID:c,data:h}=s,{points:u,activeHandleIndex:g}=h.handles;d.annotationUID=c;const{color:p,lineWidth:v,lineDash:f,shadow:m}=this.getAnnotationStyle({annotation:s,styleSpecifier:d}),w=u.map((e=>o.worldToCanvas(e)));let E;if(h.cachedStats[r]&&null!=h.cachedStats[r].unit?s.invalidated&&this._throttledCalculateCachedStats(s,l,e):(h.cachedStats[r]={length:null,unit:null},this._calculateCachedStats(s,l,e)),!(0,Rt.isAnnotationVisible)(c))continue;if((0,wt.isAnnotationLocked)(c)||this.editData||null===g||(E=[w[g]]),E){const e="0";(0,Ve.drawHandles)(t,c,e,w,{color:p,lineDash:f,lineWidth:v})}const b="0";if((0,Ve.drawHeight)(t,c,b,w[0],w[1],{color:p,width:v,lineDash:f}),n=!0,!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;const y=this.getLinkedTextBoxStyle(d,s);if(!y.visibility){h.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const I=this.configuration.getTextLines(h,r);if(!h.handles.textBox.hasMoved){const e=(0,bn.getTextBoxCoordsCanvas)(w);h.handles.textBox.worldPosition=o.canvasToWorld(e)}const _=o.worldToCanvas(h.handles.textBox.worldPosition),C="1",T=(0,Ve.drawLinkedTextBox)(t,c,C,I,_,w,{},y),{x:S,y:x,width:D,height:A}=T;h.handles.textBox.worldBoundingBox={topLeft:o.canvasToWorld([S,x]),topRight:o.canvasToWorld([S+D,x]),bottomLeft:o.canvasToWorld([S,x+A]),bottomRight:o.canvasToWorld([S+D,x+A])}}return n},this._throttledCalculateCachedStats=(0,En.A)(this._calculateCachedStats,100,{trailing:!0})}handleSelectedCallback(e,t,n){const o=e.detail,{element:i}=o,{data:a}=t;t.highlighted=!0;let s,l=!1;n.worldPosition?l=!0:s=a.handles.points.findIndex((e=>e===n));const d=(0,Qe.getViewportIdsWithToolToRender)(i,this.getToolName());this.editData={annotation:t,viewportIdsToRender:d,handleIndex:s,movingTextBox:l},this._activateModify(i),(0,et.hideElementCursor)(i);const c=(0,r.getEnabledElement)(i),{renderingEngine:h}=c;(0,tt.A)(d),e.preventDefault()}_calculateHeight(e,t){const n=t[0]-e[0],o=t[1]-e[1],i=t[2]-e[2];return 0==n?0!=o?Math.abs(i):0:0==o?Math.abs(i):0==i?Math.abs(o):void 0}_calculateCachedStats(e,t,n){const o=e.data,{element:i}=n.viewport,a=o.handles.points[0],r=o.handles.points[1],{cachedStats:s}=o,l=Object.keys(s);for(let e=0;e<l.length;e++){const t=l[e],n=this.getTargetImageData(t);if(!n)continue;const{imageData:o,dimensions:i}=n,d=Tn(o,a),c=Tn(o,r),h=[d,c],{scale:u,unit:g}=(0,wn.Op)(n,h),p=this._calculateHeight(a,r)/u,v=this._isInsideVolume(d,c,i);this.isHandleOutsideImage=v,s[t]={height:p,unit:g}}return e.invalidated=!1,(0,Je.XF)(e,i),s}_isInsideVolume(e,t,n){return r.utilities.indexWithinDimensions(e,n)&&r.utilities.indexWithinDimensions(t,n)}}function xn(e,t){const n=e.cachedStats[t],{height:o,unit:i}=n;if(null==o||isNaN(o))return;return[`${r.utilities.roundNumber(o)} ${i}`]}Sn.toolName="Height";const Dn=Sn;var An=n(40634),On=n(18990);const{transformWorldToIndex:Mn}=r.utilities;class Rn extends Ge.EC{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,getTextLines:kn}}){super(e,t),this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:o}=t,i=n.world,a=(0,r.getEnabledElement)(o),{viewport:l}=a;this.isDrawing=!0;const d=l.getCamera(),{viewPlaneNormal:c,viewUp:h}=d,u=this.getReferencedImageId(l,i,c),g=l.getFrameOfReferenceUID(),p={invalidated:!0,highlighted:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...c],viewUp:[...h],FrameOfReferenceUID:g,referencedImageId:u},data:{label:"",handles:{points:[[...i]]},cachedStats:{}}};(0,s.addAnnotation)(p,o);const v=(0,Qe.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:p,newAnnotation:!0,viewportIdsToRender:v},this._activateModify(o),(0,et.hideElementCursor)(o),e.preventDefault(),(0,tt.A)(v),p},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:i,newAnnotation:a}=this.editData,{viewportId:l,renderingEngine:d}=(0,r.getEnabledElement)(n);this.eventDispatchDetail={viewportId:l,renderingEngineId:d.id},this._deactivateModify(n),(0,et.resetElementCursor)(n),this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,s.removeAnnotation)(o.annotationUID),(0,tt.A)(i),a&&(0,Je.dZ)(o)},this._dragCallback=e=>{this.isDrawing=!0;const t=e.detail,{currentPoints:n,element:o}=t,i=n.world,{annotation:a,viewportIdsToRender:s}=this.editData,{data:l}=a;l.handles.points[0]=[...i],a.invalidated=!0;const d=(0,r.getEnabledElement)(o),{renderingEngine:c}=d;(0,tt.A)(s)},this.cancel=e=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateModify(e),(0,et.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:o}=this.editData,{data:i}=t;return t.highlighted=!1,i.handles.activeHandleIndex=null,(0,tt.A)(n),o&&(0,Je.dZ)(t),this.editData=null,t.annotationUID}},this._activateModify=e=>{B.wk.isInteractingWithTool=!0,e.addEventListener(l.Events.MOUSE_UP,this._endCallback),e.addEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(l.Events.TOUCH_END,this._endCallback),e.addEventListener(l.Events.TOUCH_DRAG,this._dragCallback),e.addEventListener(l.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{B.wk.isInteractingWithTool=!1,e.removeEventListener(l.Events.MOUSE_UP,this._endCallback),e.removeEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(l.Events.TOUCH_END,this._endCallback),e.removeEventListener(l.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(l.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:o}=e,{element:i}=o;let a=(0,s.getAnnotations)(this.getToolName(),i);if(!a?.length)return n;if(a=this.filterInteractableAnnotationsForElement(i,a),!a?.length)return n;const l=this.getTargetId(o),d=o.getRenderingEngine(),c={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let i=0;i<a.length;i++){const s=a[i],h=s.annotationUID,u=s.data,g=u.handles.points[0],p=o.worldToCanvas(g);c.annotationUID=h;const{color:v}=this.getAnnotationStyle({annotation:s,styleSpecifier:c});if(u.cachedStats||(u.cachedStats={}),u.cachedStats[l]&&null!=u.cachedStats[l].value){if(s.invalidated&&(this._calculateCachedStats(s,d,e),o instanceof r.VolumeViewport)){const{referencedImageId:e}=s.metadata;for(const t in u.cachedStats)if(t.startsWith("imageId")){d.getStackViewports().find((t=>{const n=r.utilities.imageIdToURI(e),o=t.hasImageURI(n),i=r.utilities.imageIdToURI(t.getCurrentImageId());return o&&i!==n}))&&delete u.cachedStats[t]}}}else u.cachedStats[l]={Modality:null,index:null,value:null},this._calculateCachedStats(s,d,e);if(!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;const f="0";(0,Ve.drawHandles)(t,h,f,[p],{color:v}),n=!0;const m=this.getLinkedTextBoxStyle(c,s);if(!m.visibility)continue;const w=this.configuration.getTextLines(u,l);if(w){const e=[p[0]+6,p[1]-6],n="0";(0,Ve.drawTextBox)(t,h,n,w,[e[0],e[1]],m)}}return n}}isPointNearTool(){return!1}toolSelectedCallback(){}getHandleNearImagePoint(e,t,n,o){const i=(0,r.getEnabledElement)(e),{viewport:a}=i,{data:s}=t,l=s.handles.points[0],d=a.worldToCanvas(l);if(!0===De.Zc.distance(n,d)<o)return l}handleSelectedCallback(e,t){const n=e.detail,{element:o}=n;t.highlighted=!0;const i=(0,Qe.getViewportIdsWithToolToRender)(o,this.getToolName());this.editData={annotation:t,viewportIdsToRender:i},this._activateModify(o),(0,et.hideElementCursor)(o);const a=(0,r.getEnabledElement)(o),{renderingEngine:s}=a;(0,tt.A)(i),e.preventDefault()}_calculateCachedStats(e,t,n){const o=e.data,{renderingEngineId:i,viewport:a}=n,{element:s}=a,l=o.handles.points[0],{cachedStats:d}=o,c=Object.keys(d);for(let t=0;t<c.length;t++){const n=c[t],o={isPreScaled:(0,On.u)(a,n),isSuvScaled:this.isSuvScaled(a,n,e.metadata.referencedImageId)},i=this.getTargetImageData(n);if(!i)continue;const{dimensions:h,imageData:u,metadata:g,voxelManager:p}=i,v=g.Modality;let f=Mn(u,l);if(f=De.eR.round(f,f),r.utilities.indexWithinDimensions(f,h)){this.isHandleOutsideImage=!1;let t,a=p.getAtIJKPoint(f);if(n.startsWith("imageId:")){const e=n.split("imageId:")[1],t=r.utilities.imageIdToURI(e),o=r.utilities.getViewportsWithImageURI(t)[0];f[2]=o.getCurrentImageIdIndex()}if("US"===v){const e=(0,wn.Xw)(i,[f]),n=e.values.every((e=>null!==e));a=n?e.values:a,t=n?e.units:"raw"}else t=(0,An.j)(v,e.metadata.referencedImageId,o);d[n]={index:f,value:a,Modality:v,modalityUnit:t}}else this.isHandleOutsideImage=!0,d[n]={index:f,Modality:v};e.invalidated=!1,(0,Je.XF)(e,s)}return d}}function kn(e,t){const n=e.cachedStats[t],{index:o,value:i,modalityUnit:a}=n;if(void 0===i)return;const s=[];if(s.push(`(${o[0]}, ${o[1]}, ${o[2]})`),i instanceof Array&&a instanceof Array)for(let e=0;e<i.length;e++)s.push(`${r.utilities.roundNumber(i[e])} ${a[e]}`);else s.push(`${r.utilities.roundNumber(i)} ${a}`);return s}Rn.toolName="Probe";const Ln=Rn;class Pn extends Ln{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,getTextLines:Nn}}){super(e,t),this.postMouseDownCallback=e=>{const t=e.detail,{currentPoints:n,element:o}=t,i=n.world,a=(0,r.getEnabledElement)(o),{viewport:s,renderingEngine:l}=a;this.isDrawing=!0;const d=s.getCamera(),{viewPlaneNormal:c,viewUp:h}=d,u=this.getReferencedImageId(s,i,c,h),g={invalidated:!0,highlighted:!0,isVisible:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...c],viewUp:[...h],FrameOfReferenceUID:s.getFrameOfReferenceUID(),referencedImageId:u},data:{label:"",handles:{points:[[...i]]},cachedStats:{}}},p=(0,Qe.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:g,newAnnotation:!0,viewportIdsToRender:p},this._activateModify(o),(0,et.hideElementCursor)(o),e.preventDefault(),(0,tt.A)(p),g},this.postTouchStartCallback=e=>this.postMouseDownCallback(e),this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:o}=e;if(!this.editData)return n;const i=this.filterInteractableAnnotationsForElement(o.element,[this.editData.annotation]);if(!i?.length)return n;const a=this.getTargetId(o),r=o.getRenderingEngine(),s={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id},l=this.editData.annotation,d=l.annotationUID,c=l.data,h=c.handles.points[0],u=o.worldToCanvas(h);s.annotationUID=d;const{color:g}=this.getAnnotationStyle({annotation:l,styleSpecifier:s});if(c.cachedStats[a]&&null!=c.cachedStats[a].value?l.invalidated&&this._calculateCachedStats(l,r,e):(c.cachedStats[a]={Modality:null,index:null,value:null},this._calculateCachedStats(l,r,e)),!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;(0,Ve.drawHandles)(t,d,"0",[u],{color:g}),n=!0;const p=this.configuration.getTextLines(c,a);if(p){const e=[u[0]+6,u[1]-6],n="0";(0,Ve.drawTextBox)(t,d,n,p,[e[0],e[1]],this.getLinkedTextBoxStyle(s,l))}return n}}}function Nn(e,t){const n=e.cachedStats[t],{index:o,value:i,modalityUnit:a}=n;if(void 0===i)return;const r=[];return r.push(`(${o[0]}, ${o[1]}, ${o[2]})`),r.push(`${i.toFixed(2)} ${a}`),r}Pn.toolName="DragProbe";const Un=Pn;var Vn=n(4010),Bn=n(40133),Hn=n(87009),Wn=n(79362);const{transformWorldToIndex:Fn}=r.utilities;class jn extends Ge.EC{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,storePointData:!1,centerPointRadius:0,getTextLines:Gn,statsCalculator:Wn.BasicStatsCalculator}}){super(e,t),this.isHandleOutsideImage=!1,this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:o}=t,i=n.world,a=(n.canvas,(0,r.getEnabledElement)(o)),{viewport:l,renderingEngine:d}=a;this.isDrawing=!0;const c=l.getCamera(),{viewPlaneNormal:h,viewUp:u}=c,g=this.getReferencedImageId(l,i,h,u),p=l.getFrameOfReferenceUID(),v={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...h],viewUp:[...u],FrameOfReferenceUID:p,referencedImageId:g,...l.getViewReference({points:[i]})},data:{label:"",handles:{textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},points:[[...i],[...i],[...i],[...i]],activeHandleIndex:null},cachedStats:{},initialRotation:l.getRotation()}};(0,s.addAnnotation)(v,o);const f=(0,Qe.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:v,viewportIdsToRender:f,centerWorld:i,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),(0,et.hideElementCursor)(o),e.preventDefault(),(0,tt.A)(f),v},this.isPointNearTool=(e,t,n,o)=>{const i=(0,r.getEnabledElement)(e),{viewport:a}=i,{data:s}=t,{points:l}=s.handles,d=l.map((e=>a.worldToCanvas(e))),c=(0,Hn.getCanvasEllipseCorners)(d),[h,u]=c,g={left:Math.min(h[0],u[0])+o/2,top:Math.min(h[1],u[1])+o/2,width:Math.abs(h[0]-u[0])-o,height:Math.abs(h[1]-u[1])-o},p={left:Math.min(h[0],u[0])-o/2,top:Math.min(h[1],u[1])-o/2,width:Math.abs(h[0]-u[0])+o,height:Math.abs(h[1]-u[1])+o},v=this._pointInEllipseCanvas(g,n);return!(!this._pointInEllipseCanvas(p,n)||v)},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:o}=n;t.highlighted=!0;const i=(0,Qe.getViewportIdsWithToolToRender)(o,this.getToolName());this.editData={annotation:t,viewportIdsToRender:i,movingTextBox:!1},(0,et.hideElementCursor)(o),this._activateModify(o);const a=(0,r.getEnabledElement)(o),{renderingEngine:s}=a;(0,tt.A)(i),e.preventDefault()},this.handleSelectedCallback=(e,t,n)=>{const o=e.detail,{element:i}=o,{data:a}=t;t.highlighted=!0;let s,l,d,c,h,u,g=!1;if(n.worldPosition)g=!0;else{const{points:e}=a.handles,{viewport:t}=(0,r.getEnabledElement)(i),{worldToCanvas:o,canvasToWorld:g}=t;s=e.findIndex((e=>e===n));const p=e.map(o);u=p[s],c=Math.abs(p[2][0]-p[3][0]),h=Math.abs(p[0][1]-p[1][1]),l=[(p[2][0]+p[3][0])/2,(p[0][1]+p[1][1])/2],d=g(l)}const p=(0,Qe.getViewportIdsWithToolToRender)(i,this.getToolName());this.editData={annotation:t,viewportIdsToRender:p,handleIndex:s,canvasWidth:c,canvasHeight:h,centerWorld:d,originalHandleCanvas:u,movingTextBox:g},this._activateModify(i),(0,et.hideElementCursor)(i);const v=(0,r.getEnabledElement)(i),{renderingEngine:f}=v;(0,tt.A)(p),e.preventDefault()},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:i,newAnnotation:a,hasMoved:l}=this.editData,{data:d}=o;if(a&&!l)return;o.highlighted=!1,d.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,et.resetElementCursor)(n);const{renderingEngine:c}=(0,r.getEnabledElement)(n);this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,s.removeAnnotation)(o.annotationUID),(0,tt.A)(i),a&&(0,Je.dZ)(o)},this._dragDrawCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{currentPoints:o}=t,i=o.canvas,a=(0,r.getEnabledElement)(n),{renderingEngine:s,viewport:l}=a,{canvasToWorld:d}=l,{annotation:c,viewportIdsToRender:h,centerWorld:u}=this.editData,g=l.worldToCanvas(u),{data:p}=c,v=Math.abs(i[0]-g[0]),f=Math.abs(i[1]-g[1]),m=[g[0],g[1]-f],w=[g[0],g[1]+f],E=[g[0]-v,g[1]],b=[g[0]+v,g[1]];p.handles.points=[d(m),d(w),d(E),d(b)],c.invalidated=!0,this.editData.hasMoved=!0,(0,tt.A)(h)},this._dragModifyCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:i,handleIndex:a,movingTextBox:s}=this.editData,{data:l}=o;if(s){const{deltaPoints:e}=t,n=e.world,{textBox:o}=l.handles,{worldPosition:i}=o;i[0]+=n[0],i[1]+=n[1],i[2]+=n[2],o.hasMoved=!0}else if(void 0===a){const{deltaPoints:e}=t,n=e.world;l.handles.points.forEach((e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]})),o.invalidated=!0}else this._dragHandle(e),o.invalidated=!0;const d=(0,r.getEnabledElement)(n),{renderingEngine:c}=d;(0,tt.A)(i)},this._dragHandle=e=>{const t=e.detail,{element:n}=t,{viewport:o}=(0,r.getEnabledElement)(n),{canvasToWorld:i,worldToCanvas:a}=o,{annotation:s,canvasWidth:l,canvasHeight:d,handleIndex:c,centerWorld:h,originalHandleCanvas:u}=this.editData,g=o.worldToCanvas(h),{data:p}=s,{points:v}=p.handles,{currentPoints:f}=t,m=f.canvas;if(0===c||1===c){const e=Math.abs(m[1]-g[1]),t=[g[0],g[1]-e],n=[g[0],g[1]+e];v[0]=i(t),v[1]=i(n);const o=l/2+(m[0]-u[0]),a=[g[0]-o,g[1]],r=[g[0]+o,g[1]];v[2]=i(a),v[3]=i(r)}else{const e=Math.abs(m[0]-g[0]),t=[g[0]-e,g[1]],n=[g[0]+e,g[1]];v[2]=i(t),v[3]=i(n);const o=d/2+(m[1]-u[1]),a=[g[0],g[1]-o],r=[g[0],g[1]+o];v[0]=i(a),v[1]=i(r)}},this.cancel=e=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,et.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:o}=this.editData,{data:i}=t;return t.highlighted=!1,i.handles.activeHandleIndex=null,(0,tt.A)(n),o&&(0,Je.dZ)(t),this.editData=null,t.annotationUID}},this._activateModify=e=>{B.wk.isInteractingWithTool=!0,e.addEventListener(l.Events.MOUSE_UP,this._endCallback),e.addEventListener(l.Events.MOUSE_DRAG,this._dragModifyCallback),e.addEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(l.Events.TOUCH_END,this._endCallback),e.addEventListener(l.Events.TOUCH_DRAG,this._dragModifyCallback),e.addEventListener(l.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{B.wk.isInteractingWithTool=!1,e.removeEventListener(l.Events.MOUSE_UP,this._endCallback),e.removeEventListener(l.Events.MOUSE_DRAG,this._dragModifyCallback),e.removeEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(l.Events.TOUCH_END,this._endCallback),e.removeEventListener(l.Events.TOUCH_DRAG,this._dragModifyCallback),e.removeEventListener(l.Events.TOUCH_TAP,this._endCallback)},this._activateDraw=e=>{B.wk.isInteractingWithTool=!0,e.addEventListener(l.Events.MOUSE_UP,this._endCallback),e.addEventListener(l.Events.MOUSE_DRAG,this._dragDrawCallback),e.addEventListener(l.Events.MOUSE_MOVE,this._dragDrawCallback),e.addEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(l.Events.TOUCH_END,this._endCallback),e.addEventListener(l.Events.TOUCH_DRAG,this._dragDrawCallback),e.addEventListener(l.Events.TOUCH_TAP,this._endCallback)},this._deactivateDraw=e=>{B.wk.isInteractingWithTool=!1,e.removeEventListener(l.Events.MOUSE_UP,this._endCallback),e.removeEventListener(l.Events.MOUSE_DRAG,this._dragDrawCallback),e.removeEventListener(l.Events.MOUSE_MOVE,this._dragDrawCallback),e.removeEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(l.Events.TOUCH_END,this._endCallback),e.removeEventListener(l.Events.TOUCH_DRAG,this._dragDrawCallback),e.removeEventListener(l.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:o}=e,{element:i}=o;let a=(0,s.getAnnotations)(this.getToolName(),i);if(!a?.length)return n;if(a=this.filterInteractableAnnotationsForElement(i,a),!a?.length)return n;const l=this.getTargetId(o),d=o.getRenderingEngine(),c={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let i=0;i<a.length;i++){const s=a[i],{annotationUID:h,data:u}=s,{handles:g}=u,{points:p,activeHandleIndex:v}=g;c.annotationUID=h;const{color:f,lineWidth:m,lineDash:w}=this.getAnnotationStyle({annotation:s,styleSpecifier:c}),E=p.map((e=>o.worldToCanvas(e))),b=(0,Hn.getCanvasEllipseCorners)(E),{centerPointRadius:y}=this.configuration;if(u.cachedStats[l]&&null!=u.cachedStats[l].areaUnit){if(s.invalidated&&(this._throttledCalculateCachedStats(s,o,d,e),o instanceof r.VolumeViewport)){const{referencedImageId:e}=s.metadata;for(const t in u.cachedStats)if(t.startsWith("imageId")){d.getStackViewports().find((t=>{const n=r.utilities.imageIdToURI(e),o=t.hasImageURI(n),i=r.utilities.imageIdToURI(t.getCurrentImageId());return o&&i!==n}))&&delete u.cachedStats[t]}}}else u.cachedStats[l]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null},this._calculateCachedStats(s,o,d);if(!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;let I;if(!(0,Rt.isAnnotationVisible)(h))continue;if((0,wt.isAnnotationLocked)(h)||this.editData||null===v||(I=[E[v]]),I){const e="0";(0,Ve.drawHandles)(t,h,e,I,{color:f})}const _=`${h}-ellipse`,C="0";if((0,Ve.drawEllipseByCoordinates)(t,h,C,E,{color:f,lineDash:w,lineWidth:m},_),y>0){if(Math.min(Math.abs(b[0][0]-b[1][0])/2,Math.abs(b[0][1]-b[1][1])/2)>3*y){const e=this._getCanvasEllipseCenter(E);(0,Ve.drawCircle)(t,h,`${C}-center`,e,y,{color:f,lineDash:w,lineWidth:m})}}n=!0;const T=this.getLinkedTextBoxStyle(c,s);if(!T.visibility){u.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const S=this.configuration.getTextLines(u,l);if(!S||0===S.length)continue;let x;u.handles.textBox.hasMoved||(x=(0,bn.getTextBoxCoordsCanvas)(b),u.handles.textBox.worldPosition=o.canvasToWorld(x));const D=o.worldToCanvas(u.handles.textBox.worldPosition),A="1",O=(0,Ve.drawLinkedTextBox)(t,h,A,S,D,E,{},T),{x:M,y:R,width:k,height:L}=O;u.handles.textBox.worldBoundingBox={topLeft:o.canvasToWorld([M,R]),topRight:o.canvasToWorld([M+k,R]),bottomLeft:o.canvasToWorld([M,R+L]),bottomRight:o.canvasToWorld([M+k,R+L])}}return n},this._calculateCachedStats=(e,t,n)=>{const o=e.data,{element:i}=t,{points:a}=o.handles,r=a.map((e=>t.worldToCanvas(e))),{viewPlaneNormal:s,viewUp:l}=t.getCamera(),[d,c]=(0,Hn.getCanvasEllipseCorners)(r),h=t.canvasToWorld(d),u=t.canvasToWorld(c),{cachedStats:g}=o,p=Object.keys(g),v=h,f=u;for(let n=0;n<p.length;n++){const o=p[n],i=this.getTargetImageData(o);if(!i)continue;const{dimensions:a,imageData:r,metadata:d,voxelManager:c}=i,m=Fn(r,v);m[0]=Math.floor(m[0]),m[1]=Math.floor(m[1]),m[2]=Math.floor(m[2]);const w=Fn(r,f);w[0]=Math.floor(w[0]),w[1]=Math.floor(w[1]),w[2]=Math.floor(w[2]),this.isHandleOutsideImage=!this._isInsideVolume(m,w,a);const E=[[Math.min(m[0],w[0]),Math.max(m[0],w[0])],[Math.min(m[1],w[1]),Math.max(m[1],w[1])],[Math.min(m[2],w[2]),Math.max(m[2],w[2])]],b={center:[(h[0]+u[0])/2,(h[1]+u[1])/2,(h[2]+u[2])/2],xRadius:Math.abs(h[0]-u[0])/2,yRadius:Math.abs(h[1]-u[1])/2,zRadius:Math.abs(h[2]-u[2])/2},{worldWidth:y,worldHeight:I}=(0,Bn.A)(s,l,v,f),_=0===y&&0===I,C=[m,w],{scale:T,areaUnit:S}=(0,wn.Op)(i,C),x=Math.abs(Math.PI*(y/2)*(I/2))/T/T,D={isPreScaled:(0,On.u)(t,o),isSuvScaled:this.isSuvScaled(t,o,e.metadata.referencedImageId)},A=(0,An.j)(d.Modality,e.metadata.referencedImageId,D),O=c.forEach(this.configuration.statsCalculator.statsCallback,{boundsIJK:E,imageData:r,isInObject:e=>(0,Hn.pointInEllipse)(b,e,{fast:!0}),returnPoints:this.configuration.storePointData}),M=this.configuration.statsCalculator.getStatistics();g[o]={Modality:d.Modality,area:x,mean:M.mean?.value,max:M.max?.value,stdDev:M.stdDev?.value,statsArray:M.array,pointsInShape:O,isEmptyArea:_,areaUnit:S,modalityUnit:A}}return e.invalidated=!1,(0,Je.XF)(e,i),g},this._isInsideVolume=(e,t,n)=>r.utilities.indexWithinDimensions(e,n)&&r.utilities.indexWithinDimensions(t,n),this._throttledCalculateCachedStats=(0,En.A)(this._calculateCachedStats,100,{trailing:!0})}_pointInEllipseCanvas(e,t){const n=e.width/2,o=e.height/2;if(n<=0||o<=0)return!1;const i=[e.left+n,e.top+o],a=[t[0]-i[0],t[1]-i[1]];return a[0]*a[0]/(n*n)+a[1]*a[1]/(o*o)<=1}_getCanvasEllipseCenter(e){const[t,n,o,i]=e,a=[o[0],n[1]],r=[i[0],t[1]];return[(a[0]+r[0])/2,(a[1]+r[1])/2]}}function Gn(e,t){const n=e.cachedStats[t],{area:o,mean:i,stdDev:a,max:s,isEmptyArea:l,areaUnit:d,modalityUnit:c}=n,h=[];if(o){const e=l?"Area: Oblique not supported":`Area: ${r.utilities.roundNumber(o)} ${d}`;h.push(e)}return i&&h.push(`Mean: ${r.utilities.roundNumber(i)} ${c}`),s&&h.push(`Max: ${r.utilities.roundNumber(s)} ${c}`),a&&h.push(`Std Dev: ${r.utilities.roundNumber(a)} ${c}`),h}jn.toolName="EllipticalROI";const $n=jn,{transformWorldToIndex:zn}=r.utilities;class qn extends Ge.EC{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,storePointData:!1,centerPointRadius:0,getTextLines:Zn,statsCalculator:Wn.BasicStatsCalculator}}){super(e,t),this.isHandleOutsideImage=!1,this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:o}=t,i=n.world,a=(0,r.getEnabledElement)(o),{viewport:l,renderingEngine:d}=a;this.isDrawing=!0;const c=l.getCamera(),{viewPlaneNormal:h,viewUp:u}=c,g=this.getReferencedImageId(l,i,h,u),p=l.getFrameOfReferenceUID(),v={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...h],viewUp:[...u],FrameOfReferenceUID:p,referencedImageId:g,...l.getViewReference({points:[i]})},data:{label:"",handles:{textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},points:[[...i],[...i]],activeHandleIndex:null},cachedStats:{}}};(0,s.addAnnotation)(v,o);const f=(0,Qe.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:v,viewportIdsToRender:f,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),(0,et.hideElementCursor)(o),e.preventDefault(),(0,tt.A)(f),v},this.isPointNearTool=(e,t,n,o)=>{const i=(0,r.getEnabledElement)(e),{viewport:a}=i,{data:s}=t,{points:l}=s.handles,d=l.map((e=>a.worldToCanvas(e))),c=(0,kt.r)(d),h=(0,kt.r)([d[0],n]);return Math.abs(h-c)<o/2},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:o}=n;t.highlighted=!0;const i=(0,Qe.getViewportIdsWithToolToRender)(o,this.getToolName());this.editData={annotation:t,viewportIdsToRender:i,movingTextBox:!1},(0,et.hideElementCursor)(o),this._activateModify(o);const a=(0,r.getEnabledElement)(o),{renderingEngine:s}=a;(0,tt.A)(i),e.preventDefault()},this.handleSelectedCallback=(e,t,n)=>{const o=e.detail,{element:i}=o,{data:a}=t;t.highlighted=!0;let s,l=!1;if(n.worldPosition)l=!0;else{const{points:e}=a.handles;s=e.findIndex((e=>e===n))}const d=(0,Qe.getViewportIdsWithToolToRender)(i,this.getToolName());this.editData={annotation:t,viewportIdsToRender:d,handleIndex:s,movingTextBox:l},this._activateModify(i),(0,et.hideElementCursor)(i);const c=(0,r.getEnabledElement)(i),{renderingEngine:h}=c;(0,tt.A)(d),e.preventDefault()},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:i,newAnnotation:a,hasMoved:l}=this.editData,{data:d}=o;if(a&&!l)return;o.highlighted=!1,d.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,et.resetElementCursor)(n);const{renderingEngine:c}=(0,r.getEnabledElement)(n);this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,s.removeAnnotation)(o.annotationUID),(0,tt.A)(i),a&&(0,Je.dZ)(o)},this._dragDrawCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{currentPoints:o}=t,i=o.canvas,a=(0,r.getEnabledElement)(n),{renderingEngine:s,viewport:l}=a,{canvasToWorld:d}=l,{annotation:c,viewportIdsToRender:h}=this.editData,{data:u}=c;u.handles.points=[u.handles.points[0],d(i)],c.invalidated=!0,this.editData.hasMoved=!0,(0,tt.A)(h)},this._dragModifyCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:i,handleIndex:a,movingTextBox:s}=this.editData,{data:l}=o;if(s){const{deltaPoints:e}=t,n=e.world,{textBox:o}=l.handles,{worldPosition:i}=o;i[0]+=n[0],i[1]+=n[1],i[2]+=n[2],o.hasMoved=!0}else if(void 0===a){const{deltaPoints:e}=t,n=e.world;l.handles.points.forEach((e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]})),o.invalidated=!0}else this._dragHandle(e),o.invalidated=!0;const d=(0,r.getEnabledElement)(n),{renderingEngine:c}=d;(0,tt.A)(i)},this._dragHandle=e=>{const t=e.detail,{element:n}=t,o=(0,r.getEnabledElement)(n),{canvasToWorld:i,worldToCanvas:a}=o.viewport,{annotation:s,handleIndex:l}=this.editData,{data:d}=s,{points:c}=d.handles,h=c.map((e=>a(e))),{currentPoints:u}=t,g=u.canvas;if(0===l){const e=g[0]-h[0][0],t=g[1]-h[0][1],n=g,o=[h[1][0]+e,h[1][1]+t];c[0]=i(n),c[1]=i(o)}else c[1]=i(g)},this.cancel=e=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,et.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:o}=this.editData,{data:i}=t;return t.highlighted=!1,i.handles.activeHandleIndex=null,(0,tt.A)(n),o&&(0,Je.dZ)(t),this.editData=null,t.annotationUID}},this._activateModify=e=>{B.wk.isInteractingWithTool=!0,e.addEventListener(l.Events.MOUSE_UP,this._endCallback),e.addEventListener(l.Events.MOUSE_DRAG,this._dragModifyCallback),e.addEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(l.Events.TOUCH_END,this._endCallback),e.addEventListener(l.Events.TOUCH_DRAG,this._dragModifyCallback),e.addEventListener(l.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{B.wk.isInteractingWithTool=!1,e.removeEventListener(l.Events.MOUSE_UP,this._endCallback),e.removeEventListener(l.Events.MOUSE_DRAG,this._dragModifyCallback),e.removeEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(l.Events.TOUCH_END,this._endCallback),e.removeEventListener(l.Events.TOUCH_DRAG,this._dragModifyCallback),e.removeEventListener(l.Events.TOUCH_TAP,this._endCallback)},this._activateDraw=e=>{B.wk.isInteractingWithTool=!0,e.addEventListener(l.Events.MOUSE_UP,this._endCallback),e.addEventListener(l.Events.MOUSE_DRAG,this._dragDrawCallback),e.addEventListener(l.Events.MOUSE_MOVE,this._dragDrawCallback),e.addEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(l.Events.TOUCH_END,this._endCallback),e.addEventListener(l.Events.TOUCH_DRAG,this._dragDrawCallback),e.addEventListener(l.Events.TOUCH_TAP,this._endCallback)},this._deactivateDraw=e=>{B.wk.isInteractingWithTool=!1,e.removeEventListener(l.Events.MOUSE_UP,this._endCallback),e.removeEventListener(l.Events.MOUSE_DRAG,this._dragDrawCallback),e.removeEventListener(l.Events.MOUSE_MOVE,this._dragDrawCallback),e.removeEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(l.Events.TOUCH_END,this._endCallback),e.removeEventListener(l.Events.TOUCH_DRAG,this._dragDrawCallback),e.removeEventListener(l.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:o}=e,{element:i}=o;let a=(0,s.getAnnotations)(this.getToolName(),i);if(!a?.length)return n;if(a=this.filterInteractableAnnotationsForElement(i,a),!a?.length)return n;const l=this.getTargetId(o),d=o.getRenderingEngine(),c={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let i=0;i<a.length;i++){const s=a[i],{annotationUID:h,data:u}=s,{handles:g}=u,{points:p,activeHandleIndex:v}=g;c.annotationUID=h;const{color:f,lineWidth:m,lineDash:w}=this.getAnnotationStyle({annotation:s,styleSpecifier:c}),E=p.map((e=>o.worldToCanvas(e))),b=E[0],y=(0,kt.r)(E),I=(0,kt.H)(E),{centerPointRadius:_}=this.configuration;if(u.cachedStats[l]&&null!=u.cachedStats[l].areaUnit){if(s.invalidated&&(this._throttledCalculateCachedStats(s,o,d,e),o instanceof r.VolumeViewport)){const{referencedImageId:e}=s.metadata;for(const t in u.cachedStats)if(t.startsWith("imageId")){d.getStackViewports().find((t=>{const n=r.utilities.imageIdToURI(e),o=t.hasImageURI(n),i=r.utilities.imageIdToURI(t.getCurrentImageId());return o&&i!==n}))&&delete u.cachedStats[t]}}}else u.cachedStats[l]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null,radius:null,radiusUnit:null,perimeter:null},this._calculateCachedStats(s,o,d,e);if(!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;let C;if(!(0,Rt.isAnnotationVisible)(h))continue;if((0,wt.isAnnotationLocked)(h)||this.editData||null===v||(C=[E[v]]),C){const e="0";(0,Ve.drawHandles)(t,h,e,C,{color:f})}const T=`${h}-circle`,S="0";(0,Ve.drawCircle)(t,h,S,b,y,{color:f,lineDash:w,lineWidth:m},T),_>0&&y>3*_&&(0,Ve.drawCircle)(t,h,`${S}-center`,b,_,{color:f,lineDash:w,lineWidth:m}),n=!0;const x=this.getLinkedTextBoxStyle(c,s);if(!x.visibility){u.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const D=this.configuration.getTextLines(u,l);if(!D||0===D.length)continue;let A;u.handles.textBox.hasMoved||(A=(0,bn.getTextBoxCoordsCanvas)(I),u.handles.textBox.worldPosition=o.canvasToWorld(A));const O=o.worldToCanvas(u.handles.textBox.worldPosition),M="1",R=(0,Ve.drawLinkedTextBox)(t,h,M,D,O,E,{},x),{x:k,y:L,width:P,height:N}=R;u.handles.textBox.worldBoundingBox={topLeft:o.canvasToWorld([k,L]),topRight:o.canvasToWorld([k+P,L]),bottomLeft:o.canvasToWorld([k,L+N]),bottomRight:o.canvasToWorld([k+P,L+N])}}return n},this._calculateCachedStats=(e,t,n,o)=>{const i=e.data,{element:a}=t,{points:r}=i.handles,s=r.map((e=>t.worldToCanvas(e))),{viewPlaneNormal:l,viewUp:d}=t.getCamera(),[c,h]=(0,kt.H)(s),u=t.canvasToWorld(c),g=t.canvasToWorld(h),{cachedStats:p}=i,v=Object.keys(p),f=u,m=g;for(let n=0;n<v.length;n++){const o=v[n],i=this.getTargetImageData(o);if(!i)continue;const{dimensions:a,imageData:r,metadata:s,voxelManager:c}=i,h=zn(r,f);h[0]=Math.floor(h[0]),h[1]=Math.floor(h[1]),h[2]=Math.floor(h[2]);const w=zn(r,m);if(w[0]=Math.floor(w[0]),w[1]=Math.floor(w[1]),w[2]=Math.floor(w[2]),this._isInsideVolume(h,w,a)){const n=[[Math.min(h[0],w[0]),Math.max(h[0],w[0])],[Math.min(h[1],w[1]),Math.max(h[1],w[1])],[Math.min(h[2],w[2]),Math.max(h[2],w[2])]],a={center:[(u[0]+g[0])/2,(u[1]+g[1])/2,(u[2]+g[2])/2],xRadius:Math.abs(u[0]-g[0])/2,yRadius:Math.abs(u[1]-g[1])/2,zRadius:Math.abs(u[2]-g[2])/2},{worldWidth:v,worldHeight:E}=(0,Bn.A)(l,d,f,m),b=0===v&&0===E,y=[h,w],{scale:I,unit:_,areaUnit:C}=(0,wn.Op)(i,y),T=(0,wn.CQ)(i),S=Math.abs(Math.PI*(v/I/2)*(E/T/I/2)),x={isPreScaled:(0,On.u)(t,o),isSuvScaled:this.isSuvScaled(t,o,e.metadata.referencedImageId)},D=(0,An.j)(s.Modality,e.metadata.referencedImageId,x),A=c.forEach(this.configuration.statsCalculator.statsCallback,{isInObject:e=>(0,Hn.pointInEllipse)(a,e,{fast:!0}),boundsIJK:n,imageData:r,returnPoints:this.configuration.storePointData}),O=this.configuration.statsCalculator.getStatistics();p[o]={Modality:s.Modality,area:S,mean:O.mean?.value,max:O.max?.value,stdDev:O.stdDev?.value,statsArray:O.array,pointsInShape:A,isEmptyArea:b,areaUnit:C,radius:v/2/I,radiusUnit:_,perimeter:2*Math.PI*(v/2)/I,modalityUnit:D}}else this.isHandleOutsideImage=!0,p[o]={Modality:s.Modality}}return e.invalidated=!1,(0,Je.XF)(e,a),p},this._isInsideVolume=(e,t,n)=>r.utilities.indexWithinDimensions(e,n)&&r.utilities.indexWithinDimensions(t,n),this._throttledCalculateCachedStats=(0,En.A)(this._calculateCachedStats,100,{trailing:!0})}}function Zn(e,t){const n=e.cachedStats[t],{radius:o,radiusUnit:i,area:a,mean:s,stdDev:l,max:d,isEmptyArea:c,areaUnit:h,modalityUnit:u}=n,g=[];if(o){const e=c?"Radius: Oblique not supported":`Radius: ${r.utilities.roundNumber(o)} ${i}`;g.push(e)}if(a){const e=c?"Area: Oblique not supported":`Area: ${r.utilities.roundNumber(a)} ${h}`;g.push(e)}return s&&g.push(`Mean: ${r.utilities.roundNumber(s)} ${u}`),d&&g.push(`Max: ${r.utilities.roundNumber(d)} ${u}`),l&&g.push(`Std Dev: ${r.utilities.roundNumber(l)} ${u}`),g}qn.toolName="CircleROI";const Kn=qn;class Yn extends Ge.EC{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,degrees:[45,135,225,315],diameters:[10,30,60]}}){super(e,t),this.isHandleOutsideImage=!1,this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:o}=t,i=n.world,a=(0,r.getEnabledElement)(o),{viewport:l,renderingEngine:d}=a;this.isDrawing=!0;const c=l.getCamera(),{viewPlaneNormal:h,viewUp:u}=c,g=this.getReferencedImageId(l,i,h,u),p=l.getFrameOfReferenceUID(),v={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...h],viewUp:[...u],FrameOfReferenceUID:p,referencedImageId:g,...l.getViewReference({points:[i]})},data:{label:"",handles:{points:[[...i]]}}};(0,s.addAnnotation)(v,o);const f=(0,Qe.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:v,viewportIdsToRender:f,newAnnotation:!0},this._activateDraw(o),(0,et.hideElementCursor)(o),e.preventDefault(),(0,tt.A)(f),v},this.isPointNearTool=(e,t,n,o)=>{const i=(0,r.getEnabledElement)(e),{viewport:a}=i,{data:s}=t,{points:l}=s.handles,d=a.worldToCanvas(l[0]),c=(0,kt.r)([d,n]);return Math.abs(c)<o},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:o}=n;t.highlighted=!0;const i=(0,Qe.getViewportIdsWithToolToRender)(o,this.getToolName());this.editData={annotation:t,viewportIdsToRender:i},(0,et.hideElementCursor)(o),this._activateModify(o);const a=(0,r.getEnabledElement)(o),{renderingEngine:s}=a;(0,tt.A)(i),e.preventDefault()},this.handleSelectedCallback=(e,t)=>{const n=e.detail,{element:o}=n;t.highlighted=!0;const i=(0,Qe.getViewportIdsWithToolToRender)(o,this.getToolName());this.editData={annotation:t,viewportIdsToRender:i},this._activateModify(o),(0,et.hideElementCursor)(o);const a=(0,r.getEnabledElement)(o),{renderingEngine:s}=a;(0,tt.A)(i),e.preventDefault()},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:i,newAnnotation:a,hasMoved:l}=this.editData,{data:d}=o;if(a&&!l)return;o.highlighted=!1,d.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,et.resetElementCursor)(n);const{renderingEngine:c}=(0,r.getEnabledElement)(n);this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,s.removeAnnotation)(o.annotationUID),(0,tt.A)(i),a&&(0,Je.dZ)(o)},this._dragDrawCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{currentPoints:o}=t,i=o.canvas,a=(0,r.getEnabledElement)(n),{renderingEngine:s,viewport:l}=a,{canvasToWorld:d}=l,{annotation:c,viewportIdsToRender:h}=this.editData,{data:u}=c;u.handles.points=[d(i),d(i)],c.invalidated=!0,this.editData.hasMoved=!0,(0,tt.A)(h)},this._dragModifyCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:i}=this.editData,{data:a}=o,{deltaPoints:s}=t,l=s.world;a.handles.points.forEach((e=>{e[0]+=l[0],e[1]+=l[1],e[2]+=l[2]})),o.invalidated=!0;const d=(0,r.getEnabledElement)(n),{renderingEngine:c}=d;(0,tt.A)(i)},this._dragHandle=e=>{const t=e.detail,{element:n}=t,o=(0,r.getEnabledElement)(n),{canvasToWorld:i,worldToCanvas:a}=o.viewport,{annotation:s}=this.editData,{data:l}=s,{points:d}=l.handles,c=d.map((e=>a(e))),{currentPoints:h}=t,u=h.canvas,g=u[0]-c[0][0],p=u[1]-c[0][1],v=u,f=[c[1][0]+g,c[1][1]+p];d[0]=i(v),d[1]=i(f)},this.cancel=e=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,et.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:o}=this.editData,{data:i}=t;t.highlighted=!1,i.handles.activeHandleIndex=null;const{renderingEngine:a}=(0,r.getEnabledElement)(e);return(0,tt.A)(n),o&&(0,Je.dZ)(t),this.editData=null,t.annotationUID}},this._activateModify=e=>{B.wk.isInteractingWithTool=!0,e.addEventListener(l.Events.MOUSE_UP,this._endCallback),e.addEventListener(l.Events.MOUSE_DRAG,this._dragModifyCallback),e.addEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(l.Events.TOUCH_END,this._endCallback),e.addEventListener(l.Events.TOUCH_DRAG,this._dragModifyCallback),e.addEventListener(l.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{B.wk.isInteractingWithTool=!1,e.removeEventListener(l.Events.MOUSE_UP,this._endCallback),e.removeEventListener(l.Events.MOUSE_DRAG,this._dragModifyCallback),e.removeEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(l.Events.TOUCH_END,this._endCallback),e.removeEventListener(l.Events.TOUCH_DRAG,this._dragModifyCallback),e.removeEventListener(l.Events.TOUCH_TAP,this._endCallback)},this._activateDraw=e=>{B.wk.isInteractingWithTool=!0,e.addEventListener(l.Events.MOUSE_UP,this._endCallback),e.addEventListener(l.Events.MOUSE_DRAG,this._dragDrawCallback),e.addEventListener(l.Events.MOUSE_MOVE,this._dragDrawCallback),e.addEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(l.Events.TOUCH_END,this._endCallback),e.addEventListener(l.Events.TOUCH_DRAG,this._dragDrawCallback),e.addEventListener(l.Events.TOUCH_TAP,this._endCallback)},this._deactivateDraw=e=>{B.wk.isInteractingWithTool=!1,e.removeEventListener(l.Events.MOUSE_UP,this._endCallback),e.removeEventListener(l.Events.MOUSE_DRAG,this._dragDrawCallback),e.removeEventListener(l.Events.MOUSE_MOVE,this._dragDrawCallback),e.removeEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(l.Events.TOUCH_END,this._endCallback),e.removeEventListener(l.Events.TOUCH_DRAG,this._dragDrawCallback),e.removeEventListener(l.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:o}=e,{element:i}=o;let a=(0,s.getAnnotations)(this.getToolName(),i);if(!a?.length)return n;if(a=this.filterInteractableAnnotationsForElement(i,a),!a?.length)return n;const r={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let e=0;e<a.length;e++){const i=a[e],{annotationUID:s,data:l}=i,{handles:d}=l,{points:c}=d;r.annotationUID=s;const{color:h,lineWidth:u,lineDash:g}=this.getAnnotationStyle({annotation:i,styleSpecifier:r}),p=c.map((e=>o.worldToCanvas(e)))[0];if(!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;if(!(0,Rt.isAnnotationVisible)(s))continue;let v=`${s}-crosshair-vertical`,f=[p[0],p[1]+5],m=[p[0],p[1]-5];(0,Ve.drawLine)(t,s,v,f,m,{color:h,lineDash:g,lineWidth:u}),v=`${s}-crosshair-horizontal`,f=[p[0]+5,p[1]],m=[p[0]-5,p[1]],(0,Ve.drawLine)(t,s,v,f,m,{color:h,lineDash:g,lineWidth:u});const w=this.configuration.diameters.map((e=>this.worldMeasureToCanvas(e,o)));for(let e=0;e<w.length;e++){const n=`${s}-circle-${e}`,o=`${s}-circle-${e}`;(0,Ve.drawCircle)(t,s,o,p,w[e]/2,{color:h,lineDash:g,lineWidth:u},n)}const E=e=>e*Math.PI/180,b=this.configuration.degrees.map((e=>E(e)));for(let e=0;e<b.length;e++){const n=`${s}-line-${e}`,o=[Math.cos(b[e])*w[0]/2+p[0],Math.sin(b[e])*w[0]/2+p[1]],i=[Math.cos(b[e])*w[2]/2+p[0],Math.sin(b[e])*w[2]/2+p[1]];(0,Ve.drawLine)(t,s,n,o,i,{color:h,lineDash:g,lineWidth:u})}n=!0}return n}}worldMeasureToCanvas(e,t){const n=t.canvasToWorld([t.canvas.width/2,t.canvas.height/2]),{viewUp:o}=t.getCamera(),i=De.eR.scaleAndAdd(De.eR.create(),n,o,e),a=t.worldToCanvas(n),r=t.worldToCanvas(i);return Math.sqrt(Math.pow(r[0]-a[0],2)+Math.pow(r[1]-a[1],2))}}Yn.toolName="ETDRSGrid";const Xn=Yn;var Jn=n(76910),Qn=n(93126),eo=n(71543),to=n(63802),no=n(31147),oo=n(34115),io=n(36320);const ao={resolution:20,controlPointAdditionDistance:6,controlPointDeletionDistance:6,showControlPointsConnectors:!1,controlPointAdditionEnabled:!0,controlPointDeletionEnabled:!0};var ro,so;!function(e){e.Cardinal="CARDINAL",e.Linear="LINEAR",e.CatmullRom="CATMULLROM",e.BSpline="BSPLINE"}(ro||(ro={})),function(e){e.AddControlPoint="addControlPoint",e.DeleteControlPoint="deleteControlPoint"}(so||(so={}));class lo extends io.A{static{this.SplineTypes=ro}static{this.Actions=so}constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{preventHandleOutsideImage:!1,calculateStats:!0,getTextLines:co,contourHoleAdditionModifierKey:l.KeyboardBindings.Shift,decimate:{enabled:!1,epsilon:.1},spline:{configuration:{[ro.Cardinal]:{Class:eo.A,scale:.5},[ro.CatmullRom]:{Class:no.e},[ro.Linear]:{Class:to.F},[ro.BSpline]:{Class:oo.k,controlPointAdditionEnabled:!1,controlPointDeletionEnabled:!1,showControlPointsConnectors:!0}},type:ro.CatmullRom,drawPreviewEnabled:!0,lastControlPointDeletionKeys:["Backspace","Delete"]},actions:{[so.AddControlPoint]:{method:"addControlPointCallback",bindings:[{mouseButton:l.MouseBindings.Primary,modifierKey:l.KeyboardBindings.Shift}]},[so.DeleteControlPoint]:{method:"deleteControlPointCallback",bindings:[{mouseButton:l.MouseBindings.Primary,modifierKey:l.KeyboardBindings.Ctrl}]}}}}){super(e,t),this.isHandleOutsideImage=!1,this.fireChangeOnUpdate=null,this.isPointNearTool=(e,t,n,o)=>{const{instance:i}=t.data.spline;return i.isPointNearCurve(n,o)},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:o}=n;t.highlighted=!0;const i=(0,Qe.getViewportIdsWithToolToRender)(o,this.getToolName());this.editData={annotation:t,viewportIdsToRender:i,movingTextBox:!1};const a=(0,r.getEnabledElement)(o),{renderingEngine:s}=a;this._activateModify(o),(0,Be.triggerAnnotationRenderForViewportIds)(i),e.preventDefault()},this.handleSelectedCallback=(e,t,n)=>{const o=e.detail,{element:i}=o,{data:a}=t;t.highlighted=!0;let s,l=!1;if(n.worldPosition)l=!0;else{const{points:e}=a.handles;s=e.findIndex((e=>e===n))}const d=(0,Qe.getViewportIdsWithToolToRender)(i,this.getToolName());this.editData={annotation:t,viewportIdsToRender:d,handleIndex:s,movingTextBox:l},this._activateModify(i);const c=(0,r.getEnabledElement)(i),{renderingEngine:h}=c;(0,Be.triggerAnnotationRenderForViewportIds)(d),e.preventDefault()},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:i,newAnnotation:a,contourHoleProcessingEnabled:d}=this.editData,{data:c}=o;o.autoGenerated=!1,c.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,et.resetElementCursor)(n);const h=(0,r.getEnabledElement)(n),u=this.getTargetImageData(this.getTargetId(h.viewport)),{imageData:g,dimensions:p}=u;this.isHandleOutsideImage=c.handles.points.map((e=>r.utilities.transformWorldToIndex(g,e))).some((e=>!r.utilities.indexWithinDimensions(e,p))),this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,s.removeAnnotation)(o.annotationUID);const v=a?l.ChangeTypes.Completed:l.ChangeTypes.HandlesUpdated;this.fireChangeOnUpdate?(this.fireChangeOnUpdate.annotationUID=o.annotationUID,this.fireChangeOnUpdate.changeType=v):this.fireChangeOnUpdate={annotationUID:o.annotationUID,changeType:v,contourHoleProcessingEnabled:d},(0,Be.triggerAnnotationRenderForViewportIds)(i),this.editData=null,this.isDrawing=!1},this._keyDownCallback=e=>{const t=e.detail,{element:n}=t,o=t.key??"",{lastControlPointDeletionKeys:i}=this.configuration.spline;if(!i.includes(o))return;const{annotation:a}=this.editData,{data:r}=a;if(3!==r.handles.points.length){{const e=r.handles.points.length-1;this._deleteControlPointByIndex(n,a,e)}e.preventDefault()}else this.cancel(n)},this._mouseMoveCallback=e=>{const{drawPreviewEnabled:t}=this.configuration.spline;if(!t)return;const{element:n}=e.detail,{renderingEngine:o}=(0,r.getEnabledElement)(n),i=(0,Qe.getViewportIdsWithToolToRender)(n,this.getToolName());this.editData.lastCanvasPoint=e.detail.currentPoints.canvas,(0,Be.triggerAnnotationRenderForViewportIds)(i),e.preventDefault()},this._mouseDownCallback=e=>{const t=e.type===l.Events.MOUSE_DOUBLE_CLICK,{annotation:n,viewportIdsToRender:o}=this.editData,{data:i}=n;if(i.contour.closed)return;const a=e.detail,{element:s}=a,{currentPoints:d}=a,{canvas:c,world:h}=d,u=(0,r.getEnabledElement)(s),{renderingEngine:g}=u;let p=i.handles.points.length>=2&&t,v=!0;if(i.handles.points.length>=3){const{instance:e}=i.spline,t=e.getClosestControlPointWithinDistance(c,10);0===t?.index&&(v=!1,p=!0)}v&&i.handles.points.push(h),i.contour.closed=i.contour.closed||p,n.invalidated=!0,(0,Be.triggerAnnotationRenderForViewportIds)(o),i.contour.closed&&this._endCallback(e),e.preventDefault()},this._dragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:i,handleIndex:a,movingTextBox:s}=this.editData,{data:l}=o;if(s){const{deltaPoints:e}=t,n=e.world,{textBox:o}=l.handles,{worldPosition:i}=o;i[0]+=n[0],i[1]+=n[1],i[2]+=n[2],o.hasMoved=!0}else if(void 0===a){const{deltaPoints:e}=t,n=e.world;this.moveAnnotation(o,n)}else{const{currentPoints:e}=t,n=e.world;l.handles.points[a]=[...n],o.invalidated=!0}this.editData.hasMoved=!0;const d=(0,r.getEnabledElement)(n),{renderingEngine:c}=d;(0,Be.triggerAnnotationRenderForViewportIds)(i)},this.triggerAnnotationCompleted=(e,t)=>{const n=l.Events.ANNOTATION_COMPLETED,o={annotation:e,changeType:l.ChangeTypes.Completed,contourHoleProcessingEnabled:t};(0,r.triggerEvent)(r.eventTarget,n,o)},this.triggerAnnotationModified=(e,t,n=l.ChangeTypes.StatsUpdated)=>{const{viewportId:o,renderingEngineId:i}=t,a=l.Events.ANNOTATION_MODIFIED,s={annotation:e,viewportId:o,renderingEngineId:i,changeType:n};(0,r.triggerEvent)(r.eventTarget,a,s)},this.triggerChangeEvent=(e,t,n=l.ChangeTypes.StatsUpdated,o)=>{n===l.ChangeTypes.Completed?this.triggerAnnotationCompleted(e,o):this.triggerAnnotationModified(e,t,n)},this._activateModify=e=>{B.wk.isInteractingWithTool=!0,e.addEventListener(l.Events.MOUSE_UP,this._endCallback),e.addEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(l.Events.TOUCH_END,this._endCallback),e.addEventListener(l.Events.TOUCH_DRAG,this._dragCallback),e.addEventListener(l.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{B.wk.isInteractingWithTool=!1,e.removeEventListener(l.Events.MOUSE_UP,this._endCallback),e.removeEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(l.Events.TOUCH_END,this._endCallback),e.removeEventListener(l.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(l.Events.TOUCH_TAP,this._endCallback)},this._activateDraw=e=>{B.wk.isInteractingWithTool=!0,e.addEventListener(l.Events.KEY_DOWN,this._keyDownCallback),e.addEventListener(l.Events.MOUSE_MOVE,this._mouseMoveCallback),e.addEventListener(l.Events.MOUSE_DOWN,this._mouseDownCallback),e.addEventListener(l.Events.MOUSE_DOUBLE_CLICK,this._mouseDownCallback),e.addEventListener(l.Events.TOUCH_TAP,this._mouseDownCallback)},this._deactivateDraw=e=>{B.wk.isInteractingWithTool=!1,e.removeEventListener(l.Events.KEY_DOWN,this._keyDownCallback),e.removeEventListener(l.Events.MOUSE_MOVE,this._mouseMoveCallback),e.removeEventListener(l.Events.MOUSE_DOWN,this._mouseDownCallback),e.removeEventListener(l.Events.MOUSE_DOUBLE_CLICK,this._mouseDownCallback),e.removeEventListener(l.Events.TOUCH_TAP,this._mouseDownCallback)},this._renderStats=(e,t,n,o)=>{const i=e.data,a=this.getTargetId(t);if(!i.spline.instance.closed||!o.visibility)return;const r=this.configuration.getTextLines(i,a);if(!r||0===r.length)return;const s=i.handles.points.map((e=>t.worldToCanvas(e)));if(!i.handles.textBox.hasMoved){const e=(0,bn.getTextBoxCoordsCanvas)(s);i.handles.textBox.worldPosition=t.canvasToWorld(e)}const l=t.worldToCanvas(i.handles.textBox.worldPosition),d=(0,Ve.drawLinkedTextBox)(n,e.annotationUID??"","textBox",r,l,s,{},o),{x:c,y:h,width:u,height:g}=d;i.handles.textBox.worldBoundingBox={topLeft:t.canvasToWorld([c,h]),topRight:t.canvasToWorld([c+u,h]),bottomLeft:t.canvasToWorld([c,h+g]),bottomRight:t.canvasToWorld([c+u,h+g])}},this.addControlPointCallback=(e,t)=>{const{data:n}=t,o=n.spline.type,i=this._getSplineConfig(o),a=i.controlPointAdditionDistance;if(!1===i.controlPointAdditionEnabled)return;const s=e.detail,{element:l}=s,d=(0,r.getEnabledElement)(l),{renderingEngine:c,viewport:h}=d,{canvasToWorld:u}=h,{instance:g}=n.spline,p=e.detail.currentPoints.canvas,v=g.getClosestPoint(p);if(v.distance>a)return;const{index:f,point:m}=g.addControlPointAtU(v.uValue);n.handles.points.splice(f,0,u(m)),t.invalidated=!0;const w=(0,Qe.getViewportIdsWithToolToRender)(l,this.getToolName());(0,Be.triggerAnnotationRenderForViewportIds)(w)},this.deleteControlPointCallback=(e,t)=>{const n=t.data.spline.type,o=this._getSplineConfig(n),i=o.controlPointDeletionDistance;if(!1===o.controlPointDeletionEnabled)return;const a=e.detail,{element:r,currentPoints:s}=a,{canvas:l}=s,{instance:d}=t.data.spline,c=d.getClosestControlPointWithinDistance(l,i);c&&this._deleteControlPointByIndex(r,t,c.index)},this._calculateCachedStats=(e,t)=>{if(!this.configuration.calculateStats)return;const n=e.data;if(!n.contour.closed)return;const o=(0,r.getEnabledElement)(t),{viewport:i}=o,{cachedStats:a}=n,{polyline:s}=n.contour,d=Object.keys(a);for(let e=0;e<d.length;e++){const t=d[e],n=this.getTargetImageData(t);if(!n)continue;const{metadata:o}=n,l=s.map((e=>i.worldToCanvas(e))),c=l[0],h=i.canvasToWorld(c),u=i.canvasToWorld([c[0]+1,c[1]]),g=i.canvasToWorld([c[0],c[1]+1]),p=De.eR.distance(h,u),v=De.eR.distance(h,g),{imageData:f}=n,{scale:m,areaUnit:w}=(0,wn.Op)(n,(()=>{const{maxX:e,maxY:t,minX:n,minY:o}=sn.polyline.getAABB(l),a=i.canvasToWorld([n,o]),s=r.utilities.transformWorldToIndex(f,a),d=i.canvasToWorld([e,t]);return[s,r.utilities.transformWorldToIndex(f,d)]}));let E=sn.polyline.getArea(l)/m/m;E*=p*v,a[t]={Modality:o.Modality,area:E,areaUnit:w}}return this.triggerAnnotationModified(e,o,l.ChangeTypes.StatsUpdated),a},this._throttledCalculateCachedStats=(0,En.A)(this._calculateCachedStats,100,{trailing:!0})}addNewAnnotation(e){const t=e.detail,{currentPoints:n,element:o}=t,{canvas:i}=n,a=(0,Jn.A)(e.detail.event)===this.configuration.contourHoleAdditionModifierKey,s=(0,r.getEnabledElement)(o),{renderingEngine:l}=s,d=this.createAnnotation(e);this.isDrawing=!0,this.addAnnotation(d,o);const c=(0,Qe.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:d,viewportIdsToRender:c,movingTextBox:!1,newAnnotation:!0,hasMoved:!1,lastCanvasPoint:i,contourHoleProcessingEnabled:a},this._activateDraw(o),e.preventDefault(),(0,Be.triggerAnnotationRenderForViewportIds)(c),d}cancel(e){if(!this.isDrawing)return;this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,et.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:o}=this.editData;o&&(0,s.removeAnnotation)(t.annotationUID),super.cancelAnnotation(t);const i=(0,r.getEnabledElement)(e),{renderingEngine:a}=i;return(0,Be.triggerAnnotationRenderForViewportIds)(n),this.editData=null,t.annotationUID}isContourSegmentationTool(){return!1}renderAnnotationInstance(e){const{enabledElement:t,targetId:n,svgDrawingHelper:o,annotationStyle:i}=e,{viewport:a}=t,{worldToCanvas:r}=a,{element:l}=a,d=e.annotation,{annotationUID:c,data:h,highlighted:u}=d,{handles:g}=h,{points:p,activeHandleIndex:v}=g,f=this.editData?.newAnnotation,{lineWidth:m,lineDash:w,color:E,locked:b}=i,y=p.map((e=>r(e))),{drawPreviewEnabled:I}=this.configuration.spline,_=d.data.spline.type,C=this._getSplineConfig(_),T=d.data.spline.instance,S=(0,s.getChildAnnotations)(d);if(-1!==S.findIndex((e=>!e)))throw new Error(`Can't find annotation for child ${d.childAnnotationUIDs.join()}`);let x;if([d,...S].filter((e=>this._isSplineROIAnnotation(e))).forEach((e=>{const t=this._updateSplineInstance(l,e).getPolylinePoints();this.updateContourPolyline(e,{points:t,closed:h.contour.closed,targetWindingDirection:Qn.W.Clockwise},a,{updateWindingDirection:h.contour.closed})})),super.renderAnnotationInstance(e),h.cachedStats[n]&&null!=h.cachedStats[n].areaUnit?d.invalidated&&this._throttledCalculateCachedStats(d,l):(h.cachedStats[n]={Modality:null,area:null,areaUnit:null},this._calculateCachedStats(d,l)),b||this.editData||null===v||(x=[y[v]]),x||f||u){const e="0";(0,Ve.drawHandles)(o,c,e,y,{color:E,lineWidth:m,handleRadius:"3"})}if(I&&T.numControlPoints>1&&this.editData?.lastCanvasPoint&&!T.closed){const{lastCanvasPoint:e}=this.editData,t=T.getPreviewPolylinePoints(e,10);(0,Ve.drawPolyline)(o,c,"previewSplineChange",t,{color:"#9EA0CA",lineDash:w,lineWidth:1})}if(C.showControlPointsConnectors){const e=[...y];T.closed&&e.push(y[0]),(0,Ve.drawPolyline)(o,c,"controlPointsConnectors",e,{color:"rgba(255, 255, 255, 0.5)",lineWidth:1})}return this._renderStats(d,a,o,i.textbox),this.fireChangeOnUpdate?.annotationUID===c&&(this.triggerChangeEvent(d,t,this.fireChangeOnUpdate.changeType,this.fireChangeOnUpdate.contourHoleProcessingEnabled),this.fireChangeOnUpdate=null),d.invalidated=!1,!0}createInterpolatedSplineControl(e){if(e.data.handles.points?.length)return;const{polyline:t}=e.data.contour;if(!t||!t.length)return;e.data.handles.points=[];const{points:n}=e.data.handles,o=Math.max(10,Math.floor(t.length/20));for(let e=0;e<t.length-o;e+=o)n.push(t[e]);n.push(t[t.length-1])}createAnnotation(e){const t=super.createAnnotation(e),{world:n}=e.detail.currentPoints,{type:o}=this.configuration.spline,i=this._getSplineConfig(o),a=new i.Class,s=()=>({type:i.type,instance:a,resolution:i.resolution});let l;return this.configuration.interpolation?.enabled&&(l=e=>{e.data.spline||=s(),this.createInterpolatedSplineControl(e)}),r.utilities.deepMerge(t,{data:{handles:{points:[[...n]]},spline:s(),cachedStats:{}},onInterpolationComplete:l})}_deleteControlPointByIndex(e,t,n){const o=(0,r.getEnabledElement)(e),{points:i}=t.data.handles;3===i.length?(0,s.removeAnnotation)(t.annotationUID):i.splice(n,1);const{renderingEngine:a}=o,l=(0,Qe.getViewportIdsWithToolToRender)(e,this.getToolName());t.invalidated=!0,(0,Be.triggerAnnotationRenderForViewportIds)(l)}_isSplineROIAnnotation(e){return!!e.data?.spline}_getSplineConfig(e){const{configuration:t}=this,n=t.spline.configuration;return Object.assign({type:e},ao,n[e])}_updateSplineInstance(e,t){const n=(0,r.getEnabledElement)(e),{viewport:o}=n,{worldToCanvas:i}=o,{data:a}=t,{type:s,instance:l}=t.data.spline,d=this._getSplineConfig(s),c=a.handles.points.map(i),h=void 0!==d.resolution?parseInt(d.resolution):void 0,u=void 0!==d.scale?parseFloat(d.scale):void 0;return l.setControlPoints(c),l.closed=!!a.contour.closed,l.fixedResolution||void 0===h||l.resolution===h||(l.resolution=h,t.invalidated=!0),l instanceof eo.A&&!l.fixedScale&&void 0!==u&&l.scale!==u&&(l.scale=u,t.invalidated=!0),l}}function co(e,t){const n=e.cachedStats[t],{area:o,isEmptyArea:i,areaUnit:a}=n,s=[];if(o){const e=i?"Area: Oblique not supported":`Area: ${r.utilities.roundNumber(o)} ${a}`;s.push(e)}return s}lo.toolName="SplineROI";const ho=lo;class uo extends ho{constructor(e){super(r.utilities.deepMerge({configuration:{calculateStats:!1}},e))}isContourSegmentationTool(){return!0}}uo.toolName="SplineContourSegmentationTool";const go=uo;var po=n(28220),vo=n(37590),fo=n(98013),mo=n(78044),wo=n(38776);class Eo extends io.A{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{getTextLines:yo,calculateStats:!0,preventHandleOutsideImage:!1,contourHoleAdditionModifierKey:l.KeyboardBindings.Shift,snapHandleNearby:2,interpolation:{enabled:!1,nearestEdge:2,showInterpolationPolyline:!1},decimate:{enabled:!1,epsilon:.1},actions:{undo:{method:"undo",bindings:[{key:"Escape"}]}}}}){super(e,t),this.isHandleOutsideImage=!1,this.isPointNearTool=(e,t,n,o)=>{const i=(0,r.getEnabledElement)(e),{viewport:a}=i,s=o*o,l=t.data.contour.polyline.map((e=>a.worldToCanvas(e)));let d=l[l.length-1];for(let e=0;e<l.length;e++){const t=l[e];if(sn.lineSegment.distanceToPointSquared(d,t,n)<=s)return!0;d=t}return!1},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:o}=n;t.highlighted=!0;const i=(0,Qe.getViewportIdsWithToolToRender)(o,this.getToolName());this.editData={annotation:t,viewportIdsToRender:i,movingTextBox:!1};const a=(0,r.getEnabledElement)(o),{renderingEngine:s}=a;this._activateModify(o),(0,tt.A)(i),e.preventDefault()},this.handleSelectedCallback=(e,t,n)=>{const o=e.detail,{element:i}=o,{data:a}=t;t.highlighted=!0;let s,l=!1;if(n.worldPosition)l=!0;else{const{points:e}=a.handles;s=e.findIndex((e=>e===n))}const d=(0,Qe.getViewportIdsWithToolToRender)(i,this.getToolName());this.editData={annotation:t,viewportIdsToRender:d,handleIndex:s,movingTextBox:l},this._activateModify(i);const c=(0,r.getEnabledElement)(i),{renderingEngine:h}=c;(0,tt.A)(d),e.preventDefault()},this._endCallback=(e,t=!1)=>{const n=e.detail,{element:o}=n,{annotation:i,viewportIdsToRender:a,newAnnotation:d,contourHoleProcessingEnabled:c}=this.editData,{data:h}=i;h.handles.activeHandleIndex=null,this._deactivateModify(o),this._deactivateDraw(o),(0,et.resetElementCursor)(o);const u=(0,r.getEnabledElement)(o);if(this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage||t)return(0,s.removeAnnotation)(i.annotationUID),this.clearEditData(),void(0,tt.A)(a);(0,tt.A)(a);const g=d?l.ChangeTypes.Completed:l.ChangeTypes.HandlesUpdated;this.triggerChangeEvent(i,u,g,c),this.clearEditData()},this.triggerChangeEvent=(e,t,n=l.ChangeTypes.StatsUpdated,o=!1)=>{n===l.ChangeTypes.Completed?(0,Je.PS)(e,o):(0,Je.XF)(e,t.viewport.element,n)},this._mouseDownCallback=e=>{const t=e.type===l.Events.MOUSE_DOUBLE_CLICK,{annotation:n,viewportIdsToRender:o,worldToSlice:i,sliceToWorld:a}=this.editData;if(this.editData.closed)return;const s=e.detail,{element:d}=s,{currentPoints:c}=s,{canvas:h,world:u}=c;let g=u;const p=(0,r.getEnabledElement)(d),{viewport:v,renderingEngine:f}=p,m=this.editData.currentPath.getControlPoints();let w=m.length>=2&&t;if(m.length>=2){const e={index:-1,distSquared:1/0};for(let t=0,n=m.length;t<n;t++){const n=a(m[t]),o=v.worldToCanvas(n),i=sn.point.distanceToPointSquared(h,o);i<=100&&i<e.distSquared&&(e.distSquared=i,e.index=t)}0===e.index&&(w=!0)}const{snapHandleNearby:E}=this.configuration;if(E&&!this.editData.closed){const e=new wo.j,t=this.scissors.findMinNearby(i(u),1),n=this.scissors.findPathToPoint(t);e.addPoints(n),e.prependPath(this.editData.confirmedPath),g=a(t),this.editData.currentPath=e}this.editData.closed=this.editData.closed||w,this.editData.confirmedPath=this.editData.currentPath;const b=this.editData.currentPath.getLastPoint();this.editData.confirmedPath.addControlPoint(b),n.data.handles.points.push(a(b)),this.scissors.startSearch(i(g)),n.invalidated=!0,(0,tt.A)(o),this.editData.closed&&(this.updateAnnotation(this.editData.confirmedPath),this._endCallback(e)),e.preventDefault()},this._mouseMoveCallback=e=>{const{element:t,currentPoints:n}=e.detail,{world:o,canvas:i}=n,{renderingEngine:a}=(0,r.getEnabledElement)(t),s=(0,Qe.getViewportIdsWithToolToRender)(t,this.getToolName());this.editData.lastCanvasPoint=i;const{width:l,height:d}=this.scissors,{worldToSlice:c}=this.editData,h=c(o);if(h[0]<0||h[1]<0||h[0]>=l||h[1]>=d)return;const u=this.scissors.findPathToPoint(h),g=new wo.j;g.addPoints(u),g.prependPath(this.editData.confirmedPath),this.editData.currentPath=g,(0,tt.A)(s),e.preventDefault()},this._dragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:i,handleIndex:a,movingTextBox:s}=this.editData,{data:l}=o;if(s){const{deltaPoints:e}=t,n=e.world,{textBox:o}=l.handles,{worldPosition:i}=o;i[0]+=n[0],i[1]+=n[1],i[2]+=n[2],o.hasMoved=!0}else if(void 0===a)console.warn("Drag annotation not implemented");else{const{currentPoints:e}=t,i=e.world;this.editHandle(i,n,o,a)}this.editData.hasMoved=!0;const d=(0,r.getEnabledElement)(n),{renderingEngine:c}=d;(0,tt.A)(i)},this.cancel=e=>{if(!this.isDrawing)return;this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,et.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:o}=this.editData;o&&(0,s.removeAnnotation)(t.annotationUID);const i=(0,r.getEnabledElement)(e),{renderingEngine:a}=i;return(0,tt.A)(n),this.editData=null,this.scissors=null,t.annotationUID},this._activateModify=e=>{B.wk.isInteractingWithTool=!0,e.addEventListener(l.Events.MOUSE_UP,this._endCallback),e.addEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(l.Events.TOUCH_END,this._endCallback),e.addEventListener(l.Events.TOUCH_DRAG,this._dragCallback),e.addEventListener(l.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{B.wk.isInteractingWithTool=!1,e.removeEventListener(l.Events.MOUSE_UP,this._endCallback),e.removeEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(l.Events.TOUCH_END,this._endCallback),e.removeEventListener(l.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(l.Events.TOUCH_TAP,this._endCallback)},this._activateDraw=e=>{B.wk.isInteractingWithTool=!0,e.addEventListener(l.Events.MOUSE_MOVE,this._mouseMoveCallback),e.addEventListener(l.Events.MOUSE_DOWN,this._mouseDownCallback),e.addEventListener(l.Events.MOUSE_DOUBLE_CLICK,this._mouseDownCallback),e.addEventListener(l.Events.TOUCH_TAP,this._mouseDownCallback)},this._deactivateDraw=e=>{B.wk.isInteractingWithTool=!1,e.removeEventListener(l.Events.MOUSE_MOVE,this._mouseMoveCallback),e.removeEventListener(l.Events.MOUSE_DOWN,this._mouseDownCallback),e.removeEventListener(l.Events.MOUSE_DOUBLE_CLICK,this._mouseDownCallback),e.removeEventListener(l.Events.TOUCH_TAP,this._mouseDownCallback)},this._calculateCachedStats=(e,t)=>{if(!this.configuration.calculateStats)return;const n=e.data;if(!n.contour.closed)return;const o=(0,r.getEnabledElement)(t),{viewport:i,renderingEngine:a}=o,{cachedStats:s}=n,{polyline:d}=n.contour,c=Object.keys(s);for(let e=0;e<c.length;e++){const t=c[e],n=this.getTargetImageData(t);if(!n)continue;const{metadata:o}=n,a=d.map((e=>i.worldToCanvas(e))),l=a[0],h=i.canvasToWorld(l),u=i.canvasToWorld([l[0]+1,l[1]]),g=i.canvasToWorld([l[0],l[1]+1]),p=De.eR.distance(h,u),v=De.eR.distance(h,g),{imageData:f}=n,{scale:m,areaUnit:w}=(0,Be.getCalibratedLengthUnitsAndScale)(n,(()=>{const{maxX:e,maxY:t,minX:n,minY:o}=sn.polyline.getAABB(a),s=i.canvasToWorld([n,o]),l=r.utilities.transformWorldToIndex(f,s),d=i.canvasToWorld([e,t]);return[l,r.utilities.transformWorldToIndex(f,d)]}));let E=sn.polyline.getArea(a)/m/m;E*=p*v,s[t]={Modality:o.Modality,area:E,areaUnit:w}}return this.triggerAnnotationModified(e,o,l.ChangeTypes.StatsUpdated),s},this._renderStats=(e,t,n,o)=>{const i=e.data,a=this.getTargetId(t);if(!i.contour.closed||!o.visibility)return;const r=this.configuration.getTextLines(i,a);if(!r||0===r.length)return;const s=i.handles.points.map((e=>t.worldToCanvas(e)));if(!i.handles.textBox.hasMoved){const e=(0,bn.getTextBoxCoordsCanvas)(s);i.handles.textBox.worldPosition=t.canvasToWorld(e)}const l=t.worldToCanvas(i.handles.textBox.worldPosition),d=(0,Ve.drawLinkedTextBox)(n,e.annotationUID??"","textBox",r,l,s,{},o),{x:c,y:h,width:u,height:g}=d;i.handles.textBox.worldBoundingBox={topLeft:t.canvasToWorld([c,h]),topRight:t.canvasToWorld([c+u,h]),bottomLeft:t.canvasToWorld([c,h+g]),bottomRight:t.canvasToWorld([c+u,h+g])}},this.triggerAnnotationModified=(e,t,n=l.ChangeTypes.StatsUpdated)=>{const{viewportId:o,renderingEngineId:i}=t,a=l.Events.ANNOTATION_MODIFIED,s={annotation:e,viewportId:o,renderingEngineId:i,changeType:n};(0,r.triggerEvent)(r.eventTarget,a,s)},this._throttledCalculateCachedStats=(0,Be.throttle)(this._calculateCachedStats,100,{trailing:!0})}setupBaseEditData(e,t,n,o,i){const a=(0,r.getEnabledElement)(t),{viewport:s}=a;this.isDrawing=!0;const l=s.getImageData(),{imageData:d}=l;let c,h,u,g,p;if(s instanceof r.VolumeViewport){if(!(s instanceof r.VolumeViewport))throw new Error("Viewport not supported");{const e=r.utilities.getCurrentVolumeViewportSlice(s),{sliceToIndexMatrix:t,indexToSliceMatrix:n}=e;c=e=>{const t=r.utilities.transformWorldToIndex(d,e),o=De.eR.transformMat4([0,0,0],t,n);return[o[0],o[1]]},h=e=>{const n=De.eR.transformMat4([0,0,0],[e[0],e[1],0],t);return r.utilities.transformIndexToWorld(d,n)},p=e.scalarData,u=e.width,g=e.height}}else u=l.dimensions[0],g=l.dimensions[1],c=e=>{const t=r.utilities.transformWorldToIndex(d,e);return[t[0],t[1]]},h=e=>r.utilities.transformIndexToWorld(d,[e[0],e[1],0]),p=l.scalarData;p=r.utilities.convertToGrayscale(p,u,g);const{voiRange:v}=s.getProperties(),f=c(e);this.scissors=mo.f.createInstanceFromRawPixelData(p,u,g,v),o&&(this.scissorsNext=mo.f.createInstanceFromRawPixelData(p,u,g,v),this.scissorsNext.startSearch(c(o))),this.scissors.startSearch(f);const m=!o,w=new wo.j,E=new wo.j,b=m?void 0:new wo.j;w.addPoint(f),w.addControlPoint(f);const y=(0,Qe.getViewportIdsWithToolToRender)(t,this.getToolName()),I=s.worldToCanvas(e);this.editData={annotation:n,viewportIdsToRender:y,newAnnotation:m,hasMoved:!1,lastCanvasPoint:I,confirmedPath:w,currentPath:E,confirmedPathNext:b,closed:!1,handleIndex:this.editData?.handleIndex??n.handles?.activeHandleIndex,worldToSlice:c,sliceToWorld:h,contourHoleProcessingEnabled:i}}addNewAnnotation(e){const t=e.detail,{currentPoints:n,element:o}=t,{world:i}=n,a=this.createAnnotation(e),r=(0,Jn.A)(e.detail.event)===this.configuration.contourHoleAdditionModifierKey;return this.setupBaseEditData(i,o,a,void 0,r),this.addAnnotation(a,o),this._activateDraw(o),e.preventDefault(),(0,tt.A)(this.editData.viewportIdsToRender),a}clearEditData(){this.editData=null,this.scissors=null,this.scissorsNext=null,this.isDrawing=!1}editHandle(e,t,n,o){const{data:i}=n,{points:a}=i.handles,{length:r}=a,s=a[(o-1+r)%r],l=a[(o+1)%r];if(!this.editData?.confirmedPathNext){this.setupBaseEditData(s,t,n,l);const{polyline:e}=i.contour,a=new wo.j,r=new wo.j,{worldToSlice:d}=this.editData,c=(0,fo.A)(n,o-1),h=(0,fo.A)(n,o+1);if(-1===h||-1===c)throw new Error(`Can't find handle index ${-1===h&&l} ${-1===c&&s}`);0===o?r.addPoints(e.slice(h+1,c).map(d)):(a.addPoints(e.slice(0,c+1).map(d)),r.addPoints(e.slice(h,e.length).map(d))),this.editData.confirmedPath=a,this.editData.confirmedPathNext=r}const{editData:d,scissors:c}=this,{worldToSlice:h,sliceToWorld:u}=d,{activeHandleIndex:g}=i.handles;if(null==g)i.handles.activeHandleIndex=o;else if(g!==o)throw new Error(`Trying to edit a different handle than the one currently being edited ${o}!==${i.handles.activeHandleIndex}`);const p=h(e);if(p[0]<0||p[0]>=c.width||p[1]<0||p[1]>=c.height)return;a[o]=u(p);const v=c.findPathToPoint(p),f=this.scissorsNext.findPathToPoint(p),m=new wo.j;m.prependPath(d.confirmedPath),0!==o&&m.addPoints(v),m.addPoints(f.reverse()),m.appendPath(d.confirmedPathNext),0===o&&m.addPoints(v),d.currentPath=m,n.invalidated=!0,d.hasMoved=!0,d.closed=!0}renderAnnotation(e,t){return this.updateAnnotation(this.editData?.currentPath),super.renderAnnotation(e,t)}isContourSegmentationTool(){return!1}createAnnotation(e){const t=super.createAnnotation(e),{world:n}=e.detail.currentPoints;return r.utilities.deepMerge(t,{data:{handles:{points:[[...n]]}}})}undo(e,t,n){this.editData&&this._endCallback(n,!0)}renderAnnotationInstance(e){const{annotation:t,enabledElement:n,svgDrawingHelper:o,annotationStyle:i,targetId:a}=e,{viewport:r}=n,{element:s}=r,{worldToCanvas:l}=r,{annotationUID:d,data:c,highlighted:h}=t,{handles:u}=c,g=this.editData?.newAnnotation,{lineWidth:p,lineDash:v,color:f}=i;if(h||g&&t.annotationUID===this.editData?.annotation?.annotationUID){const e="0",t=u.points.map(l);(0,Ve.drawHandles)(o,d,e,t,{color:f,lineDash:v,lineWidth:p})}return super.renderAnnotationInstance(e),c.cachedStats[a]&&null!=c.cachedStats[a].areaUnit?t.invalidated&&this._throttledCalculateCachedStats(t,s):(c.cachedStats[a]={Modality:null,area:null,areaUnit:null},this._calculateCachedStats(t,s)),this._renderStats(t,r,o,i.textbox),!0}updateAnnotation(e){if(!this.editData||!e)return;const{annotation:t,sliceToWorld:n,worldToSlice:o,closed:i,newAnnotation:a}=this.editData;let{pointArray:r}=e;r.length>1&&(r=[...r,r[0]]);const s=a&&i?Qn.W.Clockwise:void 0;this.updateContourPolyline(t,{points:r,closed:i,targetWindingDirection:s},{canvasToWorld:n,worldToCanvas:o})}}Eo.toolName="LivewireContour";const bo=Eo;function yo(e,t){const n=e.cachedStats[t],{area:o,areaUnit:i}=n,a=[];if(o){const e=`Area: ${r.utilities.roundNumber(o)} ${i}`;a.push(e)}return a}class Io extends bo{updateInterpolatedAnnotation(e,t){!this.editData&&e.invalidated&&e.data.handles.interpolationSources&&(e.data.contour.originalPolyline=e.data.contour.polyline,queueMicrotask((()=>{if(!e.data.handles.interpolationSources)return;const{points:n}=e.data.handles,{element:o}=t.viewport;this.setupBaseEditData(n[0],o,e);const{length:i}=n,{scissors:a}=this,{nearestEdge:s,repeatInterpolation:d}=this.configuration.interpolation;e.data.handles.originalPoints=n;const{worldToSlice:c,sliceToWorld:h}=this.editData,u=[];if(s){let e=c(n[n.length-1]);n.forEach(((t,o)=>{const i=c(t);e=i,u.push(i),a.startSearch(e),a.findPathToPoint(i),a.findPathToPoint(c(n[(o+3)%n.length]));const l=a.findMinNearby(i,s);r.utilities.isEqual(i,l)||(u[o]=l,e=l,n[o]=h(l))}))}const g=new wo.j;for(let e=0;e<i;e++){a.startSearch(c(n[e]));const t=a.findPathToPoint(c(n[(e+1)%i]));g.addPoints(t)}this.updateAnnotation(g),this.scissors=null,this.scissorsNext=null,this.editData=null,e.data.handles.interpolationSources=null,d&&(0,Je.XF)(e,t.viewport.element,l.ChangeTypes.InterpolationUpdated)})))}renderAnnotationInstance(e){const{enabledElement:t,svgDrawingHelper:n}=e,o=e.annotation,{annotationUID:i}=o,{viewport:a}=t,{worldToCanvas:r}=a,{showInterpolationPolyline:s}=this.configuration.interpolation||{};this.updateInterpolatedAnnotation?.(o,t);const{originalPolyline:l}=o.data.contour,d=super.renderAnnotationInstance(e);if(s&&l&&o.autoGenerated){const e=l.map(r);e.push(e[0]),(0,Ve.drawPolyline)(n,i,"interpolationContour-0",e,{color:"#70ffff",lineWidth:1,fillOpacity:0})}return d}isContourSegmentationTool(){return!0}}Io.toolName="LivewireContourSegmentationTool";const _o=Io;class Co extends Ge.EC{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,getTextCallback:To,changeTextCallback:So,preventHandleOutsideImage:!1,arrowFirst:!0}}){super(e,t),this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:o}=t,i=n.world,a=(0,r.getEnabledElement)(o),{viewport:l,renderingEngine:d}=a;(0,et.hideElementCursor)(o),this.isDrawing=!0;const c=l.getCamera(),{viewPlaneNormal:h,viewUp:u}=c,g=this.getReferencedImageId(l,i,h,u),{arrowFirst:p}=this.configuration,v=l.getFrameOfReferenceUID(),f={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...h],viewUp:[...u],FrameOfReferenceUID:v,referencedImageId:g,...l.getViewReference({points:[i]})},data:{text:"",handles:{points:[[...i],[...i]],activeHandleIndex:null,arrowFirst:p,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:""}};(0,s.addAnnotation)(f,o);const m=(0,Qe.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:f,viewportIdsToRender:m,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),e.preventDefault(),(0,tt.A)(m),f},this.isPointNearTool=(e,t,n,o)=>{const i=(0,r.getEnabledElement)(e),{viewport:a}=i,{data:s}=t,[l,d]=s.handles.points,c=a.worldToCanvas(l),h=a.worldToCanvas(d),u={start:{x:c[0],y:c[1]},end:{x:h[0],y:h[1]}};return mt.distanceToPoint([u.start.x,u.start.y],[u.end.x,u.end.y],[n[0],n[1]])<=o},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:o}=n;t.highlighted=!0;const i=(0,Qe.getViewportIdsWithToolToRender)(o,this.getToolName());this.editData={annotation:t,viewportIdsToRender:i,movingTextBox:!1},this._activateModify(o),(0,et.hideElementCursor)(o);const a=(0,r.getEnabledElement)(o),{renderingEngine:s}=a;(0,tt.A)(i),e.preventDefault()},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:i,newAnnotation:a,hasMoved:r}=this.editData,{data:l}=o;a&&!r||(l.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,et.resetElementCursor)(n),this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,s.removeAnnotation)(o.annotationUID),a?this.configuration.getTextCallback((e=>{if(!e)return(0,s.removeAnnotation)(o.annotationUID),(0,tt.A)(i),this.editData=null,void(this.isDrawing=!1);o.data.text=e,(0,Je.dZ)(o),(0,tt.A)(i)})):(0,Je.XF)(o,n),this.editData=null,this.isDrawing=!1)},this._dragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:i,handleIndex:a,movingTextBox:s}=this.editData,{data:l}=o;if(s){const{deltaPoints:e}=t,n=e.world,{textBox:o}=l.handles,{worldPosition:i}=o;i[0]+=n[0],i[1]+=n[1],i[2]+=n[2],o.hasMoved=!0}else if(void 0===a){const{deltaPoints:e}=t,n=e.world;l.handles.points.forEach((e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]})),o.invalidated=!0}else{const{currentPoints:e}=t,n=e.world;l.handles.points[a]=[...n],o.invalidated=!0}this.editData.hasMoved=!0;const d=(0,r.getEnabledElement)(n),{renderingEngine:c}=d;(0,tt.A)(i)},this.touchTapCallback=e=>{2==e.detail.taps&&this.doubleClickCallback(e)},this.doubleClickCallback=e=>{const t=e.detail,{element:n}=t;let o=(0,s.getAnnotations)(this.getToolName(),n);if(o=this.filterInteractableAnnotationsForElement(n,o),!o?.length)return;const i=o.find((e=>this.isPointNearTool(n,e,t.currentPoints.canvas,6)));if(!i)return;const a=i;this.configuration.changeTextCallback(i,e.detail,this._doneChangingTextCallback.bind(this,n,a)),this.editData=null,this.isDrawing=!1,e.stopImmediatePropagation(),e.preventDefault()},this.cancel=e=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,et.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:o}=this.editData,{data:i}=t;return t.highlighted=!1,i.handles.activeHandleIndex=null,(0,tt.A)(n),o&&(0,Je.dZ)(t),this.editData=null,t.annotationUID}},this._activateModify=e=>{B.wk.isInteractingWithTool=!0,e.addEventListener(l.Events.MOUSE_UP,this._endCallback),e.addEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(l.Events.TOUCH_TAP,this._endCallback),e.addEventListener(l.Events.TOUCH_END,this._endCallback),e.addEventListener(l.Events.TOUCH_DRAG,this._dragCallback)},this._deactivateModify=e=>{B.wk.isInteractingWithTool=!1,e.removeEventListener(l.Events.MOUSE_UP,this._endCallback),e.removeEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(l.Events.TOUCH_TAP,this._endCallback),e.removeEventListener(l.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(l.Events.TOUCH_END,this._endCallback)},this._activateDraw=e=>{B.wk.isInteractingWithTool=!0,e.addEventListener(l.Events.MOUSE_UP,this._endCallback),e.addEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(l.Events.MOUSE_MOVE,this._dragCallback),e.addEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(l.Events.TOUCH_TAP,this._endCallback),e.addEventListener(l.Events.TOUCH_END,this._endCallback),e.addEventListener(l.Events.TOUCH_DRAG,this._dragCallback)},this._deactivateDraw=e=>{B.wk.isInteractingWithTool=!1,e.removeEventListener(l.Events.MOUSE_UP,this._endCallback),e.removeEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(l.Events.MOUSE_MOVE,this._dragCallback),e.removeEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(l.Events.TOUCH_TAP,this._endCallback),e.removeEventListener(l.Events.TOUCH_END,this._endCallback),e.removeEventListener(l.Events.TOUCH_DRAG,this._dragCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:o}=e,{element:i}=o;let a=(0,s.getAnnotations)(this.getToolName(),i);if(!a?.length)return n;if(a=this.filterInteractableAnnotationsForElement(i,a),!a?.length)return n;const r={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let e=0;e<a.length;e++){const i=a[e],{annotationUID:s,data:l}=i,{handles:d,text:c}=l,{points:h,activeHandleIndex:u}=d;r.annotationUID=s;const{color:g,lineWidth:p,lineDash:v}=this.getAnnotationStyle({annotation:i,styleSpecifier:r}),f=h.map((e=>o.worldToCanvas(e)));let m;if((0,wt.isAnnotationLocked)(s)||this.editData||null===u||(m=[f[u]]),m){const e="0";(0,Ve.drawHandles)(t,s,e,f,{color:g,lineWidth:p})}const w="1";if(this.configuration.arrowFirst?(0,Ve.drawArrow)(t,s,w,f[1],f[0],{color:g,width:p,lineDash:v}):(0,Ve.drawArrow)(t,s,w,f[0],f[1],{color:g,width:p,lineDash:v}),n=!0,!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;if(!c)continue;const E=this.getLinkedTextBoxStyle(r,i);if(!E.visibility){l.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}if(!l.handles.textBox.hasMoved){const e=f[1];l.handles.textBox.worldPosition=o.canvasToWorld(e)}const b=o.worldToCanvas(l.handles.textBox.worldPosition),y="1",I=(0,Ve.drawLinkedTextBox)(t,s,y,[c],b,f,{},E),{x:_,y:C,width:T,height:S}=I;l.handles.textBox.worldBoundingBox={topLeft:o.canvasToWorld([_,C]),topRight:o.canvasToWorld([_+T,C]),bottomLeft:o.canvasToWorld([_,C+S]),bottomRight:o.canvasToWorld([_+T,C+S])}}return n}}handleSelectedCallback(e,t,n){const o=e.detail,{element:i}=o,{data:a}=t;t.highlighted=!0;let s,l=!1;n.worldPosition?l=!0:s=a.handles.points.findIndex((e=>e===n));const d=(0,Qe.getViewportIdsWithToolToRender)(i,this.getToolName());this.editData={annotation:t,viewportIdsToRender:d,handleIndex:s,movingTextBox:l},this._activateModify(i),(0,et.hideElementCursor)(i);const c=(0,r.getEnabledElement)(i),{renderingEngine:h}=c;(0,tt.A)(d),e.preventDefault()}_doneChangingTextCallback(e,t,n){t.data.text=n;(0,r.getEnabledElement)(e);const o=(0,Qe.getViewportIdsWithToolToRender)(e,this.getToolName());(0,tt.A)(o),(0,Je.XF)(t,e)}_isInsideVolume(e,t,n){return r.utilities.indexWithinDimensions(e,n)&&r.utilities.indexWithinDimensions(t,n)}}function To(e){return e(prompt("Enter your annotation:"))}function So(e,t,n){return n(prompt("Enter your annotation:"))}Co.toolName="ArrowAnnotate";const xo=Co;class Do extends Ge.EC{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,getTextLines:Ao}}){super(e,t),this.addNewAnnotation=e=>{if(this.angleStartedNotYetCompleted)return;this.angleStartedNotYetCompleted=!0;const t=e.detail,{currentPoints:n,element:o}=t,i=n.world,a=(0,r.getEnabledElement)(o),{viewport:l,renderingEngine:d}=a;(0,et.hideElementCursor)(o),this.isDrawing=!0;const c=l.getCamera(),{viewPlaneNormal:h,viewUp:u}=c,g=this.getReferencedImageId(l,i,h,u),p=l.getFrameOfReferenceUID(),v={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...h],viewUp:[...u],FrameOfReferenceUID:p,referencedImageId:g,...l.getViewReference({points:[i]})},data:{handles:{points:[[...i],[...i]],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:"",cachedStats:{}}};(0,s.addAnnotation)(v,o);const f=(0,Qe.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:v,viewportIdsToRender:f,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),e.preventDefault(),(0,tt.A)(f),v},this.isPointNearTool=(e,t,n,o)=>{const i=(0,r.getEnabledElement)(e),{viewport:a}=i,{data:s}=t,[l,d,c]=s.handles.points,h=a.worldToCanvas(l),u=a.worldToCanvas(d),g={start:{x:h[0],y:h[1]},end:{x:u[0],y:u[1]}};if(mt.distanceToPoint([g.start.x,g.start.y],[g.end.x,g.end.y],[n[0],n[1]])<=o)return!0;if(!c)return!1;const p=a.worldToCanvas(c),v={start:{x:u[0],y:u[1]},end:{x:p[0],y:p[1]}};return mt.distanceToPoint([v.start.x,v.start.y],[v.end.x,v.end.y],[n[0],n[1]])<=o},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:o}=n;t.highlighted=!0;const i=(0,Qe.getViewportIdsWithToolToRender)(o,this.getToolName());this.editData={annotation:t,viewportIdsToRender:i,movingTextBox:!1},this._activateModify(o),(0,et.hideElementCursor)(o);const a=(0,r.getEnabledElement)(o),{renderingEngine:s}=a;(0,tt.A)(i),e.preventDefault()},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:i,newAnnotation:a,hasMoved:l}=this.editData,{data:d}=o;if(a&&!l)return;if(this.angleStartedNotYetCompleted&&2===d.handles.points.length)return void(this.editData.handleIndex=2);this.angleStartedNotYetCompleted=!1,d.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,et.resetElementCursor)(n);const c=(0,r.getEnabledElement)(n),{renderingEngine:h}=c;this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,s.removeAnnotation)(o.annotationUID),(0,tt.A)(i),a&&(0,Je.dZ)(o),this.editData=null,this.isDrawing=!1},this._dragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:i,handleIndex:a,movingTextBox:s}=this.editData,{data:l}=o;if(s){const{deltaPoints:e}=t,n=e.world,{textBox:o}=l.handles,{worldPosition:i}=o;i[0]+=n[0],i[1]+=n[1],i[2]+=n[2],o.hasMoved=!0}else if(void 0===a){const{deltaPoints:e}=t,n=e.world;l.handles.points.forEach((e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]})),o.invalidated=!0}else{const{currentPoints:e}=t,n=e.world;l.handles.points[a]=[...n],o.invalidated=!0}this.editData.hasMoved=!0;const d=(0,r.getEnabledElement)(n),{renderingEngine:c}=d;(0,tt.A)(i)},this.cancel=e=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,et.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:o}=this.editData,{data:i}=t;return t.highlighted=!1,i.handles.activeHandleIndex=null,(0,tt.A)(n),o&&(0,Je.dZ)(t),this.editData=null,this.angleStartedNotYetCompleted=!1,t.annotationUID}},this._activateModify=e=>{B.wk.isInteractingWithTool=!0,e.addEventListener(l.Events.MOUSE_UP,this._endCallback),e.addEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(l.Events.TOUCH_TAP,this._endCallback),e.addEventListener(l.Events.TOUCH_END,this._endCallback),e.addEventListener(l.Events.TOUCH_DRAG,this._dragCallback)},this._deactivateModify=e=>{B.wk.isInteractingWithTool=!1,e.removeEventListener(l.Events.MOUSE_UP,this._endCallback),e.removeEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(l.Events.TOUCH_TAP,this._endCallback),e.removeEventListener(l.Events.TOUCH_END,this._endCallback),e.removeEventListener(l.Events.TOUCH_DRAG,this._dragCallback)},this._activateDraw=e=>{B.wk.isInteractingWithTool=!0,e.addEventListener(l.Events.MOUSE_UP,this._endCallback),e.addEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(l.Events.MOUSE_MOVE,this._dragCallback),e.addEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(l.Events.TOUCH_TAP,this._endCallback),e.addEventListener(l.Events.TOUCH_END,this._endCallback),e.addEventListener(l.Events.TOUCH_DRAG,this._dragCallback)},this._deactivateDraw=e=>{B.wk.isInteractingWithTool=!1,e.removeEventListener(l.Events.MOUSE_UP,this._endCallback),e.removeEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(l.Events.MOUSE_MOVE,this._dragCallback),e.removeEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(l.Events.TOUCH_TAP,this._endCallback),e.removeEventListener(l.Events.TOUCH_END,this._endCallback),e.removeEventListener(l.Events.TOUCH_DRAG,this._dragCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:o}=e,{element:i}=o;let a=(0,s.getAnnotations)(this.getToolName(),i);if(!a?.length)return n;if(a=this.filterInteractableAnnotationsForElement(i,a),!a?.length)return n;const r=this.getTargetId(o),l=o.getRenderingEngine(),d={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let i=0;i<a.length;i++){const s=a[i],{annotationUID:c,data:h}=s,{points:u,activeHandleIndex:g}=h.handles;d.annotationUID=c;const{color:p,lineWidth:v,lineDash:f}=this.getAnnotationStyle({annotation:s,styleSpecifier:d}),m=u.map((e=>o.worldToCanvas(e)));let w;if(h.cachedStats[r]&&null!=h.cachedStats[r].angle?s.invalidated&&this._throttledCalculateCachedStats(s,l,e):(h.cachedStats[r]={angle:null},this._calculateCachedStats(s,l,e)),(0,wt.isAnnotationLocked)(s.annotationUID)||this.editData||null===g||(w=[m[g]]),!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;if(w){const e="0";(0,Ve.drawHandles)(t,c,e,m,{color:p,lineDash:f,lineWidth:v})}let E="1";if((0,Ve.drawLine)(t,c,E,m[0],m[1],{color:p,width:v,lineDash:f}),n=!0,3!==m.length)return n;if(E="2",(0,Ve.drawLine)(t,c,E,m[1],m[2],{color:p,width:v,lineDash:f}),!h.cachedStats[r]?.angle)continue;const b=this.getLinkedTextBoxStyle(d,s);if(!b.visibility){h.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const y=this.configuration.getTextLines(h,r);if(!h.handles.textBox.hasMoved){const e=m[1];h.handles.textBox.worldPosition=o.canvasToWorld(e)}const I=o.worldToCanvas(h.handles.textBox.worldPosition),_="1",C=(0,Ve.drawLinkedTextBox)(t,c,_,y,I,m,{},b),{x:T,y:S,width:x,height:D}=C;h.handles.textBox.worldBoundingBox={topLeft:o.canvasToWorld([T,S]),topRight:o.canvasToWorld([T+x,S]),bottomLeft:o.canvasToWorld([T,S+D]),bottomRight:o.canvasToWorld([T+x,S+D])}}return n},this._throttledCalculateCachedStats=(0,En.A)(this._calculateCachedStats,100,{trailing:!0})}handleSelectedCallback(e,t,n){const o=e.detail,{element:i}=o,{data:a}=t;t.highlighted=!0;let s,l=!1;n.worldPosition?l=!0:s=a.handles.points.findIndex((e=>e===n));const d=(0,Qe.getViewportIdsWithToolToRender)(i,this.getToolName());this.editData={annotation:t,viewportIdsToRender:d,handleIndex:s,movingTextBox:l},this._activateModify(i),(0,et.hideElementCursor)(i);const c=(0,r.getEnabledElement)(i),{renderingEngine:h}=c;(0,tt.A)(d),e.preventDefault()}_calculateCachedStats(e,t,n){const o=e.data,{element:i}=n.viewport;if(3!==o.handles.points.length)return;const a=o.handles.points[0],s=o.handles.points[1],l=o.handles.points[2],{cachedStats:d}=o,c=Object.keys(d);for(let e=0;e<c.length;e++){const t=c[e],n=(0,st.A)([a,s],[s,l]),{dimensions:o,imageData:i}=this.getTargetImageData(t);this.isHandleOutsideImage=[a,s,l].map((e=>r.utilities.transformWorldToIndex(i,e))).some((e=>!r.utilities.indexWithinDimensions(e,o))),d[t]={angle:isNaN(n)?"Incomplete Angle":n}}return e.invalidated=!1,(0,Je.XF)(e,i),d}}function Ao(e,t){const n=e.cachedStats[t],{angle:o}=n;if(void 0===o)return;if(isNaN(o))return[`${o}`];return[`${r.utilities.roundNumber(o)} ${String.fromCharCode(176)}`]}Do.toolName="Angle";const Oo=Do;var Mo=n(82983);class Ro extends Ge.EC{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,getTextLines:ko,showArcLines:!1}}){super(e,t),this.addNewAnnotation=e=>{if(this.angleStartedNotYetCompleted)return;this.angleStartedNotYetCompleted=!0;const t=e.detail,{currentPoints:n,element:o}=t,i=n.world,a=(0,r.getEnabledElement)(o),{viewport:l,renderingEngine:d}=a;(0,et.hideElementCursor)(o),this.isDrawing=!0;const c=l.getCamera(),{viewPlaneNormal:h,viewUp:u}=c,g=this.getReferencedImageId(l,i,h,u),p=l.getFrameOfReferenceUID(),v={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...h],viewUp:[...u],FrameOfReferenceUID:p,referencedImageId:g,...l.getViewReference({points:[i]})},data:{handles:{points:[[...i],[...i]],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:"",cachedStats:{}}};(0,s.addAnnotation)(v,o);const f=(0,Qe.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:v,viewportIdsToRender:f,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),e.preventDefault(),(0,tt.A)(f),v},this.isPointNearTool=(e,t,n,o)=>{const i=(0,r.getEnabledElement)(e),{viewport:a}=i,{data:s}=t,{distanceToPoint:l,distanceToPoint2:d}=this.distanceToLines({viewport:a,points:s.handles.points,canvasCoords:n,proximity:o});return l<=o||d<=o},this.toolSelectedCallback=(e,t,n,o,i=6)=>{const a=e.detail,{element:s}=a;t.highlighted=!0;const l=(0,Qe.getViewportIdsWithToolToRender)(s,this.getToolName()),d=(0,r.getEnabledElement)(s),{renderingEngine:c,viewport:h}=d,{isNearFirstLine:u,isNearSecondLine:g}=this.distanceToLines({viewport:h,points:t.data.handles.points,canvasCoords:o,proximity:i});this.editData={annotation:t,viewportIdsToRender:l,movingTextBox:!1,isNearFirstLine:u,isNearSecondLine:g},this._activateModify(s),(0,et.hideElementCursor)(s),(0,tt.A)(l),e.preventDefault()},this._mouseUpCallback=e=>{const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:i,newAnnotation:a,hasMoved:l}=this.editData,{data:d}=o;if(a&&!l)return;if(this.angleStartedNotYetCompleted&&d.handles.points.length<4)return(0,et.resetElementCursor)(n),void(this.editData.handleIndex=d.handles.points.length);this.angleStartedNotYetCompleted=!1,d.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,et.resetElementCursor)(n);const c=(0,r.getEnabledElement)(n),{renderingEngine:h}=c;this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,s.removeAnnotation)(o.annotationUID),(0,tt.A)(i),a&&(0,Je.dZ)(o),this.editData=null,this.isDrawing=!1},this._mouseDownCallback=e=>{const{annotation:t,handleIndex:n}=this.editData,o=e.detail,{element:i,currentPoints:a}=o,r=a.world,{data:s}=t;return 1===n?(s.handles.points[1]=r,void(this.editData.hasMoved=s.handles.points[1][0]!==s.handles.points[0][0]||s.handles.points[1][1]!==s.handles.points[0][0])):3===n?(s.handles.points[3]=r,this.editData.hasMoved=s.handles.points[3][0]!==s.handles.points[2][0]||s.handles.points[3][1]!==s.handles.points[2][0],void(this.angleStartedNotYetCompleted=!1)):(this.editData.hasMoved=!1,(0,et.hideElementCursor)(i),s.handles.points[2]=s.handles.points[3]=r,void(this.editData.handleIndex=s.handles.points.length-1))},this._mouseDragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:i,handleIndex:a,movingTextBox:s,isNearFirstLine:l,isNearSecondLine:d}=this.editData,{data:c}=o;if(s){const{deltaPoints:e}=t,n=e.world,{textBox:o}=c.handles,{worldPosition:i}=o;i[0]+=n[0],i[1]+=n[1],i[2]+=n[2],o.hasMoved=!0}else if(void 0===a&&(l||d)){const{deltaPoints:e}=t,n=e.world,i=c.handles.points;if(l){[i[0],i[1]].forEach((e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]}))}else if(d){[i[2],i[3]].forEach((e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]}))}o.invalidated=!0}else{const{currentPoints:e}=t,n=e.world;c.handles.points[a]=[...n],o.invalidated=!0}this.editData.hasMoved=!0;const h=(0,r.getEnabledElement)(n),{renderingEngine:u}=h;(0,tt.A)(i)},this.cancel=e=>{if(!this.isDrawing)return;this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,et.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:o}=this.editData,{data:i}=t;i.handles.points.length<4&&(0,s.removeAnnotation)(t.annotationUID),t.highlighted=!1,i.handles.activeHandleIndex=null;const a=(0,r.getEnabledElement)(e),{renderingEngine:l}=a;return(0,tt.A)(n),o&&(0,Je.dZ)(t),this.editData=null,this.angleStartedNotYetCompleted=!1,t.annotationUID},this._activateModify=e=>{B.wk.isInteractingWithTool=!0,e.addEventListener(l.Events.MOUSE_UP,this._mouseUpCallback),e.addEventListener(l.Events.MOUSE_DRAG,this._mouseDragCallback),e.addEventListener(l.Events.MOUSE_CLICK,this._mouseUpCallback)},this._deactivateModify=e=>{B.wk.isInteractingWithTool=!1,e.removeEventListener(l.Events.MOUSE_UP,this._mouseUpCallback),e.removeEventListener(l.Events.MOUSE_DRAG,this._mouseDragCallback),e.removeEventListener(l.Events.MOUSE_CLICK,this._mouseUpCallback)},this._activateDraw=e=>{B.wk.isInteractingWithTool=!0,e.addEventListener(l.Events.MOUSE_UP,this._mouseUpCallback),e.addEventListener(l.Events.MOUSE_DRAG,this._mouseDragCallback),e.addEventListener(l.Events.MOUSE_MOVE,this._mouseDragCallback),e.addEventListener(l.Events.MOUSE_CLICK,this._mouseUpCallback),e.addEventListener(l.Events.MOUSE_DOWN,this._mouseDownCallback)},this._deactivateDraw=e=>{B.wk.isInteractingWithTool=!1,e.removeEventListener(l.Events.MOUSE_UP,this._mouseUpCallback),e.removeEventListener(l.Events.MOUSE_DRAG,this._mouseDragCallback),e.removeEventListener(l.Events.MOUSE_MOVE,this._mouseDragCallback),e.removeEventListener(l.Events.MOUSE_CLICK,this._mouseUpCallback),e.removeEventListener(l.Events.MOUSE_DOWN,this._mouseDownCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:o}=e,{element:i}=o;let a=(0,s.getAnnotations)(this.getToolName(),i);if(!a?.length)return n;if(a=this.filterInteractableAnnotationsForElement(i,a),!a?.length)return n;const r=this.getTargetId(o),l=o.getRenderingEngine(),d={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let i=0;i<a.length;i++){const s=a[i],{annotationUID:c,data:h}=s,{points:u,activeHandleIndex:g}=h.handles;d.annotationUID=c;const{color:p,lineWidth:v,lineDash:f}=this.getAnnotationStyle({annotation:s,styleSpecifier:d}),m=u.map((e=>o.worldToCanvas(e)));let w;if(h.cachedStats[r]&&null!=h.cachedStats[r].angle?s.invalidated&&this._throttledCalculateCachedStats(s,l,e):(h.cachedStats[r]={angle:null,arc1Angle:null,arc2Angle:null,points:{world:{arc1Start:null,arc1End:null,arc2Start:null,arc2End:null,arc1Angle:null,arc2Angle:null},canvas:{arc1Start:null,arc1End:null,arc2Start:null,arc2End:null,arc1Angle:null,arc2Angle:null}}},this._calculateCachedStats(s,l,e)),(0,wt.isAnnotationLocked)(c)||this.editData||null===g||(w=[m[g]]),!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;if(w){const e="0";(0,Ve.drawHandles)(t,c,e,m,{color:p,lineDash:f,lineWidth:v})}const E=[m[0],m[1]],b=[m[2],m[3]];let y="line1";if((0,Ve.drawLine)(t,c,y,E[0],E[1],{color:p,width:v,lineDash:f}),n=!0,m.length<4)return n;y="line2",(0,Ve.drawLine)(t,c,y,b[0],b[1],{color:p,width:v,lineDash:f}),y="linkLine";const I=(0,Mo.f)(E[0],E[1]),_=(0,Mo.f)(b[0],b[1]);(0,Ve.drawLine)(t,c,y,I,_,{color:p,lineWidth:"1",lineDash:"1,4"});const{arc1Start:C,arc1End:T,arc2End:S,arc2Start:x}=h.cachedStats[r].points.canvas,{arc1Angle:D,arc2Angle:A}=h.cachedStats[r];if(this.configuration.showArcLines&&(y="arc1",(0,Ve.drawLine)(t,c,y,C,T,{color:p,lineWidth:"1"}),y="arc2",(0,Ve.drawLine)(t,c,y,x,S,{color:p,lineWidth:"1"})),!h.cachedStats[r]?.angle)continue;const O=this.getLinkedTextBoxStyle(d,s);if(!O.visibility){h.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const M=this.configuration.getTextLines(h,r);if(!h.handles.textBox.hasMoved){const e=(0,bn.getTextBoxCoordsCanvas)(m);h.handles.textBox.worldPosition=o.canvasToWorld(e)}const R=o.worldToCanvas(h.handles.textBox.worldPosition),k="cobbAngleText",L=(0,Ve.drawLinkedTextBox)(t,c,k,M,R,m,{},O),{x:P,y:N,width:U,height:V}=L;if(h.handles.textBox.worldBoundingBox={topLeft:o.canvasToWorld([P,N]),topRight:o.canvasToWorld([P+U,N]),bottomLeft:o.canvasToWorld([P,N+V]),bottomRight:o.canvasToWorld([P+U,N+V])},this.configuration.showArcLines){const e="arcAngle1",n=[`${D.toFixed(2)} ${String.fromCharCode(176)}`],o=(0,Mo.f)(C,T);(0,Ve.drawTextBox)(t,c,e,n,o,{...O,padding:3});const i="arcAngle2",a=[`${A.toFixed(2)} ${String.fromCharCode(176)}`],r=(0,Mo.f)(x,S);(0,Ve.drawTextBox)(t,c,i,a,r,{...O,padding:3})}}return n},this.distanceToLines=({viewport:e,points:t,canvasCoords:n,proximity:o})=>{const[i,a,r,s]=t,l=e.worldToCanvas(i),d=e.worldToCanvas(a),c=e.worldToCanvas(r),h=e.worldToCanvas(s),u={start:{x:l[0],y:l[1]},end:{x:d[0],y:d[1]}},g={start:{x:c[0],y:c[1]},end:{x:h[0],y:h[1]}},p=mt.distanceToPoint([u.start.x,u.start.y],[u.end.x,u.end.y],[n[0],n[1]]),v=mt.distanceToPoint([g.start.x,g.start.y],[g.end.x,g.end.y],[n[0],n[1]]);let f=!1,m=!1;return p<=o?f=!0:v<=o&&(m=!0),{distanceToPoint:p,distanceToPoint2:v,isNearFirstLine:f,isNearSecondLine:m}},this.getArcsStartEndPoints=({firstLine:e,secondLine:t,mid1:n,mid2:o})=>{const i=[n,o],a=(0,st.A)(e,i),r=(0,st.A)(t,i),s=a>90?1:0,l=r>90?0:1,d=(0,Mo.f)(i[0],i[1]),c=Math.sqrt((i[1][0]-i[0][0])**2+(i[1][1]-i[0][1])**2),h=.1,u=(0,Mo.f)(e[0],e[1]),g=(0,Mo.f)(t[0],t[1]),p=[e[s][0]-u[0],e[s][1]-u[1]],v=Math.sqrt(p[0]**2+p[1]**2),f=[p[0]/v,p[1]/v],m=[u[0]+f[0]*c*h,u[1]+f[1]*c*h],w=[d[0]-n[0],d[1]-n[1]],E=Math.sqrt(w[0]**2+w[1]**2),b=[w[0]/E,w[1]/E],y=[n[0]+b[0]*c*h,n[1]+b[1]*c*h],I=[t[l][0]-g[0],t[l][1]-g[1]],_=Math.sqrt(I[0]**2+I[1]**2),C=[I[0]/_,I[1]/_],T=[g[0]+C[0]*c*h,g[1]+C[1]*c*h],S=[d[0]-o[0],d[1]-o[1]],x=Math.sqrt(S[0]**2+S[1]**2),D=[S[0]/x,S[1]/x];return{arc1Start:m,arc1End:y,arc2Start:T,arc2End:[o[0]+D[0]*c*h,o[1]+D[1]*c*h],arc1Angle:a>90?180-a:a,arc2Angle:r>90?180-r:r}},this._throttledCalculateCachedStats=(0,En.A)(this._calculateCachedStats,25,{trailing:!0})}handleSelectedCallback(e,t,n,o="mouse"){const i=e.detail,{element:a}=i,{data:s}=t;t.highlighted=!0;let l,d=!1;n.worldPosition?d=!0:l=s.handles.points.findIndex((e=>e===n));const c=(0,Qe.getViewportIdsWithToolToRender)(a,this.getToolName());this.editData={annotation:t,viewportIdsToRender:c,handleIndex:l,movingTextBox:d},this._activateModify(a),(0,et.hideElementCursor)(a);const h=(0,r.getEnabledElement)(a),{renderingEngine:u}=h;(0,tt.A)(c),e.preventDefault()}_calculateCachedStats(e,t,n){const o=e.data;if(4!==o.handles.points.length)return;const i=[null,null],a=[null,null];let r=Number.MAX_VALUE;for(let e=0;e<2;e+=1)for(let t=2;t<4;t+=1){const n=De.eR.distance(o.handles.points[e],o.handles.points[t]);n<r&&(r=n,i[1]=o.handles.points[e],i[0]=o.handles.points[(e+1)%2],a[0]=o.handles.points[t],a[1]=o.handles.points[2+(t-1)%2])}const{viewport:s}=n,{element:l}=s,d=o.handles.points.map((e=>s.worldToCanvas(e))),c=[d[0],d[1]],h=[d[2],d[3]],u=(0,Mo.f)(c[0],c[1]),g=(0,Mo.f)(h[0],h[1]),{arc1Start:p,arc1End:v,arc2End:f,arc2Start:m,arc1Angle:w,arc2Angle:E}=this.getArcsStartEndPoints({firstLine:c,secondLine:h,mid1:u,mid2:g}),{cachedStats:b}=o,y=Object.keys(b);for(let e=0;e<y.length;e++){b[y[e]]={angle:(0,st.A)(i,a),arc1Angle:w,arc2Angle:E,points:{canvas:{arc1Start:p,arc1End:v,arc2End:f,arc2Start:m},world:{arc1Start:s.canvasToWorld(p),arc1End:s.canvasToWorld(v),arc2End:s.canvasToWorld(f),arc2Start:s.canvasToWorld(m)}}}}return e.invalidated=!1,(0,Je.XF)(e,l),b}}function ko(e,t){const n=e.cachedStats[t],{angle:o}=n;if(void 0===o)return;return[`${o.toFixed(2)} ${String.fromCharCode(176)}`]}Ro.toolName="CobbAngle";const Lo=Ro,{transformWorldToIndex:Po}=r.utilities;class No extends Ge.EC{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,getTextLines:Uo,displayBothAxesDistances:!1}}){super(e,t),this.addNewAnnotation=e=>{if(this.startedDrawing)return;this.startedDrawing=!0;const t=e.detail,{currentPoints:n,element:o}=t,i=n.world,a=(0,r.getEnabledElement)(o),{viewport:l,renderingEngine:d}=a;if(!(l instanceof r.StackViewport))throw new Error("UltrasoundDirectionalTool can only be used on a StackViewport");(0,et.hideElementCursor)(o),this.isDrawing=!0;const c=l.getCamera(),{viewPlaneNormal:h,viewUp:u}=c,g=this.getReferencedImageId(l,i,h,u),p=l.getFrameOfReferenceUID(),v={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...h],viewUp:[...u],FrameOfReferenceUID:p,referencedImageId:g},data:{handles:{points:[[...i],[...i]],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:"",cachedStats:{}}};(0,s.addAnnotation)(v,o);const f=(0,Qe.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:v,viewportIdsToRender:f,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),e.preventDefault(),(0,tt.A)(f),v},this.isPointNearTool=(e,t,n,o)=>!1,this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:i,newAnnotation:a,hasMoved:l}=this.editData,{data:d}=o;if(a&&!l)return;if(this.startedDrawing&&1===d.handles.points.length)return void(this.editData.handleIndex=1);this.startedDrawing=!1,d.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,et.resetElementCursor)(n);const c=(0,r.getEnabledElement)(n),{renderingEngine:h}=c;this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,s.removeAnnotation)(o.annotationUID),(0,tt.A)(i),a&&(0,Je.dZ)(o),this.editData=null,this.isDrawing=!1},this._dragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:i,handleIndex:a,movingTextBox:s}=this.editData,{data:l}=o;if(s){const{deltaPoints:e}=t,n=e.world,{textBox:o}=l.handles,{worldPosition:i}=o;i[0]+=n[0],i[1]+=n[1],i[2]+=n[2],o.hasMoved=!0}else if(void 0===a){const{deltaPoints:e}=t,n=e.world;l.handles.points.forEach((e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]})),o.invalidated=!0}else{const{currentPoints:e}=t,n=e.world;l.handles.points[a]=[...n],o.invalidated=!0}this.editData.hasMoved=!0;const d=(0,r.getEnabledElement)(n),{renderingEngine:c}=d;(0,tt.A)(i)},this.cancel=e=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,et.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:o}=this.editData,{data:i}=t;return t.highlighted=!1,i.handles.activeHandleIndex=null,(0,tt.A)(n),o&&(0,Je.dZ)(t),this.editData=null,this.startedDrawing=!1,t.annotationUID}},this._activateModify=e=>{B.wk.isInteractingWithTool=!0,e.addEventListener(l.Events.MOUSE_UP,this._endCallback),e.addEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(l.Events.TOUCH_TAP,this._endCallback),e.addEventListener(l.Events.TOUCH_END,this._endCallback),e.addEventListener(l.Events.TOUCH_DRAG,this._dragCallback)},this._deactivateModify=e=>{B.wk.isInteractingWithTool=!1,e.removeEventListener(l.Events.MOUSE_UP,this._endCallback),e.removeEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(l.Events.TOUCH_TAP,this._endCallback),e.removeEventListener(l.Events.TOUCH_END,this._endCallback),e.removeEventListener(l.Events.TOUCH_DRAG,this._dragCallback)},this._activateDraw=e=>{B.wk.isInteractingWithTool=!0,e.addEventListener(l.Events.MOUSE_UP,this._endCallback),e.addEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(l.Events.MOUSE_MOVE,this._dragCallback),e.addEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(l.Events.TOUCH_TAP,this._endCallback),e.addEventListener(l.Events.TOUCH_END,this._endCallback),e.addEventListener(l.Events.TOUCH_DRAG,this._dragCallback)},this._deactivateDraw=e=>{B.wk.isInteractingWithTool=!1,e.removeEventListener(l.Events.MOUSE_UP,this._endCallback),e.removeEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(l.Events.MOUSE_MOVE,this._dragCallback),e.removeEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(l.Events.TOUCH_TAP,this._endCallback),e.removeEventListener(l.Events.TOUCH_END,this._endCallback),e.removeEventListener(l.Events.TOUCH_DRAG,this._dragCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:o}=e,{element:i}=o;let a=(0,s.getAnnotations)(this.getToolName(),i);if(!a?.length)return n;if(a=this.filterInteractableAnnotationsForElement(i,a),!a?.length)return n;const r=this.getTargetId(o),l=o.getRenderingEngine(),d={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let i=0;i<a.length;i++){const s=a[i],{annotationUID:c,data:h}=s,{points:u}=h.handles;d.annotationUID=c;const g=this.getStyle("color",d,s),p=u.map((e=>o.worldToCanvas(e)));if(h.cachedStats[r]&&null!=h.cachedStats[r].xValues?s.invalidated&&this._throttledCalculateCachedStats(s,l,e):(h.cachedStats[r]={xValues:[0,0],yValues:[0,0],isHorizontal:!1,units:[""],isUnitless:!1},this._calculateCachedStats(s,l,e)),!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;let v="0";if((0,Ve.drawHandle)(t,c,v,p[0],{color:g},0),n=!0,2!==p.length)return n;v="1",(0,Ve.drawHandle)(t,c,v,p[1],{color:g},1);if(h.cachedStats[r].isUnitless){const e=`${c}-line-1`,n="1";(0,Ve.drawLine)(t,c,n,p[0],p[1],{color:g,width:1,shadow:this.configuration.shadow},e)}else{const e=p[0],n=p[1],o=n[1]-e[1],i=n[0]-e[0];let a=[0,0];a=h.cachedStats[r].isHorizontal?[e[0]+i,e[1]]:[e[0],e[1]+o];let s=`${c}-line-1`,l="1";(0,Ve.drawLine)(t,c,l,p[0],a,{color:g,width:1,shadow:this.configuration.shadow},s),s=`${c}-line-2`,l="2",(0,Ve.drawLine)(t,c,l,p[1],a,{color:g,width:1,lineDash:[1,1],shadow:this.configuration.shadow},s)}const f=this.getLinkedTextBoxStyle(d,s);if(!f.visibility){h.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const m=this.configuration.getTextLines(h,r,this.configuration);if(!h.handles.textBox.hasMoved){const e=p[1];h.handles.textBox.worldPosition=o.canvasToWorld(e)}const w=o.worldToCanvas(h.handles.textBox.worldPosition),E="1",b=(0,Ve.drawLinkedTextBox)(t,c,E,m,w,p,{},f),{x:y,y:I,width:_,height:C}=b;h.handles.textBox.worldBoundingBox={topLeft:o.canvasToWorld([y,I]),topRight:o.canvasToWorld([y+_,I]),bottomLeft:o.canvasToWorld([y,I+C]),bottomRight:o.canvasToWorld([y+_,I+C])}}return n},this._throttledCalculateCachedStats=(0,En.A)(this._calculateCachedStats,100,{trailing:!0})}toolSelectedCallback(e,t,n,o){}handleSelectedCallback(e,t,n){const o=e.detail,{element:i}=o,{data:a}=t;t.highlighted=!0;const s=(0,Qe.getViewportIdsWithToolToRender)(i,this.getToolName());let l,d=!1;n.worldPosition?d=!0:l=a.handles.points.findIndex((e=>e===n)),this.editData={handleIndex:l,annotation:t,viewportIdsToRender:s},this._activateModify(i),(0,et.hideElementCursor)(i);const c=(0,r.getEnabledElement)(i),{renderingEngine:h}=c;(0,tt.A)(s),e.preventDefault()}_calculateCachedStats(e,t,n){const o=e.data,{element:i}=n.viewport;if(2!==o.handles.points.length)return;const{cachedStats:a}=o,r=Object.keys(a);for(let e=0;e<r.length;e++){const t=r[e],i=this.getTargetImageData(t);if(!i)continue;const{imageData:s}=i,l=o.handles.points[0],d=o.handles.points[1],c=Po(s,l),h=Po(s,d),{values:u,units:g}=(0,wn.Xw)(i,[c]),{values:p,units:v}=(0,wn.Xw)(i,[h]);let f,m,w,E,b=!1;if(g[0]!==v[0]||g[1]!==v[1]||"raw"===g[0]&&"raw"===v[0]){const e=(0,Pt.distanceToPoint)(l,d);f=[e,0],m=[e,0],w=["px"],b=!0}else{const e=n.viewport.worldToCanvas(l),t=n.viewport.worldToCanvas(d),o=t[1]-e[1],i=t[0]-e[0];E=Math.abs(i)>Math.abs(o),f=[u[0],p[0]],m=[u[1],p[1]],w=[g[0],g[1]]}a[t]={xValues:f,yValues:m,isHorizontal:E,units:w,isUnitless:b}}return e.invalidated=!1,(0,Je.XF)(e,i),a}}function Uo(e,t,n){const o=e.cachedStats[t],{xValues:i,yValues:a,units:s,isUnitless:l,isHorizontal:d}=o;if(l)return[`${r.utilities.roundNumber(i[0])} px`];if(n.displayBothAxesDistances){const e=Math.abs(i[1]-i[0]),t=Math.abs(a[1]-a[0]);return[`${r.utilities.roundNumber(e)} ${s[0]}`,`${r.utilities.roundNumber(t)} ${s[1]}`]}if(d){const e=Math.abs(i[1]-i[0]);return[`${r.utilities.roundNumber(e)} ${s[0]}`]}{const e=Math.abs(a[1]-a[0]);return[`${r.utilities.roundNumber(e)} ${s[1]}`]}}No.toolName="UltrasoundDirectionalTool";const Vo=No;class Bo extends Ge.EC{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{getTextCallback:Ho,changeTextCallback:Wo,canvasPosition:[10,10],canvasSize:10}}){super(e,t),this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:o}=t,i=n.world,a=(0,r.getEnabledElement)(o),{viewport:l,renderingEngine:d}=a,c=l.getCamera(),{viewPlaneNormal:h,viewUp:u}=c,g=this.getReferencedImageId(l,i,h,u),p=Bo.createAnnotation({metadata:{...l.getViewReference(),referencedImageId:g}});(0,s.addAnnotation)(p,o);const v=(0,Qe.getViewportIdsWithToolToRender)(o,this.getToolName());return e.preventDefault(),(0,tt.A)(v),this.configuration.getTextCallback((e=>{if(!e)return(0,s.removeAnnotation)(p.annotationUID),(0,tt.A)(v),void(this.isDrawing=!1);p.data.text=e,(0,Je.dZ)(p),(0,tt.A)(v)})),p},this.isPointNearTool=(e,t,n,o)=>{const i=(0,r.getEnabledElement)(e),{viewport:a}=i,{data:s}=t,{canvasPosition:l,canvasSize:d}=this.configuration;return!!l?.length&&(Math.abs(n[0]-l[0]+d/2)<=d/2&&Math.abs(n[1]-l[1]+d/2)<=d/2)},this.toolSelectedCallback=(e,t)=>{t.highlighted=!0,e.preventDefault()},this._endCallback=e=>{const t=e.detail,{element:n}=t;this._deactivateModify(n),(0,et.resetElementCursor)(n)},this.doubleClickCallback=e=>{const t=e.detail,{element:n}=t;let o=(0,s.getAnnotations)(this.getToolName(),n);if(o=this.filterInteractableAnnotationsForElement(n,o),!o?.length)return;const i=o.find((e=>this.isPointNearTool(n,e,t.currentPoints.canvas,6)));if(!i)return;const a=i;this.configuration.changeTextCallback(i,e.detail,this._doneChangingTextCallback.bind(this,n,a)),this.isDrawing=!1,e.stopImmediatePropagation(),e.preventDefault()},this._activateModify=e=>{B.wk.isInteractingWithTool=!0,e.addEventListener(l.Events.MOUSE_UP,this._endCallback),e.addEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(l.Events.TOUCH_TAP,this._endCallback),e.addEventListener(l.Events.TOUCH_END,this._endCallback)},this._deactivateModify=e=>{B.wk.isInteractingWithTool=!1,e.removeEventListener(l.Events.MOUSE_UP,this._endCallback),e.removeEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(l.Events.TOUCH_TAP,this._endCallback),e.removeEventListener(l.Events.TOUCH_END,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:o}=e,{element:i}=o;let a=(0,s.getAnnotations)(this.getToolName(),i);if(!a?.length)return n;if(a=this.filterInteractableAnnotationsForElement(i,a),!a?.length)return n;const r={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let e=0;e<a.length;e++){const i=a[e],{annotationUID:s}=i;r.annotationUID=s;const{color:l}=this.getAnnotationStyle({annotation:i,styleSpecifier:r}),{canvasPosition:d,canvasSize:c}=this.configuration;if(d?.length){const e="1";(0,Ve.drawArrow)(t,s,e,d.map((e=>e+c)),d,{color:l,width:1})}if(n=!0,!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n}return n}}cancel(){}handleSelectedCallback(e,t,n){}_doneChangingTextCallback(e,t,n){t.data.text=n;const o=(0,r.getEnabledElement)(e),{renderingEngine:i}=o,a=(0,Qe.getViewportIdsWithToolToRender)(e,this.getToolName());(0,tt.A)(a),(0,Je.XF)(t,e)}_isInsideVolume(e,t,n){return r.utilities.indexWithinDimensions(e,n)&&r.utilities.indexWithinDimensions(t,n)}}function Ho(e){return e(prompt("Enter your annotation:"))}function Wo(e,t,n){return n(prompt("Enter your annotation:"))}Bo.toolName="KeyImage";const Fo=Bo;var jo=n(17343);class Go extends Ge.oS{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"]}){super(e,t),this.preMouseDownCallback=e=>this._deleteNearbyAnnotations(e,"mouse"),this.preTouchStartCallback=e=>this._deleteNearbyAnnotations(e,"touch")}_deleteNearbyAnnotations(e,t){const{renderingEngineId:n,viewportId:o,element:i,currentPoints:a}=e.detail,r=(0,ne.getToolGroupForViewport)(o,n);if(!r)return!1;const l=r._toolInstances,d=[];for(const e in l){const n=l[e];if("function"!=typeof n.isPointNearTool||"function"!=typeof n.filterInteractableAnnotationsForElement)continue;const o=(0,s.getAnnotations)(e,i);if(!o.length)continue;const r=n.filterInteractableAnnotationsForElement(i,o)||[];for(const e of r)n.isPointNearTool(i,e,a.canvas,10,t)&&d.push(e.annotationUID)}for(const e of d)(0,jo.setAnnotationSelected)(e),(0,s.removeAnnotation)(e);return e.preventDefault(),!0}}Go.toolName="Eraser";const $o=Go;var zo=n(10088),qo=n(47347),Zo=n(98870);class Ko extends Ge.oS{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{strategies:{FILL_INSIDE:zo.p,ERASE_INSIDE:qo.M},defaultStrategy:"FILL_INSIDE",activeStrategy:"FILL_INSIDE"}}){super(e,t),this.preMouseDownCallback=e=>{if(!0===this.isDrawing)return;const t=e.detail,{currentPoints:n,element:o}=t,i=n.world,a=(0,r.getEnabledElement)(o),{viewport:s}=a;this.isDrawing=!0;const d=s.getCamera(),{viewPlaneNormal:c,viewUp:h}=d,u=je.activeSegmentation.getActiveSegmentation(s.id);if(!u)throw new Error("No active segmentation detected, create one before using scissors tool");const{segmentationId:g}=u,p=je.segmentIndex.getActiveSegmentIndex(g),v=je.segmentLocking.getLockedSegmentIndices(g),f=je.config.color.getSegmentIndexColor(s.id,g,p),{representationData:m}=(0,Zo.getSegmentation)(g),w=m[l.SegmentationRepresentations.Labelmap],E={highlighted:!0,invalidated:!0,metadata:{viewPlaneNormal:[...c],viewUp:[...h],FrameOfReferenceUID:s.getFrameOfReferenceUID(),referencedImageId:"",toolName:this.getToolName(),segmentColor:f},data:{handles:{points:[[...i],[...i],[...i],[...i]],activeHandleIndex:null}}},b=(0,Qe.getViewportIdsWithToolToRender)(o,this.getToolName());if(this.editData={annotation:E,segmentIndex:p,segmentationId:g,segmentsLocked:v,segmentColor:f,viewportIdsToRender:b,handleIndex:3,movingTextBox:!1,newAnnotation:!0,hasMoved:!1,volumeId:null,referencedVolumeId:null,imageId:null},s instanceof r.BaseVolumeViewport){const{volumeId:e}=w,t=r.cache.getVolume(e);this.editData={...this.editData,volumeId:e,referencedVolumeId:t.referencedVolumeId}}else{const e=(0,Zo.getCurrentLabelmapImageIdForViewport)(s.id,g);this.editData={...this.editData,imageId:e}}return this._activateDraw(o),(0,et.hideElementCursor)(o),e.preventDefault(),(0,tt.A)(b),!0},this._dragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:i,handleIndex:a}=this.editData,{data:s}=o,{currentPoints:l}=t,d=(0,r.getEnabledElement)(n),{worldToCanvas:c,canvasToWorld:h}=d.viewport,u=l.world,{points:g}=s.handles;let p,v,f,m,w,E,b,y;switch(g[a]=[...u],a){case 0:case 3:p=c(g[0]),m=c(g[3]),v=[m[0],p[1]],f=[p[0],m[1]],E=h(v),b=h(f),g[1]=E,g[2]=b;break;case 1:case 2:v=c(g[1]),f=c(g[2]),p=[f[0],v[1]],m=[v[0],f[1]],w=h(p),y=h(m),g[0]=w,g[3]=y}o.invalidated=!0,this.editData.hasMoved=!0,(0,tt.A)(i)},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:o,newAnnotation:i,hasMoved:a}=this.editData,{data:s}=o;if(i&&!a)return;s.handles.activeHandleIndex=null,this._deactivateDraw(n),(0,et.resetElementCursor)(n);const l=(0,r.getEnabledElement)(n),d={...this.editData,points:s.handles.points};this.editData=null,this.isDrawing=!1,this.applyActiveStrategy(l,d)},this._activateDraw=e=>{e.addEventListener(l.Events.MOUSE_UP,this._endCallback),e.addEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(l.Events.MOUSE_MOVE,this._dragCallback),e.addEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(l.Events.TOUCH_END,this._endCallback),e.addEventListener(l.Events.TOUCH_DRAG,this._dragCallback),e.addEventListener(l.Events.TOUCH_TAP,this._endCallback)},this._deactivateDraw=e=>{e.removeEventListener(l.Events.MOUSE_UP,this._endCallback),e.removeEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(l.Events.MOUSE_MOVE,this._dragCallback),e.removeEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(l.Events.TOUCH_TAP,this._endCallback),e.removeEventListener(l.Events.TOUCH_END,this._endCallback),e.removeEventListener(l.Events.TOUCH_DRAG,this._dragCallback)},this.renderAnnotation=(e,t)=>{let n=!1;if(!this.editData)return n;const{viewport:o}=e,{annotation:i}=this.editData,a=i.metadata,r=i.annotationUID,s=i.data,{points:l}=s.handles,d=l.map((e=>o.worldToCanvas(e))),c=`rgb(${a.segmentColor.slice(0,3)})`;if(!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;return(0,Ve.drawRect)(t,r,"0",d[0],d[3],{color:c}),n=!0,n}}}Ko.toolName="RectangleScissor";const Yo=Ko;var Xo=n(56789),Jo=n(33852);class Qo extends Ge.oS{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{strategies:{FILL_INSIDE:Xo.kr,ERASE_INSIDE:Jo.r},defaultStrategy:"FILL_INSIDE",activeStrategy:"FILL_INSIDE"}}){super(e,t),this.preMouseDownCallback=e=>{if(!0===this.isDrawing)return;const t=e.detail,{currentPoints:n,element:o}=t,i=n.world,a=n.canvas,s=(0,r.getEnabledElement)(o),{viewport:l}=s;this.isDrawing=!0;const d=l.getCamera(),{viewPlaneNormal:c,viewUp:h}=d,u=je.activeSegmentation.getActiveSegmentation(l.id);if(!u)throw new Error("No active segmentation detected, create one before using scissors tool");const{segmentationId:g}=u,p=je.segmentIndex.getActiveSegmentIndex(g),v=je.segmentLocking.getLockedSegmentIndices(g),f=je.config.color.getSegmentIndexColor(l.id,g,p),{representationData:m}=(0,Zo.getSegmentation)(g),w=m.Labelmap;if(!w)throw new Error("No labelmap data found for the active segmentation, create one before using scissors tool");const E={invalidated:!0,highlighted:!0,metadata:{viewPlaneNormal:[...c],viewUp:[...h],FrameOfReferenceUID:l.getFrameOfReferenceUID(),referencedImageId:"",toolName:this.getToolName(),segmentColor:f},data:{handles:{points:[[...i],[...i],[...i],[...i]],activeHandleIndex:null},isDrawing:!0,cachedStats:{}}},b=[l.id];if(this.editData={annotation:E,centerCanvas:a,segmentIndex:p,segmentationId:g,segmentsLocked:v,segmentColor:f,viewportIdsToRender:b,handleIndex:3,movingTextBox:!1,newAnnotation:!0,hasMoved:!1,volumeId:null,referencedVolumeId:null,imageId:null},l instanceof r.BaseVolumeViewport){const{volumeId:e}=w,t=r.cache.getVolume(e);this.editData={...this.editData,volumeId:e,referencedVolumeId:t.referencedVolumeId}}else{const e=(0,Zo.getCurrentLabelmapImageIdForViewport)(l.id,g);this.editData={...this.editData,imageId:e}}return this._activateDraw(o),(0,et.hideElementCursor)(o),e.preventDefault(),(0,tt.A)(b),!0},this._dragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{currentPoints:o}=t,i=o.canvas,a=(0,r.getEnabledElement)(n),{renderingEngine:s,viewport:l}=a,{canvasToWorld:d}=l,{annotation:c,viewportIdsToRender:h,centerCanvas:u}=this.editData,{data:g}=c,p=Math.abs(i[0]-u[0]),v=Math.abs(i[1]-u[1]),f=Math.sqrt(p*p+v*v),m=[u[0],u[1]+f],w=[u[0],u[1]-f],E=[u[0]-f,u[1]],b=[u[0]+f,u[1]];g.handles.points=[d(m),d(w),d(E),d(b)],c.invalidated=!0,this.editData.hasMoved=!0,(0,tt.A)(h)},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:o,newAnnotation:i,hasMoved:a}=this.editData,{data:s}=o,{viewPlaneNormal:l,viewUp:d}=o.metadata;if(i&&!a)return;s.handles.activeHandleIndex=null,this._deactivateDraw(n),(0,et.resetElementCursor)(n);const c=(0,r.getEnabledElement)(n),h={...this.editData,points:s.handles.points,viewPlaneNormal:l,viewUp:d,strategySpecificConfiguration:{}};this.editData=null,this.isDrawing=!1,this.applyActiveStrategy(c,h)},this._activateDraw=e=>{e.addEventListener(l.Events.MOUSE_UP,this._endCallback),e.addEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(l.Events.MOUSE_MOVE,this._dragCallback),e.addEventListener(l.Events.TOUCH_TAP,this._endCallback),e.addEventListener(l.Events.TOUCH_DRAG,this._dragCallback),e.addEventListener(l.Events.TOUCH_END,this._endCallback)},this._deactivateDraw=e=>{e.removeEventListener(l.Events.MOUSE_UP,this._endCallback),e.removeEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(l.Events.MOUSE_MOVE,this._dragCallback),e.removeEventListener(l.Events.TOUCH_END,this._endCallback),e.removeEventListener(l.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(l.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!1;if(!this.editData)return n;const{viewport:o}=e,{viewportIdsToRender:i}=this.editData;if(!i.includes(o.id))return n;const{annotation:a}=this.editData,r=a.metadata,s=a.annotationUID,l=a.data,{points:d}=l.handles,c=d.map((e=>o.worldToCanvas(e))),h=c[0],u=c[1],g=[Math.floor((h[0]+u[0])/2),Math.floor((h[1]+u[1])/2)],p=Math.abs(h[1]-Math.floor((h[1]+u[1])/2)),v=`rgb(${r.segmentColor.slice(0,3)})`;if(!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;return(0,Ve.drawCircle)(t,s,"0",g,p,{color:v}),n=!0,n}}}Qo.toolName="CircleScissor";const ei=Qo;var ti=n(17492),ni=n(1989);class oi extends Ge.oS{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{strategies:{FILL_INSIDE:ti.Jq,ERASE_INSIDE:ni._},defaultStrategy:"FILL_INSIDE",activeStrategy:"FILL_INSIDE"}}){super(e,t),this.preMouseDownCallback=e=>{if(!0===this.isDrawing)return;const t=e.detail,{currentPoints:n,element:o}=t,i=n.world,a=n.canvas,s=(0,r.getEnabledElement)(o),{viewport:d}=s;this.isDrawing=!0;const c=d.getCamera(),{viewPlaneNormal:h,viewUp:u}=c,g=je.activeSegmentation.getActiveSegmentation(d.id);if(!g)throw new Error("No active segmentation detected, create one before using scissors tool");const{segmentationId:p}=g,v=je.segmentIndex.getActiveSegmentIndex(p),f=je.segmentLocking.getLockedSegmentIndices(p),m=je.config.color.getSegmentIndexColor(d.id,p,v);this.isDrawing=!0;const w={metadata:{viewPlaneNormal:[...h],viewUp:[...u],FrameOfReferenceUID:d.getFrameOfReferenceUID(),referencedImageId:"",toolName:this.getToolName(),segmentColor:m},data:{invalidated:!0,handles:{points:[[...i],[...i],[...i],[...i]],activeHandleIndex:null},cachedStats:{},highlighted:!0}},E=[d.id];this.editData={annotation:w,centerCanvas:a,segmentIndex:v,segmentationId:p,segmentsLocked:f,segmentColor:m,toolGroupId:this.toolGroupId,viewportIdsToRender:E,handleIndex:3,movingTextBox:!1,newAnnotation:!0,hasMoved:!1,volumeId:null,referencedVolumeId:null,imageId:null};const{representationData:b}=(0,Zo.getSegmentation)(p),y=b[l.SegmentationRepresentations.Labelmap];if(d instanceof r.BaseVolumeViewport){const{volumeId:e}=y,t=r.cache.getVolume(e);this.editData={...this.editData,volumeId:e,referencedVolumeId:t.referencedVolumeId}}else this.editData={...this.editData};return this._activateDraw(o),(0,et.hideElementCursor)(o),e.preventDefault(),(0,tt.A)(E),!0},this._dragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{currentPoints:o}=t,i=o.canvas,a=(0,r.getEnabledElement)(n),{renderingEngine:s,viewport:l}=a,{canvasToWorld:d}=l,{annotation:c,viewportIdsToRender:h,centerCanvas:u}=this.editData,{data:g}=c,p=Math.abs(i[0]-u[0]),v=Math.abs(i[1]-u[1]),f=Math.sqrt(p*p+v*v),m=[u[0],u[1]+f],w=[u[0],u[1]-f],E=[u[0]-f,u[1]],b=[u[0]+f,u[1]];g.handles.points=[d(m),d(w),d(E),d(b)],c.invalidated=!0,this.editData.hasMoved=!0,(0,tt.A)(h)},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:o,newAnnotation:i,hasMoved:a,segmentIndex:s,segmentsLocked:l}=this.editData,{data:d}=o,{viewPlaneNormal:c,viewUp:h}=o.metadata;if(i&&!a)return;o.highlighted=!1,d.handles.activeHandleIndex=null,this._deactivateDraw(n),(0,et.resetElementCursor)(n);const u=(0,r.getEnabledElement)(n),g={...this.editData,points:d.handles.points,segmentIndex:s,segmentsLocked:l,viewPlaneNormal:c,viewUp:h};this.editData=null,this.isDrawing=!1,this.applyActiveStrategy(u,g)},this._activateDraw=e=>{e.addEventListener(l.Events.MOUSE_UP,this._endCallback),e.addEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(l.Events.MOUSE_MOVE,this._dragCallback),e.addEventListener(l.Events.TOUCH_END,this._endCallback),e.addEventListener(l.Events.TOUCH_TAP,this._endCallback),e.addEventListener(l.Events.TOUCH_DRAG,this._dragCallback)},this._deactivateDraw=e=>{e.removeEventListener(l.Events.MOUSE_UP,this._endCallback),e.removeEventListener(l.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(l.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(l.Events.MOUSE_MOVE,this._dragCallback),e.removeEventListener(l.Events.TOUCH_END,this._endCallback),e.removeEventListener(l.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(l.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!1;if(!this.editData)return n;const{viewport:o}=e,{viewportIdsToRender:i}=this.editData;if(!i.includes(o.id))return n;const{annotation:a}=this.editData,r=a.metadata,s=a.annotationUID,l=a.data,{points:d}=l.handles,c=d.map((e=>o.worldToCanvas(e))),h=c[0],u=c[1],g=[Math.floor((h[0]+u[0])/2),Math.floor((h[1]+u[1])/2)],p=Math.abs(h[1]-Math.floor((h[1]+u[1])/2)),v=`rgb(${r.segmentColor.slice(0,3)})`;if(!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;return(0,Ve.drawCircle)(t,s,"0",g,p,{color:v}),n=!0,n}}}oi.toolName="SphereScissor";const ii=oi;var ai=n(40336),ri=n(67847);const{transformWorldToIndex:si}=r.utilities;class li extends Kn{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{storePointData:!1,numSlicesToPropagate:10,calculatePointsInsideVolume:!1,getTextLines:di,statsCalculator:Wn.BasicStatsCalculator,showTextBox:!1}}){super(e,t),this.isHandleOutsideImage=!1,this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:o}=t,i=n.world,a=(0,r.getEnabledElement)(o),{viewport:l,renderingEngine:d}=a;this.isDrawing=!0;const c=l.getCamera(),{viewPlaneNormal:h,viewUp:u}=c;let g,p,v;if(l instanceof r.StackViewport)throw new Error("Stack Viewport Not implemented");{const e=this.getTargetId(l);v=r.utilities.getVolumeId(e),p=r.cache.getVolume(v),g=r.utilities.getClosestImageId(p,i,h)}const f=r.utilities.getSpacingInNormalDirection(p,h),m=this._getStartCoordinate(i,f,h),w=this._getEndCoordinate(i,f,h),E=l.getFrameOfReferenceUID(),b={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...h],viewUp:[...u],FrameOfReferenceUID:E,referencedImageId:g,volumeId:v,spacingInNormal:f,enabledElement:a},data:{label:"",startCoordinate:m,endCoordinate:w,handles:{textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},points:[[...i],[...i]],activeHandleIndex:null},cachedStats:{pointsInVolume:[],projectionPoints:[],statistics:[]},labelmapUID:null}};this._computeProjectionPoints(b,p),(0,s.addAnnotation)(b,o);const y=(0,Qe.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:b,viewportIdsToRender:y,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),(0,et.hideElementCursor)(o),e.preventDefault(),(0,tt.A)(y),b},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:i,newAnnotation:a,hasMoved:l}=this.editData,{data:d}=o;if(a&&!l)return;o.highlighted=!1,d.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,et.resetElementCursor)(n);const c=(0,r.getEnabledElement)(n);this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,s.removeAnnotation)(o.annotationUID);const h=this.getTargetId(c.viewport),u=r.cache.getVolume(h.split(/volumeId:|\?/)[1]);this.configuration.calculatePointsInsideVolume&&this._computePointsInsideVolume(o,u,h,c),(0,tt.A)(i),a&&(0,Je.dZ)(o)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:o}=e;let i=(0,s.getAnnotations)(this.getToolName(),o.element);if(!i?.length)return n;i=(0,ut.filterAnnotationsWithinSamePlane)(i,o.getCamera());const a={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let s=0;s<i.length;s++){const l=i[s],{annotationUID:d,data:c}=l,{startCoordinate:h,endCoordinate:u}=c,{points:g,activeHandleIndex:p}=c.handles;a.annotationUID=d;const v=this.getStyle("lineWidth",a,l),f=this.getStyle("lineDash",a,l),m=this.getStyle("color",a,l),w=g.map((e=>o.worldToCanvas(e))),E=w[0],b=(0,kt.r)(w),{centerPointRadius:y}=this.configuration,I=(0,kt.H)(w),_=o.getCamera().focalPoint,C=o.getCamera().viewPlaneNormal;let T=h,S=u;Array.isArray(h)&&(T=this._getCoordinateForViewplaneNormal(T,C),c.startCoordinate=T),Array.isArray(u)&&(S=this._getCoordinateForViewplaneNormal(S,C),c.endCoordinate=S);const x=r.utilities.roundToPrecision(c.startCoordinate),D=r.utilities.roundToPrecision(c.endCoordinate),A=this._getCoordinateForViewplaneNormal(_,C),O=r.utilities.roundToPrecision(A);if(O<Math.min(x,D)||O>Math.max(x,D))continue;const M=r.utilities.roundToPrecision((c.startCoordinate+c.endCoordinate)/2);let R,k=!1;if(O===M&&(k=!0),c.handles.points[0][this._getIndexOfCoordinatesForViewplaneNormal(C)]=M,l.invalidated&&this._throttledCalculateCachedStats(l,e),!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;if(!(0,Rt.isAnnotationVisible)(d))continue;if((0,wt.isAnnotationLocked)(d)||this.editData||null===p||!k||(R=[w[p]]),R){const e="0";(0,Ve.drawHandles)(t,d,e,R,{color:m})}let L=v,P=f;k?(L=v,P=[]):P=[5,5];const N="0";if((0,Ve.drawCircle)(t,d,N,E,b,{color:m,lineDash:P,lineWidth:L}),y>0&&b>3*y&&(0,Ve.drawCircle)(t,d,`${N}-center`,E,y,{color:m,lineDash:f,lineWidth:v}),n=!0,1==this.configuration.showTextBox&&1==this.configuration.calculatePointsInsideVolume){const e=this.getLinkedTextBoxStyle(a,l);if(!e.visibility){c.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const n=this.configuration.getTextLines(c);if(!n||0===n.length)continue;let i;c.handles.textBox.hasMoved||(i=(0,bn.getTextBoxCoordsCanvas)(I),c.handles.textBox.worldPosition=o.canvasToWorld(i));const r=o.worldToCanvas(c.handles.textBox.worldPosition),s="1",h=(0,Ve.drawLinkedTextBox)(t,d,s,n,r,w,{},e),{x:u,y:g,width:p,height:v}=h;c.handles.textBox.worldBoundingBox={topLeft:o.canvasToWorld([u,g]),topRight:o.canvasToWorld([u+p,g]),bottomLeft:o.canvasToWorld([u,g+v]),bottomRight:o.canvasToWorld([u+p,g+v])}}}return n},this._throttledCalculateCachedStats=(0,En.A)(this._calculateCachedStatsTool,100,{trailing:!0})}_computeProjectionPoints(e,t){const{data:n,metadata:o}=e,{viewPlaneNormal:i,spacingInNormal:a}=o,{imageData:s}=t,{startCoordinate:l,endCoordinate:d}=n,{points:c}=n.handles,h=si(s,c[0]),u=si(s,c[0]),g=r.utilities.deepClone(c),p=De.eR.create();s.indexToWorldVec3(h,p);const v=De.eR.create();s.indexToWorldVec3(u,v),2==this._getIndexOfCoordinatesForViewplaneNormal(i)?(p[2]=l,v[2]=d,g[0][2]=l,g[1][2]=l):0==this._getIndexOfCoordinatesForViewplaneNormal(i)?(p[0]=l,v[0]=d,g[0][0]=l,g[1][0]=l):1==this._getIndexOfCoordinatesForViewplaneNormal(i)&&(p[1]=l,v[1]=d,g[0][1]=l,g[1][1]=l);const f=De.eR.distance(p,v),m=[];for(let e=0;e<f;e+=a)m.push(g.map((t=>{const n=De.eR.create();return De.eR.scaleAndAdd(n,t,i,e),Array.from(n)})));n.cachedStats.projectionPoints=m}_computePointsInsideVolume(e,t,n,o){const{data:i,metadata:a}=e,{viewPlaneNormal:r,viewUp:s}=a,{viewport:l}=o,d=i.cachedStats.projectionPoints,c=[[]],h=this.getTargetImageData(n),u=i.handles.points.map((e=>l.worldToCanvas(e))),[g,p]=(0,kt.H)(u),v=l.canvasToWorld(g),f=l.canvasToWorld(p),{worldWidth:m,worldHeight:w}=(0,Bn.A)(r,s,v,f),E=(0,wn.Op)(h,i.handles),b=(0,wn.CQ)(h),y=Math.abs(Math.PI*(m/E.scale/2)*(w/b/E.scale/2)),I={isPreScaled:(0,On.u)(l,n),isSuvScaled:this.isSuvScaled(l,n,e.metadata.referencedImageId)},_=(0,An.j)(a.Modality,e.metadata.referencedImageId,I);for(let e=0;e<d.length;e++){if(!t)continue;const n=d[e][0],o=d[e].map((e=>l.worldToCanvas(e))),[i,a]=(0,kt.H)(o),s=l.canvasToWorld(i),h=l.canvasToWorld(a),u=s,g=h,{dimensions:p,imageData:v,voxelManager:f}=t,m=si(v,u),w=si(v,n),E=this._getIndexOfCoordinatesForViewplaneNormal(r);m[0]=Math.floor(m[0]),m[1]=Math.floor(m[1]),m[2]=Math.floor(m[2]),m[E]=w[E];const b=si(v,g);if(b[0]=Math.floor(b[0]),b[1]=Math.floor(b[1]),b[2]=Math.floor(b[2]),b[E]=w[E],this._isInsideVolume(m,b,p)){const e=[[Math.min(m[0],b[0]),Math.max(m[0],b[0])],[Math.min(m[1],b[1]),Math.max(m[1],b[1])],[Math.min(m[2],b[2]),Math.max(m[2],b[2])]],t={center:n,xRadius:Math.abs(s[0]-h[0])/2,yRadius:Math.abs(s[1]-h[1])/2,zRadius:Math.abs(s[2]-h[2])/2},o=f.forEach(this.configuration.statsCalculator.statsCallback,{isInObject:e=>(0,Hn.pointInEllipse)(t,e),boundsIJK:e,imageData:v,returnPoints:this.configuration.storePointData});c.push(o)}}const C=this.configuration.statsCalculator.getStatistics();i.cachedStats.pointsInVolume=c,i.cachedStats.statistics={Modality:a.Modality,area:y,mean:C.mean?.value,stdDev:C.stdDev?.value,max:C.max?.value,statsArray:C.array,areaUnit:E.areaUnit,modalityUnit:_}}_calculateCachedStatsTool(e,t){const n=e.data,{viewport:o}=t,{cachedStats:i}=n,a=this.getTargetId(o),s=r.cache.getVolume(a.split(/volumeId:|\?/)[1]);return this._computeProjectionPoints(e,s),this.configuration.calculatePointsInsideVolume&&this._computePointsInsideVolume(e,s,a,t),e.invalidated=!1,(0,Je.XF)(e,o.element),i}_getStartCoordinate(e,t,n){const o=this.configuration.numSlicesToPropagate,i=Math.round(o/2),a=De.eR.create();De.eR.scaleAndAdd(a,e,n,i*-t);return this._getCoordinateForViewplaneNormal(a,n)}_getEndCoordinate(e,t,n){const o=this.configuration.numSlicesToPropagate,i=o-Math.round(o/2),a=De.eR.create();De.eR.scaleAndAdd(a,e,n,i*t);return this._getCoordinateForViewplaneNormal(a,n)}_getIndexOfCoordinatesForViewplaneNormal(e){const t=[Math.abs(e[0]),Math.abs(e[1]),Math.abs(e[2])];return t.indexOf(Math.max(...t))}_getCoordinateForViewplaneNormal(e,t){return e[this._getIndexOfCoordinatesForViewplaneNormal(t)]}}function di(e){const t=e.cachedStats.statistics,{area:n,mean:o,max:i,stdDev:a,areaUnit:s,modalityUnit:l}=t;if(void 0===o)return;const d=[];return d.push(`Area: ${r.utilities.roundNumber(n)} ${s}`),d.push(`Mean: ${r.utilities.roundNumber(o)} ${l}`),d.push(`Max: ${r.utilities.roundNumber(i)} ${l}`),d.push(`Std Dev: ${r.utilities.roundNumber(a)} ${l}`),d}li.toolName="CircleROIStartEndThreshold";const ci=li;var hi=n(48736),ui=n(49906),gi=n(84882);const{transformWorldToIndex:pi,isEqual:vi}=r.utilities;class fi extends Ge.oS{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"]}){super(e,t),this.preMouseDownCallback=e=>{const t=e.detail,{currentPoints:n,element:o}=t,i=n.world,a=(0,r.getEnabledElement)(o),{viewport:s}=a,d=s.getCamera(),{viewPlaneNormal:c}=d,h=je.activeSegmentation.getActiveSegmentation(s.id);if(!h)throw new Error("No active segmentation detected, create one before using scissors tool");const{segmentationId:u}=h,g=je.segmentIndex.getActiveSegmentIndex(u),p=je.segmentLocking.getLockedSegmentIndices(u),{representationData:v}=(0,Zo.getSegmentation)(u);let f,m,w,E;if(s instanceof r.BaseVolumeViewport){const{volumeId:e}=v[l.SegmentationRepresentations.Labelmap],t=r.cache.getVolume(e);({dimensions:f,direction:m}=t),E=t.voxelManager,w=pi(t.imageData,i)}else{const e=(0,Zo.getCurrentLabelmapImageIdForViewport)(s.id,u);if(!e)throw new Error("No active segmentation imageId detected, create one before using scissors tool");const{imageData:t}=s.getImageData();f=t.getDimensions(),m=t.getDirection();const n=r.cache.getImage(e);E=n.voxelManager,w=pi(t,i)}const b=this.getFixedDimension(c,m);if(void 0===b)return void console.warn("Oblique paint fill not yet supported");const{floodFillGetter:y,getLabelValue:I,getScalarDataPositionFromPlane:_,inPlaneSeedPoint:C,fixedDimensionValue:T}=this.generateHelpers(E,f,w,b);if(w[0]<0||w[0]>=f[0]||w[1]<0||w[1]>=f[1]||w[2]<0||w[2]>=f[2])return;const S=I(w[0],w[1],w[2]);if(p.includes(S))return;const x=(0,gi.A)(y,C),{flooded:D}=x;D.forEach((e=>{const t=_(e[0],e[1]);E.setAtIndex(t,g)}));const A=this.getFramesModified(b,T,x);return(0,ui.triggerSegmentationDataModified)(u,A),!0},this.getFramesModified=(e,t,n)=>{const{boundaries:o}=n;if(2===e)return[t];let i=1/0,a=-1/0;for(let e=0;e<o.length;e++){const t=o[e][1];t<i&&(i=t),t>a&&(a=t)}const r=[];for(let e=i;e<=a;e++)r.push(e);return r},this.generateHelpers=(e,t,n,o=2)=>{let i,a;switch(o){case 0:i=n[0],a=[n[1],n[2]];break;case 1:i=n[1],a=[n[0],n[2]];break;case 2:i=n[2],a=[n[0],n[1]];break;default:throw new Error(`Invalid fixedDimension: ${o}`)}const r=(t,n,o)=>e.getAtIJK(t,n,o),s=this.generateFloodFillGetter(t,o,i,r);return{getScalarDataPositionFromPlane:this.generateGetScalarDataPositionFromPlane(((t,n,o)=>e.toIndex([t,n,o])),o,i),getLabelValue:r,floodFillGetter:s,inPlaneSeedPoint:a,fixedDimensionValue:i}},this.generateFloodFillGetter=(e,t,n,o)=>{let i;switch(t){case 0:i=(t,i)=>{if(!(t>=e[1]||t<0||i>=e[2]||i<0))return o(n,t,i)};break;case 1:i=(t,i)=>{if(!(t>=e[0]||t<0||i>=e[2]||i<0))return o(t,n,i)};break;case 2:i=(t,i)=>{if(!(t>=e[0]||t<0||i>=e[1]||i<0))return o(t,i,n)};break;default:throw new Error(`Invalid fixedDimension: ${t}`)}return i},this.generateGetScalarDataPositionFromPlane=(e,t,n)=>{let o;switch(t){case 0:o=(t,o)=>e(n,t,o);break;case 1:o=(t,o)=>e(t,n,o);break;case 2:o=(t,o)=>e(t,o,n);break;default:throw new Error(`Invalid fixedDimension: ${t}`)}return o}}getFixedDimension(e,t){const n=t.slice(0,3),o=t.slice(3,6),i=t.slice(6,9),a=[Math.abs(e[0]),Math.abs(e[1]),Math.abs(e[2])],r=[Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2])];if(vi(a,r))return 0;const s=[Math.abs(o[0]),Math.abs(o[1]),Math.abs(o[2])];if(vi(a,s))return 1;const l=[Math.abs(i[0]),Math.abs(i[1]),Math.abs(i[2])];return vi(a,l)?2:void 0}}fi.toolName="PaintFill";const mi=fi;var wi,Ei=n(25161),bi=n(85825),yi=n(45700),Ii=n(7019),_i=n(82409),Ci=n(49368),Ti=n(79484);!function(e){e[e.ANNOTATED_CUBE=1]="ANNOTATED_CUBE",e[e.AXES=2]="AXES",e[e.CUSTOM=3]="CUSTOM"}(wi||(wi={}));class Si extends Ge.oS{static{this.CUBE=1}static{this.AXIS=2}static{this.VTPFILE=3}static{this.OVERLAY_MARKER_TYPES=wi}constructor(e={},t={configuration:{orientationWidget:{enabled:!0,viewportCorner:Ei.Ay.Corners.BOTTOM_RIGHT,viewportSize:.15,minPixelSize:100,maxPixelSize:300},overlayMarkerType:Si.OVERLAY_MARKER_TYPES.ANNOTATED_CUBE,overlayConfiguration:{[Si.OVERLAY_MARKER_TYPES.ANNOTATED_CUBE]:{faceProperties:{xPlus:{text:"L",faceColor:"#ffff00",faceRotation:90},xMinus:{text:"R",faceColor:"#ffff00",faceRotation:270},yPlus:{text:"P",faceColor:"#00ffff",fontColor:"white",faceRotation:180},yMinus:{text:"A",faceColor:"#00ffff",fontColor:"white"},zPlus:{text:"S"},zMinus:{text:"I"}},defaultStyle:{fontStyle:"bold",fontFamily:"Arial",fontColor:"black",fontSizeScale:e=>e/2,faceColor:"#0000ff",edgeThickness:.1,edgeColor:"black",resolution:400}},[Si.OVERLAY_MARKER_TYPES.AXES]:{},[Si.OVERLAY_MARKER_TYPES.CUSTOM]:{polyDataURL:"https://raw.githubusercontent.com/Slicer/Slicer/80ad0a04dacf134754459557bf2638c63f3d1d1b/Base/Logic/Resources/OrientationMarkers/Human.vtp"}}}}){super(e,t),this._resizeObservers=new Map,this.onSetToolEnabled=()=>{this.initViewports(),this._subscribeToViewportEvents()},this.onSetToolActive=()=>{this.initViewports(),this._subscribeToViewportEvents()},this.onSetToolDisabled=()=>{this.cleanUpData(),this._unsubscribeToViewportNewVolumeSet()},this._getViewportsInfo=()=>(0,ne.getToolGroup)(this.toolGroupId).viewportsInfo,this.resize=e=>{const t=this.orientationMarkers[e];if(!t)return;const{orientationWidget:n}=t;n.updateViewport()},this.orientationMarkers={},this.updatingOrientationMarker={}}_unsubscribeToViewportNewVolumeSet(){const e=()=>{this._getViewportsInfo().forEach((({viewportId:e,renderingEngineId:t})=>{const{viewport:n}=(0,r.getEnabledElementByIds)(e,t),{element:o}=n;o.removeEventListener(r.Enums.Events.VOLUME_VIEWPORT_NEW_VOLUME,this.initViewports.bind(this));this._resizeObservers.get(e).unobserve(o)}))};r.eventTarget.removeEventListener(l.Events.TOOLGROUP_VIEWPORT_ADDED,(t=>{t.detail.toolGroupId===this.toolGroupId&&(e(),this.initViewports())}))}_subscribeToViewportEvents(){const e=()=>{this._getViewportsInfo().forEach((({viewportId:e,renderingEngineId:t})=>{const{viewport:n}=(0,r.getEnabledElementByIds)(e,t),{element:o}=n;this.initViewports(),o.addEventListener(r.Enums.Events.VOLUME_VIEWPORT_NEW_VOLUME,this.initViewports.bind(this));const i=new ResizeObserver((()=>{setTimeout((()=>{const n=(0,r.getEnabledElementByIds)(e,t);if(!n)return;const{viewport:o}=n;this.resize(e),o.render()}),100)}));i.observe(o),this._resizeObservers.set(e,i)}))};e(),r.eventTarget.addEventListener(l.Events.TOOLGROUP_VIEWPORT_ADDED,(t=>{t.detail.toolGroupId===this.toolGroupId&&(e(),this.initViewports())}))}cleanUpData(){(0,r.getRenderingEngines)()[0].getViewports().forEach((e=>{const t=this.orientationMarkers[e.id];if(!t)return;const{actor:n,orientationWidget:o}=t;o?.setEnabled(!1),o?.delete(),n?.delete();e.getRenderingEngine().offscreenMultiRenderWindow.getRenderWindow().render(),e.getRenderingEngine().render(),delete this.orientationMarkers[e.id]}))}initViewports(){const e=(0,r.getRenderingEngines)()[0];if(!e)return;let t=e.getViewports();t=(0,Qe.filterViewportsWithToolEnabled)(t,this.getToolName()),t.forEach((e=>{const t=e.getWidget(this.getToolName());t&&!t.isDeleted()||this.addAxisActorInViewport(e)}))}async addAxisActorInViewport(e){const t=e.id;if(!this.updatingOrientationMarker[t]){this.updatingOrientationMarker[t]=!0;const n=this.configuration.overlayMarkerType,o=this.configuration.overlayConfiguration[n];if(this.orientationMarkers[t]){const{actor:n,orientationWidget:o}=this.orientationMarkers[t];e.getRenderer().removeActor(n),o.setEnabled(!1)}let i;1===n?i=this.createAnnotationCube(o):2===n?i=yi.Ay.newInstance():3===n&&(i=await this.createCustomActor());const a=e.getRenderer(),r=e.getRenderingEngine().offscreenMultiRenderWindow.getRenderWindow(),{enabled:s,viewportCorner:l,viewportSize:d,minPixelSize:c,maxPixelSize:h}=this.configuration.orientationWidget,u=Ei.Ay.newInstance({actor:i,interactor:r.getInteractor(),parentRenderer:a});u.setEnabled(s),u.setViewportCorner(l),u.setViewportSize(d),u.setMinPixelSize(c),u.setMaxPixelSize(h),u.updateMarkerOrientation(),this.orientationMarkers[t]={orientationWidget:u,actor:i},e.addWidget(this.getToolName(),u),r.render(),e.getRenderingEngine().render(),this.updatingOrientationMarker[t]=!1}}async createCustomActor(){const e=this.configuration.overlayConfiguration[wi.CUSTOM].polyDataURL,t=await fetch(e),n=await t.arrayBuffer(),o=Ci.Ay.newInstance();o.parseAsArrayBuffer(n),o.update();const i=Ti.Ay.newInstance();i.shallowCopy(o.getOutputData()),i.getPointData().setActiveScalars("Color");const a=_i.Ay.newInstance();a.setInputData(i),a.setColorModeToDirectScalars();const r=Ii.Ay.newInstance();return r.setMapper(a),r.rotateZ(180),r}createAnnotationCube(e){const t=bi.Ay.newInstance();return t.setDefaultStyle({...e.defaultStyle}),t.setXPlusFaceProperty({...e.faceProperties.xPlus}),t.setXMinusFaceProperty({...e.faceProperties.xMinus}),t.setYPlusFaceProperty({...e.faceProperties.yPlus}),t.setYMinusFaceProperty({...e.faceProperties.yMinus}),t.setZPlusFaceProperty({...e.faceProperties.zPlus}),t.setZMinusFaceProperty({...e.faceProperties.zMinus}),t}async createAnnotatedCubeActor(){const e=bi.Ay.newInstance(),{faceProperties:t,defaultStyle:n}=this.configuration.annotatedCube;return e.setDefaultStyle(n),Object.keys(t).forEach((n=>{const o=`set${n.charAt(0).toUpperCase()+n.slice(1)}FaceProperty`;e[o](t[n])})),e}}Si.toolName="OrientationMarker";const xi=Si;var Di=n(26228),Ai=(n(18682),n(70930)),Oi=n(67470);class Mi extends Ge.oS{static{this.SelectMode={Inside:"Inside",Border:"Border"}}constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{hoverTimeout:100,mode:Mi.SelectMode.Border,searchRadius:6}}){super(e,t),this.mouseMoveCallback=e=>(this.hoverTimer&&clearTimeout(this.hoverTimer),this.hoverTimer=setTimeout((()=>{this._setActiveSegment(e),this.hoverTimer=null}),this.configuration.hoverTimeout),!0),this.onSetToolEnabled=()=>{this.onSetToolActive()},this.onSetToolActive=()=>{this.hoverTimer=null},this.onSetToolDisabled=()=>{this.hoverTimer=null},this.hoverTimer=null}_setActiveSegment(e={}){if(B.wk.isInteractingWithTool)return;const{element:t,currentPoints:n}=e.detail,o=n.world,i=(0,r.getEnabledElement)(t);if(!i)return;const{viewport:a}=i,s=(0,Di.getActiveSegmentation)(a.id);s&&this._setActiveSegmentForType(s,o,a)}_setActiveSegmentForType(e,t,n){if(!n.getImageData())return;const{segmentationId:o,representationData:i}=e;let a;if(this.configuration.mode===Mi.SelectMode.Inside?a=(0,Oi.getSegmentIndexAtWorldPoint)(o,t,{viewport:n}):i.Labelmap?a=(0,Oi.getSegmentIndexAtLabelmapBorder)(o,t,{viewport:n,searchRadius:this.configuration.searchRadius}):i.Contour?a=(0,Oi.getHoveredContourSegmentationAnnotation)(o):i.Surface,!a||0===a)return;(0,Ai.setActiveSegmentIndex)(o,a);const r=n.getRenderingEngine().getViewports().map((e=>e.id));(0,ui.triggerSegmentationModified)(o),(0,tt.A)(r)}}Mi.toolName="SegmentSelectTool";const Ri=Mi;var ki=n(92282);class Li extends Ge.EC{constructor(e={}){super(e,{supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1}}),this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:o}=t,i=n.world,a=(0,r.getEnabledElement)(o),{viewport:s,renderingEngine:l}=a;this.isDrawing=!0;const d=s.getCamera(),{viewPlaneNormal:c,viewUp:h}=d,u=this.getReferencedImageId(s,i,c,h),g={metadata:{viewPlaneNormal:[0,0,1],viewUp:[0,1,0],FrameOfReferenceUID:s.getFrameOfReferenceUID(),referencedImageId:u,toolName:this.getToolName()},data:{invalidated:!0,handles:{points:[[...i],[...i],[...i],[...i]],activeHandleIndex:null},cachedStats:{},active:!0}};(0,G.lC)(g,o);const p=(0,Qe.getViewportIdsWithToolToRender)(o,this.getToolName(),!1);return this.editData={annotation:g,viewportUIDsToRender:p,handleIndex:3,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),(0,et.hideElementCursor)(o),e.preventDefault(),(0,tt.A)(p),g},this.getHandleNearImagePoint=(e,t,n,o)=>{const i=(0,r.getEnabledElement)(e),{viewport:a}=i,{data:s}=t,{points:l}=s.handles;for(let e=0;e<l.length;e++){const t=l[e],i=a.worldToCanvas(t);if(!0===De.Zc.distance(n,i)<o)return s.handles.activeHandleIndex=e,t}s.handles.activeHandleIndex=null},this.isPointNearTool=(e,t,n,o)=>{const i=(0,r.getEnabledElement)(e),{viewport:a}=i,{data:s}=t,{points:l}=s.handles,d=a.worldToCanvas(l[0]),c=a.worldToCanvas(l[3]),h=this._getRectangleImageCoordinates([d,c]),u=[n[0],n[1]],{left:g,top:p,width:v,height:f}=h;if(ki.distanceToPoint([g,p,v,f],u)<=o)return!0},this.toolSelectedCallback=(e,t,n="mouse")=>{const o=e.detail,{element:i}=o,{data:a}=t;a.active=!0;const r=(0,Qe.getViewportIdsWithToolToRender)(i,this.getToolName(),!1);this.editData={annotation:t,viewportUIDsToRender:r},this._activateModify(i),(0,et.hideElementCursor)(i),(0,tt.A)(r),e.preventDefault()},this.handleSelectedCallback=(e,t,n,o="mouse")=>{const i=e.detail,{element:a}=i,{data:r}=t;r.active=!0;let s,l=!1;n.worldPosition?l=!0:s=r.handles.points.findIndex((e=>e===n));const d=(0,Qe.getViewportIdsWithToolToRender)(a,this.getToolName(),!1);this.editData={annotation:t,viewportUIDsToRender:d,handleIndex:s},this._activateModify(a),(0,et.hideElementCursor)(a),(0,tt.A)(d),e.preventDefault()},this._mouseUpCallback=e=>{const t=e.detail,{element:n}=t,{annotation:o,viewportUIDsToRender:i,newAnnotation:a,hasMoved:s}=this.editData,{data:l}=o;if(a&&!s)return;l.active=!1,l.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,et.resetElementCursor)(n);(0,r.getEnabledElement)(n);this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,G.O8)(o.annotationUID),(0,tt.A)(i)},this._mouseDragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:o,viewportUIDsToRender:i,handleIndex:a}=this.editData,{data:s}=o;if(void 0===a){const{deltaPoints:e}=t,n=e.world,{points:o}=s.handles;o.forEach((e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]})),s.invalidated=!0}else{const{currentPoints:e}=t,o=(0,r.getEnabledElement)(n),{worldToCanvas:i,canvasToWorld:l}=o.viewport,d=e.world,{points:c}=s.handles;let h,u,g,p,v,f,m,w;switch(c[a]=[...d],a){case 0:case 3:h=i(c[0]),p=i(c[3]),u=[p[0],h[1]],g=[h[0],p[1]],f=l(u),m=l(g),c[1]=f,c[2]=m;break;case 1:case 2:u=i(c[1]),g=i(c[2]),h=[g[0],u[1]],p=[u[0],g[1]],v=l(h),w=l(p),c[0]=v,c[3]=w}s.invalidated=!0}this.editData.hasMoved=!0;(0,r.getEnabledElement)(n);(0,tt.A)(i)},this._activateDraw=e=>{B.wk.isInteractingWithTool=!0,e.addEventListener(l.Events.MOUSE_UP,this._mouseUpCallback),e.addEventListener(l.Events.MOUSE_DRAG,this._mouseDragCallback),e.addEventListener(l.Events.MOUSE_MOVE,this._mouseDragCallback),e.addEventListener(l.Events.MOUSE_CLICK,this._mouseUpCallback),e.addEventListener(l.Events.TOUCH_END,this._mouseUpCallback),e.addEventListener(l.Events.TOUCH_DRAG,this._mouseDragCallback)},this._deactivateDraw=e=>{B.wk.isInteractingWithTool=!1,e.removeEventListener(l.Events.MOUSE_UP,this._mouseUpCallback),e.removeEventListener(l.Events.MOUSE_DRAG,this._mouseDragCallback),e.removeEventListener(l.Events.MOUSE_MOVE,this._mouseDragCallback),e.removeEventListener(l.Events.MOUSE_CLICK,this._mouseUpCallback),e.removeEventListener(l.Events.TOUCH_END,this._mouseUpCallback),e.removeEventListener(l.Events.TOUCH_DRAG,this._mouseDragCallback)},this._activateModify=e=>{B.wk.isInteractingWithTool=!0,e.addEventListener(l.Events.MOUSE_UP,this._mouseUpCallback),e.addEventListener(l.Events.MOUSE_DRAG,this._mouseDragCallback),e.addEventListener(l.Events.MOUSE_CLICK,this._mouseUpCallback),e.addEventListener(l.Events.TOUCH_END,this._mouseUpCallback),e.addEventListener(l.Events.TOUCH_DRAG,this._mouseDragCallback)},this._deactivateModify=e=>{B.wk.isInteractingWithTool=!1,e.removeEventListener(l.Events.MOUSE_UP,this._mouseUpCallback),e.removeEventListener(l.Events.MOUSE_DRAG,this._mouseDragCallback),e.removeEventListener(l.Events.MOUSE_CLICK,this._mouseUpCallback),e.removeEventListener(l.Events.TOUCH_END,this._mouseUpCallback),e.removeEventListener(l.Events.TOUCH_DRAG,this._mouseDragCallback)},this.renderAnnotation=(e,t)=>{const n=!1,{viewport:o}=e,{element:i}=o;let a=(0,G.Rh)(this.getToolName(),i);if(!a?.length)return n;if(a=this.filterInteractableAnnotationsForElement(i,a),!a?.length)return n;this.getTargetId(o),o.getRenderingEngine();const r={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let e=0;e<a.length;e++){const n=a[e],{annotationUID:i}=n,s=(n.metadata,n.data),{points:l,activeHandleIndex:d}=s.handles,c=l.map((e=>o.worldToCanvas(e))),h=this.getStyle("lineWidth",r,n),u=this.getStyle("lineDash",r,n),g=this.getStyle("color",r,n);if(!o.getRenderingEngine())return void console.warn("Rendering Engine has been destroyed");let p;if(this.editData||null===d||(p=[c[d]]),p){const e="0";(0,Ve.drawHandles)(t,i,e,p,{color:g})}const v="0";(0,Ve.drawRedactionRect)(t,i,v,c[0],c[3],{color:"black",lineDash:u,lineWidth:h})}},this._getRectangleImageCoordinates=e=>{const[t,n]=e;return{left:Math.min(t[0],n[0]),top:Math.min(t[1],n[1]),width:Math.abs(t[0]-n[0]),height:Math.abs(t[1]-n[1])}},this._calculateCachedStats=(e,t,n,o,i)=>{const{data:a}=e,{viewportUID:s,renderingEngineUID:d,sceneUID:c}=i,h=a.handles.points[0],u=a.handles.points[3],{cachedStats:g}=a,p=Object.keys(g);for(let e=0;e<p.length;e++){const i=p[e],{imageVolume:a}=this._getImageVolumeFromTargetUID(i,o),{dimensions:r,scalarData:s,vtkImageData:l,metadata:d}=a,c=De.eR.fromValues(0,0,0),v=De.eR.fromValues(0,0,0);if(l.worldToIndexVec3(h,c),c[0]=Math.floor(c[0]),c[1]=Math.floor(c[1]),c[2]=Math.floor(c[2]),l.worldToIndexVec3(u,v),v[0]=Math.floor(v[0]),v[1]=Math.floor(v[1]),v[2]=Math.floor(v[2]),this._isInsideVolume(c,v,r)){this.isHandleOutsideImage=!1;const e=Math.min(c[0],v[0]),o=Math.max(c[0],v[0]),a=Math.min(c[1],v[1]),l=Math.max(c[1],v[1]),p=Math.min(c[2],v[2]),f=Math.max(c[2],v[2]),{worldWidth:m,worldHeight:w}=(0,Bn.A)(t,n,h,u),E=m*w;let b=0,y=0,I=0;const _=r[0],C=r[0]*r[1];for(let t=p;t<=f;t++)for(let n=a;n<=l;n++)for(let i=e;i<=o;i++){b++,y+=s[t*C+n*_+i]}y/=b;for(let t=p;t<=f;t++)for(let n=a;n<=l;n++)for(let i=e;i<=o;i++){const e=s[t*C+n*_+i]-y;I+=e*e}I/=b,I=Math.sqrt(I),g[i]={Modality:d.Modality,area:E,mean:y,stdDev:I}}else this.isHandleOutsideImage=!0,g[i]={Modality:d.Modality}}a.invalidated=!1;const v=l.Events.ANNOTATION_MODIFIED,f={annotation:e,viewportUID:s,renderingEngineUID:d,sceneUID:c};return(0,r.triggerEvent)(r.eventTarget,v,f),g},this._isInsideVolume=(e,t,n)=>r.utilities.indexWithinDimensions(e,n)&&r.utilities.indexWithinDimensions(t,n),this._getTargetVolumeUID=e=>{if(this.configuration.volumeUID)return this.configuration.volumeUID;const t=e.getVolumeActors();return t||t.length?t[0].uid:void 0},this._throttledCalculateCachedStats=(0,En.A)(this._calculateCachedStats,100,{trailing:!0})}cancel(e){if(!this.isDrawing)return;this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,et.resetElementCursor)(e);const{annotation:t,viewportUIDsToRender:n}=this.editData,{data:o}=t;return o.active=!1,o.handles.activeHandleIndex=null,(0,tt.A)(n),this.editData=null,t.metadata.annotationUID}_getImageVolumeFromTargetUID(e,t){let n;if(e.startsWith("stackTarget")){const o=e.indexOf(":"),i=e.substring(o+1);n=t.getViewport(i).getImageData()}else n=r.cache.getVolume(e);return{imageVolume:n,viewport:undefined}}_getTargetStackUID(e){return`stackTarget:${e.uid}`}}Li.toolName="VideoRedaction";const Pi=Li},39011:(e,t,n)=>{"use strict";n.d(t,{o:()=>c});var o=n(81985),i=n(99737),a=n(89578),r=n(39848);const{Active:s,Passive:l,Enabled:d}=i.ToolModes;const c=new class{constructor(){this._needsRender=new Set,this._animationFrameSet=!1,this._animationFrameHandle=null,this._renderFlaggedViewports=()=>{this._throwIfDestroyed();const e=Array.from(this._viewportElements.values());for(let t=0;t<e.length;t++){const n=e[t];if(this._needsRender.has(n)&&(this._triggerRender(n),this._needsRender.delete(n),0===this._needsRender.size))break}this._animationFrameSet=!1,this._animationFrameHandle=null,this._render()},this._viewportElements=new Map}addViewportElement(e,t){this._viewportElements.set(e,t)}removeViewportElement(e,t){this._viewportElements.delete(e),this._needsRender.delete(t),this._reset()}renderViewport(e){this._setViewportsToBeRenderedNextFrame([e])}_throwIfDestroyed(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}_setAllViewportsToBeRenderedNextFrame(){[...this._viewportElements.values()].forEach((e=>{this._needsRender.add(e)})),this._renderFlaggedViewports()}_setViewportsToBeRenderedNextFrame(e){const t=[...this._viewportElements.values()];e.forEach((e=>{-1!==t.indexOf(e)&&this._needsRender.add(e)})),this._render()}_render(){this._needsRender.size>0&&!1===this._animationFrameSet&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedViewports),this._animationFrameSet=!0)}_triggerRender(e){const t=(0,o.getEnabledElement)(e);if(!t)return;if(!(0,o.getRenderingEngine)(t.renderingEngineId))return void console.warn("rendering Engine has been destroyed");const n=(0,r.A)(e,[s,l,d]),{renderingEngineId:c,viewportId:h}=t,u={element:e,renderingEngineId:c,viewportId:h};(0,a.draw)(e,(a=>{let r=!1;n.forEach((e=>{if(e.renderAnnotation){const n=e.renderAnnotation(t,a);r=r||n}})),r&&(0,o.triggerEvent)(e,i.Events.ANNOTATION_RENDERED,{...u})}))}_reset(){window.cancelAnimationFrame(this._animationFrameHandle),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null,this._setAllViewportsToBeRenderedNextFrame()}}},67013:(e,t,n)=>{"use strict";n.d(t,{A:()=>r,H:()=>a});var o=n(81985);class i{constructor(e){this.getGroupKey=e=>{if("string"==typeof e)return e;const t=e,n=(0,o.getEnabledElement)(t);if(!n)throw new Error("Element not enabled, you must have an enabled element if you are not providing a FrameOfReferenceUID");return n.FrameOfReferenceUID},this._imageVolumeModifiedHandler=e=>{const t=e.detail,{FrameOfReferenceUID:n}=t,o=this.annotations[n];o&&Object.keys(o).forEach((e=>{o[e].forEach((e=>{void 0!==e.invalidated&&(e.invalidated=!0)}))}))},this.getFramesOfReference=()=>Object.keys(this.annotations),this.getAnnotations=(e,t)=>{const n=this.annotations;return n[e]?t?n[e][t]?n[e][t]:[]:n[e]:[]},this.getAnnotation=e=>{const t=this.annotations;for(const n in t){const o=t[n];for(const t in o){const n=o[t];for(const t of n)if(e===t.annotationUID)return t}}},this.getNumberOfAnnotations=(e,t)=>{const n=this.getAnnotations(e,t);if(!n.length)return 0;if(t)return n.length;let o=0;for(const e in n)o+=n[e].length;return o},this.addAnnotation=(e,t)=>{const{metadata:n}=e,{FrameOfReferenceUID:o,toolName:i}=n;t=t||o;const a=this.annotations;let r=a[t];r||(a[t]={},r=a[t]);let s=r[i];s||(r[i]=[],s=r[i]),this.preprocessingFn&&(e=this.preprocessingFn(e)),s.push(e)},this.removeAnnotation=e=>{const{annotations:t}=this;for(const n in t){const o=t[n];for(const t in o){const n=o[t],i=n.findIndex((t=>t.annotationUID===e));-1!==i&&(n.splice(i,1),0===n.length&&delete o[t])}0===Object.keys(o).length&&delete t[n]}},this.removeAnnotations=(e,t)=>{const n=this.annotations,o=[];if(!n[e])return o;if(t){const i=n[e][t];for(const e of i)this.removeAnnotation(e.annotationUID),o.push(e)}else for(const t in n[e]){const i=n[e][t];for(const e of i)this.removeAnnotation(e.annotationUID),o.push(e)}return o},this.saveAnnotations=(e,t)=>{const n=this.annotations;if(e&&t){const o=n[e];if(!o)return;const i=o[t];return structuredClone(i)}if(e){const t=n[e];return structuredClone(t)}return structuredClone(n)},this.restoreAnnotations=(e,t,n)=>{const o=this.annotations;if(t&&n){let i=o[t];i||(o[t]={},i=o[t]),i[n]=e}else t?o[t]=e:this.annotations=structuredClone(e)},this.getAllAnnotations=()=>Object.values(this.annotations).map((e=>Object.values(e))).flat(2),this.getNumberOfAllAnnotations=()=>{let e=0;const t=this.annotations;for(const n in t){const o=t[n];for(const t in o){e+=o[t].length}}return e},this.removeAllAnnotations=()=>{const e=[];for(const t of this.getAllAnnotations())this.removeAnnotation(t.annotationUID),e.push(t);return e},e||(e=o.utilities.uuidv4()),this.annotations={},this.uid=e,o.eventTarget.addEventListener(o.Enums.Events.IMAGE_VOLUME_MODIFIED,this._imageVolumeModifiedHandler)}setPreprocessingFn(e){this.preprocessingFn=e}}const a=new i("DEFAULT"),r=i},2076:(e,t,n)=>{"use strict";n.r(t),n.d(t,{checkAndSetAnnotationLocked:()=>u,getAnnotationsLocked:()=>d,getAnnotationsLockedCount:()=>h,isAnnotationLocked:()=>c,setAnnotationLocked:()=>s,unlockAllAnnotations:()=>l});var o=n(81985),i=n(99737),a=n(69059);const r=new Set;function s(e,t=!0){const n=g();e&&(t?function(e,t,n){if(!t.has(e)){t.add(e),n.added.push(e);const o=(0,a.g)(e);o&&(o.isLocked=!0)}}(e,r,n):p(e,r,n)),v(n,r)}function l(){const e=g();!function(e,t){e.forEach((n=>{p(n,e,t)}))}(r,e),v(e,r)}function d(){return Array.from(r)}function c(e){return r.has(e)}function h(){return r.size}function u(e){const t=c(e);return s(e,t),t}function g(){return Object.freeze({added:[],removed:[],locked:[]})}function p(e,t,n){if(t.delete(e)){n.removed.push(e);const t=(0,a.g)(e);t&&(t.isLocked=!1)}}function v(e,t){(e.added.length>0||e.removed.length>0)&&(t.forEach((t=>{e.locked.push(t)})),(0,o.triggerEvent)(o.eventTarget,i.Events.ANNOTATION_LOCK_CHANGE,e))}},17343:(e,t,n)=>{"use strict";n.r(t),n.d(t,{deselectAnnotation:()=>l,getAnnotationsSelected:()=>d,getAnnotationsSelectedByToolName:()=>c,getAnnotationsSelectedCount:()=>u,isAnnotationSelected:()=>h,setAnnotationSelected:()=>s});var o=n(81985),i=n(99737),a=n(69059);const r=new Set;function s(e,t=!0,n=!1){t?function(e,t=!1){const n=g();if(!t){p(r,n);const t=(0,a.g)(e);t&&(t.isSelected=!0)}if(e&&!r.has(e)){r.add(e),n.added.push(e);const t=(0,a.g)(e);t&&(t.isSelected=!0)}v(n,r)}(e,n):l(e)}function l(e){const t=g();if(e){if(r.delete(e)){t.removed.push(e);(0,a.g)(e).isSelected=!1}}else p(r,t);v(t,r)}function d(){return Array.from(r)}function c(e){return d().filter((t=>{const n=(0,a.g)(t);return n?.metadata?.toolName===e}))}function h(e){return r.has(e)}function u(){return r.size}function g(){return Object.freeze({added:[],removed:[],selection:[]})}function p(e,t){e.forEach((n=>{if(e.delete(n)){t.removed.push(n);const e=(0,a.g)(n);e&&(e.isSelected=!1)}}))}function v(e,t){(e.added.length>0||e.removed.length>0)&&(t.forEach((t=>{e.selection.push(t)})),(0,o.triggerEvent)(o.eventTarget,i.Events.ANNOTATION_SELECTION_CHANGE,e))}},82056:(e,t,n)=>{"use strict";n.r(t),n.d(t,{addAnnotation:()=>b,addChildAnnotation:()=>m,clearParentAnnotation:()=>f,getAllAnnotations:()=>v,getAnnotation:()=>a.g,getAnnotationManager:()=>h,getAnnotations:()=>p,getChildAnnotations:()=>E,getNumberOfAnnotations:()=>y,getParentAnnotation:()=>w,invalidateAnnotation:()=>T,removeAllAnnotations:()=>_,removeAnnotation:()=>I,removeAnnotations:()=>C,resetAnnotationManager:()=>g,setAnnotationManager:()=>u});var o=n(81985),i=n(67013),a=n(69059),r=n(44049),s=n(2076),l=n(82107),d=n(29601);let c=i.H;function h(){return c}function u(e){c=e}function g(){c=i.H}function p(e,t){const n=h(),o=n.getGroupKey(t);return n.getAnnotations(o,e)}function v(){return h().getAllAnnotations()}function f(e){const{annotationUID:t,parentAnnotationUID:n}=e;if(!n)return;const o=(0,a.g)(n),i=o.childAnnotationUIDs.indexOf(t);o.childAnnotationUIDs.splice(i,1),e.parentAnnotationUID=void 0}function m(e,t){const{annotationUID:n}=e,{annotationUID:o}=t;f(t),e.childAnnotationUIDs||(e.childAnnotationUIDs=[]),e.childAnnotationUIDs.includes(o)||(e.childAnnotationUIDs.push(o),t.parentAnnotationUID=n)}function w(e){return e.parentAnnotationUID?(0,a.g)(e.parentAnnotationUID):void 0}function E(e){return e.childAnnotationUIDs?.map((e=>(0,a.g)(e)))??[]}function b(e,t){e.annotationUID||(e.annotationUID=o.utilities.uuidv4());const n=h();if(t instanceof HTMLDivElement){const o=n.getGroupKey(t);n.addAnnotation(e,o),(0,r.$f)(e,t)}else n.addAnnotation(e,void 0),(0,r._3)(e);return e.annotationUID}function y(e,t){const n=h(),o=n.getGroupKey(t);return n.getNumberOfAnnotations(o,e)}function I(e){if(!e)return;const t=h(),n=t.getAnnotation(e);n&&(n.childAnnotationUIDs?.forEach((e=>I(e))),t.removeAnnotation(e),(0,r.SH)({annotation:n,annotationManagerUID:t.uid}))}function _(){const e=h(),t=e.removeAllAnnotations();for(const n of t)(0,r.SH)({annotation:n,annotationManagerUID:e.uid})}function C(e,t){const n=h(),o=n.getGroupKey(t),i=n.removeAnnotations(o,e);for(const e of i)(0,r.SH)({annotation:e,annotationManagerUID:n.uid})}function T(e){let t=e;for(;t;)t.invalidated=!0,t=t.parentAnnotationUID?(0,a.g)(t.parentAnnotationUID):void 0}c.setPreprocessingFn((e=>{e=(0,l.Q)(e);const t=(e=(0,l.d)(e)).annotationUID,n=(0,s.checkAndSetAnnotationLocked)(t);e.isLocked=n;const o=(0,d.checkAndSetAnnotationVisibility)(t);return e.isVisible=o,e}))},29601:(e,t,n)=>{"use strict";n.r(t),n.d(t,{checkAndSetAnnotationVisibility:()=>p,isAnnotationVisible:()=>c,setAnnotationVisibility:()=>l,showAllAnnotations:()=>d});var o=n(81985),i=n(99737),a=n(17343),r=n(69059);const s=new Set;function l(e,t=!0){const n=h();e&&(t?u(e,s,n):function(e,t,n){t.has(e)||(t.add(e),(0,a.isAnnotationSelected)(e)&&(0,a.deselectAnnotation)(e),n.lastHidden.push(e))}(e,s,n)),g(n)}function d(){const e=h();s.forEach((t=>{u(t,s,e)})),g(e)}function c(e){if((0,r.g)(e))return!s.has(e)}function h(){return Object.freeze({lastVisible:[],lastHidden:[],hidden:[]})}function u(e,t,n){if(t.delete(e)){n.lastVisible.push(e);(0,r.g)(e).isVisible=!0}}function g(e){(e.lastHidden.length>0||e.lastVisible.length>0)&&(s.forEach((t=>{e.hidden.push(t)})),(0,o.triggerEvent)(o.eventTarget,i.Events.ANNOTATION_VISIBILITY_CHANGE,e))}function p(e){const t=!s.has(e);return l(e,t),t}},8710:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});const o=new class{constructor(){this._initializeConfig({color:"rgb(255, 255, 0)",colorHighlighted:"rgb(0, 255, 0)",colorSelected:"rgb(0, 220, 0)",colorLocked:"rgb(209, 193, 90)",lineWidth:"1",lineDash:"",shadow:!0,textBoxVisibility:!0,textBoxFontFamily:"Helvetica Neue, Helvetica, Arial, sans-serif",textBoxFontSize:"14px",textBoxColor:"rgb(255, 255, 0)",textBoxColorHighlighted:"rgb(0, 255, 0)",textBoxColorSelected:"rgb(0, 255, 0)",textBoxColorLocked:"rgb(209, 193, 90)",textBoxBackground:"",textBoxLinkLineWidth:"1",textBoxLinkLineDash:"2,3",textBoxShadow:!0})}getAnnotationToolStyles(e){return this.config.annotations&&this.config.annotations[e]}getViewportToolStyles(e){return this.config.viewports&&this.config.viewports[e]}getToolGroupToolStyles(e){return this.config.toolGroups&&this.config.toolGroups[e]}getDefaultToolStyles(){return this.config.default}setAnnotationStyles(e,t){let n=this.config.annotations;n||(this.config={...this.config,annotations:{}},n=this.config.annotations),n[e]=t}setViewportToolStyles(e,t){let n=this.config.viewports;n||(this.config={...this.config,viewports:{}},n=this.config.viewports),n[e]=t}setToolGroupToolStyles(e,t){let n=this.config.toolGroups;n||(this.config={...this.config,toolGroups:{}},n=this.config.toolGroups),n[e]=t}setDefaultToolStyles(e){this.config.default=e}getStyleProperty(e,t){const{annotationUID:n,viewportId:o,toolGroupId:i,toolName:a}=t;return this._getToolStyle(e,n,o,i,a)}_getToolStyle(e,t,n,o,i){if(t){const n=this.getAnnotationToolStyles(t);if(n&&void 0!==n[e])return n[e]}if(n){const t=this.getViewportToolStyles(n);if(t){if(t[i]&&void 0!==t[i][e])return t[i][e];if(t.global&&void 0!==t.global[e])return t.global[e]}}if(o){const t=this.getToolGroupToolStyles(o);if(t){if(t[i]&&void 0!==t[i][e])return t[i][e];if(t.global&&void 0!==t.global[e])return t.global[e]}}const a=this.getDefaultToolStyles();return a[i]&&void 0!==a[i][e]?a[i][e]:a.global&&void 0!==a.global[e]?a.global[e]:void 0}_initializeConfig(e){const t={};for(const n in e)t[n]=e[n];this.config={default:{global:t}}}}},76712:(e,t,n)=>{"use strict";n.d(t,{h:()=>i});var o=n(8710);function i(e,t,n,i){const a=function(e,t,n){const o=[`${e}`];return t&&o.push(`${o[0]}${t}`),n&&o.push(`${o[o.length-1]}${n}`),o}(e,n,i);for(let e=a.length-1;e>=0;--e){const n=o.A.getStyleProperty(a[e],t);if(void 0!==n)return n}}},49310:(e,t,n)=>{"use strict";n.r(t),n.d(t,{getFont:()=>l,getState:()=>r,style:()=>d.A});var o=n(2076),i=n(17343),a=n(99737);const r=function(e){if(e){if(e.data&&e.highlighted)return a.AnnotationStyleStates.Highlighted;if((0,i.isAnnotationSelected)(e.annotationUID))return a.AnnotationStyleStates.Selected;if((0,o.isAnnotationLocked)(e.annotationUID))return a.AnnotationStyleStates.Locked;if(e.data&&e.autoGenerated)return a.AnnotationStyleStates.AutoGenerated}return a.AnnotationStyleStates.Default};var s=n(76712);const l=function(e,t,n){return`${(0,s.h)("textBoxFontSize",e,t,n)}px ${(0,s.h)("textBoxFontFamily",e,t,n)}`};var d=n(8710)},69059:(e,t,n)=>{"use strict";n.d(t,{g:()=>i});var o=n(67013);function i(e){return o.H.getAnnotation(e)}},44049:(e,t,n)=>{"use strict";n.d(t,{$f:()=>r,PS:()=>h,SH:()=>l,XF:()=>d,_3:()=>s,dZ:()=>c});var o=n(81985),i=n(99737),a=n(7754);function r(e,t){const n=(0,o.getEnabledElement)(t),{renderingEngine:a,viewportId:r}=n,s=i.Events.ANNOTATION_ADDED,l={annotation:e,viewportId:r,renderingEngineId:a.id};(0,o.triggerEvent)(o.eventTarget,s,l)}function s(e){const{toolName:t}=e.metadata,n=(0,a.getToolGroupsWithToolName)(t);if(!n.length)return;const r=[];n.forEach((t=>{t.viewportsInfo.forEach((t=>{const{renderingEngineId:n,viewportId:i}=t,{FrameOfReferenceUID:a}=(0,o.getEnabledElementByIds)(i,n);e.metadata.FrameOfReferenceUID===a&&r.push(t)}))}));const s=i.Events.ANNOTATION_ADDED,l={annotation:e};r.length?r.forEach((({renderingEngineId:e,viewportId:t})=>{l.viewportId=t,l.renderingEngineId=e,(0,o.triggerEvent)(o.eventTarget,s,l)})):(0,o.triggerEvent)(o.eventTarget,s,l)}function l(e){const t=i.Events.ANNOTATION_REMOVED;(0,o.triggerEvent)(o.eventTarget,t,e)}function d(e,t,n=i.ChangeTypes.HandlesUpdated){const a=(0,o.getEnabledElement)(t),{viewportId:r,renderingEngineId:s}=a,l=i.Events.ANNOTATION_MODIFIED,d={annotation:e,viewportId:r,renderingEngineId:s,changeType:n};(0,o.triggerEvent)(o.eventTarget,l,d)}function c(e){u({annotation:e})}function h(e,t=!1){u({annotation:e,contourHoleProcessingEnabled:t})}function u(e){const t=i.Events.ANNOTATION_COMPLETED;(0,o.triggerEvent)(o.eventTarget,t,e)}},47807:(e,t,n)=>{"use strict";n.r(t),n.d(t,{AnnotationGroup:()=>h,FrameOfReferenceSpecificAnnotationManager:()=>l.A,config:()=>o,locking:()=>i,selection:()=>a,state:()=>r,visibility:()=>s});var o=n(49310),i=n(2076),a=n(17343),r=n(82056),s=n(29601),l=n(67013),d=n(81985),c=n(94021);class h{constructor(){this.annotationUIDs=new Set,this._isVisible=!0,this.visibleFilter=this.unboundVisibleFilter.bind(this)}unboundVisibleFilter(e){return!this._isVisible||!this.annotationUIDs.has(e)}has(e){return this.annotationUIDs.has(e)}setVisible(e=!0,t,n){this._isVisible!==e&&(this._isVisible=e,this.annotationUIDs.forEach((o=>{const i=(0,r.getAnnotation)(o);if(!i)return void this.annotationUIDs.delete(o);if(i.isVisible===e)return;if(!e&&!1===n?.(o))return;i.isVisible=e;const a={...t,annotation:i};(0,d.triggerEvent)(d.eventTarget,c.A.ANNOTATION_MODIFIED,a)})))}get isVisible(){return this._isVisible}findNearby(e,t){const n=[...this.annotationUIDs];if(0===n.length)return null;if(!e)return n[1===t?0:n.length-1];const o=n.indexOf(e);return-1===o||o+t<0||o+t>=n.length?null:n[o+t]}add(...e){e.forEach((e=>this.annotationUIDs.add(e)))}remove(...e){e.forEach((e=>this.annotationUIDs.delete(e)))}clear(){this.annotationUIDs.clear()}}},24917:(e,t,n)=>{"use strict";n.d(t,{fy:()=>m,h6:()=>f});var o=n(81985),i=n(99737),a=n(18682),r=n(93210),s=n(67014),l=n(25894),d=n(684),c=n(68040),h=n(85204),u=n(37590),g=n(7754);const p={[a.A.Labelmap]:d.Ay,[a.A.Contour]:l.A,[a.A.Surface]:s.Ay},v=u.A.toolName;function f(e){w.renderSegmentationsForViewport(e)}function m(e){w.renderSegmentation(e)}const w=new class{constructor(){this._needsRender=new Set,this._animationFrameSet=!1,this._animationFrameHandle=null,this._getAllViewports=()=>(0,o.getRenderingEngines)().flatMap((e=>e.getViewports())),this._renderFlaggedSegmentations=()=>{this._throwIfDestroyed();Array.from(this._needsRender).forEach((e=>{this._triggerRender(e)})),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null}}renderSegmentationsForViewport(e){const t=e?[e]:this._getViewportIdsForSegmentation();this._setViewportsToBeRenderedNextFrame(t)}renderSegmentation(e){const t=this._getViewportIdsForSegmentation(e);this._setViewportsToBeRenderedNextFrame(t)}_getViewportIdsForSegmentation(e){const t=this._getAllViewports(),n=[];for(const o of t){const t=o.id;if(e){const o=(0,r.r$)(t,{segmentationId:e});o?.length>0&&n.push(t)}else{const e=(0,r.r$)(t);e?.length>0&&n.push(t)}}return n}_throwIfDestroyed(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}_setViewportsToBeRenderedNextFrame(e){e.forEach((e=>{this._needsRender.add(e)})),this._render()}_render(){this._needsRender.size>0&&!1===this._animationFrameSet&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedSegmentations),this._animationFrameSet=!0)}_triggerRender(e){const t=(0,r.r$)(e);if(!t?.length)return;const{viewport:n}=(0,o.getEnabledElementByViewportId)(e)||{};if(!n)return;const a=[],s=t.map((e=>{e.type===i.SegmentationRepresentations.Contour&&this._addPlanarFreeHandToolIfAbsent(n);const t=p[e.type];try{const o=t.render(n,e);a.push(o)}catch(e){console.error(e)}return Promise.resolve({segmentationId:e.segmentationId,type:e.type})}));Promise.allSettled(s).then((e=>{const t=e.filter((e=>"fulfilled"===e.status)).map((e=>e.value));n.element.addEventListener(o.Enums.Events.IMAGE_RENDERED,(function e(n){const{element:a,viewportId:r}=n.detail;a.removeEventListener(o.Enums.Events.IMAGE_RENDERED,e),t.forEach((e=>{const t={viewportId:r,segmentationId:e.segmentationId,type:e.type};(0,o.triggerEvent)(o.eventTarget,i.Events.SEGMENTATION_RENDERED,{...t})}))})),n.render()}))}_addPlanarFreeHandToolIfAbsent(e){v in h.wk.tools||(0,c.Gx)(u.A);const t=(0,g.getToolGroupForViewport)(e.id);t.hasTool(v)||(t.addTool(v),t.setToolPassive(v))}}},59475:(e,t,n)=>{"use strict";n.d(t,{Zm:()=>h,_6:()=>p,cC:()=>u});var o=n(81985),i=n(99737),a=n(33739),r=n(99341),s=n(49906),l=n(92686),d=n(75419);const c={colorLUT:[],segmentations:[],viewportSegRepresentations:{}};async function h({imageIds:e,options:t}){const n=e,i=t?.volumeId||o.utilities.uuidv4();return await o.volumeLoader.createAndCacheVolumeFromImages(i,n),{volumeId:i}}async function u({segmentationId:e,options:t}){const n=p.getSegmentation(e),o=n.representationData.Labelmap,{volumeId:i}=await h({imageIds:o.imageIds,options:t});n.representationData.Labelmap.volumeId=i}function g(e){const t=a.Ay.newInstance(),n=r.Ay.newInstance();return n.addPoint(0,0),e===i.SegmentationRepresentations.Labelmap?{cfun:t,ofun:n}:{}}const p=new class{constructor(e){this._stackLabelmapImageIdReferenceMap=new Map,e||=o.utilities.uuidv4(),this.state=Object.freeze(o.utilities.deepClone(c)),this.uid=e}getState(){return this.state}updateState(e){const t=o.utilities.deepClone(this.state);e(t),this.state=Object.freeze(t)}getColorLUT(e){return this.state.colorLUT[e]}getNextColorLUTIndex(){return this.state.colorLUT.length}resetState(){this.state=Object.freeze(o.utilities.deepClone(c))}getSegmentation(e){return this.state.segmentations.find((t=>t.segmentationId===e))}updateSegmentation(e,t){this.updateState((n=>{const o=n.segmentations.find((t=>t.segmentationId===e));o?Object.assign(o,t):console.warn(`Segmentation with id ${e} not found. Update aborted.`)})),(0,s.triggerSegmentationModified)(e)}addSegmentation(e){if(this.getSegmentation(e.segmentationId))throw new Error(`Segmentation with id ${e.segmentationId} already exists`);this.updateState((t=>{const n=o.utilities.deepClone(e);if(n.representationData.Labelmap&&"volumeId"in n.representationData.Labelmap&&!("imageIds"in n.representationData.Labelmap)){const e=this.getLabelmapImageIds(n.representationData);n.representationData.Labelmap.imageIds=e}t.segmentations.push(n)})),(0,d.R)(e.segmentationId)}removeSegmentation(e){this.updateState((t=>{const n=t.segmentations.filter((t=>t.segmentationId!==e));t.segmentations.splice(0,t.segmentations.length,...n)})),(0,s.triggerSegmentationRemoved)(e)}addSegmentationRepresentation(e,t,n,a){if(!(0,o.getEnabledElementByViewportId)(e))return;this.getSegmentationRepresentations(e,{type:n,segmentationId:t}).length>0?console.debug("A segmentation representation of type",n,"already exists in viewport",e,"for segmentation",t):(this.updateState((o=>{o.viewportSegRepresentations[e]||(o.viewportSegRepresentations[e]=[],l.Y.setRenderInactiveSegmentations(e,!0)),n!==i.SegmentationRepresentations.Labelmap?this.addDefaultSegmentationRepresentation(o,e,t,n,a):this.addLabelmapRepresentation(o,e,t,a)})),(0,s.triggerSegmentationRepresentationModified)(e,t,n))}addDefaultSegmentationRepresentation(e,t,n,o,i){const a=e.segmentations.find((e=>e.segmentationId===n));if(!a)return;const r={};Object.keys(a.segments).forEach((e=>{r[Number(e)]={visible:!0}})),e.viewportSegRepresentations[t].push({segmentationId:n,type:o,active:!0,visible:!0,colorLUTIndex:0,segments:r,config:{...g(o),...i}}),this._setActiveSegmentation(e,t,n)}addLabelmapRepresentation(e,t,n,a=g(i.SegmentationRepresentations.Labelmap)){if(!(0,o.getEnabledElementByViewportId)(t))return;const r=this.getSegmentation(n);if(!r)return;const{representationData:s}=r;if(!s.Labelmap)return this.addDefaultSegmentationRepresentation(e,t,n,i.SegmentationRepresentations.Labelmap,a);this.processLabelmapRepresentationAddition(t,n),this.addDefaultSegmentationRepresentation(e,t,n,i.SegmentationRepresentations.Labelmap,a)}async processLabelmapRepresentationAddition(e,t){const n=(0,o.getEnabledElementByViewportId)(e);if(!n)return;const i=this.getSegmentation(t);if(!i)return;const a=n.viewport instanceof o.BaseVolumeViewport,{representationData:r}=i,s="volumeId"in r.Labelmap;n.viewport;a||s||this.updateLabelmapSegmentationImageReferences(e,i.segmentationId)}_updateLabelmapSegmentationReferences(e,t,n,o){const i=t.getCurrentImageId();let a=!1;for(const o of n){t.isReferenceViewable({referencedImageId:o},{asOverlay:!0})&&(a=!0,this._stackLabelmapImageIdReferenceMap.get(e).set(i,o))}return o&&o(t,e,n),a?this._stackLabelmapImageIdReferenceMap.get(e).get(i):void 0}updateLabelmapSegmentationImageReferences(e,t){const n=this.getSegmentation(t);if(!n)return;this._stackLabelmapImageIdReferenceMap.has(t)||this._stackLabelmapImageIdReferenceMap.set(t,new Map);const{representationData:i}=n;if(!i.Labelmap)return;const a=this.getLabelmapImageIds(i),r=(0,o.getEnabledElementByViewportId)(e).viewport;return this._updateLabelmapSegmentationReferences(t,r,a,null)}_updateAllLabelmapSegmentationImageReferences(e,t){const n=this.getSegmentation(t);if(!n)return;this._stackLabelmapImageIdReferenceMap.has(t)||this._stackLabelmapImageIdReferenceMap.set(t,new Map);const{representationData:i}=n;if(!i.Labelmap)return;const a=this.getLabelmapImageIds(i),r=(0,o.getEnabledElementByViewportId)(e).viewport;this._updateLabelmapSegmentationReferences(t,r,a,((e,t,n)=>{e.getImageIds().forEach(((o,i)=>{for(const a of n){e.isReferenceViewable({referencedImageId:a,sliceIndex:i},{asOverlay:!0,withNavigation:!0})&&this._stackLabelmapImageIdReferenceMap.get(t).set(o,a)}}))}))}getLabelmapImageIds(e){const t=e.Labelmap;let n;if(t.imageIds)n=t.imageIds;else if(!n&&t.volumeId){const e=t.volumeId;n=o.cache.getVolume(e).imageIds}return n}getCurrentLabelmapImageIdForViewport(e,t){const n=(0,o.getEnabledElementByViewportId)(e);if(!n)return;if(!this._stackLabelmapImageIdReferenceMap.has(t))return;const i=n.viewport.getCurrentImageId();return this._stackLabelmapImageIdReferenceMap.get(t).get(i)}getStackSegmentationImageIdsForViewport(e,t){if(!this.getSegmentation(t))return[];this._updateAllLabelmapSegmentationImageReferences(e,t);const{viewport:n}=(0,o.getEnabledElementByViewportId)(e),i=n.getImageIds(),a=this._stackLabelmapImageIdReferenceMap.get(t);return i.map((e=>a.get(e)))}removeSegmentationRepresentationsInternal(e,t){const n=[];return this.updateState((o=>{if(!o.viewportSegRepresentations[e])return;const i=o.viewportSegRepresentations[e];let a=!1;if(!t||Object.values(t).every((e=>void 0===e)))n.push(...i),delete o.viewportSegRepresentations[e];else{const{segmentationId:r,type:s}=t;o.viewportSegRepresentations[e]=i.filter((e=>{const t=r&&s&&e.segmentationId===r&&e.type===s||r&&!s&&e.segmentationId===r||!r&&s&&e.type===s;return t&&(n.push(e),e.active&&(a=!0)),!t})),0===o.viewportSegRepresentations[e].length?delete o.viewportSegRepresentations[e]:a&&(o.viewportSegRepresentations[e][0].active=!0)}})),n}removeSegmentationRepresentations(e,t){const n=this.removeSegmentationRepresentationsInternal(e,t);n.forEach((t=>{(0,s.triggerSegmentationRepresentationRemoved)(e,t.segmentationId,t.type)}));const o=this.getSegmentationRepresentations(e);return o.length>0&&o[0].active&&(0,s.triggerSegmentationRepresentationModified)(e,o[0].segmentationId,o[0].type),n}removeSegmentationRepresentation(e,t,n){const o=this.removeSegmentationRepresentationsInternal(e,t);return n||o.forEach((({segmentationId:t,type:n})=>{(0,s.triggerSegmentationRepresentationRemoved)(e,t,n)})),o}_setActiveSegmentation(e,t,n){const o=e.viewportSegRepresentations[t];o&&o.forEach((e=>{e.active=e.segmentationId===n}))}setActiveSegmentation(e,t){this.updateState((n=>{const o=n.viewportSegRepresentations[e];o&&o.forEach((e=>{e.active=e.segmentationId===t}))})),(0,s.triggerSegmentationRepresentationModified)(e,t)}getActiveSegmentation(e){if(!this.state.viewportSegRepresentations[e])return;const t=this.state.viewportSegRepresentations[e].find((e=>e.active));return t?this.getSegmentation(t.segmentationId):void 0}getSegmentationRepresentations(e,t={}){const n=this.state.viewportSegRepresentations[e];return n?t.type||t.segmentationId?n.filter((e=>{const n=!t.type||e.type===t.type,o=!t.segmentationId||e.segmentationId===t.segmentationId;return n&&o})):n:[]}getSegmentationRepresentation(e,t){return this.getSegmentationRepresentations(e,t)[0]}getSegmentationRepresentationVisibility(e,t){const n=this.getSegmentationRepresentation(e,t);return n?.visible}setSegmentationRepresentationVisibility(e,t,n){this.updateState((o=>{const i=this.getSegmentationRepresentations(e,t);i&&i.forEach((e=>{e.visible=n,Object.entries(e.segments).forEach((([e,t])=>{t.visible=n}))}))})),(0,s.triggerSegmentationRepresentationModified)(e,t.segmentationId,t.type)}addColorLUT(e,t){this.updateState((n=>{n.colorLUT[t]&&console.warn("Color LUT table already exists, overwriting"),n.colorLUT[t]=o.utilities.deepClone(e)}))}removeColorLUT(e){this.updateState((t=>{delete t.colorLUT[e]}))}_getStackIdForImageIds(e){return e.map((e=>e.slice(-Math.round(.15*e.length)))).join("_")}getAllViewportSegmentationRepresentations(){return Object.entries(this.state.viewportSegRepresentations).map((([e,t])=>({viewportId:e,representations:t})))}getSegmentationRepresentationsBySegmentationId(e){const t=[];return Object.entries(this.state.viewportSegRepresentations).forEach((([n,o])=>{const i=o.filter((t=>t.segmentationId===e));i.length>0&&t.push({viewportId:n,representations:i})})),t}}("DEFAULT")},92686:(e,t,n)=>{"use strict";n.d(t,{Y:()=>s});var o=n(67772),i=n(53486),a=n(99737),r=n(81985);const s=new class{constructor(){this.config={global:{},segmentations:{},viewportsStyle:{}}}setStyle(e,t){const{viewportId:n,segmentationId:o,type:i,segmentIndex:a}=e,r=this.getStyle(e);let s;if(s=n||o?this.copyActiveToInactiveIfNotProvided({...r,...t},i):{...r,...t},!i)throw new Error("Type is required to set a style");if(n){this.config.viewportsStyle[n]||(this.config.viewportsStyle[n]={renderInactiveSegmentations:!1,representations:{}});const e=this.config.viewportsStyle[n].representations;if(o){e[o]||(e[o]={}),e[o][i]||(e[o][i]={});const t=e[o][i];void 0!==a?(t.perSegment||(t.perSegment={}),t.perSegment[a]=s):t.allSegments=s}else{const t="__allSegmentations__";e[t]||(e[t]={}),e[t][i]||(e[t][i]={}),e[t][i].allSegments=s}}else if(o){this.config.segmentations[o]||(this.config.segmentations[o]={}),this.config.segmentations[o][i]||(this.config.segmentations[o][i]={});const e=this.config.segmentations[o][i];void 0!==a?(e.perSegment||(e.perSegment={}),e.perSegment[a]=s):e.allSegments=s}else this.config.global[i]=s}copyActiveToInactiveIfNotProvided(e,t){const n={...e};if(t===a.SegmentationRepresentations.Labelmap){const e=n;e.renderOutlineInactive=e.renderOutline,e.outlineWidthInactive=e.outlineWidth,e.renderFillInactive=e.renderFill,e.fillAlphaInactive=e.fillAlpha,e.outlineOpacityInactive=e.outlineOpacity}else if(t===a.SegmentationRepresentations.Contour){const e=n;e.outlineWidthInactive=e.outlineWidth,e.outlineOpacityInactive=e.outlineOpacity,e.outlineDashInactive=e.outlineDash,e.renderOutlineInactive=e.renderOutline,e.renderFillInactive=e.renderFill,e.fillAlphaInactive=e.fillAlpha}return n}getStyle(e){const{viewportId:t,segmentationId:n,type:o,segmentIndex:i}=e;let a=this.getDefaultStyle(o),r=!1;if(this.config.global[o]&&(a={...a,...this.config.global[o]}),this.config.segmentations[n]?.[o]&&(a={...a,...this.config.segmentations[n][o].allSegments},void 0!==i&&this.config.segmentations[n][o].perSegment?.[i]&&(a={...a,...this.config.segmentations[n][o].perSegment[i]})),t&&this.config.viewportsStyle[t]){r=this.config.viewportsStyle[t].renderInactiveSegmentations;const e="__allSegmentations__";this.config.viewportsStyle[t].representations[e]?.[o]&&(a={...a,...this.config.viewportsStyle[t].representations[e][o].allSegments}),n&&this.config.viewportsStyle[t].representations[n]?.[o]&&(a={...a,...this.config.viewportsStyle[t].representations[n][o].allSegments},void 0!==i&&this.config.viewportsStyle[t].representations[n][o].perSegment?.[i]&&(a={...a,...this.config.viewportsStyle[t].representations[n][o].perSegment[i]}))}return a}getRenderInactiveSegmentations(e){return this.config.viewportsStyle[e]?.renderInactiveSegmentations}setRenderInactiveSegmentations(e,t){this.config.viewportsStyle[e]||(this.config.viewportsStyle[e]={renderInactiveSegmentations:!1,representations:{}}),this.config.viewportsStyle[e].renderInactiveSegmentations=t}getDefaultStyle(e){switch(e){case a.SegmentationRepresentations.Labelmap:return(0,i.A)();case a.SegmentationRepresentations.Contour:return(0,o.A)();case a.SegmentationRepresentations.Surface:return{};default:throw new Error(`Unknown representation type: ${e}`)}}clearSegmentationStyle(e){this.config.segmentations[e]&&delete this.config.segmentations[e]}clearAllSegmentationStyles(){this.config.segmentations={}}clearViewportStyle(e){this.config.viewportsStyle[e]&&delete this.config.viewportsStyle[e]}clearAllViewportStyles(){for(const e in this.config.viewportsStyle){const t=this.config.viewportsStyle[e].renderInactiveSegmentations;this.config.viewportsStyle[e]={renderInactiveSegmentations:t,representations:{}}}}resetToGlobalStyle(){this.clearAllSegmentationStyles(),this.clearAllViewportStyles()}hasCustomStyle(e){const{type:t}=e,n=this.getStyle(e),o=this.getDefaultStyle(t);return!r.utilities.deepEqual(n,o)}}},26228:(e,t,n)=>{"use strict";n.r(t),n.d(t,{getActiveSegmentation:()=>a,setActiveSegmentation:()=>r});var o=n(67165),i=n(59475);function a(e){return(0,o.T)(e)}function r(e,t,n=!1){!function(e,t){i._6.setActiveSegmentation(e,t)}(e,t)}},4714:(e,t,n)=>{"use strict";n.d(t,{u:()=>s});var o=n(81985),i=n(59475),a=n(70906),r=n(93952);function s(e,t){const n=i._6,s=t??(0,a.u)();let l=[...e];if(o.utilities.isEqual(l[0],[0,0,0,0])||(console.warn("addColorLUT: [0, 0, 0, 0] color is not provided for the background color (segmentIndex =0), automatically adding it"),l=[[0,0,0,0],...l]),l=l.map((e=>3===e.length?[e[0],e[1],e[2],255]:e)),l.length<255){const e=r.A.slice(l.length);l=[...l,...e]}return n.addColorLUT(l,s),s}},38816:(e,t,n)=>{"use strict";n.d(t,{At:()=>g,cs:()=>p,Wz:()=>v,w9:()=>f,gR:()=>u,Hr:()=>m,$j:()=>w});var o=n(99737),i=n(93952),a=n(58640),r=n(49906),s=n(4714),l=n(70906),d=n(59475),c=n(50409);function h(e){const{colorLUTOrIndex:t}=e||{},n="number"==typeof t,o=n?(0,c.B)(t):i.A,a=n?t:(0,l.u)();return n||(0,s.u)(o,a),a}function u(e,t){t.map((t=>function(e,t){const{segmentationId:n,config:i}=t,s={colorLUTIndex:h(i)};d._6.addSegmentationRepresentation(e,n,t.type,s),t.type===o.SegmentationRepresentations.Contour&&(0,a.t)([e]),(0,r.triggerSegmentationModified)(n)}(e,t)))}function g(e,t){return u(e,t.map((e=>({...e,type:o.SegmentationRepresentations.Contour}))))}function p(e){const t={};for(const[n,o]of Object.entries(e))t[n]=g(n,o);return t}function v(e,t){return u(e,t.map((e=>({...e,type:o.SegmentationRepresentations.Labelmap}))))}function f(e){const t={};for(const[n,i]of Object.entries(e))t[n]=v(n,i.map((e=>({...e,type:o.SegmentationRepresentations.Labelmap}))))}function m(e,t){return u(e,t.map((e=>({...e,type:o.SegmentationRepresentations.Surface}))))}function w(e){const t={};for(const[n,o]of Object.entries(e))t[n]=m(n,o);return t}},30935:(e,t,n)=>{"use strict";n.d(t,{d:()=>l});var o=n(59475),i=n(49906),a=n(99737),r=n(81985);const s=function(e){const{segmentationId:t,representation:n,config:o}=e,{type:i,data:s}=n,l=s?{...s}:{};if(!l)throw new Error("Segmentation representation data may not be undefined");var d;i===a.SegmentationRepresentations.Contour&&((d=l).geometryIds=d.geometryIds??[],d.annotationUIDsMap=d.annotationUIDsMap??new Map);const c=function(e,t,n){const o={};e?Object.entries(e).forEach((([e,t])=>{o[e]={segmentIndex:Number(e),label:t.label??`Segment ${e}`,locked:t.locked??!1,cachedStats:t.cachedStats??{},active:t.active??!1}})):t===a.SegmentationRepresentations.Surface?function(e,t){const{geometryIds:n}=t;n.forEach((t=>{const n=r.cache.getGeometry(t);if(n?.data){const{segmentIndex:t}=n.data;e[t]={segmentIndex:t}}}))}(o,n):o[1]={segmentIndex:1,label:"Segment 1",locked:!1,cachedStats:{},active:!0};return o}(o?.segments,i,l);return delete o?.segments,{segmentationId:t,label:o?.label??null,cachedStats:o?.cachedStats??{},segments:c,representationData:{[i]:{...l}}}};function l(e,t){const n=o._6;e.forEach((e=>{const o=s(e);n.addSegmentation(o),t||(0,i.triggerSegmentationModified)(o.segmentationId)}))}},93733:(e,t,n)=>{"use strict";n.r(t),n.d(t,{addColorLUT:()=>s,getSegmentIndexColor:()=>d,setColorLUT:()=>l,setSegmentIndexColor:()=>c});var o=n(4714),i=n(50409),a=n(93210),r=n(49906);function s(e,t){if(!e)throw new Error("addColorLUT: colorLUT is required");return(0,o.u)(e,t)}function l(e,t,n){if(!(0,i.B)(n))throw new Error(`setColorLUT: could not find colorLUT with index ${n}`);const o=(0,a.r$)(e,{segmentationId:t});if(!o)throw new Error(`viewport specific state for viewport ${e} does not exist`);o.forEach((e=>{e.colorLUTIndex=n})),(0,r.triggerSegmentationRepresentationModified)(e,t)}function d(e,t,n){const o=(0,a.r$)(e,{segmentationId:t});if(!o||0===o.length)return null;const r=o[0],{colorLUTIndex:s}=r,l=(0,i.B)(s);let d=l[n];if(!d){if("number"!=typeof n)throw new Error(`Can't create colour for LUT index ${n}`);d=l[n]=[0,0,0,0]}return d}function c(e,t,n,o){const i=d(e,t,n);for(let e=0;e<o.length;e++)i[e]=o[e];(0,r.triggerSegmentationRepresentationModified)(e,t)}},98798:(e,t,n)=>{"use strict";n.d(t,{Q:()=>r});var o=n(81985),i=n(99737),a=n(64063);function r(e,t){const n={segmentationId:e,modifiedSlicesToUse:t};(0,a.HM)(e),(0,o.triggerEvent)(o.eventTarget,i.Events.SEGMENTATION_DATA_MODIFIED,n)}},60740:(e,t,n)=>{"use strict";n.d(t,{Q:()=>i});var o=n(33283);function i(e){const t=(0,o.T)(e);if(t){const e=Object.keys(t.segments).find((e=>t.segments[e].active));return e?Number(e):void 0}}},67165:(e,t,n)=>{"use strict";n.d(t,{T:()=>i});var o=n(59475);function i(e){return o._6.getActiveSegmentation(e)}},50409:(e,t,n)=>{"use strict";n.d(t,{B:()=>i});var o=n(59475);function i(e){return o._6.getColorLUT(e)}},97577:(e,t,n)=>{"use strict";n.d(t,{v:()=>i});var o=n(59475);function i(e,t){return o._6.getCurrentLabelmapImageIdForViewport(e,t)}},70906:(e,t,n)=>{"use strict";n.d(t,{u:()=>i});var o=n(59475);function i(){return o._6.getNextColorLUTIndex()}},93210:(e,t,n)=>{"use strict";n.d(t,{Ut:()=>a,ny:()=>r,r$:()=>i});var o=n(59475);function i(e,t={}){return o._6.getSegmentationRepresentations(e,t)}function a(e,t){const n=o._6;if(!t.segmentationId||!t.type)throw new Error("getSegmentationRepresentation: No segmentationId or type provided, you need to provide at least one of them");const i=n.getSegmentationRepresentations(e,t);return i?.[0]}function r(e){return o._6.getSegmentationRepresentationsBySegmentationId(e)}},33658:(e,t,n)=>{"use strict";n.d(t,{I:()=>i});var o=n(59475);function i(e,t){return o._6.getSegmentationRepresentationVisibility(e,t)}},70758:(e,t,n)=>{"use strict";n.d(t,{K:()=>i});var o=n(59475);function i(){return o._6.getState().segmentations}},58859:(e,t,n)=>{"use strict";n.d(t,{P:()=>i});var o=n(59475);function i(e){const t=o._6.getState().viewportSegRepresentations;return Object.entries(t).filter((([,t])=>t.some((t=>t.segmentationId===e)))).map((([e])=>e))}},42568:(e,t,n)=>{"use strict";n.d(t,{a:()=>a});var o=n(33283),i=n(59475);function a(e,t){return i._6.getState().viewportSegRepresentations[e].map((e=>(t&&e.type,(0,o.T)(e.segmentationId)))).filter((e=>void 0!==e))}},6994:(e,t,n)=>{"use strict";n.d(t,{a:()=>i});var o=n(59475);async function i(e){return(0,o.Zm)(e)}},1300:(e,t,n)=>{"use strict";n.r(t),n.d(t,{activeSegmentation:()=>g,addContourRepresentationToViewport:()=>l.At,addContourRepresentationToViewportMap:()=>l.cs,addLabelmapRepresentationToViewport:()=>l.Wz,addLabelmapRepresentationToViewportMap:()=>l.w9,addSegmentationRepresentations:()=>l.gR,addSegmentations:()=>d.d,addSurfaceRepresentationToViewport:()=>l.Hr,addSurfaceRepresentationToViewportMap:()=>l.$j,config:()=>a,getLabelmapImageIds:()=>Z,helpers:()=>Y,polySeg:()=>r,removeAllSegmentationRepresentations:()=>s.us,removeAllSegmentations:()=>K.j,removeContourRepresentation:()=>s.OE,removeLabelmapRepresentation:()=>s.kN,removeSegment:()=>q,removeSegmentation:()=>K.z,removeSegmentationRepresentation:()=>s.E8,removeSegmentationRepresentations:()=>s.nc,removeSurfaceRepresentation:()=>s.JC,segmentIndex:()=>L,segmentLocking:()=>p,state:()=>v,triggerSegmentationEvents:()=>h,updateSegmentations:()=>u});var o={};n.r(o),n.d(o,{getHiddenSegmentIndices:()=>C,getSegmentIndexVisibility:()=>_,getSegmentationRepresentationVisibility:()=>y,setSegmentIndexVisibility:()=>I,setSegmentationRepresentationVisibility:()=>b});var i={};n.r(i),n.d(i,{getRenderInactiveSegmentations:()=>M,getStyle:()=>D,hasCustomStyle:()=>k,resetToGlobalStyle:()=>R,setRenderInactiveSegmentations:()=>O,setStyle:()=>A});var a={};n.r(a),n.d(a,{color:()=>f,style:()=>i,visibility:()=>o});var r={};n.r(r),n.d(r,{canComputeRequestedRepresentation:()=>H.n,computeAndAddContourRepresentation:()=>B.D,computeAndAddLabelmapRepresentation:()=>V.z,computeAndAddSurfaceRepresentation:()=>U.o});var s=n(53662),l=n(38816),d=n(30935),c=n(59475),h=n(49906);function u(e,t){const n=c._6;e.forEach((e=>{n.updateSegmentation(e.segmentationId,e.payload),t||(0,h.triggerSegmentationModified)(e.segmentationId)}))}var g=n(26228),p=n(26795),v=n(98870),f=n(93733),m=n(93210);var w=n(33658),E=n(24917);function b(e,t,n){const o=(0,m.r$)(e,t);o&&o.forEach((t=>{!function(e,t,n){c._6.setSegmentationRepresentationVisibility(e,t,n)}(e,{segmentationId:t.segmentationId,type:t.type},n)}))}function y(e,t){return(0,w.I)(e,t)}function I(e,t,n,o){const i=(0,m.r$)(e,t);i&&(i.forEach((e=>{e.segments[n].visible=o})),(0,E.fy)(t.segmentationId),(0,h.triggerSegmentationRepresentationModified)(e,t.segmentationId))}function _(e,t,n){return!C(e,t).has(n)}function C(e,t){const n=(0,m.Ut)(e,t);if(!n)return new Set;return Object.entries(n.segments).reduce(((e,[t,n])=>(n.visible||e.add(Number(t)),e)),new Set)}var T=n(70758),S=n(42568),x=n(92686);function D(e){return x.Y.getStyle(e)}function A(e,t){if(x.Y.setStyle(e,t),!e.viewportId&&!e.segmentationId){(0,T.K)().forEach((e=>{(0,E.h6)(e.segmentationId)}))}(0,h.triggerSegmentationRepresentationModified)(e.viewportId,e.segmentationId,e.type)}function O(e,t){x.Y.setRenderInactiveSegmentations(e,t),(0,E.h6)(e);(0,S.a)(e).forEach((t=>{(0,h.triggerSegmentationRepresentationModified)(e,t.segmentationId)}))}function M(e){return x.Y.getRenderInactiveSegmentations(e)}function R(){x.Y.resetToGlobalStyle(),(0,E.h6)()}function k(e){return x.Y.hasCustomStyle(e)}var L=n(70930),P=n(6273),N=n(6994),U=n(58062),V=n(79462),B=n(13654),H=n(69073),W=n(81985),F=n(33283);function j(e,t){const n=(0,F.T)(e);if(!n.representationData.Labelmap)throw new Error("Invalid segmentation type, only labelmap is supported right now");{const{representationData:o}=n,i=o.Labelmap;if("imageIds"in i||"volumeId"in i){("imageIds"in i?i.imageIds.map((e=>W.cache.getImage(e))):[W.cache.getVolume(i.volumeId)]).forEach((e=>{if(!e)return;const{voxelManager:n}=e;n.forEach((({value:e,index:o})=>{e===t&&n.setAtIndex(o,0)}))}))}(0,h.triggerSegmentationDataModified)(e)}}var G=n(21),$=n(60740),z=n(58859);function q(e,t,n={setNextSegmentAsActive:!0}){j(e,t);const o=(0,$.Q)(e)===t,i=(0,F.T)(e),{segments:a}=i;delete a[t];const r={...a};if(u([{segmentationId:e,payload:{segments:r}}]),o&&n.setNextSegmentAsActive){const n=Object.keys(a).map(Number).sort(((e,t)=>e-t)),o=n.indexOf(t),i=n[o+1],r=n[o-1];void 0!==i?(0,L.setActiveSegmentIndex)(e,i):void 0!==r&&(0,L.setActiveSegmentIndex)(e,r)}(0,z.P)(e).forEach((n=>{(0,m.r$)(n,{segmentationId:e}).forEach((e=>{delete e.segments[t]}))}))}function Z(e){const t=c._6,n=(0,F.T)(e);return t.getLabelmapImageIds(n.representationData)}var K=n(63427);const Y={clearSegmentValue:j,convertStackToVolumeLabelmap:P.p,computeVolumeLabelmapFromStack:N.a,convertVolumeToStackLabelmap:G.f}},13654:(e,t,n)=>{"use strict";n.d(t,{D:()=>r});var o=n(99737),i=n(56005),a=n(75499);function r(e,t={}){return(0,i.d)(e,o.SegmentationRepresentations.Contour,(()=>(0,a.c)(e,t)),(()=>{}))}},79462:(e,t,n)=>{"use strict";n.d(t,{z:()=>l});var o=n(99737),i=n(56005),a=n(89661),r=n(59475),s=n(49906);async function l(e,t={}){return(0,i.d)(e,o.SegmentationRepresentations.Labelmap,(()=>(0,a.Y)(e,t)),(()=>null),(()=>{r._6.processLabelmapRepresentationAddition(t.viewport.id,e),setTimeout((()=>{(0,s.triggerSegmentationDataModified)(e)}),0)}))}},58062:(e,t,n)=>{"use strict";n.d(t,{o:()=>g});var o=n(99737),i=n(56005),a=n(42867),r=n(81985),s=n(25758),l=n(58859),d=n(33283),c=n(49906),h=n(93210),u=n(85884);function g(e,t={}){return(0,i.d)(e,o.SegmentationRepresentations.Surface,(()=>(0,a.HN)(e,t)),(()=>async function(e){const t=await(0,a.HE)(e);if(!t)return;const n=(0,d.T)(e),i=(0,s.O)(e);if(!i.length)return n.representationData.Surface.geometryIds.forEach((e=>{const t=r.cache.getGeometry(e).data;t.points=[],t.polys=[]})),void(0,c.triggerSegmentationModified)(e);const g=t.map((({data:t,segmentIndex:a})=>{const s=`segmentation_${e}_surface_${a}`,d=r.cache.getGeometry(s);if(!d)return(0,l.P)(e).map((i=>[(0,h.Ut)(i,{segmentationId:e,type:o.SegmentationRepresentations.Surface})].map((o=>(n.representationData.Surface.geometryIds.set(a,s),(0,u.Y)(e,[{segmentIndex:a,data:t}],{segmentationId:o.segmentationId}))))));if(i.includes(a)){const e=d.data;e.points=t.points,e.polys=t.polys}else{const e=d.data;e.points=[],e.polys=[]}}));await Promise.all(g),(0,c.triggerSegmentationModified)(e)}(e)))}},85884:(e,t,n)=>{"use strict";n.d(t,{Y:()=>r});var o=n(81985),i=n(93733),a=n(33283);async function r(e,t,n={}){const r=(0,a.T)(e),s=new Map,l=Object.keys(t).map((async e=>{const a=t[e],l=a.segmentIndex,d=(0,i.getSegmentIndexColor)(n.viewport.id,r.segmentationId,l).slice(0,3);if(!d)throw new Error("No color found for segment index, unable to create surface");const c={id:`segmentation_${r.segmentationId}_surface_${l}`,color:d,frameOfReferenceUID:"test-frameOfReferenceUID",points:a.data.points,polys:a.data.polys,segmentIndex:l},h=c.id;return s.set(l,h),o.geometryLoader.createAndCacheGeometry(h,{type:o.Enums.GeometryType.SURFACE,geometryData:c})}));return await Promise.all(l),{geometryIds:s}}},42867:(e,t,n)=>{"use strict";n.d(t,{HN:()=>p,HE:()=>v});var o=n(25758),i=n(33283),a=n(81985),r=n(82056),s=n(99737);const l=(0,a.getWebWorkerManager)(),d=(e,t,n)=>{(0,a.triggerEvent)(e,a.Enums.Events.WEB_WORKER_PROGRESS,{progress:t,type:s.WorkerTypes.POLYSEG_CONTOUR_TO_SURFACE,id:n})};var c=n(85884),h=n(6994);const u=(0,a.getWebWorkerManager)(),g=(e,t,n)=>{(0,a.triggerEvent)(e,a.Enums.Events.WEB_WORKER_PROGRESS,{progress:t,type:s.WorkerTypes.POLYSEG_LABELMAP_TO_SURFACE,id:n})};async function p(e,t={}){const n=t.segmentIndices?.length?t.segmentIndices:(0,o.O)(e);let s;const h=(0,i.T)(e),u=h.representationData;try{u.Contour?s=await async function(e,t={}){const n=(0,i.T)(e),s=n.representationData.Contour,c=t.segmentIndices||(0,o.O)(e),h=c.map((async e=>{const t=await async function(e,t){const{annotationUIDsMap:n}=e,o=[],i=[],s=n.get(t);for(const e of s){const t=(0,r.getAnnotation)(e),{polyline:n}=t.data.contour;i.push(n.length),n.forEach((e=>o.push(...e)))}d(a.eventTarget,0,t);const c=await l.executeTask("polySeg","convertContourToSurface",{polylines:o,numPointsArray:i},{callbacks:[e=>{d(a.eventTarget,e,t)}]});return d(a.eventTarget,100,t),c}(s,e);return{segmentIndex:e,data:t}}));return await Promise.all(h)}(e,{segmentIndices:n,...t}):u.Labelmap&&(s=await v(h.segmentationId,{segmentIndices:n,...t}))}catch(e){throw console.error(e),e}if(!s)throw new Error("Not enough data to convert to surface, currently only support converting volume labelmap to surface if available");return await(0,c.Y)(e,s,t)}async function v(e,t={}){const n=(0,i.T)(e);if(!n?.representationData?.Labelmap)return void console.warn("Only support surface update from labelmaps");const r=n.representationData.Labelmap,s=t.segmentIndices||(0,o.O)(e),l=s.map((e=>{const t=async function(e,t){let n;if(e.volumeId)n=e.volumeId;else{const{imageIds:t}=e;({volumeId:n}=await(0,h.a)({imageIds:t}))}const o=a.cache.getVolume(n),i=o.voxelManager.getCompleteScalarDataArray(),{dimensions:r,spacing:s,origin:l,direction:d}=o;g(a.eventTarget,0,t);const c=await u.executeTask("polySeg","convertLabelmapToSurface",{scalarData:i,dimensions:r,spacing:s,origin:l,direction:d,segmentIndex:t},{callbacks:[e=>{g(a.eventTarget,e,t)}]});return g(a.eventTarget,100,t),c}(r,e);return t})),d=await Promise.allSettled(l),c=d.filter((e=>"rejected"===e.status));if(c.length>0)throw console.error(c),new Error("Failed to convert labelmap to surface");return d.map(((e,t)=>{if("fulfilled"===e.status)return{segmentIndex:s[t],data:e.value}})).filter(Boolean)}},69073:(e,t,n)=>{"use strict";n.d(t,{n:()=>s});var o=n(99737),i=n(33283),a=n(6934);const r=new Map([[o.SegmentationRepresentations.Labelmap,new Set([o.SegmentationRepresentations.Surface,o.SegmentationRepresentations.Contour])],[o.SegmentationRepresentations.Contour,new Set([o.SegmentationRepresentations.Labelmap,o.SegmentationRepresentations.Surface])],[o.SegmentationRepresentations.Surface,new Set([o.SegmentationRepresentations.Labelmap])]]);function s(e,t){const{representationData:n}=(0,i.T)(e),s=function(e){const t=[];return Object.keys(e).forEach((n=>{const i=e[n];let r;if(n===o.SegmentationRepresentations.Labelmap)r=a.t;if(r)try{r(i),t.push(n)}catch(e){console.warn(`Validation failed for labelmap of type ${n}`)}else t.push(n)})),t}(n);return s.some((e=>async function(e,t){return r.get(e)?.has(t)||!1}(e,t)))}},56005:(e,t,n)=>{"use strict";n.d(t,{d:()=>c});var o=n(81985),i=n(99737),a=n(44188),r=n(49906),s=n(52905),l=n(31199);const d=new Map;async function c(e,t,n,s,c){(0,l.b)();const u=await n();(0,a.A)({segmentationId:e,type:t,data:u}),c?.(),d.has(e)||d.set(e,[]);const g=d.get(e);return g.includes(t)||g.push(t),function(e){const t=t=>{h(t,e)};e._debouncedUpdateFunction=t,o.eventTarget.removeEventListener(i.Events.SEGMENTATION_DATA_MODIFIED,e._debouncedUpdateFunction),o.eventTarget.addEventListener(i.Events.SEGMENTATION_DATA_MODIFIED,e._debouncedUpdateFunction)}(s),(0,r.triggerSegmentationModified)(e),u}const h=(0,s.A)(((e,t)=>{const n=e.detail.segmentationId,o=d.get(n);o&&o.length&&(t(n),o.length&&(0,r.triggerSegmentationModified)(n))}),300)},63427:(e,t,n)=>{"use strict";n.d(t,{j:()=>s,z:()=>r});var o=n(59475),i=n(49906),a=n(53662);function r(e){const t=o._6;t.getAllViewportSegmentationRepresentations().filter((({representations:t})=>t.some((t=>t.segmentationId===e)))).map((({viewportId:e})=>e)).forEach((t=>{(0,a.nc)(t,{segmentationId:e})})),t.removeSegmentation(e),(0,i.triggerSegmentationRemoved)(e)}function s(){const e=o._6;e.getState().segmentations.forEach((e=>{r(e.segmentationId)})),e.resetState()}},53662:(e,t,n)=>{"use strict";n.d(t,{us:()=>g,OE:()=>v,kN:()=>p,E8:()=>c,nc:()=>h,JC:()=>f});var o=n(18682),i=n(684),a=n(25894),r=n(93210),s=n(81985),l=n(59475),d=n(67014);function c(e,t,n){return u(e,t,n)}function h(e,t,n){return u(e,t,n)}function u(e,t,n){const{segmentationId:c,type:h}=t;return function(e,t,n,l){const c=(0,r.r$)(e,{segmentationId:t,type:n});c.forEach((t=>{t.type===o.A.Labelmap?i.Ay.removeRepresentation(e,t.segmentationId,l):t.type===o.A.Contour?a.A.removeRepresentation(e,t.segmentationId,l):t.type===o.A.Surface&&d.Ay.removeRepresentation(e,t.segmentationId,l)}));const{viewport:h}=(0,s.getEnabledElementByViewportId)(e)||{};h&&h.render()}(e,c,h,n),l._6.removeSegmentationRepresentations(e,{segmentationId:c,type:h})}function g(){l._6.getAllViewportSegmentationRepresentations().forEach((({viewportId:e,representations:t})=>{t.forEach((({segmentationId:t,type:n})=>{c(e,{segmentationId:t,type:n})}))})),l._6.resetState()}function p(e,t,n){c(e,{segmentationId:t,type:o.A.Labelmap},n)}function v(e,t,n){c(e,{segmentationId:t,type:o.A.Contour},n)}function f(e,t,n){c(e,{segmentationId:t,type:o.A.Surface},n)}},70930:(e,t,n)=>{"use strict";n.r(t),n.d(t,{getActiveSegmentIndex:()=>l.Q,setActiveSegmentIndex:()=>c});var o=n(7754),i=n(35706),a=n(33283),r=n(58859),s=n(49906),l=n(60740),d=n(93210);function c(e,t){const n=(0,a.T)(e);"string"==typeof t&&(console.warn("segmentIndex is a string, converting to number"),t=Number(t)),Object.values(n.segments).forEach((e=>{e.active=!1})),n.segments[t]||(n.segments[t]={segmentIndex:t,label:"",locked:!1,cachedStats:{},active:!1}),!0!==n.segments[t].active&&(n.segments[t].active=!0,(0,s.triggerSegmentationModified)(e));const l=(0,r.P)(e);l.forEach((n=>{(0,d.r$)(n,{segmentationId:e}).forEach((e=>{e.segments[t]||(e.segments[t]={visible:!0})}))})),l.forEach((e=>{const t=(0,o.getToolGroupForViewport)(e);(0,i.E)(t.id)}))}},26795:(e,t,n)=>{"use strict";n.r(t),n.d(t,{getLockedSegmentIndices:()=>s,isSegmentIndexLocked:()=>a,setSegmentIndexLocked:()=>r});var o=n(33283),i=n(49906);function a(e,t){const n=(0,o.T)(e);if(!n)throw new Error(`No segmentation state found for ${e}`);const{segments:i}=n;return i[t].locked}function r(e,t,n=!0){const a=(0,o.T)(e);if(!a)throw new Error(`No segmentation state found for ${e}`);const{segments:r}=a;r[t].locked=n,(0,i.triggerSegmentationModified)(e)}function s(e){const t=(0,o.T)(e);if(!t)throw new Error(`No segmentation state found for ${e}`);const{segments:n}=t;return Object.keys(n).filter((e=>n[e].locked)).map((e=>parseInt(e)))}},98870:(e,t,n)=>{"use strict";n.r(t),n.d(t,{addColorLUT:()=>l.u,addSegmentations:()=>a.d,destroy:()=>E,getColorLUT:()=>d.B,getCurrentLabelmapImageIdForViewport:()=>v.v,getNextColorLUTIndex:()=>c.u,getSegmentation:()=>o.T,getSegmentationRepresentation:()=>w.Ut,getSegmentationRepresentations:()=>w.r$,getSegmentationRepresentationsBySegmentationId:()=>w.ny,getSegmentations:()=>i.K,getStackSegmentationImageIdsForViewport:()=>m,getViewportIdsWithSegmentation:()=>p.P,getViewportSegmentations:()=>g.a,removeAllSegmentationRepresentations:()=>s.us,removeAllSegmentations:()=>r.j,removeColorLUT:()=>u,removeContourRepresentation:()=>s.OE,removeLabelmapRepresentation:()=>s.kN,removeSegmentation:()=>r.z,removeSegmentationRepresentation:()=>s.E8,removeSurfaceRepresentation:()=>s.JC,updateLabelmapSegmentationImageReferences:()=>f.t});var o=n(33283),i=n(70758),a=n(30935),r=n(63427),s=n(53662),l=n(4714),d=n(50409),c=n(70906),h=n(59475);function u(e){h._6.removeColorLUT(e)}var g=n(42568),p=n(58859),v=n(97577),f=n(78231);function m(e,t){return h._6.getStackSegmentationImageIdsForViewport(e,t)}var w=n(93210);function E(){h._6.resetState()}},49906:(e,t,n)=>{"use strict";n.r(t),n.d(t,{triggerSegmentationDataModified:()=>o.Q,triggerSegmentationModified:()=>i.G,triggerSegmentationRemoved:()=>a.B,triggerSegmentationRepresentationModified:()=>r.r,triggerSegmentationRepresentationRemoved:()=>s.O});var o=n(98798),i=n(9726),a=n(1485),r=n(44951),s=n(65290)},78231:(e,t,n)=>{"use strict";n.d(t,{t:()=>i});var o=n(59475);function i(e,t){return o._6.updateLabelmapSegmentationImageReferences(e,t)}},65136:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var o=n(81985),i=n(85204);const a=function(e,t){t||(t=(0,o.getRenderingEngines)().find((t=>t.getViewports().find((t=>t.id===e))))?.id);const n=i.wk.toolGroups.filter((n=>n.viewportsInfo.some((n=>n.renderingEngineId===t&&(!n.viewportId||n.viewportId===e)))));if(n.length){if(n.length>1)throw new Error(`Multiple tool groups found for renderingEngineId: ${t} and viewportId: ${e}. You should only\n      have one tool group per viewport in a renderingEngine.`);return n[0]}}},7754:(e,t,n)=>{"use strict";n.r(t),n.d(t,{createToolGroup:()=>w,destroy:()=>b,destroyToolGroup:()=>E,getAllToolGroups:()=>I,getToolGroup:()=>c,getToolGroupForViewport:()=>y.A,getToolGroupsWithToolName:()=>C});var o=n(85204),i=n(99737),a=n(93008),r=n.n(a),s=n(81985),l=n(79475),d=n(7001);const c=function(e){return o.wk.toolGroups.find((t=>t.id===e))},{Active:h,Passive:u,Enabled:g,Disabled:p}=i.ToolModes,v=[{mouseButton:i.MouseBindings.Primary}];class f{constructor(e){this.viewportsInfo=[],this.toolOptions={},this.currentActivePrimaryToolName=null,this.prevActivePrimaryToolName=null,this.restoreToolOptions={},this._toolInstances={},this.id=e}getViewportIds(){return this.viewportsInfo.map((({viewportId:e})=>e))}getViewportsInfo(){return this.viewportsInfo.slice()}getToolInstance(e){const t=this._toolInstances[e];if(t)return t;console.warn(`'${e}' is not registered with this toolGroup (${this.id}).`)}getToolInstances(){return this._toolInstances}hasTool(e){return!!this._toolInstances[e]}addTool(e,t={}){const n=o.wk.tools[e],i=void 0!==e&&""!==e,a=this.toolOptions[e];if(!i)return void console.warn("Tool with configuration did not produce a toolName: ",t);if(!n)return void console.warn(`'${e}' is not registered with the library. You need to use cornerstoneTools.addTool to register it.`);if(a)return void console.warn(`'${e}' is already registered for ToolGroup ${this.id}.`);const{toolClass:r}=n,s=new r({name:e,toolGroupId:this.id,configuration:t});this._toolInstances[e]=s}addToolInstance(e,t,n={}){let i=o.wk.tools[e]?.toolClass;if(!i){const n=o.wk.tools[t].toolClass;class a extends n{}a.toolName=e,i=a,o.wk.tools[e]={toolClass:a}}this.addTool(i.toolName,n)}addViewport(e,t){if("string"!=typeof e)throw new Error("viewportId must be defined and be a string");const n=this._findRenderingEngine(e,t);this.viewportsInfo.some((({viewportId:t})=>t===e))||this.viewportsInfo.push({viewportId:e,renderingEngineId:n});const o=this.getActivePrimaryMouseButtonTool();s.Settings.getRuntimeSettings().get("useCursors")&&this.setViewportsCursorByToolName(o);const a={toolGroupId:this.id,viewportId:e,renderingEngineId:n};(0,s.triggerEvent)(s.eventTarget,i.Events.TOOLGROUP_VIEWPORT_ADDED,a)}removeViewports(e,t){const n=[];if(this.viewportsInfo.forEach(((o,i)=>{let a=!1;o.renderingEngineId===e&&(a=!0,t&&o.viewportId!==t&&(a=!1)),a&&n.push(i)})),n.length)for(let e=n.length-1;e>=0;e--)this.viewportsInfo.splice(n[e],1);const o={toolGroupId:this.id,viewportId:t,renderingEngineId:e};(0,s.triggerEvent)(s.eventTarget,i.Events.TOOLGROUP_VIEWPORT_REMOVED,o)}setActiveStrategy(e,t){const n=this._toolInstances[e];void 0!==n?n.setActiveStrategy(t):console.warn(`Tool ${e} not added to toolGroup, can't set tool configuration.`)}setToolMode(e,t,n={}){e?t!==i.ToolModes.Active?t!==i.ToolModes.Passive?t!==i.ToolModes.Enabled?t!==i.ToolModes.Disabled?console.warn("setToolMode: mode must be defined"):this.setToolDisabled(e):this.setToolEnabled(e):this.setToolPassive(e):this.setToolActive(e,n||this.restoreToolOptions[e]):console.warn("setToolMode: toolName must be defined")}setToolActive(e,t={}){const n=this._toolInstances[e];if(void 0===n)return void console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);if(!n)return void console.warn(`'${e}' instance ${n} is not registered with this toolGroup, can't set tool mode.`);const o={bindings:[...this.toolOptions[e]?this.toolOptions[e].bindings:[],...t.bindings?t.bindings:[]].reduce(((e,t)=>{const n=void 0!==t.numTouchPoints,o=void 0!==t.mouseButton;return e.some((e=>m(e,t)))||!n&&!o||e.push(t),e}),[]),mode:h};this.toolOptions[e]=o,this._toolInstances[e].mode=h;const a=s.Settings.getRuntimeSettings().get("useCursors");if(this._hasMousePrimaryButtonBinding(t)&&a)this.setViewportsCursorByToolName(e);else{if(!this.getActivePrimaryMouseButtonTool()&&a){const e=l.MouseCursor.getDefinedCursor("default");this._setCursorForViewports(e)}}this._hasMousePrimaryButtonBinding(t)&&(null===this.prevActivePrimaryToolName?this.prevActivePrimaryToolName=e:this.prevActivePrimaryToolName=this.currentActivePrimaryToolName,this.currentActivePrimaryToolName=e),"function"==typeof n.onSetToolActive&&n.onSetToolActive(),this._renderViewports();const r={toolGroupId:this.id,toolName:e,toolBindingsOptions:t};(0,s.triggerEvent)(s.eventTarget,i.Events.TOOL_ACTIVATED,r),this._triggerToolModeChangedEvent(e,h,t)}setToolPassive(e,t){const n=this._toolInstances[e];if(void 0===n)return void console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);const o=this.getToolOptions(e),i=Object.assign({bindings:o?o.bindings:[]},o,{mode:u}),a=Array.isArray(t?.removeAllBindings)?t.removeAllBindings:this.getDefaultPrimaryBindings();i.bindings=i.bindings.filter((e=>!0!==t?.removeAllBindings&&!a.some((t=>m(e,t)))));let r=u;0!==i.bindings.length&&(r=h,i.mode=r),this.toolOptions[e]=i,n.mode=r,"function"==typeof n.onSetToolPassive&&n.onSetToolPassive(),this._renderViewports(),this._triggerToolModeChangedEvent(e,u)}setToolEnabled(e){const t=this._toolInstances[e];if(void 0===t)return void console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);const n={bindings:[],mode:g};this.toolOptions[e]=n,t.mode=g,"function"==typeof t.onSetToolEnabled&&t.onSetToolEnabled(),this._renderViewports(),this._triggerToolModeChangedEvent(e,g)}setToolDisabled(e){const t=this._toolInstances[e];if(void 0===t)return void console.warn(`Tool ${e} not added to toolGroup, can't set tool mode.`);const n={bindings:[],mode:p};this.restoreToolOptions[e]=this.toolOptions[e],this.toolOptions[e]=n,t.mode=p,"function"==typeof t.onSetToolDisabled&&t.onSetToolDisabled(),this._renderViewports(),this._triggerToolModeChangedEvent(e,p)}getToolOptions(e){const t=this.toolOptions[e];if(void 0!==t)return t}getActivePrimaryMouseButtonTool(){return Object.keys(this.toolOptions).find((e=>{const t=this.toolOptions[e];return t.mode===h&&this._hasMousePrimaryButtonBinding(t)}))}setViewportsCursorByToolName(e,t){const n=this._getCursor(e,t);this._setCursorForViewports(n)}_getCursor(e,t){let n,o;return t&&(n=`${e}.${t}`,o=l.SVGMouseCursor.getDefinedCursor(n,!0),o)?o:(n=`${e}`,o=l.SVGMouseCursor.getDefinedCursor(n,!0),o||(n=e,o=l.SVGMouseCursor.getDefinedCursor(n,!0),o||l.MouseCursor.getDefinedCursor("default")))}_setCursorForViewports(e){this.viewportsInfo.forEach((({renderingEngineId:t,viewportId:n})=>{const o=(0,s.getEnabledElementByIds)(n,t);if(!o)return;const{viewport:i}=o;(0,d.initElementCursor)(i.element,e)}))}setToolConfiguration(e,t,n){const o=this._toolInstances[e];if(void 0===o)return console.warn(`Tool ${e} not present, can't set tool configuration.`),!1;let i;return i=n?t:Object.assign(o.configuration,t),o.configuration=i,"function"==typeof o.onSetToolConfiguration&&o.onSetToolConfiguration(),this._renderViewports(),!0}getDefaultMousePrimary(){return i.MouseBindings.Primary}getDefaultPrimaryBindings(){return v}getToolConfiguration(e,t){if(void 0===this._toolInstances[e])return void console.warn(`Tool ${e} not present, can't set tool configuration.`);const n=r()(this._toolInstances[e].configuration,t)||this._toolInstances[e].configuration;return s.utilities.deepClone(n)}getPrevActivePrimaryToolName(){return this.prevActivePrimaryToolName}setActivePrimaryTool(e){const t=this.getCurrentActivePrimaryToolName();this.setToolDisabled(t),this.setToolActive(e,{bindings:[{mouseButton:i.MouseBindings.Primary}]})}getCurrentActivePrimaryToolName(){return this.currentActivePrimaryToolName}clone(e,t=null){let n=c(e);return n?(console.debug(`ToolGroup ${e} already exists`),n):(n=new f(e),o.wk.toolGroups.push(n),t=t??(()=>!0),Object.keys(this._toolInstances).filter(t).forEach((e=>{const t=this._toolInstances[e],o=this.toolOptions[e],i=t.mode;n.addTool(e),n.setToolMode(e,i,{bindings:o.bindings??[]})})),n)}_hasMousePrimaryButtonBinding(e){const t=this.getDefaultPrimaryBindings();return e?.bindings?.some((e=>t.some((t=>m(e,t)))))}_renderViewports(){this.viewportsInfo.forEach((({renderingEngineId:e,viewportId:t})=>{(0,s.getRenderingEngine)(e).renderViewport(t)}))}_triggerToolModeChangedEvent(e,t,n){const o={toolGroupId:this.id,toolName:e,mode:t,toolBindingsOptions:n};(0,s.triggerEvent)(s.eventTarget,i.Events.TOOL_MODE_CHANGED,o)}_findRenderingEngine(e,t){const n=(0,s.getRenderingEngines)();if(0===n?.length)throw new Error("No rendering engines found.");if(t)return t;const o=n.filter((t=>t.getViewport(e)));if(0===o.length){if(1===n.length)return n[0].id;throw new Error("No rendering engines found that contain the viewport with the same viewportId, you must specify a renderingEngineId.")}if(o.length>1)throw new Error("Multiple rendering engines found that contain the viewport with the same viewportId, you must specify a renderingEngineId.");return o[0].id}}function m(e,t){return e.mouseButton===t.mouseButton&&(e.numTouchPoints===t.numTouchPoints&&e.modifierKey===t.modifierKey)}const w=function(e){if(o.wk.toolGroups.some((t=>t.id===e)))return void console.warn(`'${e}' already exists.`);const t=new f(e);return o.wk.toolGroups.push(t),t};const E=function(e){const t=o.wk.toolGroups.findIndex((t=>t.id===e));t>-1&&o.wk.toolGroups.splice(t,1)};const b=function(){const e=[...o.wk.toolGroups];for(const t of e)E(t.id);o.wk.toolGroups=[]};var y=n(65136);const I=function(){return o.wk.toolGroups},_=[i.ToolModes.Active,i.ToolModes.Passive,i.ToolModes.Enabled];const C=function(e){return o.wk.toolGroups.filter((({toolOptions:t})=>{const n=Object.keys(t);for(let o=0;o<n.length;o++)if(e===n[o]&&t[e]&&_.includes(t[e].mode))return!0;return!1}))}},68040:(e,t,n)=>{"use strict";n.d(t,{Bl:()=>r,Gx:()=>i,l$:()=>a});var o=n(85204);function i(e){const t=e.toolName;o.wk.tools[t];if(!t)throw new Error(`No Tool Found for the ToolClass ${e.name}`);o.wk.tools[t]={toolClass:e}}function a(e){return!(!e||!o.wk.tools[e])}function r(e){const t=e.toolName;if(!t)throw new Error(`No tool found for: ${e.name}`);if(void 0===!o.wk.tools[t])throw new Error(`${t} cannot be removed because it has not been added`);delete o.wk.tools[t]}},85204:(e,t,n)=>{"use strict";n.d(t,{qh:()=>r,wk:()=>a});var o=n(48145);const i={isInteractingWithTool:!1,isMultiPartToolActive:!1,tools:{},toolGroups:[],synchronizers:[],svgNodeCache:o.A,enabledElements:[],handleRadius:6};let a={isInteractingWithTool:!1,isMultiPartToolActive:!1,tools:{},toolGroups:[],synchronizers:[],svgNodeCache:o.A,enabledElements:[],handleRadius:6};function r(){(0,o.e)(),a={...structuredClone({...i,svgNodeCache:{}}),svgNodeCache:{...i.svgNodeCache}}}},48145:(e,t,n)=>{"use strict";n.d(t,{A:()=>a,e:()=>i});let o={};function i(){o={}}const a=o},25072:(e,t,n)=>{"use strict";n.d(t,{A:()=>_});var o=n(3823),i=n(81985),a=n(4096),r=n(85817),s=n(27730),l=n(82056),d=n(2076),c=n(29601),h=n(44049),u=n(89578),g=n(85204),p=n(99737),v=n(8056),f=n(93258),m=n(66990),w=n(7001),E=n(58640);const{transformWorldToIndex:b}=i.utilities;class y extends r.EC{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{preventHandleOutsideImage:!1,getTextLines:I}}){super(e,t),this.isPointNearTool=(e,t,n,o)=>{const a=(0,i.getEnabledElement)(e),{viewport:r}=a,{data:s}=t,{points:l}=s.handles;let d=r.worldToCanvas(l[0]),c=r.worldToCanvas(l[1]),h={start:{x:d[0],y:d[1]},end:{x:c[0],y:c[1]}},u=f.distanceToPoint([h.start.x,h.start.y],[h.end.x,h.end.y],[n[0],n[1]]);return u<=o||(d=r.worldToCanvas(l[2]),c=r.worldToCanvas(l[3]),h={start:{x:d[0],y:d[1]},end:{x:c[0],y:c[1]}},u=f.distanceToPoint([h.start.x,h.start.y],[h.end.x,h.end.y],[n[0],n[1]]),u<=o)},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:o}=n;t.highlighted=!0;const a=(0,v.getViewportIdsWithToolToRender)(o,this.getToolName());this.editData={annotation:t,viewportIdsToRender:a,movingTextBox:!1},this._activateModify(o);const r=(0,i.getEnabledElement)(o),{renderingEngine:s}=r;(0,E.A)(a),(0,w.hideElementCursor)(o),e.preventDefault()},this.handleSelectedCallback=(e,t,n)=>{const o=e.detail,{element:a}=o,r=t.data;t.highlighted=!0;let s,l=!1;n.worldPosition?l=!0:s=r.handles.points.findIndex((e=>e===n));const d=(0,v.getViewportIdsWithToolToRender)(a,this.getToolName());(0,w.hideElementCursor)(a),this.editData={annotation:t,viewportIdsToRender:d,handleIndex:s,movingTextBox:l},this._activateModify(a);const c=(0,i.getEnabledElement)(a),{renderingEngine:h}=c;(0,E.A)(d),e.preventDefault()},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:a,viewportIdsToRender:r,newAnnotation:s,hasMoved:d}=this.editData,{data:c}=a;if(s&&!d)return;c.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,w.resetElementCursor)(n);const{renderingEngine:u}=(0,i.getEnabledElement)(n);if(void 0!==this.editData.handleIndex){const{points:e}=c.handles,t=o.eR.distance(e[0],e[1]);if(o.eR.distance(e[2],e[3])>t){const t=[[...e[2]],[...e[3]]],n=[...e[0]],i=[...e[1]],a=o.Zc.create();o.Zc.set(a,t[1][0]-t[0][0],t[1][1]-t[1][0]);const r=o.Zc.create();o.Zc.set(r,-a[1],a[0]);const s=o.Zc.create();let l;o.Zc.set(s,i[0]-n[0],i[1]-n[0]),l=o.Zc.dot(s,r)>0?[n,i]:[i,n],c.handles.points=[t[0],t[1],l[0],l[1]]}}this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,l.removeAnnotation)(a.annotationUID),(0,E.A)(r),s&&(0,h.dZ)(a),this.editData=null,this.isDrawing=!1},this._dragDrawCallback=e=>{this.isDrawing=!0;const t=e.detail,{currentPoints:n,element:a}=t,r=(0,i.getEnabledElement)(a),{renderingEngine:s,viewport:l}=r,{worldToCanvas:d}=l,{annotation:c,viewportIdsToRender:h,handleIndex:u}=this.editData,{data:g}=c,p=n.world;g.handles.points[u]=[...p];const v=g.handles.points.map(d),f={start:{x:v[0][0],y:v[0][1]},end:{x:v[1][0],y:v[1][1]}},m=(v[2][0],v[2][1],v[3][0],v[3][1],o.Zc.distance(v[0],v[1])/3),w=f.start.x-f.end.x,b=f.start.y-f.end.y,y=Math.sqrt(w*w+b*b),I=w/y,_=b/y,C=(f.start.x+f.end.x)/2,T=(f.start.y+f.end.y)/2,S=C+m*_,x=T-m*I,D=C-m*_,A=T+m*I;g.handles.points[2]=l.canvasToWorld([S,x]),g.handles.points[3]=l.canvasToWorld([D,A]),c.invalidated=!0,(0,E.A)(h),this.editData.hasMoved=!0},this._dragModifyCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,o=(0,i.getEnabledElement)(n),{renderingEngine:a}=o,{annotation:r,viewportIdsToRender:s,handleIndex:l,movingTextBox:d}=this.editData,{data:c}=r;if(d){const{deltaPoints:e}=t,n=e.world,{textBox:o}=c.handles,{worldPosition:i}=o;i[0]+=n[0],i[1]+=n[1],i[2]+=n[2],o.hasMoved=!0}else if(void 0===l){const{deltaPoints:e}=t,n=e.world;c.handles.points.forEach((e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]})),r.invalidated=!0}else this._dragModifyHandle(e),r.invalidated=!0;(0,E.A)(s)},this._dragModifyHandle=e=>{const t=e.detail,{currentPoints:n,element:a}=t,r=(0,i.getEnabledElement)(a),{viewport:s}=r,{annotation:l,handleIndex:d}=this.editData,{data:c}=l,h=n.world,u=[s.worldToCanvas(c.handles.points[0]),s.worldToCanvas(c.handles.points[1]),s.worldToCanvas(c.handles.points[2]),s.worldToCanvas(c.handles.points[3])],g={start:{x:u[0][0],y:u[0][1]},end:{x:u[1][0],y:u[1][1]}},p={start:{x:u[2][0],y:u[2][1]},end:{x:u[3][0],y:u[3][1]}},v=[...h],m=s.worldToCanvas(v);if(0===d||1===d){const e=u[0===d?1:0],t=o.Zc.set(o.Zc.create(),m[0]-e[0],m[1]-e[1]),n=o.Zc.set(o.Zc.create(),u[d][0]-e[0],u[d][1]-e[1]);o.Zc.normalize(t,t),o.Zc.normalize(n,n);const i={start:{x:e[0],y:e[1]},end:{x:m[0],y:m[1]}};if(this._movingLongAxisWouldPutItThroughShortAxis(i,p))return;const a=e,r=this._getSignedAngle(n,t);let l=u[2][0],h=u[2][1],g=u[3][0],f=u[3][1];l-=a[0],h-=a[1],g-=a[0],f-=a[1];const w=l*Math.cos(r)-h*Math.sin(r),E=l*Math.sin(r)+h*Math.cos(r),b=g*Math.cos(r)-f*Math.sin(r),y=g*Math.sin(r)+f*Math.cos(r);l=w+a[0],h=E+a[1],g=b+a[0],f=y+a[1];const I=s.canvasToWorld([l,h]),_=s.canvasToWorld([g,f]);c.handles.points[d]=v,c.handles.points[2]=I,c.handles.points[3]=_}else{const e=2===d?3:2,t={longLineSegment:{start:g.start,end:g.end},shortLineSegment:{start:p.start,end:p.end}},n=o.Zc.subtract(o.Zc.create(),[t.longLineSegment.end.x,t.longLineSegment.end.y],[t.longLineSegment.start.x,t.longLineSegment.start.y]),i=o.Zc.normalize(o.Zc.create(),n),a=o.Zc.subtract(o.Zc.create(),[m[0],m[1]],[u[d][0],u[d][1]]),r=o.Zc.length(a),l=this._getSignedAngle(i,a),h=Math.cos(l)*r,w=o.Zc.scaleAndAdd(o.Zc.create(),[u[e][0],u[e][1]],i,h);if(this._movingLongAxisWouldPutItThroughShortAxis({start:{x:m[0],y:m[1]},end:{x:w[0],y:w[1]}},{start:{x:t.longLineSegment.start.x,y:t.longLineSegment.start.y},end:{x:t.longLineSegment.end.x,y:t.longLineSegment.end.y}}))return;if(!f.intersectLine([m[0],m[1]],[w[0],w[1]],[g.start.x,g.start.y],[g.end.x,g.end.y]))return;c.handles.points[e]=s.canvasToWorld(w),c.handles.points[d]=v}},this.cancel=e=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,w.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:o}=this.editData,{data:i}=t;return t.highlighted=!1,i.handles.activeHandleIndex=null,(0,E.A)(n),o&&(0,h.dZ)(t),this.editData=null,t.annotationUID}},this._activateDraw=e=>{g.wk.isInteractingWithTool=!0,e.addEventListener(p.Events.MOUSE_UP,this._endCallback),e.addEventListener(p.Events.MOUSE_DRAG,this._dragDrawCallback),e.addEventListener(p.Events.MOUSE_MOVE,this._dragDrawCallback),e.addEventListener(p.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(p.Events.TOUCH_TAP,this._endCallback),e.addEventListener(p.Events.TOUCH_END,this._endCallback),e.addEventListener(p.Events.TOUCH_DRAG,this._dragDrawCallback)},this._deactivateDraw=e=>{g.wk.isInteractingWithTool=!1,e.removeEventListener(p.Events.MOUSE_UP,this._endCallback),e.removeEventListener(p.Events.MOUSE_DRAG,this._dragDrawCallback),e.removeEventListener(p.Events.MOUSE_MOVE,this._dragDrawCallback),e.removeEventListener(p.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(p.Events.TOUCH_TAP,this._endCallback),e.removeEventListener(p.Events.TOUCH_END,this._endCallback),e.removeEventListener(p.Events.TOUCH_DRAG,this._dragDrawCallback)},this._activateModify=e=>{g.wk.isInteractingWithTool=!0,e.addEventListener(p.Events.MOUSE_UP,this._endCallback),e.addEventListener(p.Events.MOUSE_DRAG,this._dragModifyCallback),e.addEventListener(p.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(p.Events.TOUCH_END,this._endCallback),e.addEventListener(p.Events.TOUCH_DRAG,this._dragModifyCallback),e.addEventListener(p.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{g.wk.isInteractingWithTool=!1,e.removeEventListener(p.Events.MOUSE_UP,this._endCallback),e.removeEventListener(p.Events.MOUSE_DRAG,this._dragModifyCallback),e.removeEventListener(p.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(p.Events.TOUCH_END,this._endCallback),e.removeEventListener(p.Events.TOUCH_DRAG,this._dragModifyCallback),e.removeEventListener(p.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!0;const{viewport:o}=e,{element:i}=o;let a=(0,l.getAnnotations)(this.getToolName(),i);if(!a?.length)return n;if(a=this.filterInteractableAnnotationsForElement(i,a),!a?.length)return n;const r=this.getTargetId(o),s=o.getRenderingEngine(),h={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let i=0;i<a.length;i++){const l=a[i],{annotationUID:g,data:p}=l,{points:v,activeHandleIndex:f}=p.handles,w=v.map((e=>o.worldToCanvas(e)));h.annotationUID=g;const{color:E,lineWidth:b,lineDash:y,shadow:I}=this.getAnnotationStyle({annotation:l,styleSpecifier:h});if(p.cachedStats[r]&&null!=p.cachedStats[r].unit?l.invalidated&&this._throttledCalculateCachedStats(l,s,e):(p.cachedStats[r]={length:null,width:null,unit:null},this._calculateCachedStats(l,s,e)),!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;let _;if(!(0,c.isAnnotationVisible)(g))continue;if((0,d.isAnnotationLocked)(g)||this.editData||null===f||(_=[w[f]]),_){const e="0";(0,u.drawHandles)(t,g,e,_,{color:E})}const C=`${g}-line-1`,T=`${g}-line-2`,S="0";(0,u.drawLine)(t,g,S,w[0],w[1],{color:E,lineDash:y,lineWidth:b,shadow:I},C);const x="1";(0,u.drawLine)(t,g,x,w[2],w[3],{color:E,lineDash:y,lineWidth:b,shadow:I},T),n=!0;const D=this.getLinkedTextBoxStyle(h,l);if(!D.visibility){p.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const A=this.configuration.getTextLines(p,r);if(!A||0===A.length)continue;let O;p.handles.textBox.hasMoved||(O=(0,m.getTextBoxCoordsCanvas)(w),p.handles.textBox.worldPosition=o.canvasToWorld(O));const M=o.worldToCanvas(p.handles.textBox.worldPosition),R="1",k=(0,u.drawLinkedTextBox)(t,g,R,A,M,w,{},D),{x:L,y:P,width:N,height:U}=k;p.handles.textBox.worldBoundingBox={topLeft:o.canvasToWorld([L,P]),topRight:o.canvasToWorld([L+N,P]),bottomLeft:o.canvasToWorld([L,P+U]),bottomRight:o.canvasToWorld([L+N,P+U])}}return n},this._movingLongAxisWouldPutItThroughShortAxis=(e,t)=>{const n=o.Zc.create();o.Zc.set(n,t.end.x-t.start.x,t.end.y-t.start.y),o.Zc.normalize(n,n);const i={start:{x:t.start.x-10*n[0],y:t.start.y-10*n[1]},end:{x:t.end.x+10*n[0],y:t.end.y+10*n[1]}};return!f.intersectLine([i.start.x,i.start.y],[i.end.x,i.end.y],[e.start.x,e.start.y],[e.end.x,e.end.y])},this._calculateCachedStats=(e,t,n)=>{const{data:o}=e,{element:i}=n.viewport,r=o.handles.points[0],s=o.handles.points[1],l=o.handles.points[2],d=o.handles.points[3],{cachedStats:c}=o,u=Object.keys(c);for(let e=0;e<u.length;e++){const t=u[e],n=this.getTargetImageData(t);if(!n)continue;const{imageData:o,dimensions:i}=n,h=b(o,r),g=b(o,s),p=b(o,l),v=b(o,d),f=[h,g],m=[p,v],{scale:w,unit:E}=(0,a.Op)(n,f),{scale:y,unit:I}=(0,a.Op)(n,m),_=this._calculateLength(r,s)/w,C=this._calculateLength(l,d)/y,T=_>C?_:C,S=_>C?C:_,x=_>C?E:I,D=_>C?I:E;this._isInsideVolume(h,g,p,v,i)?this.isHandleOutsideImage=!1:this.isHandleOutsideImage=!0,c[t]={length:T,width:S,unit:x,widthUnit:D}}return e.invalidated=!1,(0,h.XF)(e,i),c},this._isInsideVolume=(e,t,n,o,a)=>i.utilities.indexWithinDimensions(e,a)&&i.utilities.indexWithinDimensions(t,a)&&i.utilities.indexWithinDimensions(n,a)&&i.utilities.indexWithinDimensions(o,a),this._getSignedAngle=(e,t)=>Math.atan2(e[0]*t[1]-e[1]*t[0],e[0]*t[0]+e[1]*t[1]),this._throttledCalculateCachedStats=(0,s.A)(this._calculateCachedStats,100,{trailing:!0})}addNewAnnotation(e){const t=e.detail,{currentPoints:n,element:o}=t,a=n.world,r=(0,i.getEnabledElement)(o),{viewport:s,renderingEngine:d}=r;this.isDrawing=!0;const c=s.getCamera(),{viewPlaneNormal:h,viewUp:u}=c,g=this.getReferencedImageId(s,a,h,u),p=s.getFrameOfReferenceUID(),f={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...h],viewUp:[...u],FrameOfReferenceUID:p,referencedImageId:g,...s.getViewReference({points:[a]})},data:{handles:{points:[[...a],[...a],[...a],[...a]],textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},activeHandleIndex:null},label:"",cachedStats:{}}};(0,l.addAnnotation)(f,o);const m=(0,v.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:f,viewportIdsToRender:m,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),(0,w.hideElementCursor)(o),e.preventDefault(),(0,E.A)(m),f}_calculateLength(e,t){const n=e[0]-t[0],o=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(n*n+o*o+i*i)}}function I(e,t){const{cachedStats:n,label:o}=e,{length:a,width:r,unit:s}=n[t],l=[];return o&&l.push(o),void 0===a||l.push(`L: ${i.utilities.roundNumber(a)} ${s||s}`,`W: ${i.utilities.roundNumber(r)} ${s}`),l}y.toolName="Bidirectional";const _=y},37590:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var o=n(81985),i=n(49906),a=n(28220);class r extends a.A{constructor(e){super(o.utilities.deepMerge({configuration:{calculateStats:!1,allowOpenContours:!1}},e))}isContourSegmentationTool(){return!0}renderAnnotationInstance(e){const t=e.annotation,{invalidated:n}=t,o=super.renderAnnotationInstance(e);if(n){const{segmentationId:e}=t.data.segmentation;(0,i.triggerSegmentationDataModified)(e)}return o}}r.toolName="PlanarFreehandContourSegmentationTool";const s=r},28220:(e,t,n)=>{"use strict";n.d(t,{A:()=>R});var o=n(81985),i=n(3823),a=n(4096),r=n(95527),s=n(13165),l=n(27730),d=n(8056),c=n(58640),h=n(55927),u=n(92400),g=n(57999),p=n(69855),v=n(70734),f=n(58161),m=n(44049),w=n(89578),E=n(66990),b=n(92984),y=n(18990),I=n(79362),_=n(93843),C=n(36320),T=n(99737),S=n(40634);const{pointCanProjectOnLine:x}=r.polyline,{EPSILON:D}=o.CONSTANTS,A=1-D;class O extends C.A{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{storePointData:!1,shadow:!0,preventHandleOutsideImage:!1,contourHoleAdditionModifierKey:T.KeyboardBindings.Shift,alwaysRenderOpenContourHandles:{enabled:!1,radius:2},allowOpenContours:!0,closeContourProximity:10,checkCanvasEditFallbackProximity:6,makeClockWise:!0,subPixelResolution:4,smoothing:{smoothOnAdd:!1,smoothOnEdit:!1,knotsRatioPercentageOnAdd:40,knotsRatioPercentageOnEdit:40},interpolation:{enabled:!1,onInterpolationComplete:null},decimate:{enabled:!1,epsilon:.1},displayOnePointAsCrosshairs:!1,calculateStats:!0,getTextLines:M,statsCalculator:I.BasicStatsCalculator}}){super(e,t),this.isDrawing=!1,this.isEditingClosed=!1,this.isEditingOpen=!1,this.addNewAnnotation=e=>{const t=e.detail,{element:n}=t,o=this.createAnnotation(e);this.addAnnotation(o,n);const i=(0,d.getViewportIdsWithToolToRender)(n,this.getToolName());return this.activateDraw(e,o,i),e.preventDefault(),(0,c.A)(i),o},this.handleSelectedCallback=(e,t,n)=>{const o=e.detail,{element:i}=o,a=(0,d.getViewportIdsWithToolToRender)(i,this.getToolName());this.activateOpenContourEndEdit(e,t,a,n)},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:o}=n,i=(0,d.getViewportIdsWithToolToRender)(o,this.getToolName());t.data.contour.closed?this.activateClosedContourEdit(e,t,i):this.activateOpenContourEdit(e,t,i),e.preventDefault()},this.isPointNearTool=(e,t,n,i)=>{const a=(0,o.getEnabledElement)(e),{viewport:r}=a,{polyline:s}=t.data.contour;let l=r.worldToCanvas(s[0]);for(let e=1;e<s.length;e++){const t=l,o=r.worldToCanvas(s[e]);if(x(n,t,o,i))return!0;l=o}if(!t.data.contour.closed)return!1;const d=r.worldToCanvas(s[0]),c=r.worldToCanvas(s[s.length-1]);return x(n,d,c,i)},this.cancel=e=>{const t=this.isDrawing,n=this.isEditingOpen,o=this.isEditingClosed;t?this.cancelDrawing(e):n?this.cancelOpenContourEdit(e):o&&this.cancelClosedContourEdit(e)},this._calculateCachedStats=(e,t,n,i)=>{const{data:s}=e,{cachedStats:l}=s,{polyline:d,closed:c}=s.contour,h=Object.keys(l);for(let n=0;n<h.length;n++){const i=h[n],u=this.getTargetImageData(i);if(!u)continue;const{imageData:g,metadata:p}=u,v=d.map((e=>t.worldToCanvas(e))),f={isPreScaled:(0,y.u)(t,i),isSuvScaled:this.isSuvScaled(t,i,e.metadata.referencedImageId)},m=(0,S.j)(p.Modality,e.metadata.referencedImageId,f),w=(0,a.Op)(u,(()=>{const e=s.contour.polyline,n=e.length,i=new Array(n);for(let o=0;o<n;o++)i[o]=t.worldToCanvas(e[o]);const{maxX:a,maxY:l,minX:d,minY:c}=r.polyline.getAABB(i),h=t.canvasToWorld([d,c]),u=o.utilities.transformWorldToIndex(g,h),p=t.canvasToWorld([a,l]);return[u,o.utilities.transformWorldToIndex(g,p)]}));c?this.updateClosedCachedStats({targetId:i,viewport:t,canvasCoordinates:v,points:d,imageData:g,metadata:p,cachedStats:l,modalityUnit:m,calibratedScale:w}):this.updateOpenCachedStats({metadata:p,canvasCoordinates:v,targetId:i,cachedStats:l,modalityUnit:m,calibratedScale:w})}return(0,m.XF)(e,i.viewport.element,T.ChangeTypes.StatsUpdated),e.invalidated=!1,l},this._renderStats=(e,t,n,o)=>{const{data:i}=e,a=this.getTargetId(t),r={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:n.viewport.id},s=this.getLinkedTextBoxStyle(r,e);if(!s.visibility)return;const l=this.configuration.getTextLines(i,a);if(!l||0===l.length)return;const d=i.contour.polyline.map((e=>t.worldToCanvas(e)));if(!i.handles.textBox.hasMoved){const e=(0,E.getTextBoxCoordsCanvas)(d);i.handles.textBox.worldPosition=t.canvasToWorld(e)}const c=t.worldToCanvas(i.handles.textBox.worldPosition),h=(0,w.drawLinkedTextBox)(o,e.annotationUID??"","1",l,c,d,{},s),{x:u,y:g,width:p,height:v}=h;i.handles.textBox.worldBoundingBox={topLeft:t.canvasToWorld([u,g]),topRight:t.canvasToWorld([u+p,g]),bottomLeft:t.canvasToWorld([u,g+v]),bottomRight:t.canvasToWorld([u+p,g+v])}},(0,h.A)(this),(0,u.A)(this),(0,g.A)(this),(0,p.A)(this),(0,v.A)(this),(0,f.A)(this),this._throttledCalculateCachedStats=(0,l.A)(this._calculateCachedStats,100,{trailing:!0})}filterInteractableAnnotationsForElement(e,t){if(!t||!t.length)return;const n=(0,o.getEnabledElement)(e),{viewport:i}=n;let a;if(i instanceof o.VolumeViewport){const e=i.getCamera(),{spacingInNormalDirection:n}=o.utilities.getTargetVolumeAndSpacingInNormalDir(i,e);a=this.filterAnnotationsWithinSlice(t,e,n)}else a=(0,s.filterAnnotationsForDisplay)(i,t);return a}filterAnnotationsWithinSlice(e,t,n){const{viewPlaneNormal:o}=t,a=e.filter((e=>{const t=e.metadata.viewPlaneNormal,n=Math.abs(i.eR.dot(o,t))>A;return t&&n}));if(!a.length)return[];const r=n/2,{focalPoint:s}=t,l=[];for(const e of a){const t=e.data.contour.polyline[0];if(!e.isVisible)continue;const n=i.eR.create();i.eR.sub(n,s,t);const a=i.eR.dot(n,o);Math.abs(a)<r&&l.push(e)}return l}isContourSegmentationTool(){return!1}createAnnotation(e){const t=e.detail.currentPoints.world,n=super.createAnnotation(e);return o.utilities.deepMerge(n,{data:{contour:{polyline:[[...t]]},label:"",cachedStats:{}},onInterpolationComplete:e=>{e.data.handles.points.length=0}})}getAnnotationStyle(e){return super.getAnnotationStyle(e)}renderAnnotationInstance(e){const{enabledElement:t,targetId:n,svgDrawingHelper:o}=e,i=e.annotation;let a=!1;const{viewport:r,renderingEngine:s}=t,l=this.isDrawing,d=this.isEditingOpen,c=this.isEditingClosed;if(l||d||c){const e=this.commonData.annotation.annotationUID;if(i.annotationUID===e)if(l)this.renderContourBeingDrawn(t,o,i);else if(c)this.renderClosedContourBeingEdited(t,o,i);else{if(!d)throw new Error(`Unknown ${this.getToolName()} annotation rendering state`);this.renderOpenContourBeingEdited(t,o,i)}else this.configuration.displayOnePointAsCrosshairs&&1===i.data.contour.polyline.length?this.renderPointContourWithMarker(t,o,i):this.renderContour(t,o,i);a=!0}else this.configuration.displayOnePointAsCrosshairs&&1===i.data.contour.polyline.length?this.renderPointContourWithMarker(t,o,i):this.renderContour(t,o,i);if(this.configuration.calculateStats)return this._calculateStatsIfActive(i,n,r,s,t),this._renderStats(i,r,t,o),a}_calculateStatsIfActive(e,t,n,o,i){const a=this.commonData?.annotation.annotationUID;if((e.annotationUID!==a||this.commonData?.movingTextBox)&&!this.commonData?.movingTextBox){const{data:a}=e;a.cachedStats[t]&&null!=a.cachedStats[t].areaUnit?e.invalidated&&this._throttledCalculateCachedStats(e,n,o,i):(a.cachedStats[t]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null},this._calculateCachedStats(e,n,o,i))}}updateClosedCachedStats({viewport:e,points:t,imageData:n,metadata:a,cachedStats:s,targetId:l,modalityUnit:d,canvasCoordinates:c,calibratedScale:h}){const{scale:u,areaUnit:g,units:p}=h,{voxelManager:v}=e.getImageData(),f=c[0],m=e.canvasToWorld(f),w=e.canvasToWorld([f[0]+1,f[1]]),E=e.canvasToWorld([f[0],f[1]+1]),y=i.eR.distance(m,w),I=i.eR.distance(m,E),C=o.utilities.transformWorldToIndex(n,t[0]);C[0]=Math.floor(C[0]),C[1]=Math.floor(C[1]),C[2]=Math.floor(C[2]);let T=C[0],S=C[0],x=C[1],D=C[1],A=C[2],O=C[2];for(let e=1;e<t.length;e++){const i=o.utilities.transformWorldToIndex(n,t[e]);i[0]=Math.floor(i[0]),i[1]=Math.floor(i[1]),i[2]=Math.floor(i[2]),T=Math.min(T,i[0]),S=Math.max(S,i[0]),x=Math.min(x,i[1]),D=Math.max(D,i[1]),A=Math.min(A,i[2]),O=Math.max(O,i[2])}const M=o.utilities.transformWorldToIndex(n,t[1]);M[0]=Math.floor(M[0]),M[1]=Math.floor(M[1]),M[2]=Math.floor(M[2]);let R=r.polyline.getArea(c)/u/u;R*=y*I;const k=.01*(S-T),L=.01*(D-x),P=.01*(O-A);T=Math.floor(T-k),S=Math.ceil(S+k),x=Math.floor(x-L),D=Math.ceil(D+L),A=Math.floor(A-P),O=Math.ceil(O+P);const N=[[T,S],[x,D],[A,O]],U=n.indexToWorld([S,D,O]),V=e.worldToCanvas(U);let B=0,H=[],W=0;const F=v.forEach(this.configuration.statsCalculator.statsCallback,{imageData:n,isInObject:(t,n)=>{let o=!0;const i=e.worldToCanvas(t);return i[1]!=B&&(W=0,B=i[1],H=(0,b.getLineSegmentIntersectionsCoordinates)(c,i,[V[0],i[1]]),H.sort((function(e,t){return e[0]===t[0]?0:e[0]<t[0]?-1:1}))),H.length&&i[0]>H[0][0]&&(H.shift(),W++),W%2==0&&(o=!1),o},boundsIJK:N,returnPoints:this.configuration.storePointData}),j=this.configuration.statsCalculator.getStatistics();s[l]={Modality:a.Modality,area:R,perimeter:(0,_.A)(c,closed)/u,mean:j.mean?.value,max:j.max?.value,stdDev:j.stdDev?.value,statsArray:j.array,pointsInShape:F,areaUnit:g,modalityUnit:d,unit:p}}updateOpenCachedStats({targetId:e,metadata:t,canvasCoordinates:n,cachedStats:o,modalityUnit:i,calibratedScale:a}){const{scale:r,units:s}=a;o[e]={Modality:t.Modality,length:(0,_.A)(n,!1)/r,modalityUnit:i,getPixelValueUnitunit:s}}}function M(e,t){const n=e.cachedStats[t],{area:i,mean:a,stdDev:r,length:s,perimeter:l,max:d,isEmptyArea:c,unit:h,areaUnit:u,modalityUnit:g}=n||{},p=[];if(i){const e=c?"Area: Oblique not supported":`Area: ${o.utilities.roundNumber(i)} ${u}`;p.push(e)}return a&&p.push(`Mean: ${o.utilities.roundNumber(a)} ${g}`),Number.isFinite(d)&&p.push(`Max: ${o.utilities.roundNumber(d)} ${g}`),r&&p.push(`Std Dev: ${o.utilities.roundNumber(r)} ${g}`),l&&p.push(`Perimeter: ${o.utilities.roundNumber(l)} ${h}`),s&&p.push(`${o.utilities.roundNumber(s)} ${h}`),p}O.toolName="PlanarFreehandROI";const R=O},4010:(e,t,n)=>{"use strict";n.d(t,{A:()=>S});var o=n(85817),i=n(81985),a=n(4096),r=n(27730),s=n(6802),l=n(2076),d=n(29601),c=n(44049),h=n(89578),u=n(85204),g=n(99737),p=n(8056),v=n(92282),f=n(66990),m=n(35489),w=n(7001),E=n(58640),b=n(40634),y=n(18990),I=n(79362);const{transformWorldToIndex:_}=i.utilities;class C extends o.EC{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{storePointData:!1,shadow:!0,preventHandleOutsideImage:!1,getTextLines:T,statsCalculator:I.BasicStatsCalculator}}){super(e,t),this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:o}=t,a=n.world,r=(0,i.getEnabledElement)(o),{viewport:l,renderingEngine:d}=r;this.isDrawing=!0;const c=l.getCamera(),{viewPlaneNormal:h,viewUp:u}=c,g=this.getReferencedImageId(l,a,h,u),v=l.getFrameOfReferenceUID(),f={invalidated:!0,highlighted:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:[...h],viewUp:[...u],FrameOfReferenceUID:v,referencedImageId:g,...l.getViewReference({points:[a]})},data:{label:"",handles:{points:[[...a],[...a],[...a],[...a]],textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},activeHandleIndex:null},cachedStats:{}}};(0,s.lC)(f,o);const m=(0,p.getViewportIdsWithToolToRender)(o,this.getToolName());return this.editData={annotation:f,viewportIdsToRender:m,handleIndex:3,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(o),(0,w.hideElementCursor)(o),e.preventDefault(),(0,E.A)(m),f},this.isPointNearTool=(e,t,n,o)=>{const a=(0,i.getEnabledElement)(e),{viewport:r}=a,{data:s}=t,{points:l}=s.handles,d=r.worldToCanvas(l[0]),c=r.worldToCanvas(l[3]),h=this._getRectangleImageCoordinates([d,c]),u=[n[0],n[1]],{left:g,top:p,width:f,height:m}=h;return v.distanceToPoint([g,p,f,m],u)<=o},this.toolSelectedCallback=(e,t)=>{const n=e.detail,{element:o}=n;t.highlighted=!0;const a=(0,p.getViewportIdsWithToolToRender)(o,this.getToolName());this.editData={annotation:t,viewportIdsToRender:a,movingTextBox:!1},this._activateModify(o),(0,w.hideElementCursor)(o);const r=(0,i.getEnabledElement)(o),{renderingEngine:s}=r;(0,E.A)(a),e.preventDefault()},this.handleSelectedCallback=(e,t,n)=>{const o=e.detail,{element:a}=o,{data:r}=t;t.highlighted=!0;let s,l=!1;n.worldPosition?l=!0:s=r.handles.points.findIndex((e=>e===n));const d=(0,p.getViewportIdsWithToolToRender)(a,this.getToolName());this.editData={annotation:t,viewportIdsToRender:d,handleIndex:s,movingTextBox:l},this._activateModify(a),(0,w.hideElementCursor)(a);const c=(0,i.getEnabledElement)(a),{renderingEngine:h}=c;(0,E.A)(d),e.preventDefault()},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:a,newAnnotation:r,hasMoved:l}=this.editData,{data:d}=o;if(r&&!l)return;d.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,w.resetElementCursor)(n);const{renderingEngine:h}=(0,i.getEnabledElement)(n);this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,s.O8)(o.annotationUID),(0,E.A)(a),r&&(0,c.dZ)(o)},this._dragCallback=e=>{this.isDrawing=!0;const t=e.detail,{element:n}=t,{annotation:o,viewportIdsToRender:a,handleIndex:r,movingTextBox:s}=this.editData,{data:l}=o;if(s){const{deltaPoints:e}=t,n=e.world,{textBox:o}=l.handles,{worldPosition:i}=o;i[0]+=n[0],i[1]+=n[1],i[2]+=n[2],o.hasMoved=!0}else if(void 0===r){const{deltaPoints:e}=t,n=e.world,{points:i}=l.handles;i.forEach((e=>{e[0]+=n[0],e[1]+=n[1],e[2]+=n[2]})),o.invalidated=!0}else{const{currentPoints:e}=t,a=(0,i.getEnabledElement)(n),{worldToCanvas:s,canvasToWorld:d}=a.viewport,c=e.world,{points:h}=l.handles;let u,g,p,v,f,m,w,E;switch(h[r]=[...c],r){case 0:case 3:u=s(h[0]),v=s(h[3]),g=[v[0],u[1]],p=[u[0],v[1]],m=d(g),w=d(p),h[1]=m,h[2]=w;break;case 1:case 2:g=s(h[1]),p=s(h[2]),u=[p[0],g[1]],v=[g[0],p[1]],f=d(u),E=d(v),h[0]=f,h[3]=E}o.invalidated=!0}this.editData.hasMoved=!0;const d=(0,i.getEnabledElement)(n),{renderingEngine:c}=d;(0,E.A)(a)},this.cancel=e=>{if(this.isDrawing){this.isDrawing=!1,this._deactivateDraw(e),this._deactivateModify(e),(0,w.resetElementCursor)(e);const{annotation:t,viewportIdsToRender:n,newAnnotation:o}=this.editData,{data:i}=t;return t.highlighted=!1,i.handles.activeHandleIndex=null,(0,E.A)(n),o&&(0,c.dZ)(t),this.editData=null,t.annotationUID}},this._activateDraw=e=>{u.wk.isInteractingWithTool=!0,e.addEventListener(g.Events.MOUSE_UP,this._endCallback),e.addEventListener(g.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(g.Events.MOUSE_MOVE,this._dragCallback),e.addEventListener(g.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(g.Events.TOUCH_END,this._endCallback),e.addEventListener(g.Events.TOUCH_DRAG,this._dragCallback),e.addEventListener(g.Events.TOUCH_TAP,this._endCallback)},this._deactivateDraw=e=>{u.wk.isInteractingWithTool=!1,e.removeEventListener(g.Events.MOUSE_UP,this._endCallback),e.removeEventListener(g.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(g.Events.MOUSE_MOVE,this._dragCallback),e.removeEventListener(g.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(g.Events.TOUCH_END,this._endCallback),e.removeEventListener(g.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(g.Events.TOUCH_TAP,this._endCallback)},this._activateModify=e=>{u.wk.isInteractingWithTool=!0,e.addEventListener(g.Events.MOUSE_UP,this._endCallback),e.addEventListener(g.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(g.Events.MOUSE_CLICK,this._endCallback),e.addEventListener(g.Events.TOUCH_END,this._endCallback),e.addEventListener(g.Events.TOUCH_DRAG,this._dragCallback),e.addEventListener(g.Events.TOUCH_TAP,this._endCallback)},this._deactivateModify=e=>{u.wk.isInteractingWithTool=!1,e.removeEventListener(g.Events.MOUSE_UP,this._endCallback),e.removeEventListener(g.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(g.Events.MOUSE_CLICK,this._endCallback),e.removeEventListener(g.Events.TOUCH_END,this._endCallback),e.removeEventListener(g.Events.TOUCH_DRAG,this._dragCallback),e.removeEventListener(g.Events.TOUCH_TAP,this._endCallback)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:o}=e,{element:a}=o;let r=(0,s.Rh)(this.getToolName(),a);if(!r?.length)return n;if(r=this.filterInteractableAnnotationsForElement(a,r),!r?.length)return n;const c=this.getTargetId(o),u=o.getRenderingEngine(),g={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let a=0;a<r.length;a++){const s=r[a],{annotationUID:p,data:v}=s,{points:m,activeHandleIndex:w}=v.handles,E=m.map((e=>o.worldToCanvas(e)));g.annotationUID=p;const{color:b,lineWidth:y,lineDash:I}=this.getAnnotationStyle({annotation:s,styleSpecifier:g}),{viewPlaneNormal:_,viewUp:C}=o.getCamera();if(v.cachedStats[c]&&null!=v.cachedStats[c].areaUnit){if(s.invalidated&&(this._throttledCalculateCachedStats(s,_,C,u,e),o instanceof i.VolumeViewport)){const{referencedImageId:e}=s.metadata;for(const t in v.cachedStats)if(t.startsWith("imageId")){u.getStackViewports().find((t=>{const n=i.utilities.imageIdToURI(e),o=t.hasImageURI(n),a=i.utilities.imageIdToURI(t.getCurrentImageId());return o&&a!==n}))&&delete v.cachedStats[t]}}}else v.cachedStats[c]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null},this._calculateCachedStats(s,_,C,u,e);if(!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;let T;if(!(0,d.isAnnotationVisible)(p))continue;if((0,l.isAnnotationLocked)(p)||this.editData||null===w||(T=[E[w]]),T){const e="0";(0,h.drawHandles)(t,p,e,T,{color:b})}const S=`${p}-rect`,x="0";(0,h.drawRectByCoordinates)(t,p,x,E,{color:b,lineDash:I,lineWidth:y},S),n=!0;const D=this.getLinkedTextBoxStyle(g,s);if(!D.visibility){v.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const A=this.configuration.getTextLines(v,c);if(!A||0===A.length)continue;if(!v.handles.textBox.hasMoved){const e=(0,f.getTextBoxCoordsCanvas)(E);v.handles.textBox.worldPosition=o.canvasToWorld(e)}const O=o.worldToCanvas(v.handles.textBox.worldPosition),M="1",R=(0,h.drawLinkedTextBox)(t,p,M,A,O,E,{},D),{x:k,y:L,width:P,height:N}=R;v.handles.textBox.worldBoundingBox={topLeft:o.canvasToWorld([k,L]),topRight:o.canvasToWorld([k+P,L]),bottomLeft:o.canvasToWorld([k,L+N]),bottomRight:o.canvasToWorld([k+P,L+N])}}return n},this._getRectangleImageCoordinates=e=>{const[t,n]=e;return{left:Math.min(t[0],n[0]),top:Math.min(t[1],n[1]),width:Math.abs(t[0]-n[0]),height:Math.abs(t[1]-n[1])}},this._calculateCachedStats=(e,t,n,o,i)=>{const{data:r}=e,{viewport:s}=i,{element:l}=s,d=r.handles.points[0],h=r.handles.points[3],{cachedStats:u}=r,g=Object.keys(u);for(let o=0;o<g.length;o++){const i=g[o],r=this.getTargetImageData(i);if(!r)continue;const{dimensions:l,imageData:c,metadata:p,voxelManager:v}=r,f=_(c,d);f[0]=Math.floor(f[0]),f[1]=Math.floor(f[1]),f[2]=Math.floor(f[2]);const w=_(c,h);if(w[0]=Math.floor(w[0]),w[1]=Math.floor(w[1]),w[2]=Math.floor(w[2]),this._isInsideVolume(f,w,l)){this.isHandleOutsideImage=!1;const o=[[Math.min(f[0],w[0]),Math.max(f[0],w[0])],[Math.min(f[1],w[1]),Math.max(f[1],w[1])],[Math.min(f[2],w[2]),Math.max(f[2],w[2])]],{worldWidth:l,worldHeight:g}=(0,m.A)(t,n,d,h),E=[f,w],{scale:I,areaUnit:_}=(0,a.Op)(r,E),C=Math.abs(l*g)/(I*I),T={isPreScaled:(0,y.u)(s,i),isSuvScaled:this.isSuvScaled(s,i,e.metadata.referencedImageId)},S=(0,b.j)(p.Modality,e.metadata.referencedImageId,T),x=v.forEach(this.configuration.statsCalculator.statsCallback,{boundsIJK:o,imageData:c,returnPoints:this.configuration.storePointData}),D=this.configuration.statsCalculator.getStatistics();u[i]={Modality:p.Modality,area:C,mean:D.mean?.value,stdDev:D.stdDev?.value,max:D.max?.value,statsArray:D.array,pointsInShape:x,areaUnit:_,modalityUnit:S}}else this.isHandleOutsideImage=!0,u[i]={Modality:p.Modality}}return e.invalidated=!1,(0,c.XF)(e,l),u},this._isInsideVolume=(e,t,n)=>i.utilities.indexWithinDimensions(e,n)&&i.utilities.indexWithinDimensions(t,n),this._throttledCalculateCachedStats=(0,r.A)(this._calculateCachedStats,100,{trailing:!0})}}function T(e,t){const n=e.cachedStats[t],{area:o,mean:a,max:r,stdDev:s,areaUnit:l,modalityUnit:d}=n;if(void 0===a)return;const c=[];return c.push(`Area: ${i.utilities.roundNumber(o)} ${l}`),c.push(`Mean: ${i.utilities.roundNumber(a)} ${d}`),c.push(`Max: ${i.utilities.roundNumber(r)} ${d}`),c.push(`Std Dev: ${i.utilities.roundNumber(s)} ${d}`),c}C.toolName="RectangleROI";const S=C},6030:(e,t,n)=>{"use strict";n.d(t,{A:()=>h});var o=n(81985),i=n(37234),a=n(82056),r=n(56069),s=n(94418),l=n(76712),d=n(49310);class c extends i.A{constructor(){super(...arguments),this.onImageSpacingCalibrated=e=>{const{element:t,imageId:n}=e.detail,i=o.utilities.imageIdToURI(n),s=(0,a.getAnnotationManager)();s.getFramesOfReference().forEach((e=>{const n=s.getAnnotations(e)[this.getToolName()];n&&n.length&&(n.forEach((e=>{if(!e.metadata?.referencedImageId)return;o.utilities.imageIdToURI(e.metadata.referencedImageId)===i&&(e.invalidated=!0,e.data.cachedStats={})})),(0,r.A)(t))}))}}filterInteractableAnnotationsForElement(e,t){if(!t||!t.length)return;const n=(0,o.getEnabledElement)(e),{viewport:i}=n;return(0,s.A)(i,t)}getReferencedImageId(e,t,n,i){const a=this.getTargetId(e);let r=a.split(/^[a-zA-Z]+:/)[1];if(e instanceof o.BaseVolumeViewport){const e=o.utilities.getVolumeId(a),i=o.cache.getVolume(e);r=o.utilities.getClosestImageId(i,t,n)}return r}getStyle(e,t,n){return(0,l.h)(e,t,(0,d.getState)(n),this.mode)}}c.toolName="AnnotationDisplayTool";const h=c},37234:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var o=n(81985),i=n(49892);class a{constructor(e,t){const n=o.utilities.deepMerge(t,e),{configuration:a={},supportedInteractionTypes:r,toolGroupId:s}=n;a.strategies||(a.strategies={},a.defaultStrategy=void 0,a.activeStrategy=void 0,a.strategyOptions={}),this.toolGroupId=s,this.supportedInteractionTypes=r||[],this.configuration=Object.assign({},a),this.mode=i.A.Disabled}getToolName(){return this.constructor.toolName}applyActiveStrategy(e,t){const{strategies:n,activeStrategy:o}=this.configuration;return n[o]?.call(this,e,t)}applyActiveStrategyCallback(e,t,n){const{strategies:o,activeStrategy:i}=this.configuration;if(!o[i])throw new Error(`applyActiveStrategyCallback: active strategy ${i} not found, check tool configuration or spellings`);return o[i][n]?.call(this,e,t)}setConfiguration(e){this.configuration=o.utilities.deepMerge(this.configuration,e)}setActiveStrategy(e){this.setConfiguration({activeStrategy:e})}getTargetImageData(e){if(e.startsWith("imageId:")){const t=e.split("imageId:")[1],n=o.utilities.imageIdToURI(t);let i=o.utilities.getViewportsWithImageURI(n);if(!i||!i.length)return;if(i=i.filter((e=>e.getCurrentImageId()===t)),!i||!i.length)return;return i[0].getImageData()}if(e.startsWith("volumeId:")){const t=o.utilities.getVolumeId(e),n=o.utilities.getViewportsWithVolumeId(t);if(!n||!n.length)return;return n[0].getImageData()}if(e.startsWith("videoId:")){const t=o.utilities.imageIdToURI(e),n=o.utilities.getViewportsWithImageURI(t);if(!n||!n.length)return;return n[0].getImageData()}throw new Error('getTargetIdImage: targetId must start with "imageId:" or "volumeId:"')}getTargetId(e){const t=e.getViewReferenceId?.();if(t)return t;throw new Error("getTargetId: viewport must have a getViewReferenceId method")}}a.toolName="BaseTool";const r=a},85817:(e,t,n)=>{"use strict";n.d(t,{EC:()=>i.A,oS:()=>o.A,wh:()=>a.A});var o=n(37234),i=n(91350),a=n(6030)},25894:(e,t,n)=>{"use strict";n.d(t,{A:()=>h});var o=n(81985),i=n(18682),a=n(22384),r=n(33283),s=n(69073),l=n(13654),d=n(87420);let c=!1;new Map;const h={render:async function(e,t){const{segmentationId:n}=t,o=(0,r.T)(n);if(!o)return;let d=o.representationData[i.A.Contour];d||!(0,s.n)(n,i.A.Contour)||c||(c=!0,d=await(0,l.D)(n,{viewport:e}),c=!1),d&&d.geometryIds?.length&&(0,a.d)(e,d.geometryIds,d.annotationUIDsMap,t)},removeRepresentation:function(e,t,n=!1){const i=(0,o.getEnabledElementByViewportId)(e);if(!i)return;const{viewport:a}=i;n&&((0,d.A)(e,t),a.render())}}},684:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>_});var o=n(81985),i=n(36014),a=n(88234),r=n(26228),s=n(50409),l=n(97577),d=n(33283),c=n(69073),h=n(79462),u=n(92686),g=n(18682),p=n(47098),v=n(60740),f=n(59452);const m=255,w=new Map;let E=!1;function b(e,t,n){const o={...e,...n||{}};return{fillAlpha:t?o.fillAlpha:o.fillAlphaInactive,outlineWidth:t?o.outlineWidth:o.outlineWidthInactive,renderFill:t?o.renderFill:o.renderFillInactive,renderOutline:t?o.renderOutline:o.renderOutlineInactive,outlineOpacity:t?o.outlineOpacity:o.outlineOpacityInactive,activeSegmentOutlineWidthDelta:o.activeSegmentOutlineWidthDelta}}function y(e,t,n,{fillAlpha:o,renderFill:i,renderOutline:a,segmentColor:r,outlineWidth:s,segmentsHidden:l,cfun:d,ofun:c}){const h=`${e}-${t}-${n}`,u=w.get(h);if(!u)return w.set(h,{fillAlpha:o,renderFill:i,renderOutline:a,outlineWidth:s,segmentColor:r.slice(),segmentsHidden:new Set(l),cfunMTime:d.getMTime(),ofunMTime:c.getMTime()}),{forceOpacityUpdate:!0,forceColorUpdate:!0};const{fillAlpha:g,renderFill:p,renderOutline:v,outlineWidth:f,segmentColor:m,segmentsHidden:E,cfunMTime:b,ofunMTime:y}=u,I=m[0]!==r[0]||m[1]!==r[1]||m[2]!==r[2],_=m[3]!==r[3]||g!==o||p!==i||v!==a||f!==s||E!==l;return(_||I)&&w.set(h,{fillAlpha:o,renderFill:i,renderOutline:a,outlineWidth:s,segmentColor:r.slice(),segmentsHidden:new Set(l),cfunMTime:d.getMTime(),ofunMTime:c.getMTime()}),{forceOpacityUpdate:_,forceColorUpdate:I}}async function I(e,t,n){await(0,i.A)(e.element,t,n)}const _={render:async function(e,t){const{segmentationId:n}=t,i=(0,d.T)(n);if(!i)return void console.warn("No segmentation found for segmentationId: ",n);let a=i.representationData[g.A.Labelmap],w=(0,f.wV)(e.id,n);if(!a&&(0,c.n)(n,g.A.Labelmap)&&!E){if(E=!0,a=await(0,h.z)(n,{viewport:e}),!a)throw new Error(`No labelmap data found for segmentationId ${n}.`);E=!1}if(a){if(e instanceof o.VolumeViewport)w||await I(e,a,n),w=(0,f.wV)(e.id,n);else{if(!(0,l.v)(e.id,n))return;w||await I(e,a,n),w=(0,f.wV)(e.id,n)}w&&function(e,t,n){const{segmentationId:o}=n,{cfun:i,ofun:a}=n.config,{colorLUTIndex:l}=n,d=(0,r.getActiveSegmentation)(e),c=d?.segmentationId===o,h=u.Y.getStyle({viewportId:e,type:g.A.Labelmap,segmentationId:o}),f=u.Y.getRenderInactiveSegmentations(e),w=(0,s.B)(l),E=Math.min(256,w.length),{outlineWidth:I,renderOutline:_,outlineOpacity:C,activeSegmentOutlineWidthDelta:T}=b(h,c),S=(0,p.s)(e,{segmentationId:o,type:g.A.Labelmap});for(let t=0;t<E;t++){const n=t,r=w[n],s=u.Y.getStyle({viewportId:e,type:g.A.Labelmap,segmentationId:o,segmentIndex:n}),{fillAlpha:l,outlineWidth:d,renderFill:p,renderOutline:v}=b(h,c,s),{forceOpacityUpdate:f,forceColorUpdate:E}=y(e,o,n,{fillAlpha:l,renderFill:p,renderOutline:v,segmentColor:r,outlineWidth:d,segmentsHidden:S,cfun:i,ofun:a});if(E&&i.addRGBPoint(n,r[0]/m,r[1]/m,r[2]/m),f)if(p){const e=S.has(n)?0:r[3]/255*l;a.removePoint(n),a.addPointLong(n,e,.5,1)}else a.addPointLong(n,.01,.5,1)}const x=t.actor;if(x.getProperty().setRGBTransferFunction(0,i),a.setClamping(!1),x.getProperty().setScalarOpacity(0,a),x.getProperty().setInterpolationTypeToNearest(),_){x.getProperty().setUseLabelOutline(_),x.getProperty().setLabelOutlineOpacity(C);const e=(0,v.Q)(n.segmentationId),t=new Array(E-1);for(let n=1;n<E;n++){S.has(n)?t[n-1]=0:t[n-1]=n===e?I+T:I}x.getProperty().setLabelOutlineThickness(t)}else x.getProperty().setLabelOutlineThickness(new Array(E-1).fill(0));const D=c||f;x.setVisibility(D)}(e.id,w,t)}},removeRepresentation:function(e,t,n=!1){const i=(0,o.getEnabledElementByViewportId)(e);if(w.forEach(((e,n)=>{n.includes(t)&&w.delete(n)})),!i)return;const{viewport:r}=i;(0,a.A)(r.element,t),n&&r.render()}}},67014:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>u});var o=n(81985),i=n(18682),a=n(20552),r=n(18796),s=n(33283),l=n(50409),d=n(69073),c=n(58062);const{ViewportType:h}=o.Enums;const u={render:async function(e,t){const{segmentationId:n}=t,a=(0,s.T)(n);if(!a)return;let h=a.representationData[i.A.Surface];if(!h&&(0,d.n)(n,i.A.Surface)&&(h=await(0,c.o)(n,{viewport:e}),!h))throw new Error(`No Surface data found for segmentationId ${n}.`);const{geometryIds:u}=h;u?.size||console.warn(`No Surfaces found for segmentationId ${n}. Skipping render.`);const{colorLUTIndex:g}=t,p=(0,l.B)(g),v=[];u.forEach((t=>{const i=o.cache.getGeometry(t);if(!i?.data)return void console.warn(`No Surfaces found for geometryId ${t}. Skipping render.`);const a=i.data.segmentIndex,s=i.data,l=p[a];s.color=l.slice(0,3),v.push(s),(0,r.A)(e.element,s,n)})),e.render()},removeRepresentation:function(e,t,n=!1){const i=(0,o.getEnabledElementByViewportId)(e);if(!i)return;const{viewport:r}=i;(0,a.A)(r.element,t),n&&r.render()}}},48736:(e,t,n)=>{"use strict";n.d(t,{A:()=>b});var o=n(81985),i=n(3823),a=n(85817),r=n(17492),s=n(1989),l=n(56789),d=n(33852),c=n(99737),h=n(89578),u=n(7001),g=n(58640),p=n(98870),v=n(26795),f=n(60740),m=n(93733),w=n(67165);class E extends a.oS{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{strategies:{FILL_INSIDE_CIRCLE:l.kr,ERASE_INSIDE_CIRCLE:d.r,FILL_INSIDE_SPHERE:r.Jq,ERASE_INSIDE_SPHERE:s._,THRESHOLD_INSIDE_CIRCLE:l.q,THRESHOLD_INSIDE_SPHERE:r.rd},strategySpecificConfiguration:{THRESHOLD:{threshold:[-150,-70]}},defaultStrategy:"FILL_INSIDE_CIRCLE",activeStrategy:"FILL_INSIDE_CIRCLE",thresholdVolumeId:null,brushSize:25,preview:{enabled:!1,previewColors:{},previewTimeMs:250,previewMoveDistance:8,dragMoveDistance:4,dragTimeMs:500},actions:{[c.StrategyCallbacks.AcceptPreview]:{method:c.StrategyCallbacks.AcceptPreview,bindings:[{key:"Enter"}]},[c.StrategyCallbacks.RejectPreview]:{method:c.StrategyCallbacks.RejectPreview,bindings:[{key:"Escape"}]}}}}){super(e,t),this._previewData={preview:null,element:null,timerStart:0,timer:null,startPoint:[NaN,NaN],isDrag:!1},this.onSetToolPassive=e=>{this.disableCursor()},this.onSetToolEnabled=()=>{this.disableCursor()},this.onSetToolDisabled=e=>{this.disableCursor()},this.preMouseDownCallback=e=>{const t=e.detail,{element:n}=t,i=(0,o.getEnabledElement)(n);this._editData=this.createEditData(n),this._activateDraw(n),(0,u.hideElementCursor)(n),e.preventDefault(),this._previewData.isDrag=!1,this._previewData.timerStart=Date.now();const a=this._hoverData||this.createHoverData(n);(0,g.A)(a.viewportIdsToRender);const r=this.getOperationData(n);return this.applyActiveStrategyCallback(i,r,c.StrategyCallbacks.OnInteractionStart),!0},this.mouseMoveCallback=e=>{if(this.mode===c.ToolModes.Active){if(this.updateCursor(e),!this.configuration.preview.enabled)return;const{previewTimeMs:t,previewMoveDistance:n,dragMoveDistance:o}=this.configuration.preview,{currentPoints:a,element:r}=e.detail,{canvas:s}=a,{preview:l,startPoint:d,timer:c,timerStart:h,isDrag:u}=this._previewData,g=i.Zc.distance(s,d),p=Date.now()-h;if((g>n||p>t&&g>o)&&(c&&(window.clearTimeout(c),this._previewData.timer=null),l&&!u&&this.rejectPreview(r)),!this._previewData.timer){const e=window.setTimeout(this.previewCallback,250);Object.assign(this._previewData,{timerStart:Date.now(),timer:e,startPoint:s,element:r})}}},this.previewCallback=()=>{this._previewData.timer=null,this._previewData.preview||(this._previewData.preview=this.applyActiveStrategyCallback((0,o.getEnabledElement)(this._previewData.element),this.getOperationData(this._previewData.element),c.StrategyCallbacks.Preview))},this._dragCallback=e=>{const t=e.detail,{element:n,currentPoints:a}=t,r=(0,o.getEnabledElement)(n);this.updateCursor(e);const{viewportIdsToRender:s}=this._hoverData;(0,g.A)(s);const l=i.Zc.distance(a.canvas,this._previewData.startPoint),{dragTimeMs:d,dragMoveDistance:c}=this.configuration.preview;!this._previewData.isDrag&&this._previewData.preview&&Date.now()-this._previewData.timerStart<d&&l<c||(this._previewData.preview=this.applyActiveStrategy(r,this.getOperationData(n)),this._previewData.element=n,this._previewData.timerStart=Date.now()+d,this._previewData.isDrag=!0,this._previewData.startPoint=a.canvas)},this._endCallback=e=>{const t=e.detail,{element:n}=t,i=(0,o.getEnabledElement)(n),a=this.getOperationData(n);this._previewData.preview||this._previewData.isDrag||this.applyActiveStrategy(i,a),this._deactivateDraw(n),(0,u.resetElementCursor)(n),this.updateCursor(e),this._editData=null,this.applyActiveStrategyCallback(i,a,c.StrategyCallbacks.OnInteractionEnd),this._previewData.isDrag||this.acceptPreview(n)},this._activateDraw=e=>{e.addEventListener(c.Events.MOUSE_UP,this._endCallback),e.addEventListener(c.Events.MOUSE_DRAG,this._dragCallback),e.addEventListener(c.Events.MOUSE_CLICK,this._endCallback)},this._deactivateDraw=e=>{e.removeEventListener(c.Events.MOUSE_UP,this._endCallback),e.removeEventListener(c.Events.MOUSE_DRAG,this._dragCallback),e.removeEventListener(c.Events.MOUSE_CLICK,this._endCallback)}}disableCursor(){this._hoverData=void 0,this.rejectPreview()}createEditData(e){const t=(0,o.getEnabledElement)(e),{viewport:n}=t,i=(0,w.T)(n.id);if(!i){const e=new CustomEvent(o.Enums.Events.ERROR_EVENT,{detail:{type:"Segmentation",message:"No active segmentation detected, create a segmentation representation before using the brush tool"},cancelable:!0});return o.eventTarget.dispatchEvent(e),null}const{segmentationId:a}=i,r=(0,v.getLockedSegmentIndices)(a),{representationData:s}=(0,p.getSegmentation)(a);if(n instanceof o.BaseVolumeViewport){const{volumeId:e}=s[c.SegmentationRepresentations.Labelmap],t=n.getActors();if(n instanceof o.StackViewport){const e=new CustomEvent(o.Enums.Events.ERROR_EVENT,{detail:{type:"Segmentation",message:"Cannot perform brush operation on the selected viewport"},cancelable:!0});return o.eventTarget.dispatchEvent(e),null}const i=t.map((e=>o.cache.getVolume(e.referencedId))),a=o.cache.getVolume(e),l=i.find((e=>o.utilities.isEqual(e.dimensions,a.dimensions)))?.volumeId||i[0]?.volumeId;return{volumeId:e,referencedVolumeId:this.configuration.thresholdVolumeId??l,segmentsLocked:r}}{const e=(0,p.getCurrentLabelmapImageIdForViewport)(n.id,a);if(!e)return;if(this.configuration.activeStrategy.includes("SPHERE")){const t=n.getImageIds();if(!o.utilities.isValidVolume(t))throw new Error("Volume is not reconstructable for sphere manipulation");const i=`${a}_${n.id}`,s=o.cache.getVolume(i);if(s)return{imageId:e,segmentsLocked:r,override:{voxelManager:s.voxelManager,imageData:s.imageData}};{const t=(0,p.getStackSegmentationImageIdsForViewport)(n.id,a);if(!t||1===t.length)return{imageId:e,segmentsLocked:r};const s=o.volumeLoader.createAndCacheVolumeFromImagesSync(i,t);return{imageId:e,segmentsLocked:r,override:{voxelManager:s.voxelManager,imageData:s.imageData}}}}return{imageId:e,segmentsLocked:r}}}createHoverData(e,t){const n=(0,o.getEnabledElement)(e),{viewport:i}=n,a=i.getCamera(),{viewPlaneNormal:r,viewUp:s}=a,l=[i.id],{segmentIndex:d,segmentationId:c,segmentColor:h}=this.getActiveSegmentationData(i)||{};return{brushCursor:{metadata:{viewPlaneNormal:[...r],viewUp:[...s],FrameOfReferenceUID:i.getFrameOfReferenceUID(),referencedImageId:"",toolName:this.getToolName(),segmentColor:h},data:{}},centerCanvas:t,segmentIndex:d,viewport:i,segmentationId:c,segmentColor:h,viewportIdsToRender:l}}getActiveSegmentationData(e){const t=e.id,n=(0,w.T)(t);if(!n)return;const{segmentationId:o}=n,i=(0,f.Q)(o);if(!i)return;return{segmentIndex:i,segmentationId:o,segmentColor:(0,m.getSegmentIndexColor)(t,o,i)}}updateCursor(e){const t=e.detail,{element:n}=t,{currentPoints:o}=t,i=o.canvas;this._hoverData=this.createHoverData(n,i),this._calculateCursor(n,i),this._hoverData&&(0,g.A)(this._hoverData.viewportIdsToRender)}getOperationData(e){const t=this._editData||this.createEditData(e),{segmentIndex:n,segmentationId:o,brushCursor:i}=this._hoverData||this.createHoverData(e),{data:a,metadata:r={}}=i||{},{viewPlaneNormal:s,viewUp:l}=r;return{...t,points:a?.handles?.points,segmentIndex:n,previewColors:this.configuration.preview.enabled?this.configuration.preview.previewColors:null,viewPlaneNormal:s,toolGroupId:this.toolGroupId,segmentationId:o,viewUp:l,strategySpecificConfiguration:this.configuration.strategySpecificConfiguration,preview:this._previewData?.preview}}_calculateCursor(e,t){const n=(0,o.getEnabledElement)(e),{viewport:a}=n,{canvasToWorld:r}=a,s=a.getCamera(),{brushSize:l}=this.configuration,d=i.eR.fromValues(s.viewUp[0],s.viewUp[1],s.viewUp[2]),c=i.eR.fromValues(s.viewPlaneNormal[0],s.viewPlaneNormal[1],s.viewPlaneNormal[2]),h=i.eR.create();i.eR.cross(h,d,c);const u=r([t[0],t[1]]),g=i.eR.create(),p=i.eR.create(),v=i.eR.create(),f=i.eR.create();for(let e=0;e<=2;e++)g[e]=u[e]-d[e]*l,p[e]=u[e]+d[e]*l,v[e]=u[e]-h[e]*l,f[e]=u[e]+h[e]*l;if(!this._hoverData)return;const{brushCursor:m}=this._hoverData,{data:w}=m;void 0===w.handles&&(w.handles={}),w.handles.points=[g,p,v,f];const E=this.configuration.activeStrategy,b=this.configuration.strategies[E];"function"==typeof b.computeInnerCircleRadius&&b.computeInnerCircleRadius({configuration:this.configuration,viewport:a}),w.invalidated=!1}rejectPreview(e=this._previewData.element){if(!e||!this._previewData.preview)return;const t=(0,o.getEnabledElement)(e);this.applyActiveStrategyCallback(t,this.getOperationData(e),c.StrategyCallbacks.RejectPreview),this._previewData.preview=null,this._previewData.isDrag=!1}acceptPreview(e=this._previewData.element){if(!e)return;const t=(0,o.getEnabledElement)(e);this.applyActiveStrategyCallback(t,this.getOperationData(e),c.StrategyCallbacks.AcceptPreview),this._previewData.isDrag=!1,this._previewData.preview=null}invalidateBrushCursor(){if(void 0===this._hoverData)return;const{data:e}=this._hoverData.brushCursor,{viewport:t}=this._hoverData;e.invalidated=!0;const{segmentColor:n}=this.getActiveSegmentationData(t)||{};this._hoverData.brushCursor.metadata.segmentColor=n}renderAnnotation(e,t){if(!this._hoverData)return;const{viewport:n}=e;if(!this._hoverData.viewportIdsToRender.includes(n.id))return;const o=this._hoverData.brushCursor;if(!0===o.data.invalidated){const{centerCanvas:e}=this._hoverData,{element:t}=n;this._calculateCursor(t,e)}const i=o.metadata;if(!i)return;const a=i.brushCursorUID,r=o.data,{points:s}=r.handles,l=s.map((e=>n.worldToCanvas(e))),d=l[0],c=l[1],u=[Math.floor((d[0]+c[0])/2),Math.floor((d[1]+c[1])/2)],g=Math.abs(d[1]-Math.floor((d[1]+c[1])/2)),p=`rgb(${i.segmentColor?.slice(0,3)||[0,0,0]})`;if(!n.getRenderingEngine())return void console.warn("Rendering Engine has been destroyed");(0,h.drawCircle)(t,a,"0",u,g,{color:p});const v=this.configuration.activeStrategy,{dynamicRadiusInCanvas:f}=this.configuration.strategySpecificConfiguration[v]||{dynamicRadiusInCanvas:0};if(f){const e="1";(0,h.drawCircle)(t,a,e,u,f,{color:p})}}}E.toolName="Brush";const b=E},67847:(e,t,n)=>{"use strict";n.d(t,{A:()=>T});var o=n(81985),i=n(4096),a=n(3823),r=n(6802),s=n(2076),l=n(89578),d=n(8056),c=n(27730),h=n(66990),u=n(35489),g=n(29601),p=n(7001),v=n(58640),f=n(44049),m=n(4010),w=n(18990),E=n(79362),b=n(13165),y=n(40634);const{transformWorldToIndex:I}=o.utilities;class _ extends m.A{constructor(e={},t={configuration:{storePointData:!1,numSlicesToPropagate:10,computePointsInsideVolume:!1,getTextLines:C,statsCalculator:E.BasicStatsCalculator,showTextBox:!1}}){super(e,t),this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:i}=t,a=n.world,s=(0,o.getEnabledElement)(i),{viewport:l,renderingEngine:c}=s;this.isDrawing=!0;const h=l.getCamera(),{viewPlaneNormal:u,viewUp:g}=h;let f,m,w;if(l instanceof o.StackViewport)throw new Error("Stack Viewport Not implemented");{const e=this.getTargetId(l);w=o.utilities.getVolumeId(e),m=o.cache.getVolume(w),f=o.utilities.getClosestImageId(m,a,u)}const E=o.utilities.getSpacingInNormalDirection(m,u),b=this._getStartCoordinate(a,u),y=this._getEndCoordinate(a,E,u),I=l.getFrameOfReferenceUID(),_={highlighted:!0,invalidated:!0,metadata:{viewPlaneNormal:[...u],enabledElement:s,viewUp:[...g],FrameOfReferenceUID:I,referencedImageId:f,toolName:this.getToolName(),volumeId:w,spacingInNormal:E},data:{label:"",startCoordinate:b,endCoordinate:y,cachedStats:{pointsInVolume:[],projectionPoints:[],projectionPointsImageIds:[f],statistics:[]},handles:{textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},points:[[...a],[...a],[...a],[...a]],activeHandleIndex:null},labelmapUID:null}};this._computeProjectionPoints(_,m),(0,r.lC)(_,i);const C=(0,d.getViewportIdsWithToolToRender)(i,this.getToolName());return this.editData={annotation:_,viewportIdsToRender:C,handleIndex:3,newAnnotation:!0,hasMoved:!1},this._activateDraw(i),(0,p.hideElementCursor)(i),e.preventDefault(),(0,v.A)(C),_},this._endCallback=e=>{const t=e.detail,{element:n}=t,{annotation:i,viewportIdsToRender:a,newAnnotation:s,hasMoved:l}=this.editData,{data:d}=i;if(s&&!l)return;d.handles.activeHandleIndex=null,this._deactivateModify(n),this._deactivateDraw(n),(0,p.resetElementCursor)(n);const c=(0,o.getEnabledElement)(n);this.editData=null,this.isDrawing=!1,this.isHandleOutsideImage&&this.configuration.preventHandleOutsideImage&&(0,r.O8)(i.annotationUID);const h=this.getTargetId(c.viewport),u=o.cache.getVolume(h.split(/volumeId:|\?/)[1]);this.configuration.calculatePointsInsideVolume&&this._computePointsInsideVolume(i,h,u,c),(0,v.A)(a),s&&(0,f.dZ)(i)},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:i}=e;let a=(0,r.Rh)(this.getToolName(),i.element);if(!a?.length)return n;a=(0,b.filterAnnotationsWithinSamePlane)(a,i.getCamera());const d={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let r=0;r<a.length;r++){const c=a[r],{annotationUID:u,data:p}=c,{startCoordinate:v,endCoordinate:f}=p,{points:m,activeHandleIndex:w}=p.handles,E=m.map((e=>i.worldToCanvas(e)));d.annotationUID=u;const b=this.getStyle("lineWidth",d,c),y=this.getStyle("lineDash",d,c),I=this.getStyle("color",d,c),_=i.getCamera().focalPoint,C=i.getCamera().viewPlaneNormal;let T=v,S=f;Array.isArray(v)&&(T=this._getCoordinateForViewplaneNormal(T,C),p.startCoordinate=T,p.handles.points[0][this._getIndexOfCoordinatesForViewplaneNormal(C)]=T,p.startCoordinate=T,p.handles.points[0][this._getIndexOfCoordinatesForViewplaneNormal(C)]=T),Array.isArray(f)&&(S=this._getCoordinateForViewplaneNormal(S,C),p.endCoordinate=S,p.endCoordinate=S);const x=o.utilities.roundToPrecision(T),D=o.utilities.roundToPrecision(S),A=this._getCoordinateForViewplaneNormal(_,C),O=o.utilities.roundToPrecision(A);if(O<Math.min(x,D)||O>Math.max(x,D))continue;c.invalidated&&this._throttledCalculateCachedStats(c,e);let M,R=!1;if(O!==x&&O!==D||(R=!0),!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;if(!(0,g.isAnnotationVisible)(u))continue;if((0,s.isAnnotationLocked)(u)||this.editData||null===w||!R||(M=[E[w]]),M){const e="0";(0,l.drawHandles)(t,u,e,M,{color:I})}let k=y;R||(k=2);const L="0";if((0,l.drawRect)(t,u,L,E[0],E[3],{color:I,lineDash:k,lineWidth:b}),n=!0,this.configuration.showTextBox&&this.configuration.calculatePointsInsideVolume){const e=this.getLinkedTextBoxStyle(d,c);if(!e.visibility){p.handles.textBox={hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}};continue}const n=this.configuration.getTextLines(p);if(!n||0===n.length)continue;if(!p.handles.textBox.hasMoved){const e=(0,h.getTextBoxCoordsCanvas)(E);p.handles.textBox.worldPosition=i.canvasToWorld(e)}const o=i.worldToCanvas(p.handles.textBox.worldPosition),a="1",r=(0,l.drawLinkedTextBox)(t,u,a,n,o,E,{},e),{x:s,y:g,width:v,height:f}=r;p.handles.textBox.worldBoundingBox={topLeft:i.canvasToWorld([s,g]),topRight:i.canvasToWorld([s+v,g]),bottomLeft:i.canvasToWorld([s,g+f]),bottomRight:i.canvasToWorld([s+v,g+f])}}}return n},this._throttledCalculateCachedStats=(0,c.A)(this._calculateCachedStatsTool,100,{trailing:!0})}_computeProjectionPoints(e,t){const{data:n,metadata:o}=e,{viewPlaneNormal:i,spacingInNormal:r}=o,{imageData:s}=t,{startCoordinate:l,endCoordinate:d}=n,{points:c}=n.handles,h=I(s,c[0]),u=I(s,c[0]),g=a.eR.create();s.indexToWorldVec3(h,g);const p=a.eR.create();s.indexToWorldVec3(u,p),2==this._getIndexOfCoordinatesForViewplaneNormal(i)?(g[2]=l,p[2]=d):0==this._getIndexOfCoordinatesForViewplaneNormal(i)?(g[0]=l,p[0]=d):1==this._getIndexOfCoordinatesForViewplaneNormal(i)&&(g[1]=l,p[1]=d);const v=a.eR.distance(g,p),f=[];for(let e=0;e<v;e+=r)f.push(c.map((t=>{const n=a.eR.create();return a.eR.scaleAndAdd(n,t,i,e),Array.from(n)})));n.cachedStats.projectionPoints=f}_computePointsInsideVolume(e,t,n,o){const{data:a,metadata:r}=e,{viewPlaneNormal:s,viewUp:l}=r,{viewport:d}=o,c=a.cachedStats.projectionPoints,h=[[]],g=this.getTargetImageData(t),p=a.handles.points[0],v=a.handles.points[3],{worldWidth:f,worldHeight:m}=(0,u.A)(s,l,p,v),E=(0,i.Op)(g,a.habdles),b=Math.abs(f*m)/(E.scale*E.scale),_={isPreScaled:(0,w.u)(d,t),isSuvScaled:this.isSuvScaled(d,t,e.metadata.referencedImageId)},C=(0,y.j)(r.Modality,e.metadata.referencedImageId,_);for(let e=0;e<c.length;e++){if(!n)continue;const t=c[e][0],{dimensions:o,imageData:i,voxelManager:a}=n,r=I(i,p),l=I(i,t),d=this._getIndexOfCoordinatesForViewplaneNormal(s);r[0]=Math.floor(r[0]),r[1]=Math.floor(r[1]),r[2]=Math.floor(r[2]),r[d]=l[d];const u=I(i,v);if(u[0]=Math.floor(u[0]),u[1]=Math.floor(u[1]),u[2]=Math.floor(u[2]),u[d]=l[d],this._isInsideVolume(r,u,o)){this.isHandleOutsideImage=!1;const e=[[Math.min(r[0],u[0]),Math.max(r[0],u[0])],[Math.min(r[1],u[1]),Math.max(r[1],u[1])],[Math.min(r[2],u[2]),Math.max(r[2],u[2])]],t=a.forEach(this.configuration.statsCalculator.statsCallback,{boundsIJK:e,imageData:i,returnPoints:this.configuration.storePointData});h.push(t)}}const T=this.configuration.statsCalculator.getStatistics();a.cachedStats.pointsInVolume=h,a.cachedStats.statistics={Modality:r.Modality,area:b,mean:T.mean?.value,stdDev:T.stdDev?.value,max:T.max?.value,statsArray:T.array,areaUnit:E.areaUnit,modalityUnit:C}}_calculateCachedStatsTool(e,t){const n=e.data,{viewport:i}=t,{cachedStats:a}=n,r=this.getTargetId(i),s=o.cache.getVolume(r.split(/volumeId:|\?/)[1]);return this._computeProjectionPoints(e,s),this.configuration.calculatePointsInsideVolume&&this._computePointsInsideVolume(e,r,s,t),this.configuration.calculatePointsInsideVolume&&this._computePointsInsideVolume(e,r,s,t),e.invalidated=!1,(0,f.XF)(e,i.element),a}_getStartCoordinate(e,t){const n=e;return this._getCoordinateForViewplaneNormal(n,t)}_getEndCoordinate(e,t,n){const o=this.configuration.numSlicesToPropagate,i=a.eR.create();a.eR.scaleAndAdd(i,e,n,o*t);return this._getCoordinateForViewplaneNormal(i,n)}_getIndexOfCoordinatesForViewplaneNormal(e){const t=[Math.abs(e[0]),Math.abs(e[1]),Math.abs(e[2])];return t.indexOf(Math.max(...t))}_getCoordinateForViewplaneNormal(e,t){return e[this._getIndexOfCoordinatesForViewplaneNormal(t)]}}function C(e){const t=e.cachedStats.statistics,{area:n,mean:i,max:a,stdDev:r,areaUnit:s,modalityUnit:l}=t;if(void 0===i)return;const d=[];return d.push(`Area: ${o.utilities.roundNumber(n)} ${s}`),d.push(`Mean: ${o.utilities.roundNumber(i)} ${l}`),d.push(`Max: ${o.utilities.roundNumber(a)} ${l}`),d.push(`Std Dev: ${o.utilities.roundNumber(r)} ${l}`),d}_.toolName="RectangleROIStartEndThreshold";const T=_},40336:(e,t,n)=>{"use strict";n.d(t,{A:()=>p});var o=n(81985),i=n(6802),a=n(2076),r=n(89578),s=n(8056),l=n(7001),d=n(58640),c=n(29601),h=n(44049),u=n(4010);class g extends u.A{constructor(e={},t={supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1}}){super(e,t),this.addNewAnnotation=e=>{const t=e.detail,{currentPoints:n,element:a}=t,r=n.world,c=(0,o.getEnabledElement)(a),{viewport:h,renderingEngine:u}=c;this.isDrawing=!0;const g=h.getCamera(),{viewPlaneNormal:p,viewUp:v}=g,f=this.getTargetId(h);let m,w;if(h instanceof o.StackViewport)m=f.split("imageId:")[1];else{w=o.utilities.getVolumeId(f);const e=o.cache.getVolume(w);m=o.utilities.getClosestImageId(e,r,p)}const E=h.getFrameOfReferenceUID(),b={highlighted:!0,invalidated:!0,metadata:{viewPlaneNormal:[...p],enabledElement:c,viewUp:[...v],FrameOfReferenceUID:E,referencedImageId:m,toolName:this.getToolName(),volumeId:w},data:{label:"",handles:{textBox:{hasMoved:!1,worldPosition:null,worldBoundingBox:null},points:[[...r],[...r],[...r],[...r]],activeHandleIndex:null},segmentationId:null}};(0,i.lC)(b,a);const y=(0,s.getViewportIdsWithToolToRender)(a,this.getToolName());return this.editData={annotation:b,viewportIdsToRender:y,handleIndex:3,newAnnotation:!0,hasMoved:!1},this._activateDraw(a),(0,l.hideElementCursor)(a),e.preventDefault(),(0,d.A)(y),b},this.renderAnnotation=(e,t)=>{let n=!1;const{viewport:o}=e,{element:s}=o;let l=(0,i.Rh)(this.getToolName(),s);if(!l?.length)return n;if(l=this.filterInteractableAnnotationsForElement(s,l),!l?.length)return n;const d={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id};for(let e=0;e<l.length;e++){const i=l[e],{annotationUID:u,data:g}=i,{points:p,activeHandleIndex:v}=g.handles,f=p.map((e=>o.worldToCanvas(e)));d.annotationUID=u;const m=this.getStyle("lineWidth",d,i),w=this.getStyle("lineDash",d,i),E=this.getStyle("color",d,i);if(!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),n;let b;if((0,h.XF)(i,s),!(0,c.isAnnotationVisible)(u))continue;if((0,a.isAnnotationLocked)(u)||this.editData||null===v||(b=[f[v]]),b){const e="0";(0,r.drawHandles)(t,u,e,b,{color:E})}const y="0";(0,r.drawRect)(t,u,y,f[0],f[3],{color:E,lineDash:w,lineWidth:m}),n=!0}return n}}}g.toolName="RectangleROIThreshold";const p=g},93126:(e,t,n)=>{"use strict";var o;n.d(t,{W:()=>o}),function(e){e[e.CounterClockwise=-1]="CounterClockwise",e[e.Unknown=0]="Unknown",e[e.Clockwise=1]="Clockwise"}(o||(o={}))},13369:()=>{},64843:(e,t,n)=>{"use strict";n.r(t),n.d(t,{addContourSegmentationAnnotation:()=>a.V,areSameSegment:()=>o.A,isContourSegmentationAnnotation:()=>i.A,removeContourSegmentationAnnotation:()=>r.M});var o=n(62854),i=n(78130),a=n(85263),r=n(37354)},15295:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var o=n(81985);const{isEqual:i}=o.utilities;function a(e){const{metadata:t}=e;return(0,o.getEnabledElements)().filter((e=>{if(e.FrameOfReferenceUID===t.FrameOfReferenceUID){const n=e.viewport,{viewPlaneNormal:o,viewUp:a}=n.getCamera();return i(o,t.viewPlaneNormal)&&(!t.viewUp||i(a,t.viewUp))}})).map((e=>e.viewport))}},23566:(e,t,n)=>{"use strict";n.r(t),n.d(t,{annotationFrameRange:()=>f.A,annotationHydration:()=>w.i,boundingBox:()=>D,calibrateImageSpacing:()=>d.A,cine:()=>x,contourSegmentation:()=>U,contours:()=>E,debounce:()=>r.A,drawing:()=>y,dynamicVolume:()=>L,getAnnotationNearPoint:()=>a.S,getAnnotationNearPointOnEnabledElement:()=>a.s,getCalibratedAspect:()=>c.CQ,getCalibratedLengthUnitsAndScale:()=>c.Op,getCalibratedProbeUnitsAndValue:()=>c.Xw,getClosestImageIdForStackViewport:()=>w.x,getSphereBoundsInfo:()=>p.R,getViewportForAnnotation:()=>m.A,isObject:()=>l.A,math:()=>I,orientation:()=>o,planar:()=>_,planarFreehandROITool:()=>A,pointInSurroundingSphereCallback:()=>V.i,pointToString:()=>v.l,polyDataUtils:()=>P,rectangleROITool:()=>O,roundNumber:()=>B,segmentation:()=>b,stackContextPrefetch:()=>M.N,stackPrefetch:()=>M.S,throttle:()=>s.A,touch:()=>k,triggerAnnotationRender:()=>g.A,triggerAnnotationRenderForToolGroupIds:()=>u.A,triggerAnnotationRenderForViewportIds:()=>h.A,triggerEvent:()=>i.triggerEvent,viewport:()=>R,viewportFilters:()=>C,voi:()=>N});var o={};n.r(o),n.d(o,{getOrientationStringLPS:()=>T.A,invertOrientationStringLPS:()=>S.A});var i=n(81985),a=n(41293),r=n(52905),s=n(27730),l=n(45217),d=n(58271),c=n(4096),h=n(58640),u=n(94779),g=n(56069),p=n(4296),v=n(38726),f=n(73961),m=n(62514),w=n(64485),E=n(54010),b=n(67470),y=n(66990),I=n(95527),_=n(13165),C=n(8056),T=n(7193),S=n(2786),x=n(43488),D=n(72282),A=n(66129),O=n(74866),M=n(4850),R=n(19027),k=n(76260),L=n(74609),P=n(32994),N=n(93575),U=n(64843),V=n(10261);const B=i.utilities.roundNumber},95527:(e,t,n)=>{"use strict";n.r(t),n.d(t,{BasicStatsCalculator:()=>i,aabb:()=>o,ellipse:()=>a,lineSegment:()=>r,point:()=>s,polyline:()=>l,rectangle:()=>d,vec2:()=>c});var o=n(88638),i=n(79362),a=n(87009),r=n(93258),s=n(29614),l=n(92984),d=n(92282),c=n(23324)},90554:(e,t,n)=>{"use strict";function o(e,t){let n=[0,0],o=Number.MAX_SAFE_INTEGER;return e.forEach((function(e){const i=function(e,t){const[n,o]=e,[i,a]=t;return Math.sqrt(Math.pow(n-i,2)+Math.pow(o-a,2))}(t,e);i<o&&(o=i,n=[...e])})),n}n.d(t,{A:()=>o})},25758:(e,t,n)=>{"use strict";n.d(t,{O:()=>s});var o=n(81985),i=n(99737),a=n(64063),r=n(33283);function s(e){const t=(0,a.R1)(e);if(t)return t;const n=(0,r.T)(e);if(!n)throw new Error(`No segmentation found for segmentationId ${e}`);let s;if(n.representationData.Labelmap)s=function(e,t){const n=e.representationData[i.SegmentationRepresentations.Labelmap],a=new Set;n.imageIds?function(e,t){t.forEach((t=>{o.cache.getImage(t).voxelManager.getScalarData().forEach((t=>{0!==t&&e.add(t)}))}))}(a,n.imageIds):function(e,t){const n=o.cache.getVolume(t);n.voxelManager.forEach((({value:t})=>{0!==t&&e.add(t)}))}(a,t);return Array.from(a).map(Number).sort(((e,t)=>e-t))}(n,e);else if(n.representationData.Contour)s=function(e){const{annotationUIDsMap:t,geometryIds:n}=e.representationData.Contour||{};if(!n)throw new Error(`No geometryIds found for segmentationId ${e.segmentationId}`);const i=new Set([...t.keys()]);return n.forEach((e=>{const t=o.cache.getGeometry(e);i.add(t.data.segmentIndex)})),Array.from(i).sort(((e,t)=>e-t))}(n);else{if(!n.representationData.Surface)throw new Error(`Unsupported segmentation type: ${n.representationData}`);s=function(e){const t=e.representationData.Surface?.geometryIds??[];return Array.from(t.keys()).map(Number).sort(((e,t)=>e-t))}(n)}return(0,a.Dm)(e,s),s}},35706:(e,t,n)=>{"use strict";n.d(t,{E:()=>r});var o=n(7754),i=n(58640),a=n(14957);function r(e){const t=(0,o.getToolGroup)(e);if(void 0===t)return;(0,a.n)(e).forEach((e=>{e.invalidateBrushCursor()}));const n=t.getViewportsInfo();if(!Object.keys(n).map((e=>n[e])).length)return;const r=t.getViewportIds();(0,i.A)(r)}},64063:(e,t,n)=>{"use strict";n.d(t,{Dm:()=>h,HM:()=>d,Q5:()=>r,R1:()=>c,zf:()=>s});var o=n(81985),i=n(87063);const a=(e,t)=>JSON.stringify(e)===JSON.stringify(t);function r(e,t,n,a){const r=n[0]/2,s=n[1]/2,l=n[2]/2,d=new Array(8);d[0]=o.utilities.transformWorldToIndex(e,[a[0]-r,a[1]-s,a[2]-l]);const c=[[1,-1,-1],[-1,1,-1],[1,1,-1],[-1,-1,1],[1,-1,1],[-1,1,1],[1,1,1]];for(let t=0;t<7;t++){const[n,i,h]=c[t];d[t+1]=o.utilities.transformWorldToIndex(e,[a[0]+n*r,a[1]+i*s,a[2]+h*l])}return(0,i.g)(d,t)}function s(e,t){const{spacing:n}=e,o=e.voxelManager.getScalarDataLength(),i=[];let r=0;for(let e=0;e<t.length;e++){const{imageData:s,spacing:l,dimensions:d,voxelManager:c}=t[e].volume,h=t[e].volume.voxelManager.getScalarDataLength();h===o&&a(l,n)&&(r=e);const u=t[e].lower,g=t[e].upper;i.push({imageData:s,lower:u,upper:g,spacing:l,dimensions:d,volumeSize:h,voxelManager:c})}return{volumeInfoList:i,baseVolumeIdx:r}}const l=new Map,d=e=>{const t=l.get(e);t&&(t.isDirty=!0)},c=e=>{const t=l.get(e);return t&&!t.isDirty?t.indices:null},h=(e,t)=>{l.set(e,{indices:t,isDirty:!1})}},58640:(e,t,n)=>{"use strict";n.d(t,{A:()=>r,t:()=>a});var o=n(81985),i=n(56069);function a(e){e.length&&e.forEach((e=>{const t=(0,o.getEnabledElementByViewportId)(e);if(!t)return void console.warn(`Viewport not available for ${e}`);const{viewport:n}=t;if(!n)return void console.warn(`Viewport not available for ${e}`);const a=n.element;(0,i.A)(a)}))}const r=a},28802:(e,t,n)=>{"use strict";n.r(t),n.d(t,{Colorbar:()=>i.P,Enums:()=>o,ViewportColorbar:()=>a.b});var o=n(51807),i=n(24605),a=n(91008)},81810:(e,t,n)=>{"use strict";var o,i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},a=n(86326),r=(o=a)&&o.__esModule?o:{default:o};t.A=function(e){var t=e.fill,n=void 0===t?"currentColor":t,o=e.width,a=void 0===o?24:o,s=e.height,l=void 0===s?24:s,d=e.style,c=void 0===d?{}:d,h=function(e,t){var n={};for(var o in e)t.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}(e,["fill","width","height","style"]);return r.default.createElement("svg",i({viewBox:"0 0 24 24",style:i({fill:n,width:a,height:l},c)},h),r.default.createElement("path",{d:"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"}))}},69767:(e,t,n)=>{"use strict";var o,i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},a=n(86326),r=(o=a)&&o.__esModule?o:{default:o};t.A=function(e){var t=e.fill,n=void 0===t?"currentColor":t,o=e.width,a=void 0===o?24:o,s=e.height,l=void 0===s?24:s,d=e.style,c=void 0===d?{}:d,h=function(e,t){var n={};for(var o in e)t.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}(e,["fill","width","height","style"]);return r.default.createElement("svg",i({viewBox:"0 0 24 24",style:i({fill:n,width:a,height:l},c)},h),r.default.createElement("path",{d:"M12,18.17L8.83,15L7.42,16.41L12,21L16.59,16.41L15.17,15M12,5.83L15.17,9L16.58,7.59L12,3L7.41,7.59L8.83,9L12,5.83Z"}))}},83562:(e,t,n)=>{"use strict";function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(i=o.key,a=void 0,"symbol"==typeof(a=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"))?a:String(a)),o)}var i,a}function a(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function s(e){for(var t=new Uint8Array(e.length),n=0,o=e.length;n<o;n++)t[n]=e.charCodeAt(n);return t}function l(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(n+t.length>e.length)return!1;for(var o=n,i=0;i<t.length;i++){if(t[i]!==e[o])return!1;o+=1}return!0}function d(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0,i=e.length;o&&(i=Math.min(n+o,e.length));for(var a=n;a<i;a++)if(e[a]===t[0]&&l(e,t,a))return a;return-1}function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return"".concat(e()+e(),"-").concat(e(),"-").concat(e(),"-").concat(e(),"-").concat(e()).concat(e()).concat(e())}(),n="Content-Type: ".concat(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"application/dicom"),o="\r\n--".concat(t,"\r\n").concat(n,"\r\n\r\n"),i="\r\n--".concat(t,"--"),a=s(o),r=s(i),l=a.length,d=r.length,c=0,h=e.map((function(e){var t=new Uint8Array(e),n=t.length;return c+=l+n+d,t})),u=new Uint8Array(c);u.set(a,0);var g=0;return h.forEach((function(e){u.set(a,g),u.set(e,g+l),g+=l+e.length})),u.set(r,g),{data:u.buffer,boundary:t}}function h(e){var t=ArrayBuffer.isView(e)?e:new Uint8Array(e),n=s("\r\n\r\n"),o=d(t,n,0,1e3);if(-1===o)throw new Error("Response message has no multipart mime header");var i=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(arguments.length>2?arguments[2]:void 0)||e.length-t,o="",i=t;i<t+n;i++)o+=String.fromCharCode(e[i]);return o}(t,0,o),a=function(e){for(var t=e.split("\r\n"),n=0;n<t.length;n++)if("--"===t[n].substr(0,2))return t[n];return null}(i);if(!a)throw new Error("Header of response message does not specify boundary");for(var r,l=s(a),c=l.length,h=[],u=c;-1!==r&&-1!==(r=d(t,l,u));){var g=d(t,n,u,1e3);if(-1===g)throw new Error("Response message part has no mime header");u=g+n.length;var p=e.slice(u,r-2);h.push(p),u=r+c}return h}function u(e){return"object"===o(e)&&null!==e}function g(e){return 0===Object.keys(e).length&&e.constructor===Object}n.d(t,{FH:()=>m});var p=function(e){return e[0]},v={DICOM:"application/dicom",DICOM_JSON:"application/dicom+json",OCTET_STREAM:"application/octet-stream",PDF:"application/pdf",JPEG:"image/jpeg",PNG:"image/png"},f=function(){};var m={DICOMwebClient:function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.baseURL=t.url,this.baseURL||console.error("no DICOMweb base url provided - calls that require a URL will fail"),"username"in t&&(this.username=t.username,"password"in t||console.error("no password provided to authenticate with DICOMweb service"),this.password=t.password),"qidoURLPrefix"in t?(f("use URL prefix for QIDO-RS: ".concat(t.qidoURLPrefix)),this.qidoURL="".concat(this.baseURL,"/").concat(t.qidoURLPrefix)):this.qidoURL=this.baseURL,"wadoURLPrefix"in t?(f("use URL prefix for WADO-RS: ".concat(t.wadoURLPrefix)),this.wadoURL="".concat(this.baseURL,"/").concat(t.wadoURLPrefix)):this.wadoURL=this.baseURL,"stowURLPrefix"in t?(f("use URL prefix for STOW-RS: ".concat(t.stowURLPrefix)),this.stowURL="".concat(this.baseURL,"/").concat(t.stowURLPrefix)):this.stowURL=this.baseURL,t.singlepart?(f("use singlepart",t.singlepart),this.singlepart=!0===t.singlepart?"bulkdata,video,image":t.singlepart):this.singlepart="","requestHooks"in t&&(this.requestHooks=t.requestHooks),this.headers=t.headers||{},this.errorInterceptor=t.errorInterceptor||function(){},this.verbose=!1!==t.verbose,this.setDebug(t.debug)}var t,n,r;return t=e,n=[{key:"setDebug",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.debugLevel=!!e,f=t||e?console.log:function(){}}},{key:"getDebug",value:function(){return this.debugLevel}},{key:"setVerbose",value:function(e){this.verbose=e}},{key:"getVerbose",value:function(){return this.verbose}},{key:"_httpRequest",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=this.errorInterceptor,s=this.requestHooks;return new Promise((function(l,d){var c=a.request?a.request:new XMLHttpRequest;c.open(t,e,!0),"responseType"in a&&(c.responseType=a.responseType),"object"===o(i)&&Object.keys(i).forEach((function(e){c.setRequestHeader(e,i[e])}));var u,g=n.headers;if(Object.keys(g).forEach((function(e){c.setRequestHeader(e,g[e])})),c.onloadstart=function(){f("upload started: ",e)},c.onloadend=function(){f("upload finished")},c.onreadystatechange=function(){if(4===c.readyState)if(200===c.status){var e=c.getResponseHeader("Content-Type");e&&-1!==e.indexOf("multipart")?l(h(c.response)):"arraybuffer"===c.responseType?l([c.response]):l(c.response)}else if(202===c.status)n.verbose&&console.warn("some resources already existed: ",c),l(c.response);else if(204===c.status)n.verbose&&console.warn("empty response for request: ",c),l([]);else{var t=new Error("request failed");t.request=c,t.response=c.response,t.status=c.status,n.verbose&&(console.error("request failed: ",c),console.error(t),console.error(t.response)),r(t),d(t)}},"progressCallback"in a&&"function"==typeof a.progressCallback&&(c.onprogress=a.progressCallback),s&&function(e){var t=Array.isArray(e)&&e.every((function(e){return"function"==typeof e&&2===e.length}));return t||console.warn("Request hooks should have the following signature: function requestHook(request, metadata) { return request; }"),t}(s)){var p=Object.assign({},i,n.headers),v={method:t,url:e,headers:p},m=(u=s,function(e){return u.reduce((function(e,t){return t(e,v)}),e)});c=m(c)}"withCredentials"in a&&a.withCredentials&&(c.withCredentials=!0),"data"in a?c.send(a.data):c.send()}))}},{key:"_httpGet",value:function(e,t,n,o,i){return this._httpRequest(e,"get",t,{responseType:n,progressCallback:o,withCredentials:i})}},{key:"_httpGetApplicationJson",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,r=t;"object"===o(n)&&(g(n)||(r+=e._parseQueryParameters(n)));var s={Accept:v.DICOM_JSON};return this._httpGet(r,s,"json",i,a)}},{key:"_httpGetApplicationPdf",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,r=t;"object"===o(n)&&(g(n)||(r+=e._parseQueryParameters(n)));var s={Accept:v.PDF};return this._httpGet(r,s,"json",i,a)}},{key:"_httpGetImage",value:function(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,s=t;"object"===o(i)&&(g(i)||(s+=e._parseQueryParameters(i)));var l={Accept:e._buildAcceptHeaderFieldValue(n,["image/","image/*","image/jpeg","image/jp2","image/gif","image/png"])};return this._httpGet(s,l,"arraybuffer",a,r)}},{key:"_httpGetText",value:function(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,s=t;"object"===o(i)&&(g(i)||(s+=e._parseQueryParameters(i)));var l={Accept:e._buildAcceptHeaderFieldValue(n,["text/","text/*","text/html","text/plain","text/rtf","text/xml"])};return this._httpGet(s,l,"arraybuffer",a,r)}},{key:"_httpGetVideo",value:function(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,s=t;"object"===o(i)&&(g(i)||(s+=e._parseQueryParameters(i)));var l={Accept:e._buildAcceptHeaderFieldValue(n,["video/","video/*","video/mpeg","video/mp4","video/H265"])};return this._httpGet(s,l,"arraybuffer",a,r)}},{key:"_httpGetMultipartImage",value:function(t,n,o,i){var a,r=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0,l={};return arguments.length>4&&void 0!==arguments[4]&&arguments[4]?a=["image/jpeg","image/gif","image/png","image/jp2"]:(a={"1.2.840.10008.1.2.5":["image/x-dicom-rle"],"1.2.840.10008.1.2.4.50":["image/jpeg"],"1.2.840.10008.1.2.4.51":["image/jpeg"],"1.2.840.10008.1.2.4.57":["image/jpeg"],"1.2.840.10008.1.2.4.70":["image/jpeg"],"1.2.840.10008.1.2.4.80":["image/x-jls","image/jls"],"1.2.840.10008.1.2.4.81":["image/x-jls","image/jls"],"1.2.840.10008.1.2.4.90":["image/jp2"],"1.2.840.10008.1.2.4.91":["image/jp2"],"1.2.840.10008.1.2.4.92":["image/jpx"],"1.2.840.10008.1.2.4.93":["image/jpx"]},o&&(l.Range=e._buildRangeHeaderFieldValue(o))),l.Accept=e._buildMultipartAcceptHeaderFieldValue(n,a),this._httpGet(t,l,"arraybuffer",r,s)}},{key:"_httpGetMultipartVideo",value:function(t,n,o,i){var a,r=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0,l={};return arguments.length>4&&void 0!==arguments[4]&&arguments[4]?a=["video/","video/*","video/mpeg2","video/mp4","video/H265"]:(a={"1.2.840.10008.1.2.4.100":["video/mpeg2"],"1.2.840.10008.1.2.4.101":["video/mpeg2"],"1.2.840.10008.1.2.4.102":["video/mp4"],"1.2.840.10008.1.2.4.103":["video/mp4"],"1.2.840.10008.1.2.4.104":["video/mp4"],"1.2.840.10008.1.2.4.105":["video/mp4"],"1.2.840.10008.1.2.4.106":["video/mp4"]},o&&(l.Range=e._buildRangeHeaderFieldValue(o))),l.Accept=e._buildMultipartAcceptHeaderFieldValue(n,a),this._httpGet(t,l,"arraybuffer",r,s)}},{key:"_httpGetMultipartApplicationDicom",value:function(t,n,o,i,a){var r={},s="application/dicom",l={"1.2.840.10008.1.2.1":[s],"1.2.840.10008.1.2.5":[s],"1.2.840.10008.1.2.4.50":[s],"1.2.840.10008.1.2.4.51":[s],"1.2.840.10008.1.2.4.57":[s],"1.2.840.10008.1.2.4.70":[s],"1.2.840.10008.1.2.4.80":[s],"1.2.840.10008.1.2.4.81":[s],"1.2.840.10008.1.2.4.90":[s],"1.2.840.10008.1.2.4.91":[s],"1.2.840.10008.1.2.4.92":[s],"1.2.840.10008.1.2.4.93":[s],"1.2.840.10008.1.2.4.100":[s],"1.2.840.10008.1.2.4.101":[s],"1.2.840.10008.1.2.4.102":[s],"1.2.840.10008.1.2.4.103":[s],"1.2.840.10008.1.2.4.104":[s],"1.2.840.10008.1.2.4.105":[s],"1.2.840.10008.1.2.4.106":[s]},d=n;return n||(d=[{mediaType:s}]),r.Accept=e._buildMultipartAcceptHeaderFieldValue(d,l),this._httpGet(t,r,"arraybuffer",i,a)}},{key:"_httpGetMultipartApplicationOctetStream",value:function(t,n,o,i,r,s){var l={},d={"1.2.840.10008.1.2.1":a(Object.values(v))},c=n;return n||(c=[{mediaType:"application/octet-stream"}]),o&&(l.Range=e._buildRangeHeaderFieldValue(o)),l.Accept=e._buildMultipartAcceptHeaderFieldValue(c,d),this._httpGet(t,l,"arraybuffer",r,s)}},{key:"_httpPost",value:function(e,t,n,o,i,a){return this._httpRequest(e,"post",t,{data:n,progressCallback:o,withCredentials:i,request:a})}},{key:"_httpPostApplicationJson",value:function(e,t,n,o){var i={"Content-Type":v.DICOM_JSON};return this._httpPost(e,i,t,n,o)}},{key:"searchForStudies",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};f("search for studies");var n=!1,o="".concat(this.qidoURL,"/studies");return"queryParams"in t&&(o+=e._parseQueryParameters(t.queryParams)),"withCredentials"in t&&t.withCredentials&&(n=t.withCredentials),this._httpGetApplicationJson(o,{},!1,n)}},{key:"retrieveStudyMetadata",value:function(e){if(!("studyInstanceUID"in e))throw new Error("Study Instance UID is required for retrieval of study metadata");f("retrieve metadata of study ".concat(e.studyInstanceUID));var t="".concat(this.wadoURL,"/studies/").concat(e.studyInstanceUID,"/metadata"),n=!1;return"withCredentials"in e&&e.withCredentials&&(n=e.withCredentials),this._httpGetApplicationJson(t,{},!1,n)}},{key:"searchForSeries",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.qidoURL;"studyInstanceUID"in t&&(f("search series of study ".concat(t.studyInstanceUID)),n+="/studies/".concat(t.studyInstanceUID)),n+="/series","queryParams"in t&&(n+=e._parseQueryParameters(t.queryParams));var o=!1;return"withCredentials"in t&&t.withCredentials&&(o=t.withCredentials),this._httpGetApplicationJson(n,{},!1,o)}},{key:"retrieveSeriesMetadata",value:function(e){if(!("studyInstanceUID"in e))throw new Error("Study Instance UID is required for retrieval of series metadata");if(!("seriesInstanceUID"in e))throw new Error("Series Instance UID is required for retrieval of series metadata");f("retrieve metadata of series ".concat(e.seriesInstanceUID));var t="".concat(this.wadoURL,"/studies/").concat(e.studyInstanceUID,"/series/").concat(e.seriesInstanceUID,"/metadata"),n=!1;return"withCredentials"in e&&e.withCredentials&&(n=e.withCredentials),this._httpGetApplicationJson(t,{},!1,n)}},{key:"searchForInstances",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.qidoURL,o=!1;return"studyInstanceUID"in t?(n+="/studies/".concat(t.studyInstanceUID),"seriesInstanceUID"in t?(f("search for instances of series ".concat(t.seriesInstanceUID)),n+="/series/".concat(t.seriesInstanceUID)):f("search for instances of study ".concat(t.studyInstanceUID))):f("search for instances"),n+="/instances","queryParams"in t&&(n+=e._parseQueryParameters(t.queryParams)),"withCredentials"in t&&t.withCredentials&&(o=t.withCredentials),this._httpGetApplicationJson(n,{},!1,o)}},{key:"buildInstanceWadoURIUrl",value:function(e){if(!("studyInstanceUID"in e))throw new Error("Study Instance UID is required.");if(!("seriesInstanceUID"in e))throw new Error("Series Instance UID is required.");if(!("sopInstanceUID"in e))throw new Error("SOP Instance UID is required.");var t=e.contentType||v.DICOM,n=e.transferSyntax||"*",o=[];o.push("requestType=WADO"),o.push("studyUID=".concat(e.studyInstanceUID)),o.push("seriesUID=".concat(e.seriesInstanceUID)),o.push("objectUID=".concat(e.sopInstanceUID)),o.push("contentType=".concat(t)),o.push("transferSyntax=".concat(n));var i=o.join("&");return"".concat(this.wadoURL,"?").concat(i)}},{key:"retrieveInstanceMetadata",value:function(e){if(!("studyInstanceUID"in e))throw new Error("Study Instance UID is required for retrieval of instance metadata");if(!("seriesInstanceUID"in e))throw new Error("Series Instance UID is required for retrieval of instance metadata");if(!("sopInstanceUID"in e))throw new Error("SOP Instance UID is required for retrieval of instance metadata");f("retrieve metadata of instance ".concat(e.sopInstanceUID));var t="".concat(this.wadoURL,"/studies/").concat(e.studyInstanceUID,"/series/").concat(e.seriesInstanceUID,"/instances/").concat(e.sopInstanceUID,"/metadata"),n=!1;return"withCredentials"in e&&e.withCredentials&&(n=e.withCredentials),this._httpGetApplicationJson(t,{},!1,n)}},{key:"retrieveInstanceFrames",value:function(t){if(!("studyInstanceUID"in t))throw new Error("Study Instance UID is required for retrieval of instance frames");if(!("seriesInstanceUID"in t))throw new Error("Series Instance UID is required for retrieval of instance frames");if(!("sopInstanceUID"in t))throw new Error("SOP Instance UID is required for retrieval of instance frames");if(!("frameNumbers"in t))throw new Error("frame numbers are required for retrieval of instance frames");f("retrieve frames ".concat(t.frameNumbers.toString()," of instance ").concat(t.sopInstanceUID));var n="".concat(this.wadoURL,"/studies/").concat(t.studyInstanceUID,"/series/").concat(t.seriesInstanceUID,"/instances/").concat(t.sopInstanceUID,"/frames/").concat(t.frameNumbers.toString()),o=t.mediaTypes,i=!1;"withCredentials"in t&&t.withCredentials&&(i=t.withCredentials);var a=!1;if("progressCallback"in t&&(a=t.progressCallback),!o)return this._httpGetMultipartApplicationOctetStream(n,!1,!1,!1,a,i);if(e._getSharedMediaTypes(o).length>1){var r={Accept:e._buildMultipartAcceptHeaderFieldValue(o,{"1.2.840.10008.1.2.1":["application/octet-stream"],"1.2.840.10008.1.2.5":["image/x-dicom-rle"],"1.2.840.10008.1.2.4.50":["image/jpeg"],"1.2.840.10008.1.2.4.51":["image/jpeg"],"1.2.840.10008.1.2.4.57":["image/jpeg"],"1.2.840.10008.1.2.4.70":["image/jpeg"],"1.2.840.10008.1.2.4.80":["image/x-jls","image/jls"],"1.2.840.10008.1.2.4.81":["image/x-jls","image/jls"],"1.2.840.10008.1.2.4.90":["image/jp2"],"1.2.840.10008.1.2.4.91":["image/jp2"],"1.2.840.10008.1.2.4.92":["image/jpx"],"1.2.840.10008.1.2.4.93":["image/jpx"],"1.2.840.10008.1.2.4.201":["image/jhc"],"1.2.840.10008.1.2.4.202":["image/jhc"]})};return this._httpGet(n,r,"arraybuffer",a,i)}var s=e._getCommonMediaType(o);if(s.startsWith("application"))return this._httpGetMultipartApplicationOctetStream(n,o,!1,!1,a,i);if(s.startsWith("image"))return this._httpGetMultipartImage(n,o,!1,!1,!1,a,i);if(s.startsWith("video"))return this._httpGetMultipartVideo(n,o,!1,!1,!1,a,i);throw new Error("Media type ".concat(s," is not supported for retrieval of frames."))}},{key:"retrieveInstanceRendered",value:function(t){if(!("studyInstanceUID"in t))throw new Error("Study Instance UID is required for retrieval of rendered instance");if(!("seriesInstanceUID"in t))throw new Error("Series Instance UID is required for retrieval of rendered instance");if(!("sopInstanceUID"in t))throw new Error("SOP Instance UID is required for retrieval of rendered instance");var n="".concat(this.wadoURL,"/studies/").concat(t.studyInstanceUID,"/series/").concat(t.seriesInstanceUID,"/instances/").concat(t.sopInstanceUID,"/rendered"),o=t.mediaTypes,i=t.queryParams,a=!1;"withCredentials"in t&&t.withCredentials&&(a=t.withCredentials);var r=!1;if("progressCallback"in t&&(r=t.progressCallback),!o)return i&&(n+=e._parseQueryParameters(i)),this._httpGet(n,{},"arraybuffer",r,a);var s=e._getCommonMediaType(o);if(s.startsWith("image"))return this._httpGetImage(n,o,i,r,a);if(s.startsWith("video"))return this._httpGetVideo(n,o,i,r,a);if(s.startsWith("text"))return this._httpGetText(n,o,i,r,a);if(s===v.PDF)return this._httpGetApplicationPdf(n,i,r,a);throw new Error("Media type ".concat(s," is not supported ")+"for retrieval of rendered instance.")}},{key:"retrieveInstanceThumbnail",value:function(t){if(!("studyInstanceUID"in t))throw new Error("Study Instance UID is required for retrieval of rendered instance");if(!("seriesInstanceUID"in t))throw new Error("Series Instance UID is required for retrieval of rendered instance");if(!("sopInstanceUID"in t))throw new Error("SOP Instance UID is required for retrieval of rendered instance");var n="".concat(this.wadoURL,"/studies/").concat(t.studyInstanceUID,"/series/").concat(t.seriesInstanceUID,"/instances/").concat(t.sopInstanceUID,"/thumbnail"),o=t.mediaTypes,i=t.queryParams,a=!1;"withCredentials"in t&&t.withCredentials&&(a=t.withCredentials);var r=!1;if("progressCallback"in t&&(r=t.progressCallback),!o)return i&&(n+=e._parseQueryParameters(i)),this._httpGet(n,{},"arraybuffer",r,a);var s=e._getCommonMediaType(o);if(s.startsWith("image"))return this._httpGetImage(n,o,i,r,a);throw new Error("Media type ".concat(s," is not supported ")+"for retrieval of rendered instance.")}},{key:"retrieveInstanceFramesRendered",value:function(t){if(!("studyInstanceUID"in t))throw new Error("Study Instance UID is required for retrieval of rendered instance frames");if(!("seriesInstanceUID"in t))throw new Error("Series Instance UID is required for retrieval of rendered instance frames");if(!("sopInstanceUID"in t))throw new Error("SOP Instance UID is required for retrieval of rendered instance frames");if(!("frameNumbers"in t))throw new Error("frame numbers are required for retrieval of rendered instance frames");f("retrieve rendered frames ".concat(t.frameNumbers.toString()," of instance ").concat(t.sopInstanceUID));var n="".concat(this.wadoURL,"/studies/").concat(t.studyInstanceUID,"/series/").concat(t.seriesInstanceUID,"/instances/").concat(t.sopInstanceUID,"/frames/").concat(t.frameNumbers.toString(),"/rendered"),o=t.mediaTypes,i=t.queryParams,a=!1;"withCredentials"in t&&t.withCredentials&&(a=t.withCredentials);var r=!1;if("progressCallback"in t&&(r=t.progressCallback),!o)return i&&(n+=e._parseQueryParameters(i)),this._httpGet(n,{},"arraybuffer",!1,a);var s=e._getCommonMediaType(o);if(s.startsWith("image"))return this._httpGetImage(n,o,i,r,a);if(s.startsWith("video"))return this._httpGetVideo(n,o,i,r,a);throw new Error("Media type ".concat(s," is not supported ")+"for retrieval of rendered frame.")}},{key:"retrieveInstanceFramesThumbnail",value:function(t){if(!("studyInstanceUID"in t))throw new Error("Study Instance UID is required for retrieval of rendered instance frames");if(!("seriesInstanceUID"in t))throw new Error("Series Instance UID is required for retrieval of rendered instance frames");if(!("sopInstanceUID"in t))throw new Error("SOP Instance UID is required for retrieval of rendered instance frames");if(!("frameNumbers"in t))throw new Error("frame numbers are required for retrieval of rendered instance frames");console.debug("retrieve rendered frames ".concat(t.frameNumbers.toString()," of instance ").concat(t.sopInstanceUID));var n="".concat(this.wadoURL,"/studies/").concat(t.studyInstanceUID,"/series/").concat(t.seriesInstanceUID,"/instances/").concat(t.sopInstanceUID,"/frames/").concat(t.frameNumbers.toString(),"/thumbnail"),o=t.mediaTypes,i=t.queryParams,a=!1;"withCredentials"in t&&t.withCredentials&&(a=t.withCredentials);var r=!1;if("progressCallback"in t&&(r=t.progressCallback),!o)return i&&(n+=e._parseQueryParameters(i)),this._httpGet(n,{},"arraybuffer",r,a);var s=e._getCommonMediaType(o);if(s.startsWith("image"))return this._httpGetImage(n,o,i,r,a);throw new Error("Media type ".concat(s," is not supported ")+"for retrieval of rendered frame.")}},{key:"retrieveInstance",value:function(t){if(!("studyInstanceUID"in t))throw new Error("Study Instance UID is required");if(!("seriesInstanceUID"in t))throw new Error("Series Instance UID is required");if(!("sopInstanceUID"in t))throw new Error("SOP Instance UID is required");var n="".concat(this.wadoURL,"/studies/").concat(t.studyInstanceUID,"/series/").concat(t.seriesInstanceUID,"/instances/").concat(t.sopInstanceUID),o=t.mediaTypes,i=t.withCredentials,a=void 0!==i&&i,r=t.progressCallback,s=void 0!==r&&r;if(!o)return this._httpGetMultipartApplicationDicom(n,!1,!1,s,a).then(p);var l=e._getCommonMediaType(o);if(l===v.DICOM)return this._httpGetMultipartApplicationDicom(n,o,!1,s,a).then(p);throw new Error("Media type ".concat(l," is not supported for retrieval of instance."))}},{key:"retrieveSeries",value:function(t){if(!("studyInstanceUID"in t))throw new Error("Study Instance UID is required");if(!("seriesInstanceUID"in t))throw new Error("Series Instance UID is required");var n="".concat(this.wadoURL,"/studies/").concat(t.studyInstanceUID,"/series/").concat(t.seriesInstanceUID),o=t.mediaTypes,i=!1;"withCredentials"in t&&t.withCredentials&&(i=t.withCredentials);var a=!1;if("progressCallback"in t&&(a=t.progressCallback),!o)return this._httpGetMultipartApplicationDicom(n,!1,!1,a,i);var r=e._getCommonMediaType(o);if(r===v.DICOM)return this._httpGetMultipartApplicationDicom(n,o,!1,a,i);throw new Error("Media type ".concat(r," is not supported for retrieval of series."))}},{key:"retrieveStudy",value:function(t){if(!("studyInstanceUID"in t))throw new Error("Study Instance UID is required");var n="".concat(this.wadoURL,"/studies/").concat(t.studyInstanceUID),o=t.mediaTypes,i=t.withCredentials,a=void 0!==i&&i,r=t.progressCallback,s=void 0!==r&&r;if(!o)return this._httpGetMultipartApplicationDicom(n,!1,!1,s,a);var l=e._getCommonMediaType(o);if(l===v.DICOM)return this._httpGetMultipartApplicationDicom(n,o,!1,s,a);throw new Error("Media type ".concat(l," is not supported for retrieval of study."))}},{key:"retrieveBulkData",value:function(t){if(!("BulkDataURI"in t))throw new Error("BulkDataURI is required.");var n=t.BulkDataURI,o=t.mediaTypes,i=t.byteRange,a=t.withCredentials,r=void 0!==a&&a,s=t.progressCallback,l=void 0!==s&&s;if(-1!==this.singlepart.indexOf("bulkdata"))return this._httpGet(n,t.headers,"arraybuffer",null,r);if(o)try{if("image/"===e._getCommonMediaType(o))return this._httpGetMultipartImage(n,o,i,!1,!1,l,r)}catch(e){}return this._httpGetMultipartApplicationOctetStream(n,o,i,!1,l,r)}},{key:"storeInstances",value:function(e){if(!("datasets"in e))throw new Error("datasets are required for storing");var t="".concat(this.stowURL,"/studies");"studyInstanceUID"in e&&(t+="/".concat(e.studyInstanceUID));var n=c(e.datasets),o=n.data,i=n.boundary,a={"Content-Type":'multipart/related; type="application/dicom"; boundary="'.concat(i,'"')},r=e.withCredentials,s=void 0!==r&&r;return this._httpPost(t,a,o,e.progressCallback,s,e.request)}}],r=[{key:"_parseQueryParameters",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t="?";return Object.keys(e).forEach((function(n,o){0!==o&&(t+="&"),t+="".concat(n,"=").concat(encodeURIComponent(e[n]))})),t}},{key:"_assertMediaTypeIsValid",value:function(e){if(!e)throw new Error("Not a valid media type: ".concat(e));var t=e.indexOf("/");if(-1===t)throw new Error("Not a valid media type: ".concat(e));var n=e.slice(0,t);if(!["application","image","text","video"].includes(n))throw new Error("Not a valid media type: ".concat(e));if(e.slice(t+1).includes("/"))throw new Error("Not a valid media type: ".concat(e))}},{key:"_parseMediaType",value:function(t){return e._assertMediaTypeIsValid(t),t.split("/")}},{key:"_buildAcceptHeaderFieldValue",value:function(t,n){if(!Array.isArray(t))throw new Error("Acceptable media types must be provided as an Array");return t.map((function(t){var o=t.mediaType;if(e._assertMediaTypeIsValid(o),!n.includes(o))throw new Error("Media type ".concat(o," is not supported for requested resource"));return o})).join(", ")}},{key:"_buildMultipartAcceptHeaderFieldValue",value:function(t,n){var o=this;if(!Array.isArray(t))throw new Error("Acceptable media types must be provided as an Array");if(!Array.isArray(n)&&!u(n))throw new Error("Supported media types must be provided as an Array or an Object");var i=[];if(t.forEach((function(t){var a=t.transferSyntaxUID,r=t.mediaType;e._assertMediaTypeIsValid(r);var s='multipart/related; type="'.concat(r,'"');if(u(n)){if(!(Object.values(n).flat(1).includes(r)||r.endsWith("/*")&&r.endsWith("/")))return void f("Media type ".concat(r," is not supported for requested resource"));if(a){if("*"!==a){if(!Object.keys(n).includes(a))throw new Error("Transfer syntax ".concat(a," is not supported for requested resource"));var l=n[a];if(!l.includes(r)){var d=e._parseMediaType(r)[0];l.map((function(t){var n=e._parseMediaType(t)[0];if(d!==n||!r.endsWith("/*")&&!r.endsWith("/"))throw new Error("Transfer syntax ".concat(a," is not supported for requested resource"))}))}}s+="; transfer-syntax=".concat(a)}}else if(Array.isArray(n)&&!n.includes(r))return void(o.verbose&&console.warn("Media type ".concat(r," is not supported for requested resource")));i.push(s)})),!i.length)throw new Error("No acceptable media types found among ".concat(JSON.stringify(t)));return i.join(", ")}},{key:"_buildRangeHeaderFieldValue",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return 1===e.length?"bytes=".concat(e[0],"-"):2===e.length?"bytes=".concat(e[0],"-").concat(e[1]):"bytes=0-"}},{key:"_getSharedMediaTypes",value:function(t){var n=new Set;return t&&t.length?(t.forEach((function(t){var o=t.mediaType,i=e._parseMediaType(o)[0];n.add("".concat(i,"/"))})),Array.from(n)):n}},{key:"_getCommonMediaType",value:function(t){if(!t||!t.length)throw new Error("No acceptable media types provided");var n=e._getSharedMediaTypes(t);if(0===n.length)throw new Error("No common acceptable media type could be identified.");if(n.length>1)throw new Error("Acceptable media types must have the same type.");return n[0]}}],n&&i(t.prototype,n),r&&i(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}()}},93008:(e,t,n)=>{var o="__lodash_hash_undefined__",i=1/0,a="[object Function]",r="[object GeneratorFunction]",s="[object Symbol]",l=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,d=/^\w*$/,c=/^\./,h=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,u=/\\(\\)?/g,g=/^\[object .+?Constructor\]$/,p="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,v="object"==typeof self&&self&&self.Object===Object&&self,f=p||v||Function("return this")();var m,w=Array.prototype,E=Function.prototype,b=Object.prototype,y=f["__core-js_shared__"],I=(m=/[^.]+$/.exec(y&&y.keys&&y.keys.IE_PROTO||""))?"Symbol(src)_1."+m:"",_=E.toString,C=b.hasOwnProperty,T=b.toString,S=RegExp("^"+_.call(C).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),x=f.Symbol,D=w.splice,A=H(f,"Map"),O=H(Object,"create"),M=x?x.prototype:void 0,R=M?M.toString:void 0;function k(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}function L(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}function P(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}function N(e,t){for(var n,o,i=e.length;i--;)if((n=e[i][0])===(o=t)||n!=n&&o!=o)return i;return-1}function U(e,t){var n;t=function(e,t){if(G(e))return!1;var n=typeof e;if("number"==n||"symbol"==n||"boolean"==n||null==e||z(e))return!0;return d.test(e)||!l.test(e)||null!=t&&e in Object(t)}(t,e)?[t]:G(n=t)?n:W(n);for(var o=0,i=t.length;null!=e&&o<i;)e=e[F(t[o++])];return o&&o==i?e:void 0}function V(e){if(!$(e)||(t=e,I&&I in t))return!1;var t,n=function(e){var t=$(e)?T.call(e):"";return t==a||t==r}(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}(e)?S:g;return n.test(function(e){if(null!=e){try{return _.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(e))}function B(e,t){var n,o,i=e.__data__;return("string"==(o=typeof(n=t))||"number"==o||"symbol"==o||"boolean"==o?"__proto__"!==n:null===n)?i["string"==typeof t?"string":"hash"]:i.map}function H(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return V(n)?n:void 0}k.prototype.clear=function(){this.__data__=O?O(null):{}},k.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},k.prototype.get=function(e){var t=this.__data__;if(O){var n=t[e];return n===o?void 0:n}return C.call(t,e)?t[e]:void 0},k.prototype.has=function(e){var t=this.__data__;return O?void 0!==t[e]:C.call(t,e)},k.prototype.set=function(e,t){return this.__data__[e]=O&&void 0===t?o:t,this},L.prototype.clear=function(){this.__data__=[]},L.prototype.delete=function(e){var t=this.__data__,n=N(t,e);return!(n<0)&&(n==t.length-1?t.pop():D.call(t,n,1),!0)},L.prototype.get=function(e){var t=this.__data__,n=N(t,e);return n<0?void 0:t[n][1]},L.prototype.has=function(e){return N(this.__data__,e)>-1},L.prototype.set=function(e,t){var n=this.__data__,o=N(n,e);return o<0?n.push([e,t]):n[o][1]=t,this},P.prototype.clear=function(){this.__data__={hash:new k,map:new(A||L),string:new k}},P.prototype.delete=function(e){return B(this,e).delete(e)},P.prototype.get=function(e){return B(this,e).get(e)},P.prototype.has=function(e){return B(this,e).has(e)},P.prototype.set=function(e,t){return B(this,e).set(e,t),this};var W=j((function(e){var t;e=null==(t=e)?"":function(e){if("string"==typeof e)return e;if(z(e))return R?R.call(e):"";var t=e+"";return"0"==t&&1/e==-i?"-0":t}(t);var n=[];return c.test(e)&&n.push(""),e.replace(h,(function(e,t,o,i){n.push(o?i.replace(u,"$1"):t||e)})),n}));function F(e){if("string"==typeof e||z(e))return e;var t=e+"";return"0"==t&&1/e==-i?"-0":t}function j(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var o=arguments,i=t?t.apply(this,o):o[0],a=n.cache;if(a.has(i))return a.get(i);var r=e.apply(this,o);return n.cache=a.set(i,r),r};return n.cache=new(j.Cache||P),n}j.Cache=P;var G=Array.isArray;function $(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function z(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&T.call(e)==s}e.exports=function(e,t,n){var o=null==e?void 0:U(e,t);return void 0===o?n:o}},75178:(e,t,n)=>{var o=n(33188)(n(37183),"DataView");e.exports=o},13615:(e,t,n)=>{var o=n(48342),i=n(9184),a=n(7747),r=n(74287),s=n(80007);function l(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}l.prototype.clear=o,l.prototype.delete=i,l.prototype.get=a,l.prototype.has=r,l.prototype.set=s,e.exports=l},60789:(e,t,n)=>{var o=n(57752),i=n(718),a=n(57849),r=n(43957),s=n(50845);function l(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}l.prototype.clear=o,l.prototype.delete=i,l.prototype.get=a,l.prototype.has=r,l.prototype.set=s,e.exports=l},48561:(e,t,n)=>{var o=n(33188)(n(37183),"Map");e.exports=o},91451:(e,t,n)=>{var o=n(35674),i=n(11036),a=n(90031),r=n(21907),s=n(60971);function l(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}l.prototype.clear=o,l.prototype.delete=i,l.prototype.get=a,l.prototype.has=r,l.prototype.set=s,e.exports=l},1490:(e,t,n)=>{var o=n(33188)(n(37183),"Promise");e.exports=o},96775:(e,t,n)=>{var o=n(33188)(n(37183),"Set");e.exports=o},48869:(e,t,n)=>{var o=n(91451),i=n(86810),a=n(75813);function r(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new o;++t<n;)this.add(e[t])}r.prototype.add=r.prototype.push=i,r.prototype.has=a,e.exports=r},92823:(e,t,n)=>{var o=n(60789),i=n(88926),a=n(22680),r=n(73851),s=n(98423),l=n(3967);function d(e){var t=this.__data__=new o(e);this.size=t.size}d.prototype.clear=i,d.prototype.delete=a,d.prototype.get=r,d.prototype.has=s,d.prototype.set=l,e.exports=d},16846:(e,t,n)=>{var o=n(37183).Uint8Array;e.exports=o},88985:(e,t,n)=>{var o=n(33188)(n(37183),"WeakMap");e.exports=o},20607:e=>{e.exports=function(e,t){for(var n=-1,o=null==e?0:e.length;++n<o&&!1!==t(e[n],n,e););return e}},40836:e=>{e.exports=function(e,t){for(var n=-1,o=null==e?0:e.length,i=0,a=[];++n<o;){var r=e[n];t(r,n,e)&&(a[i++]=r)}return a}},70661:(e,t,n)=>{var o=n(40142),i=n(95962),a=n(64383),r=n(78098),s=n(84683),l=n(63905),d=Object.prototype.hasOwnProperty;e.exports=function(e,t){var n=a(e),c=!n&&i(e),h=!n&&!c&&r(e),u=!n&&!c&&!h&&l(e),g=n||c||h||u,p=g?o(e.length,String):[],v=p.length;for(var f in e)!t&&!d.call(e,f)||g&&("length"==f||h&&("offset"==f||"parent"==f)||u&&("buffer"==f||"byteLength"==f||"byteOffset"==f)||s(f,v))||p.push(f);return p}},26138:e=>{e.exports=function(e,t){for(var n=-1,o=null==e?0:e.length,i=Array(o);++n<o;)i[n]=t(e[n],n,e);return i}},65862:e=>{e.exports=function(e,t){for(var n=-1,o=t.length,i=e.length;++n<o;)e[i+n]=t[n];return e}},87938:e=>{e.exports=function(e,t){for(var n=-1,o=null==e?0:e.length;++n<o;)if(t(e[n],n,e))return!0;return!1}},72177:(e,t,n)=>{var o=n(9142),i=n(29830),a=Object.prototype.hasOwnProperty;e.exports=function(e,t,n){var r=e[t];a.call(e,t)&&i(r,n)&&(void 0!==n||t in e)||o(e,t,n)}},40435:(e,t,n)=>{var o=n(29830);e.exports=function(e,t){for(var n=e.length;n--;)if(o(e[n][0],t))return n;return-1}},90267:(e,t,n)=>{var o=n(26837),i=n(38420);e.exports=function(e,t){return e&&o(t,i(t),e)}},55240:(e,t,n)=>{var o=n(26837),i=n(53435);e.exports=function(e,t){return e&&o(t,i(t),e)}},9142:(e,t,n)=>{var o=n(83733);e.exports=function(e,t,n){"__proto__"==t&&o?o(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}},69557:(e,t,n)=>{var o=n(92823),i=n(20607),a=n(72177),r=n(90267),s=n(55240),l=n(6064),d=n(28601),c=n(2881),h=n(26186),u=n(53300),g=n(44667),p=n(58355),v=n(86203),f=n(57981),m=n(50235),w=n(64383),E=n(78098),b=n(4024),y=n(46015),I=n(88802),_=n(38420),C=n(53435),T="[object Arguments]",S="[object Function]",x="[object Object]",D={};D[T]=D["[object Array]"]=D["[object ArrayBuffer]"]=D["[object DataView]"]=D["[object Boolean]"]=D["[object Date]"]=D["[object Float32Array]"]=D["[object Float64Array]"]=D["[object Int8Array]"]=D["[object Int16Array]"]=D["[object Int32Array]"]=D["[object Map]"]=D["[object Number]"]=D[x]=D["[object RegExp]"]=D["[object Set]"]=D["[object String]"]=D["[object Symbol]"]=D["[object Uint8Array]"]=D["[object Uint8ClampedArray]"]=D["[object Uint16Array]"]=D["[object Uint32Array]"]=!0,D["[object Error]"]=D[S]=D["[object WeakMap]"]=!1,e.exports=function e(t,n,A,O,M,R){var k,L=1&n,P=2&n,N=4&n;if(A&&(k=M?A(t,O,M,R):A(t)),void 0!==k)return k;if(!y(t))return t;var U=w(t);if(U){if(k=v(t),!L)return d(t,k)}else{var V=p(t),B=V==S||"[object GeneratorFunction]"==V;if(E(t))return l(t,L);if(V==x||V==T||B&&!M){if(k=P||B?{}:m(t),!L)return P?h(t,s(k,t)):c(t,r(k,t))}else{if(!D[V])return M?t:{};k=f(t,V,L)}}R||(R=new o);var H=R.get(t);if(H)return H;R.set(t,k),I(t)?t.forEach((function(o){k.add(e(o,n,A,o,t,R))})):b(t)&&t.forEach((function(o,i){k.set(i,e(o,n,A,i,t,R))}));var W=U?void 0:(N?P?g:u:P?C:_)(t);return i(W||t,(function(o,i){W&&(o=t[i=o]),a(k,i,e(o,n,A,i,t,R))})),k}},61534:(e,t,n)=>{var o=n(46015),i=Object.create,a=function(){function e(){}return function(t){if(!o(t))return{};if(i)return i(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();e.exports=a},14183:(e,t,n)=>{var o=n(76895),i=n(19835)(o);e.exports=i},61311:(e,t,n)=>{var o=n(37747)();e.exports=o},76895:(e,t,n)=>{var o=n(61311),i=n(38420);e.exports=function(e,t){return e&&o(e,t,i)}},92748:(e,t,n)=>{var o=n(84679),i=n(54671);e.exports=function(e,t){for(var n=0,a=(t=o(t,e)).length;null!=e&&n<a;)e=e[i(t[n++])];return n&&n==a?e:void 0}},59169:(e,t,n)=>{var o=n(65862),i=n(64383);e.exports=function(e,t,n){var a=t(e);return i(e)?a:o(a,n(e))}},71607:e=>{e.exports=function(e,t){return null!=e&&t in Object(e)}},23871:(e,t,n)=>{var o=n(16990),i=n(46184);e.exports=function(e){return i(e)&&"[object Arguments]"==o(e)}},93028:(e,t,n)=>{var o=n(87114),i=n(46184);e.exports=function e(t,n,a,r,s){return t===n||(null==t||null==n||!i(t)&&!i(n)?t!=t&&n!=n:o(t,n,a,r,e,s))}},87114:(e,t,n)=>{var o=n(92823),i=n(55237),a=n(53728),r=n(45355),s=n(58355),l=n(64383),d=n(78098),c=n(63905),h="[object Arguments]",u="[object Array]",g="[object Object]",p=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,v,f,m){var w=l(e),E=l(t),b=w?u:s(e),y=E?u:s(t),I=(b=b==h?g:b)==g,_=(y=y==h?g:y)==g,C=b==y;if(C&&d(e)){if(!d(t))return!1;w=!0,I=!1}if(C&&!I)return m||(m=new o),w||c(e)?i(e,t,n,v,f,m):a(e,t,b,n,v,f,m);if(!(1&n)){var T=I&&p.call(e,"__wrapped__"),S=_&&p.call(t,"__wrapped__");if(T||S){var x=T?e.value():e,D=S?t.value():t;return m||(m=new o),f(x,D,n,v,m)}}return!!C&&(m||(m=new o),r(e,t,n,v,f,m))}},10162:(e,t,n)=>{var o=n(58355),i=n(46184);e.exports=function(e){return i(e)&&"[object Map]"==o(e)}},49121:(e,t,n)=>{var o=n(92823),i=n(93028);e.exports=function(e,t,n,a){var r=n.length,s=r,l=!a;if(null==e)return!s;for(e=Object(e);r--;){var d=n[r];if(l&&d[2]?d[1]!==e[d[0]]:!(d[0]in e))return!1}for(;++r<s;){var c=(d=n[r])[0],h=e[c],u=d[1];if(l&&d[2]){if(void 0===h&&!(c in e))return!1}else{var g=new o;if(a)var p=a(h,u,c,e,t,g);if(!(void 0===p?i(u,h,3,a,g):p))return!1}}return!0}},73829:(e,t,n)=>{var o=n(94360),i=n(67234),a=n(46015),r=n(70275),s=/^\[object .+?Constructor\]$/,l=Function.prototype,d=Object.prototype,c=l.toString,h=d.hasOwnProperty,u=RegExp("^"+c.call(h).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!a(e)||i(e))&&(o(e)?u:s).test(r(e))}},18344:(e,t,n)=>{var o=n(58355),i=n(46184);e.exports=function(e){return i(e)&&"[object Set]"==o(e)}},84271:(e,t,n)=>{var o=n(16990),i=n(31784),a=n(46184),r={};r["[object Float32Array]"]=r["[object Float64Array]"]=r["[object Int8Array]"]=r["[object Int16Array]"]=r["[object Int32Array]"]=r["[object Uint8Array]"]=r["[object Uint8ClampedArray]"]=r["[object Uint16Array]"]=r["[object Uint32Array]"]=!0,r["[object Arguments]"]=r["[object Array]"]=r["[object ArrayBuffer]"]=r["[object Boolean]"]=r["[object DataView]"]=r["[object Date]"]=r["[object Error]"]=r["[object Function]"]=r["[object Map]"]=r["[object Number]"]=r["[object Object]"]=r["[object RegExp]"]=r["[object Set]"]=r["[object String]"]=r["[object WeakMap]"]=!1,e.exports=function(e){return a(e)&&i(e.length)&&!!r[o(e)]}},94207:(e,t,n)=>{var o=n(12801),i=n(72208),a=n(69090),r=n(64383),s=n(46062);e.exports=function(e){return"function"==typeof e?e:null==e?a:"object"==typeof e?r(e)?i(e[0],e[1]):o(e):s(e)}},29966:(e,t,n)=>{var o=n(88089),i=n(6128),a=Object.prototype.hasOwnProperty;e.exports=function(e){if(!o(e))return i(e);var t=[];for(var n in Object(e))a.call(e,n)&&"constructor"!=n&&t.push(n);return t}},7641:(e,t,n)=>{var o=n(46015),i=n(88089),a=n(65567),r=Object.prototype.hasOwnProperty;e.exports=function(e){if(!o(e))return a(e);var t=i(e),n=[];for(var s in e)("constructor"!=s||!t&&r.call(e,s))&&n.push(s);return n}},35218:(e,t,n)=>{var o=n(14183),i=n(19592);e.exports=function(e,t){var n=-1,a=i(e)?Array(e.length):[];return o(e,(function(e,o,i){a[++n]=t(e,o,i)})),a}},12801:(e,t,n)=>{var o=n(49121),i=n(59406),a=n(76459);e.exports=function(e){var t=i(e);return 1==t.length&&t[0][2]?a(t[0][0],t[0][1]):function(n){return n===e||o(n,e,t)}}},72208:(e,t,n)=>{var o=n(93028),i=n(29650),a=n(2993),r=n(39668),s=n(48938),l=n(76459),d=n(54671);e.exports=function(e,t){return r(e)&&s(t)?l(d(e),t):function(n){var r=i(n,e);return void 0===r&&r===t?a(n,e):o(t,r,3)}}},55351:e=>{e.exports=function(e){return function(t){return null==t?void 0:t[e]}}},54953:(e,t,n)=>{var o=n(92748);e.exports=function(e){return function(t){return o(t,e)}}},40142:e=>{e.exports=function(e,t){for(var n=-1,o=Array(e);++n<e;)o[n]=t(n);return o}},84742:(e,t,n)=>{var o=n(7187),i=n(26138),a=n(64383),r=n(63536),s=o?o.prototype:void 0,l=s?s.toString:void 0;e.exports=function e(t){if("string"==typeof t)return t;if(a(t))return i(t,e)+"";if(r(t))return l?l.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n}},26143:e=>{e.exports=function(e){return function(t){return e(t)}}},37773:e=>{e.exports=function(e,t){return e.has(t)}},54420:(e,t,n)=>{var o=n(69090);e.exports=function(e){return"function"==typeof e?e:o}},84679:(e,t,n)=>{var o=n(64383),i=n(39668),a=n(30412),r=n(12832);e.exports=function(e,t){return o(e)?e:i(e,t)?[e]:a(r(e))}},73911:(e,t,n)=>{var o=n(16846);e.exports=function(e){var t=new e.constructor(e.byteLength);return new o(t).set(new o(e)),t}},6064:(e,t,n)=>{e=n.nmd(e);var o=n(37183),i=t&&!t.nodeType&&t,a=i&&e&&!e.nodeType&&e,r=a&&a.exports===i?o.Buffer:void 0,s=r?r.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var n=e.length,o=s?s(n):new e.constructor(n);return e.copy(o),o}},63887:(e,t,n)=>{var o=n(73911);e.exports=function(e,t){var n=t?o(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}},31871:e=>{var t=/\w*$/;e.exports=function(e){var n=new e.constructor(e.source,t.exec(e));return n.lastIndex=e.lastIndex,n}},45938:(e,t,n)=>{var o=n(7187),i=o?o.prototype:void 0,a=i?i.valueOf:void 0;e.exports=function(e){return a?Object(a.call(e)):{}}},11671:(e,t,n)=>{var o=n(73911);e.exports=function(e,t){var n=t?o(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}},28601:e=>{e.exports=function(e,t){var n=-1,o=e.length;for(t||(t=Array(o));++n<o;)t[n]=e[n];return t}},26837:(e,t,n)=>{var o=n(72177),i=n(9142);e.exports=function(e,t,n,a){var r=!n;n||(n={});for(var s=-1,l=t.length;++s<l;){var d=t[s],c=a?a(n[d],e[d],d,n,e):void 0;void 0===c&&(c=e[d]),r?i(n,d,c):o(n,d,c)}return n}},2881:(e,t,n)=>{var o=n(26837),i=n(19946);e.exports=function(e,t){return o(e,i(e),t)}},26186:(e,t,n)=>{var o=n(26837),i=n(51693);e.exports=function(e,t){return o(e,i(e),t)}},85171:(e,t,n)=>{var o=n(37183)["__core-js_shared__"];e.exports=o},19835:(e,t,n)=>{var o=n(19592);e.exports=function(e,t){return function(n,i){if(null==n)return n;if(!o(n))return e(n,i);for(var a=n.length,r=t?a:-1,s=Object(n);(t?r--:++r<a)&&!1!==i(s[r],r,s););return n}}},37747:e=>{e.exports=function(e){return function(t,n,o){for(var i=-1,a=Object(t),r=o(t),s=r.length;s--;){var l=r[e?s:++i];if(!1===n(a[l],l,a))break}return t}}},83733:(e,t,n)=>{var o=n(33188),i=function(){try{var e=o(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=i},55237:(e,t,n)=>{var o=n(48869),i=n(87938),a=n(37773);e.exports=function(e,t,n,r,s,l){var d=1&n,c=e.length,h=t.length;if(c!=h&&!(d&&h>c))return!1;var u=l.get(e),g=l.get(t);if(u&&g)return u==t&&g==e;var p=-1,v=!0,f=2&n?new o:void 0;for(l.set(e,t),l.set(t,e);++p<c;){var m=e[p],w=t[p];if(r)var E=d?r(w,m,p,t,e,l):r(m,w,p,e,t,l);if(void 0!==E){if(E)continue;v=!1;break}if(f){if(!i(t,(function(e,t){if(!a(f,t)&&(m===e||s(m,e,n,r,l)))return f.push(t)}))){v=!1;break}}else if(m!==w&&!s(m,w,n,r,l)){v=!1;break}}return l.delete(e),l.delete(t),v}},53728:(e,t,n)=>{var o=n(7187),i=n(16846),a=n(29830),r=n(55237),s=n(58887),l=n(28629),d=o?o.prototype:void 0,c=d?d.valueOf:void 0;e.exports=function(e,t,n,o,d,h,u){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!h(new i(e),new i(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return a(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var g=s;case"[object Set]":var p=1&o;if(g||(g=l),e.size!=t.size&&!p)return!1;var v=u.get(e);if(v)return v==t;o|=2,u.set(e,t);var f=r(g(e),g(t),o,d,h,u);return u.delete(e),f;case"[object Symbol]":if(c)return c.call(e)==c.call(t)}return!1}},45355:(e,t,n)=>{var o=n(53300),i=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,a,r,s){var l=1&n,d=o(e),c=d.length;if(c!=o(t).length&&!l)return!1;for(var h=c;h--;){var u=d[h];if(!(l?u in t:i.call(t,u)))return!1}var g=s.get(e),p=s.get(t);if(g&&p)return g==t&&p==e;var v=!0;s.set(e,t),s.set(t,e);for(var f=l;++h<c;){var m=e[u=d[h]],w=t[u];if(a)var E=l?a(w,m,u,t,e,s):a(m,w,u,e,t,s);if(!(void 0===E?m===w||r(m,w,n,a,s):E)){v=!1;break}f||(f="constructor"==u)}if(v&&!f){var b=e.constructor,y=t.constructor;b==y||!("constructor"in e)||!("constructor"in t)||"function"==typeof b&&b instanceof b&&"function"==typeof y&&y instanceof y||(v=!1)}return s.delete(e),s.delete(t),v}},53300:(e,t,n)=>{var o=n(59169),i=n(19946),a=n(38420);e.exports=function(e){return o(e,a,i)}},44667:(e,t,n)=>{var o=n(59169),i=n(51693),a=n(53435);e.exports=function(e){return o(e,a,i)}},18037:(e,t,n)=>{var o=n(65912);e.exports=function(e,t){var n=e.__data__;return o(t)?n["string"==typeof t?"string":"hash"]:n.map}},59406:(e,t,n)=>{var o=n(48938),i=n(38420);e.exports=function(e){for(var t=i(e),n=t.length;n--;){var a=t[n],r=e[a];t[n]=[a,r,o(r)]}return t}},33188:(e,t,n)=>{var o=n(73829),i=n(91870);e.exports=function(e,t){var n=i(e,t);return o(n)?n:void 0}},79637:(e,t,n)=>{var o=n(61429)(Object.getPrototypeOf,Object);e.exports=o},19946:(e,t,n)=>{var o=n(40836),i=n(16499),a=Object.prototype.propertyIsEnumerable,r=Object.getOwnPropertySymbols,s=r?function(e){return null==e?[]:(e=Object(e),o(r(e),(function(t){return a.call(e,t)})))}:i;e.exports=s},51693:(e,t,n)=>{var o=n(65862),i=n(79637),a=n(19946),r=n(16499),s=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)o(t,a(e)),e=i(e);return t}:r;e.exports=s},58355:(e,t,n)=>{var o=n(75178),i=n(48561),a=n(1490),r=n(96775),s=n(88985),l=n(16990),d=n(70275),c="[object Map]",h="[object Promise]",u="[object Set]",g="[object WeakMap]",p="[object DataView]",v=d(o),f=d(i),m=d(a),w=d(r),E=d(s),b=l;(o&&b(new o(new ArrayBuffer(1)))!=p||i&&b(new i)!=c||a&&b(a.resolve())!=h||r&&b(new r)!=u||s&&b(new s)!=g)&&(b=function(e){var t=l(e),n="[object Object]"==t?e.constructor:void 0,o=n?d(n):"";if(o)switch(o){case v:return p;case f:return c;case m:return h;case w:return u;case E:return g}return t}),e.exports=b},91870:e=>{e.exports=function(e,t){return null==e?void 0:e[t]}},53852:(e,t,n)=>{var o=n(84679),i=n(95962),a=n(64383),r=n(84683),s=n(31784),l=n(54671);e.exports=function(e,t,n){for(var d=-1,c=(t=o(t,e)).length,h=!1;++d<c;){var u=l(t[d]);if(!(h=null!=e&&n(e,u)))break;e=e[u]}return h||++d!=c?h:!!(c=null==e?0:e.length)&&s(c)&&r(u,c)&&(a(e)||i(e))}},48342:(e,t,n)=>{var o=n(21960);e.exports=function(){this.__data__=o?o(null):{},this.size=0}},9184:e=>{e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},7747:(e,t,n)=>{var o=n(21960),i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(o){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return i.call(t,e)?t[e]:void 0}},74287:(e,t,n)=>{var o=n(21960),i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return o?void 0!==t[e]:i.call(t,e)}},80007:(e,t,n)=>{var o=n(21960);e.exports=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=o&&void 0===t?"__lodash_hash_undefined__":t,this}},86203:e=>{var t=Object.prototype.hasOwnProperty;e.exports=function(e){var n=e.length,o=new e.constructor(n);return n&&"string"==typeof e[0]&&t.call(e,"index")&&(o.index=e.index,o.input=e.input),o}},57981:(e,t,n)=>{var o=n(73911),i=n(63887),a=n(31871),r=n(45938),s=n(11671);e.exports=function(e,t,n){var l=e.constructor;switch(t){case"[object ArrayBuffer]":return o(e);case"[object Boolean]":case"[object Date]":return new l(+e);case"[object DataView]":return i(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return s(e,n);case"[object Map]":case"[object Set]":return new l;case"[object Number]":case"[object String]":return new l(e);case"[object RegExp]":return a(e);case"[object Symbol]":return r(e)}}},50235:(e,t,n)=>{var o=n(61534),i=n(79637),a=n(88089);e.exports=function(e){return"function"!=typeof e.constructor||a(e)?{}:o(i(e))}},84683:e=>{var t=/^(?:0|[1-9]\d*)$/;e.exports=function(e,n){var o=typeof e;return!!(n=null==n?9007199254740991:n)&&("number"==o||"symbol"!=o&&t.test(e))&&e>-1&&e%1==0&&e<n}},39668:(e,t,n)=>{var o=n(64383),i=n(63536),a=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,r=/^\w*$/;e.exports=function(e,t){if(o(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!i(e))||(r.test(e)||!a.test(e)||null!=t&&e in Object(t))}},65912:e=>{e.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},67234:(e,t,n)=>{var o,i=n(85171),a=(o=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||""))?"Symbol(src)_1."+o:"";e.exports=function(e){return!!a&&a in e}},88089:e=>{var t=Object.prototype;e.exports=function(e){var n=e&&e.constructor;return e===("function"==typeof n&&n.prototype||t)}},48938:(e,t,n)=>{var o=n(46015);e.exports=function(e){return e==e&&!o(e)}},57752:e=>{e.exports=function(){this.__data__=[],this.size=0}},718:(e,t,n)=>{var o=n(40435),i=Array.prototype.splice;e.exports=function(e){var t=this.__data__,n=o(t,e);return!(n<0)&&(n==t.length-1?t.pop():i.call(t,n,1),--this.size,!0)}},57849:(e,t,n)=>{var o=n(40435);e.exports=function(e){var t=this.__data__,n=o(t,e);return n<0?void 0:t[n][1]}},43957:(e,t,n)=>{var o=n(40435);e.exports=function(e){return o(this.__data__,e)>-1}},50845:(e,t,n)=>{var o=n(40435);e.exports=function(e,t){var n=this.__data__,i=o(n,e);return i<0?(++this.size,n.push([e,t])):n[i][1]=t,this}},35674:(e,t,n)=>{var o=n(13615),i=n(60789),a=n(48561);e.exports=function(){this.size=0,this.__data__={hash:new o,map:new(a||i),string:new o}}},11036:(e,t,n)=>{var o=n(18037);e.exports=function(e){var t=o(this,e).delete(e);return this.size-=t?1:0,t}},90031:(e,t,n)=>{var o=n(18037);e.exports=function(e){return o(this,e).get(e)}},21907:(e,t,n)=>{var o=n(18037);e.exports=function(e){return o(this,e).has(e)}},60971:(e,t,n)=>{var o=n(18037);e.exports=function(e,t){var n=o(this,e),i=n.size;return n.set(e,t),this.size+=n.size==i?0:1,this}},58887:e=>{e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,o){n[++t]=[o,e]})),n}},76459:e=>{e.exports=function(e,t){return function(n){return null!=n&&(n[e]===t&&(void 0!==t||e in Object(n)))}}},72110:(e,t,n)=>{var o=n(99098);e.exports=function(e){var t=o(e,(function(e){return 500===n.size&&n.clear(),e})),n=t.cache;return t}},21960:(e,t,n)=>{var o=n(33188)(Object,"create");e.exports=o},6128:(e,t,n)=>{var o=n(61429)(Object.keys,Object);e.exports=o},65567:e=>{e.exports=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}},43271:(e,t,n)=>{e=n.nmd(e);var o=n(75194),i=t&&!t.nodeType&&t,a=i&&e&&!e.nodeType&&e,r=a&&a.exports===i&&o.process,s=function(){try{var e=a&&a.require&&a.require("util").types;return e||r&&r.binding&&r.binding("util")}catch(e){}}();e.exports=s},61429:e=>{e.exports=function(e,t){return function(n){return e(t(n))}}},86810:e=>{e.exports=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this}},75813:e=>{e.exports=function(e){return this.__data__.has(e)}},28629:e=>{e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}},88926:(e,t,n)=>{var o=n(60789);e.exports=function(){this.__data__=new o,this.size=0}},22680:e=>{e.exports=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}},73851:e=>{e.exports=function(e){return this.__data__.get(e)}},98423:e=>{e.exports=function(e){return this.__data__.has(e)}},3967:(e,t,n)=>{var o=n(60789),i=n(48561),a=n(91451);e.exports=function(e,t){var n=this.__data__;if(n instanceof o){var r=n.__data__;if(!i||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new a(r)}return n.set(e,t),this.size=n.size,this}},30412:(e,t,n)=>{var o=n(72110),i=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,a=/\\(\\)?/g,r=o((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(i,(function(e,n,o,i){t.push(o?i.replace(a,"$1"):n||e)})),t}));e.exports=r},54671:(e,t,n)=>{var o=n(63536);e.exports=function(e){if("string"==typeof e||o(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}},70275:e=>{var t=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return t.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},81285:(e,t,n)=>{var o=n(69557);e.exports=function(e){return o(e,5)}},29830:e=>{e.exports=function(e,t){return e===t||e!=e&&t!=t}},59741:(e,t,n)=>{var o=n(76895),i=n(54420);e.exports=function(e,t){return e&&o(e,i(t))}},29650:(e,t,n)=>{var o=n(92748);e.exports=function(e,t,n){var i=null==e?void 0:o(e,t);return void 0===i?n:i}},2993:(e,t,n)=>{var o=n(71607),i=n(53852);e.exports=function(e,t){return null!=e&&i(e,t,o)}},69090:e=>{e.exports=function(e){return e}},95962:(e,t,n)=>{var o=n(23871),i=n(46184),a=Object.prototype,r=a.hasOwnProperty,s=a.propertyIsEnumerable,l=o(function(){return arguments}())?o:function(e){return i(e)&&r.call(e,"callee")&&!s.call(e,"callee")};e.exports=l},64383:e=>{var t=Array.isArray;e.exports=t},19592:(e,t,n)=>{var o=n(94360),i=n(31784);e.exports=function(e){return null!=e&&i(e.length)&&!o(e)}},78098:(e,t,n)=>{e=n.nmd(e);var o=n(37183),i=n(11329),a=t&&!t.nodeType&&t,r=a&&e&&!e.nodeType&&e,s=r&&r.exports===a?o.Buffer:void 0,l=(s?s.isBuffer:void 0)||i;e.exports=l},94360:(e,t,n)=>{var o=n(16990),i=n(46015);e.exports=function(e){if(!i(e))return!1;var t=o(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},31784:e=>{e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},4024:(e,t,n)=>{var o=n(10162),i=n(26143),a=n(43271),r=a&&a.isMap,s=r?i(r):o;e.exports=s},5229:(e,t,n)=>{var o=n(16990),i=n(79637),a=n(46184),r=Function.prototype,s=Object.prototype,l=r.toString,d=s.hasOwnProperty,c=l.call(Object);e.exports=function(e){if(!a(e)||"[object Object]"!=o(e))return!1;var t=i(e);if(null===t)return!0;var n=d.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&l.call(n)==c}},88802:(e,t,n)=>{var o=n(18344),i=n(26143),a=n(43271),r=a&&a.isSet,s=r?i(r):o;e.exports=s},87561:(e,t,n)=>{var o=n(16990),i=n(64383),a=n(46184);e.exports=function(e){return"string"==typeof e||!i(e)&&a(e)&&"[object String]"==o(e)}},63905:(e,t,n)=>{var o=n(84271),i=n(26143),a=n(43271),r=a&&a.isTypedArray,s=r?i(r):o;e.exports=s},38420:(e,t,n)=>{var o=n(70661),i=n(29966),a=n(19592);e.exports=function(e){return a(e)?o(e):i(e)}},53435:(e,t,n)=>{var o=n(70661),i=n(7641),a=n(19592);e.exports=function(e){return a(e)?o(e,!0):i(e)}},764:(e,t,n)=>{var o=n(26138),i=n(94207),a=n(35218),r=n(64383);e.exports=function(e,t){return(r(e)?o:a)(e,i(t,3))}},99098:(e,t,n)=>{var o=n(91451);function i(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var o=arguments,i=t?t.apply(this,o):o[0],a=n.cache;if(a.has(i))return a.get(i);var r=e.apply(this,o);return n.cache=a.set(i,r)||a,r};return n.cache=new(i.Cache||o),n}i.Cache=o,e.exports=i},46062:(e,t,n)=>{var o=n(55351),i=n(54953),a=n(39668),r=n(54671);e.exports=function(e){return a(e)?o(r(e)):i(e)}},16499:e=>{e.exports=function(){return[]}},11329:e=>{e.exports=function(){return!1}},12832:(e,t,n)=>{var o=n(84742);e.exports=function(e){return null==e?"":o(e)}},69175:(e,t,n)=>{"use strict";n.d(t,{xk:()=>Ma});var o=n(86326),i=n(56457),a={},r=function(e,t,n,o){var i=e+"-"+t+"-"+n+(o?"-server":"");if(a[i])return a[i];var r=function(e,t,n,o){if("undefined"==typeof document&&!o)return null;var i=o?new o:document.createElement("canvas");i.width=2*n,i.height=2*n;var a=i.getContext("2d");return a?(a.fillStyle=e,a.fillRect(0,0,i.width,i.height),a.fillStyle=t,a.fillRect(0,0,n,n),a.translate(n,n),a.fillRect(0,0,n,n),i.toDataURL()):null}(e,t,n,o);return a[i]=r,r},s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},l=function(e){var t=e.white,n=e.grey,a=e.size,l=e.renderers,d=e.borderRadius,c=e.boxShadow,h=e.children,u=(0,i.Ay)({default:{grid:{borderRadius:d,boxShadow:c,absolute:"0px 0px 0px 0px",background:"url("+r(t,n,a,l.canvas)+") center left"}}});return(0,o.isValidElement)(h)?o.cloneElement(h,s({},h.props,{style:s({},h.props.style,u.grid)})):o.createElement("div",{style:u.grid})};l.defaultProps={size:8,white:"transparent",grey:"rgba(0,0,0,.08)",renderers:{}};const d=l;var c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},h=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}const g=function(e){function t(){var e,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,a=Array(i),r=0;r<i;r++)a[r]=arguments[r];return n=o=u(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),o.handleChange=function(e){var t=function(e,t,n,o,i){var a=i.clientWidth,r=i.clientHeight,s="number"==typeof e.pageX?e.pageX:e.touches[0].pageX,l="number"==typeof e.pageY?e.pageY:e.touches[0].pageY,d=s-(i.getBoundingClientRect().left+window.pageXOffset),c=l-(i.getBoundingClientRect().top+window.pageYOffset);if("vertical"===n){var h=void 0;if(h=c<0?0:c>r?1:Math.round(100*c/r)/100,t.a!==h)return{h:t.h,s:t.s,l:t.l,a:h,source:"rgb"}}else{var u=void 0;if(o!==(u=d<0?0:d>a?1:Math.round(100*d/a)/100))return{h:t.h,s:t.s,l:t.l,a:u,source:"rgb"}}return null}(e,o.props.hsl,o.props.direction,o.props.a,o.container);t&&"function"==typeof o.props.onChange&&o.props.onChange(t,e)},o.handleMouseDown=function(e){o.handleChange(e),window.addEventListener("mousemove",o.handleChange),window.addEventListener("mouseup",o.handleMouseUp)},o.handleMouseUp=function(){o.unbindEventListeners()},o.unbindEventListeners=function(){window.removeEventListener("mousemove",o.handleChange),window.removeEventListener("mouseup",o.handleMouseUp)},u(o,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),h(t,[{key:"componentWillUnmount",value:function(){this.unbindEventListeners()}},{key:"render",value:function(){var e=this,t=this.props.rgb,n=(0,i.Ay)({default:{alpha:{absolute:"0px 0px 0px 0px",borderRadius:this.props.radius},checkboard:{absolute:"0px 0px 0px 0px",overflow:"hidden",borderRadius:this.props.radius},gradient:{absolute:"0px 0px 0px 0px",background:"linear-gradient(to right, rgba("+t.r+","+t.g+","+t.b+", 0) 0%,\n           rgba("+t.r+","+t.g+","+t.b+", 1) 100%)",boxShadow:this.props.shadow,borderRadius:this.props.radius},container:{position:"relative",height:"100%",margin:"0 3px"},pointer:{position:"absolute",left:100*t.a+"%"},slider:{width:"4px",borderRadius:"1px",height:"8px",boxShadow:"0 0 2px rgba(0, 0, 0, .6)",background:"#fff",marginTop:"1px",transform:"translateX(-2px)"}},vertical:{gradient:{background:"linear-gradient(to bottom, rgba("+t.r+","+t.g+","+t.b+", 0) 0%,\n           rgba("+t.r+","+t.g+","+t.b+", 1) 100%)"},pointer:{left:0,top:100*t.a+"%"}},overwrite:c({},this.props.style)},{vertical:"vertical"===this.props.direction,overwrite:!0});return o.createElement("div",{style:n.alpha},o.createElement("div",{style:n.checkboard},o.createElement(d,{renderers:this.props.renderers})),o.createElement("div",{style:n.gradient}),o.createElement("div",{style:n.container,ref:function(t){return e.container=t},onMouseDown:this.handleMouseDown,onTouchMove:this.handleChange,onTouchStart:this.handleChange},o.createElement("div",{style:n.pointer},this.props.pointer?o.createElement(this.props.pointer,this.props):o.createElement("div",{style:n.slider}))))}}]),t}(o.PureComponent||o.Component);var p=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var v=[38,40],f=1;const m=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.handleBlur=function(){n.state.blurValue&&n.setState({value:n.state.blurValue,blurValue:null})},n.handleChange=function(e){n.setUpdatedValue(e.target.value,e)},n.handleKeyDown=function(e){var t,o=function(e){return Number(String(e).replace(/%/g,""))}(e.target.value);if(!isNaN(o)&&(t=e.keyCode,v.indexOf(t)>-1)){var i=n.getArrowOffset(),a=38===e.keyCode?o+i:o-i;n.setUpdatedValue(a,e)}},n.handleDrag=function(e){if(n.props.dragLabel){var t=Math.round(n.props.value+e.movementX);t>=0&&t<=n.props.dragMax&&n.props.onChange&&n.props.onChange(n.getValueObjectWithLabel(t),e)}},n.handleMouseDown=function(e){n.props.dragLabel&&(e.preventDefault(),n.handleDrag(e),window.addEventListener("mousemove",n.handleDrag),window.addEventListener("mouseup",n.handleMouseUp))},n.handleMouseUp=function(){n.unbindEventListeners()},n.unbindEventListeners=function(){window.removeEventListener("mousemove",n.handleDrag),window.removeEventListener("mouseup",n.handleMouseUp)},n.state={value:String(e.value).toUpperCase(),blurValue:String(e.value).toUpperCase()},n.inputId="rc-editable-input-"+f++,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),p(t,[{key:"componentDidUpdate",value:function(e,t){this.props.value===this.state.value||e.value===this.props.value&&t.value===this.state.value||(this.input===document.activeElement?this.setState({blurValue:String(this.props.value).toUpperCase()}):this.setState({value:String(this.props.value).toUpperCase(),blurValue:!this.state.blurValue&&String(this.props.value).toUpperCase()}))}},{key:"componentWillUnmount",value:function(){this.unbindEventListeners()}},{key:"getValueObjectWithLabel",value:function(e){return function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},this.props.label,e)}},{key:"getArrowOffset",value:function(){return this.props.arrowOffset||1}},{key:"setUpdatedValue",value:function(e,t){var n=this.props.label?this.getValueObjectWithLabel(e):e;this.props.onChange&&this.props.onChange(n,t),this.setState({value:e})}},{key:"render",value:function(){var e=this,t=(0,i.Ay)({default:{wrap:{position:"relative"}},"user-override":{wrap:this.props.style&&this.props.style.wrap?this.props.style.wrap:{},input:this.props.style&&this.props.style.input?this.props.style.input:{},label:this.props.style&&this.props.style.label?this.props.style.label:{}},"dragLabel-true":{label:{cursor:"ew-resize"}}},{"user-override":!0},this.props);return o.createElement("div",{style:t.wrap},o.createElement("input",{id:this.inputId,style:t.input,ref:function(t){return e.input=t},value:this.state.value,onKeyDown:this.handleKeyDown,onChange:this.handleChange,onBlur:this.handleBlur,placeholder:this.props.placeholder,spellCheck:"false"}),this.props.label&&!this.props.hideLabel?o.createElement("label",{htmlFor:this.inputId,style:t.label,onMouseDown:this.handleMouseDown},this.props.label):null)}}]),t}(o.PureComponent||o.Component);var w=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();function E(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}const b=function(e){function t(){var e,n,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,a=Array(i),r=0;r<i;r++)a[r]=arguments[r];return n=o=E(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(a))),o.handleChange=function(e){var t=function(e,t,n,o){var i=o.clientWidth,a=o.clientHeight,r="number"==typeof e.pageX?e.pageX:e.touches[0].pageX,s="number"==typeof e.pageY?e.pageY:e.touches[0].pageY,l=r-(o.getBoundingClientRect().left+window.pageXOffset),d=s-(o.getBoundingClientRect().top+window.pageYOffset);if("vertical"===t){var c=void 0;if(c=d<0?359:d>a?0:360*(-100*d/a+100)/100,n.h!==c)return{h:c,s:n.s,l:n.l,a:n.a,source:"hsl"}}else{var h=void 0;if(h=l<0?0:l>i?359:100*l/i*360/100,n.h!==h)return{h,s:n.s,l:n.l,a:n.a,source:"hsl"}}return null}(e,o.props.direction,o.props.hsl,o.container);t&&"function"==typeof o.props.onChange&&o.props.onChange(t,e)},o.handleMouseDown=function(e){o.handleChange(e),window.addEventListener("mousemove",o.handleChange),window.addEventListener("mouseup",o.handleMouseUp)},o.handleMouseUp=function(){o.unbindEventListeners()},E(o,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),w(t,[{key:"componentWillUnmount",value:function(){this.unbindEventListeners()}},{key:"unbindEventListeners",value:function(){window.removeEventListener("mousemove",this.handleChange),window.removeEventListener("mouseup",this.handleMouseUp)}},{key:"render",value:function(){var e=this,t=this.props.direction,n=void 0===t?"horizontal":t,a=(0,i.Ay)({default:{hue:{absolute:"0px 0px 0px 0px",borderRadius:this.props.radius,boxShadow:this.props.shadow},container:{padding:"0 2px",position:"relative",height:"100%",borderRadius:this.props.radius},pointer:{position:"absolute",left:100*this.props.hsl.h/360+"%"},slider:{marginTop:"1px",width:"4px",borderRadius:"1px",height:"8px",boxShadow:"0 0 2px rgba(0, 0, 0, .6)",background:"#fff",transform:"translateX(-2px)"}},vertical:{pointer:{left:"0px",top:-100*this.props.hsl.h/360+100+"%"}}},{vertical:"vertical"===n});return o.createElement("div",{style:a.hue},o.createElement("div",{className:"hue-"+n,style:a.container,ref:function(t){return e.container=t},onMouseDown:this.handleMouseDown,onTouchMove:this.handleChange,onTouchStart:this.handleChange},o.createElement("style",null,"\n            .hue-horizontal {\n              background: linear-gradient(to right, #f00 0%, #ff0 17%, #0f0\n                33%, #0ff 50%, #00f 67%, #f0f 83%, #f00 100%);\n              background: -webkit-linear-gradient(to right, #f00 0%, #ff0\n                17%, #0f0 33%, #0ff 50%, #00f 67%, #f0f 83%, #f00 100%);\n            }\n\n            .hue-vertical {\n              background: linear-gradient(to top, #f00 0%, #ff0 17%, #0f0 33%,\n                #0ff 50%, #00f 67%, #f0f 83%, #f00 100%);\n              background: -webkit-linear-gradient(to top, #f00 0%, #ff0 17%,\n                #0f0 33%, #0ff 50%, #00f 67%, #f0f 83%, #f00 100%);\n            }\n          "),o.createElement("div",{style:a.pointer},this.props.pointer?o.createElement(this.props.pointer,this.props):o.createElement("div",{style:a.slider}))))}}]),t}(o.PureComponent||o.Component);var y=n(97598),I=n.n(y);const _=function(){this.__data__=[],this.size=0};const C=function(e,t){return e===t||e!=e&&t!=t};const T=function(e,t){for(var n=e.length;n--;)if(C(e[n][0],t))return n;return-1};var S=Array.prototype.splice;const x=function(e){var t=this.__data__,n=T(t,e);return!(n<0)&&(n==t.length-1?t.pop():S.call(t,n,1),--this.size,!0)};const D=function(e){var t=this.__data__,n=T(t,e);return n<0?void 0:t[n][1]};const A=function(e){return T(this.__data__,e)>-1};const O=function(e,t){var n=this.__data__,o=T(n,e);return o<0?(++this.size,n.push([e,t])):n[o][1]=t,this};function M(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}M.prototype.clear=_,M.prototype.delete=x,M.prototype.get=D,M.prototype.has=A,M.prototype.set=O;const R=M;const k=function(){this.__data__=new R,this.size=0};const L=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n};const P=function(e){return this.__data__.get(e)};const N=function(e){return this.__data__.has(e)};const U="object"==typeof global&&global&&global.Object===Object&&global;var V="object"==typeof self&&self&&self.Object===Object&&self;const B=U||V||Function("return this")();const H=B.Symbol;var W=Object.prototype,F=W.hasOwnProperty,j=W.toString,G=H?H.toStringTag:void 0;const $=function(e){var t=F.call(e,G),n=e[G];try{e[G]=void 0;var o=!0}catch(e){}var i=j.call(e);return o&&(t?e[G]=n:delete e[G]),i};var z=Object.prototype.toString;const q=function(e){return z.call(e)};var Z=H?H.toStringTag:void 0;const K=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Z&&Z in Object(e)?$(e):q(e)};const Y=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const X=function(e){if(!Y(e))return!1;var t=K(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t};const J=B["__core-js_shared__"];var Q,ee=(Q=/[^.]+$/.exec(J&&J.keys&&J.keys.IE_PROTO||""))?"Symbol(src)_1."+Q:"";const te=function(e){return!!ee&&ee in e};var ne=Function.prototype.toString;const oe=function(e){if(null!=e){try{return ne.call(e)}catch(e){}try{return e+""}catch(e){}}return""};var ie=/^\[object .+?Constructor\]$/,ae=Function.prototype,re=Object.prototype,se=ae.toString,le=re.hasOwnProperty,de=RegExp("^"+se.call(le).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const ce=function(e){return!(!Y(e)||te(e))&&(X(e)?de:ie).test(oe(e))};const he=function(e,t){return null==e?void 0:e[t]};const ue=function(e,t){var n=he(e,t);return ce(n)?n:void 0};const ge=ue(B,"Map");const pe=ue(Object,"create");const ve=function(){this.__data__=pe?pe(null):{},this.size=0};const fe=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t};var me=Object.prototype.hasOwnProperty;const we=function(e){var t=this.__data__;if(pe){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return me.call(t,e)?t[e]:void 0};var Ee=Object.prototype.hasOwnProperty;const be=function(e){var t=this.__data__;return pe?void 0!==t[e]:Ee.call(t,e)};const ye=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=pe&&void 0===t?"__lodash_hash_undefined__":t,this};function Ie(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}Ie.prototype.clear=ve,Ie.prototype.delete=fe,Ie.prototype.get=we,Ie.prototype.has=be,Ie.prototype.set=ye;const _e=Ie;const Ce=function(){this.size=0,this.__data__={hash:new _e,map:new(ge||R),string:new _e}};const Te=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};const Se=function(e,t){var n=e.__data__;return Te(t)?n["string"==typeof t?"string":"hash"]:n.map};const xe=function(e){var t=Se(this,e).delete(e);return this.size-=t?1:0,t};const De=function(e){return Se(this,e).get(e)};const Ae=function(e){return Se(this,e).has(e)};const Oe=function(e,t){var n=Se(this,e),o=n.size;return n.set(e,t),this.size+=n.size==o?0:1,this};function Me(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}Me.prototype.clear=Ce,Me.prototype.delete=xe,Me.prototype.get=De,Me.prototype.has=Ae,Me.prototype.set=Oe;const Re=Me;const ke=function(e,t){var n=this.__data__;if(n instanceof R){var o=n.__data__;if(!ge||o.length<199)return o.push([e,t]),this.size=++n.size,this;n=this.__data__=new Re(o)}return n.set(e,t),this.size=n.size,this};function Le(e){var t=this.__data__=new R(e);this.size=t.size}Le.prototype.clear=k,Le.prototype.delete=L,Le.prototype.get=P,Le.prototype.has=N,Le.prototype.set=ke;const Pe=Le;const Ne=function(){try{var e=ue(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();const Ue=function(e,t,n){"__proto__"==t&&Ne?Ne(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n};const Ve=function(e,t,n){(void 0!==n&&!C(e[t],n)||void 0===n&&!(t in e))&&Ue(e,t,n)};const Be=function(e){return function(t,n,o){for(var i=-1,a=Object(t),r=o(t),s=r.length;s--;){var l=r[e?s:++i];if(!1===n(a[l],l,a))break}return t}}();var He="object"==typeof exports&&exports&&!exports.nodeType&&exports,We=He&&"object"==typeof module&&module&&!module.nodeType&&module,Fe=We&&We.exports===He?B.Buffer:void 0,je=Fe?Fe.allocUnsafe:void 0;const Ge=function(e,t){if(t)return e.slice();var n=e.length,o=je?je(n):new e.constructor(n);return e.copy(o),o};const $e=B.Uint8Array;const ze=function(e){var t=new e.constructor(e.byteLength);return new $e(t).set(new $e(e)),t};const qe=function(e,t){var n=t?ze(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)};const Ze=function(e,t){var n=-1,o=e.length;for(t||(t=Array(o));++n<o;)t[n]=e[n];return t};var Ke=Object.create;const Ye=function(){function e(){}return function(t){if(!Y(t))return{};if(Ke)return Ke(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();const Xe=function(e,t){return function(n){return e(t(n))}};const Je=Xe(Object.getPrototypeOf,Object);var Qe=Object.prototype;const et=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Qe)};const tt=function(e){return"function"!=typeof e.constructor||et(e)?{}:Ye(Je(e))};const nt=function(e){return null!=e&&"object"==typeof e};const ot=function(e){return nt(e)&&"[object Arguments]"==K(e)};var it=Object.prototype,at=it.hasOwnProperty,rt=it.propertyIsEnumerable;const st=ot(function(){return arguments}())?ot:function(e){return nt(e)&&at.call(e,"callee")&&!rt.call(e,"callee")};const lt=Array.isArray;const dt=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};const ct=function(e){return null!=e&&dt(e.length)&&!X(e)};const ht=function(e){return nt(e)&&ct(e)};const ut=function(){return!1};var gt="object"==typeof exports&&exports&&!exports.nodeType&&exports,pt=gt&&"object"==typeof module&&module&&!module.nodeType&&module,vt=pt&&pt.exports===gt?B.Buffer:void 0;const ft=(vt?vt.isBuffer:void 0)||ut;var mt=Function.prototype,wt=Object.prototype,Et=mt.toString,bt=wt.hasOwnProperty,yt=Et.call(Object);const It=function(e){if(!nt(e)||"[object Object]"!=K(e))return!1;var t=Je(e);if(null===t)return!0;var n=bt.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&Et.call(n)==yt};var _t={};_t["[object Float32Array]"]=_t["[object Float64Array]"]=_t["[object Int8Array]"]=_t["[object Int16Array]"]=_t["[object Int32Array]"]=_t["[object Uint8Array]"]=_t["[object Uint8ClampedArray]"]=_t["[object Uint16Array]"]=_t["[object Uint32Array]"]=!0,_t["[object Arguments]"]=_t["[object Array]"]=_t["[object ArrayBuffer]"]=_t["[object Boolean]"]=_t["[object DataView]"]=_t["[object Date]"]=_t["[object Error]"]=_t["[object Function]"]=_t["[object Map]"]=_t["[object Number]"]=_t["[object Object]"]=_t["[object RegExp]"]=_t["[object Set]"]=_t["[object String]"]=_t["[object WeakMap]"]=!1;const Ct=function(e){return nt(e)&&dt(e.length)&&!!_t[K(e)]};const Tt=function(e){return function(t){return e(t)}};var St="object"==typeof exports&&exports&&!exports.nodeType&&exports,xt=St&&"object"==typeof module&&module&&!module.nodeType&&module,Dt=xt&&xt.exports===St&&U.process,At=function(){try{var e=xt&&xt.require&&xt.require("util").types;return e||Dt&&Dt.binding&&Dt.binding("util")}catch(e){}}();var Ot=At&&At.isTypedArray;const Mt=Ot?Tt(Ot):Ct;const Rt=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]};var kt=Object.prototype.hasOwnProperty;const Lt=function(e,t,n){var o=e[t];kt.call(e,t)&&C(o,n)&&(void 0!==n||t in e)||Ue(e,t,n)};const Pt=function(e,t,n,o){var i=!n;n||(n={});for(var a=-1,r=t.length;++a<r;){var s=t[a],l=o?o(n[s],e[s],s,n,e):void 0;void 0===l&&(l=e[s]),i?Ue(n,s,l):Lt(n,s,l)}return n};const Nt=function(e,t){for(var n=-1,o=Array(e);++n<e;)o[n]=t(n);return o};var Ut=/^(?:0|[1-9]\d*)$/;const Vt=function(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&Ut.test(e))&&e>-1&&e%1==0&&e<t};var Bt=Object.prototype.hasOwnProperty;const Ht=function(e,t){var n=lt(e),o=!n&&st(e),i=!n&&!o&&ft(e),a=!n&&!o&&!i&&Mt(e),r=n||o||i||a,s=r?Nt(e.length,String):[],l=s.length;for(var d in e)!t&&!Bt.call(e,d)||r&&("length"==d||i&&("offset"==d||"parent"==d)||a&&("buffer"==d||"byteLength"==d||"byteOffset"==d)||Vt(d,l))||s.push(d);return s};const Wt=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t};var Ft=Object.prototype.hasOwnProperty;const jt=function(e){if(!Y(e))return Wt(e);var t=et(e),n=[];for(var o in e)("constructor"!=o||!t&&Ft.call(e,o))&&n.push(o);return n};const Gt=function(e){return ct(e)?Ht(e,!0):jt(e)};const $t=function(e){return Pt(e,Gt(e))};const zt=function(e,t,n,o,i,a,r){var s=Rt(e,n),l=Rt(t,n),d=r.get(l);if(d)Ve(e,n,d);else{var c=a?a(s,l,n+"",e,t,r):void 0,h=void 0===c;if(h){var u=lt(l),g=!u&&ft(l),p=!u&&!g&&Mt(l);c=l,u||g||p?lt(s)?c=s:ht(s)?c=Ze(s):g?(h=!1,c=Ge(l,!0)):p?(h=!1,c=qe(l,!0)):c=[]:It(l)||st(l)?(c=s,st(s)?c=$t(s):Y(s)&&!X(s)||(c=tt(l))):h=!1}h&&(r.set(l,c),i(c,l,o,a,r),r.delete(l)),Ve(e,n,c)}};const qt=function e(t,n,o,i,a){t!==n&&Be(n,(function(r,s){if(a||(a=new Pe),Y(r))zt(t,n,s,o,e,i,a);else{var l=i?i(Rt(t,s),r,s+"",t,n,a):void 0;void 0===l&&(l=r),Ve(t,s,l)}}),Gt)};const Zt=function(e){return e};const Kt=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)};var Yt=Math.max;const Xt=function(e,t,n){return t=Yt(void 0===t?e.length-1:t,0),function(){for(var o=arguments,i=-1,a=Yt(o.length-t,0),r=Array(a);++i<a;)r[i]=o[t+i];i=-1;for(var s=Array(t+1);++i<t;)s[i]=o[i];return s[t]=n(r),Kt(e,this,s)}};const Jt=function(e){return function(){return e}};const Qt=Ne?function(e,t){return Ne(e,"toString",{configurable:!0,enumerable:!1,value:Jt(t),writable:!0})}:Zt;var en=Date.now;const tn=function(e){var t=0,n=0;return function(){var o=en(),i=16-(o-n);if(n=o,i>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(Qt);const nn=function(e,t){return tn(Xt(e,t,Zt),e+"")};const on=function(e,t,n){if(!Y(n))return!1;var o=typeof t;return!!("number"==o?ct(n)&&Vt(t,n.length):"string"==o&&t in n)&&C(n[t],e)};const an=function(e){return nn((function(t,n){var o=-1,i=n.length,a=i>1?n[i-1]:void 0,r=i>2?n[2]:void 0;for(a=e.length>3&&"function"==typeof a?(i--,a):void 0,r&&on(n[0],n[1],r)&&(a=i<3?void 0:a,i=1),t=Object(t);++o<i;){var s=n[o];s&&e(t,s,o,a)}return t}))}((function(e,t,n){qt(e,t,n)}));var rn=function(e){var t=e.zDepth,n=e.radius,a=e.background,r=e.children,s=e.styles,l=void 0===s?{}:s,d=(0,i.Ay)(an({default:{wrap:{position:"relative",display:"inline-block"},content:{position:"relative"},bg:{absolute:"0px 0px 0px 0px",boxShadow:"0 "+t+"px "+4*t+"px rgba(0,0,0,.24)",borderRadius:n,background:a}},"zDepth-0":{bg:{boxShadow:"none"}},"zDepth-1":{bg:{boxShadow:"0 2px 10px rgba(0,0,0,.12), 0 2px 5px rgba(0,0,0,.16)"}},"zDepth-2":{bg:{boxShadow:"0 6px 20px rgba(0,0,0,.19), 0 8px 17px rgba(0,0,0,.2)"}},"zDepth-3":{bg:{boxShadow:"0 17px 50px rgba(0,0,0,.19), 0 12px 15px rgba(0,0,0,.24)"}},"zDepth-4":{bg:{boxShadow:"0 25px 55px rgba(0,0,0,.21), 0 16px 28px rgba(0,0,0,.22)"}},"zDepth-5":{bg:{boxShadow:"0 40px 77px rgba(0,0,0,.22), 0 27px 24px rgba(0,0,0,.2)"}},square:{bg:{borderRadius:"0"}},circle:{bg:{borderRadius:"50%"}}},l),{"zDepth-1":1===t});return o.createElement("div",{style:d.wrap},o.createElement("div",{style:d.bg}),o.createElement("div",{style:d.content},r))};rn.propTypes={background:I().string,zDepth:I().oneOf([0,1,2,3,4,5]),radius:I().number,styles:I().object},rn.defaultProps={background:"#fff",zDepth:1,radius:2,styles:{}};const sn=rn;const ln=function(){return B.Date.now()};var dn=/\s/;const cn=function(e){for(var t=e.length;t--&&dn.test(e.charAt(t)););return t};var hn=/^\s+/;const un=function(e){return e?e.slice(0,cn(e)+1).replace(hn,""):e};const gn=function(e){return"symbol"==typeof e||nt(e)&&"[object Symbol]"==K(e)};var pn=/^[-+]0x[0-9a-f]+$/i,vn=/^0b[01]+$/i,fn=/^0o[0-7]+$/i,mn=parseInt;const wn=function(e){if("number"==typeof e)return e;if(gn(e))return NaN;if(Y(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Y(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=un(e);var n=vn.test(e);return n||fn.test(e)?mn(e.slice(2),n?2:8):pn.test(e)?NaN:+e};var En=Math.max,bn=Math.min;const yn=function(e,t,n){var o,i,a,r,s,l,d=0,c=!1,h=!1,u=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function g(t){var n=o,a=i;return o=i=void 0,d=t,r=e.apply(a,n)}function p(e){var n=e-l;return void 0===l||n>=t||n<0||h&&e-d>=a}function v(){var e=ln();if(p(e))return f(e);s=setTimeout(v,function(e){var n=t-(e-l);return h?bn(n,a-(e-d)):n}(e))}function f(e){return s=void 0,u&&o?g(e):(o=i=void 0,r)}function m(){var e=ln(),n=p(e);if(o=arguments,i=this,l=e,n){if(void 0===s)return function(e){return d=e,s=setTimeout(v,t),c?g(e):r}(l);if(h)return clearTimeout(s),s=setTimeout(v,t),g(l)}return void 0===s&&(s=setTimeout(v,t)),r}return t=wn(t)||0,Y(n)&&(c=!!n.leading,a=(h="maxWait"in n)?En(wn(n.maxWait)||0,t):a,u="trailing"in n?!!n.trailing:u),m.cancel=function(){void 0!==s&&clearTimeout(s),d=0,o=l=i=s=void 0},m.flush=function(){return void 0===s?r:f(ln())},m};const In=function(e,t,n){var o=!0,i=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return Y(n)&&(o="leading"in n?!!n.leading:o,i="trailing"in n?!!n.trailing:i),yn(e,t,{leading:o,maxWait:t,trailing:i})};var _n=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var Cn=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.handleChange=function(e){"function"==typeof n.props.onChange&&n.throttle(n.props.onChange,function(e,t,n){var o=n.getBoundingClientRect(),i=o.width,a=o.height,r="number"==typeof e.pageX?e.pageX:e.touches[0].pageX,s="number"==typeof e.pageY?e.pageY:e.touches[0].pageY,l=r-(n.getBoundingClientRect().left+window.pageXOffset),d=s-(n.getBoundingClientRect().top+window.pageYOffset);l<0?l=0:l>i&&(l=i),d<0?d=0:d>a&&(d=a);var c=l/i,h=1-d/a;return{h:t.h,s:c,v:h,a:t.a,source:"hsv"}}(e,n.props.hsl,n.container),e)},n.handleMouseDown=function(e){n.handleChange(e);var t=n.getContainerRenderWindow();t.addEventListener("mousemove",n.handleChange),t.addEventListener("mouseup",n.handleMouseUp)},n.handleMouseUp=function(){n.unbindEventListeners()},n.throttle=In((function(e,t,n){e(t,n)}),50),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),_n(t,[{key:"componentWillUnmount",value:function(){this.throttle.cancel(),this.unbindEventListeners()}},{key:"getContainerRenderWindow",value:function(){for(var e=this.container,t=window;!t.document.contains(e)&&t.parent!==t;)t=t.parent;return t}},{key:"unbindEventListeners",value:function(){var e=this.getContainerRenderWindow();e.removeEventListener("mousemove",this.handleChange),e.removeEventListener("mouseup",this.handleMouseUp)}},{key:"render",value:function(){var e=this,t=this.props.style||{},n=t.color,a=t.white,r=t.black,s=t.pointer,l=t.circle,d=(0,i.Ay)({default:{color:{absolute:"0px 0px 0px 0px",background:"hsl("+this.props.hsl.h+",100%, 50%)",borderRadius:this.props.radius},white:{absolute:"0px 0px 0px 0px",borderRadius:this.props.radius},black:{absolute:"0px 0px 0px 0px",boxShadow:this.props.shadow,borderRadius:this.props.radius},pointer:{position:"absolute",top:-100*this.props.hsv.v+100+"%",left:100*this.props.hsv.s+"%",cursor:"default"},circle:{width:"4px",height:"4px",boxShadow:"0 0 0 1.5px #fff, inset 0 0 1px 1px rgba(0,0,0,.3),\n            0 0 1px 2px rgba(0,0,0,.4)",borderRadius:"50%",cursor:"hand",transform:"translate(-2px, -2px)"}},custom:{color:n,white:a,black:r,pointer:s,circle:l}},{custom:!!this.props.style});return o.createElement("div",{style:d.color,ref:function(t){return e.container=t},onMouseDown:this.handleMouseDown,onTouchMove:this.handleChange,onTouchStart:this.handleChange},o.createElement("style",null,"\n          .saturation-white {\n            background: -webkit-linear-gradient(to right, #fff, rgba(255,255,255,0));\n            background: linear-gradient(to right, #fff, rgba(255,255,255,0));\n          }\n          .saturation-black {\n            background: -webkit-linear-gradient(to top, #000, rgba(0,0,0,0));\n            background: linear-gradient(to top, #000, rgba(0,0,0,0));\n          }\n        "),o.createElement("div",{style:d.white,className:"saturation-white"},o.createElement("div",{style:d.black,className:"saturation-black"}),o.createElement("div",{style:d.pointer},this.props.pointer?o.createElement(this.props.pointer,this.props):o.createElement("div",{style:d.circle}))))}}]),t}(o.PureComponent||o.Component);const Tn=Cn;const Sn=function(e,t){for(var n=-1,o=null==e?0:e.length;++n<o&&!1!==t(e[n],n,e););return e};const xn=Xe(Object.keys,Object);var Dn=Object.prototype.hasOwnProperty;const An=function(e){if(!et(e))return xn(e);var t=[];for(var n in Object(e))Dn.call(e,n)&&"constructor"!=n&&t.push(n);return t};const On=function(e){return ct(e)?Ht(e):An(e)};const Mn=function(e,t){return function(n,o){if(null==n)return n;if(!ct(n))return e(n,o);for(var i=n.length,a=t?i:-1,r=Object(n);(t?a--:++a<i)&&!1!==o(r[a],a,r););return n}}((function(e,t){return e&&Be(e,t,On)}));const Rn=function(e){return"function"==typeof e?e:Zt};const kn=function(e,t){return(lt(e)?Sn:Mn)(e,Rn(t))};function Ln(e){return Ln="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ln(e)}var Pn=/^\s+/,Nn=/\s+$/;function Un(e,t){if(t=t||{},(e=e||"")instanceof Un)return e;if(!(this instanceof Un))return new Un(e,t);var n=function(e){var t={r:0,g:0,b:0},n=1,o=null,i=null,a=null,r=!1,s=!1;"string"==typeof e&&(e=function(e){e=e.replace(Pn,"").replace(Nn,"").toLowerCase();var t,n=!1;if(eo[e])e=eo[e],n=!0;else if("transparent"==e)return{r:0,g:0,b:0,a:0,format:"name"};if(t=po.rgb.exec(e))return{r:t[1],g:t[2],b:t[3]};if(t=po.rgba.exec(e))return{r:t[1],g:t[2],b:t[3],a:t[4]};if(t=po.hsl.exec(e))return{h:t[1],s:t[2],l:t[3]};if(t=po.hsla.exec(e))return{h:t[1],s:t[2],l:t[3],a:t[4]};if(t=po.hsv.exec(e))return{h:t[1],s:t[2],v:t[3]};if(t=po.hsva.exec(e))return{h:t[1],s:t[2],v:t[3],a:t[4]};if(t=po.hex8.exec(e))return{r:ao(t[1]),g:ao(t[2]),b:ao(t[3]),a:co(t[4]),format:n?"name":"hex8"};if(t=po.hex6.exec(e))return{r:ao(t[1]),g:ao(t[2]),b:ao(t[3]),format:n?"name":"hex"};if(t=po.hex4.exec(e))return{r:ao(t[1]+""+t[1]),g:ao(t[2]+""+t[2]),b:ao(t[3]+""+t[3]),a:co(t[4]+""+t[4]),format:n?"name":"hex8"};if(t=po.hex3.exec(e))return{r:ao(t[1]+""+t[1]),g:ao(t[2]+""+t[2]),b:ao(t[3]+""+t[3]),format:n?"name":"hex"};return!1}(e));"object"==Ln(e)&&(vo(e.r)&&vo(e.g)&&vo(e.b)?(l=e.r,d=e.g,c=e.b,t={r:255*oo(l,255),g:255*oo(d,255),b:255*oo(c,255)},r=!0,s="%"===String(e.r).substr(-1)?"prgb":"rgb"):vo(e.h)&&vo(e.s)&&vo(e.v)?(o=so(e.s),i=so(e.v),t=function(e,t,n){e=6*oo(e,360),t=oo(t,100),n=oo(n,100);var o=Math.floor(e),i=e-o,a=n*(1-t),r=n*(1-i*t),s=n*(1-(1-i)*t),l=o%6,d=[n,r,a,a,s,n][l],c=[s,n,n,r,a,a][l],h=[a,a,s,n,n,r][l];return{r:255*d,g:255*c,b:255*h}}(e.h,o,i),r=!0,s="hsv"):vo(e.h)&&vo(e.s)&&vo(e.l)&&(o=so(e.s),a=so(e.l),t=function(e,t,n){var o,i,a;function r(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}if(e=oo(e,360),t=oo(t,100),n=oo(n,100),0===t)o=i=a=n;else{var s=n<.5?n*(1+t):n+t-n*t,l=2*n-s;o=r(l,s,e+1/3),i=r(l,s,e),a=r(l,s,e-1/3)}return{r:255*o,g:255*i,b:255*a}}(e.h,o,a),r=!0,s="hsl"),e.hasOwnProperty("a")&&(n=e.a));var l,d,c;return n=no(n),{ok:r,format:e.format||s,r:Math.min(255,Math.max(t.r,0)),g:Math.min(255,Math.max(t.g,0)),b:Math.min(255,Math.max(t.b,0)),a:n}}(e);this._originalInput=e,this._r=n.r,this._g=n.g,this._b=n.b,this._a=n.a,this._roundA=Math.round(100*this._a)/100,this._format=t.format||n.format,this._gradientType=t.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=n.ok}function Vn(e,t,n){e=oo(e,255),t=oo(t,255),n=oo(n,255);var o,i,a=Math.max(e,t,n),r=Math.min(e,t,n),s=(a+r)/2;if(a==r)o=i=0;else{var l=a-r;switch(i=s>.5?l/(2-a-r):l/(a+r),a){case e:o=(t-n)/l+(t<n?6:0);break;case t:o=(n-e)/l+2;break;case n:o=(e-t)/l+4}o/=6}return{h:o,s:i,l:s}}function Bn(e,t,n){e=oo(e,255),t=oo(t,255),n=oo(n,255);var o,i,a=Math.max(e,t,n),r=Math.min(e,t,n),s=a,l=a-r;if(i=0===a?0:l/a,a==r)o=0;else{switch(a){case e:o=(t-n)/l+(t<n?6:0);break;case t:o=(n-e)/l+2;break;case n:o=(e-t)/l+4}o/=6}return{h:o,s:i,v:s}}function Hn(e,t,n,o){var i=[ro(Math.round(e).toString(16)),ro(Math.round(t).toString(16)),ro(Math.round(n).toString(16))];return o&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function Wn(e,t,n,o){return[ro(lo(o)),ro(Math.round(e).toString(16)),ro(Math.round(t).toString(16)),ro(Math.round(n).toString(16))].join("")}function Fn(e,t){t=0===t?0:t||10;var n=Un(e).toHsl();return n.s-=t/100,n.s=io(n.s),Un(n)}function jn(e,t){t=0===t?0:t||10;var n=Un(e).toHsl();return n.s+=t/100,n.s=io(n.s),Un(n)}function Gn(e){return Un(e).desaturate(100)}function $n(e,t){t=0===t?0:t||10;var n=Un(e).toHsl();return n.l+=t/100,n.l=io(n.l),Un(n)}function zn(e,t){t=0===t?0:t||10;var n=Un(e).toRgb();return n.r=Math.max(0,Math.min(255,n.r-Math.round(-t/100*255))),n.g=Math.max(0,Math.min(255,n.g-Math.round(-t/100*255))),n.b=Math.max(0,Math.min(255,n.b-Math.round(-t/100*255))),Un(n)}function qn(e,t){t=0===t?0:t||10;var n=Un(e).toHsl();return n.l-=t/100,n.l=io(n.l),Un(n)}function Zn(e,t){var n=Un(e).toHsl(),o=(n.h+t)%360;return n.h=o<0?360+o:o,Un(n)}function Kn(e){var t=Un(e).toHsl();return t.h=(t.h+180)%360,Un(t)}function Yn(e,t){if(isNaN(t)||t<=0)throw new Error("Argument to polyad must be a positive number");for(var n=Un(e).toHsl(),o=[Un(e)],i=360/t,a=1;a<t;a++)o.push(Un({h:(n.h+a*i)%360,s:n.s,l:n.l}));return o}function Xn(e){var t=Un(e).toHsl(),n=t.h;return[Un(e),Un({h:(n+72)%360,s:t.s,l:t.l}),Un({h:(n+216)%360,s:t.s,l:t.l})]}function Jn(e,t,n){t=t||6,n=n||30;var o=Un(e).toHsl(),i=360/n,a=[Un(e)];for(o.h=(o.h-(i*t>>1)+720)%360;--t;)o.h=(o.h+i)%360,a.push(Un(o));return a}function Qn(e,t){t=t||6;for(var n=Un(e).toHsv(),o=n.h,i=n.s,a=n.v,r=[],s=1/t;t--;)r.push(Un({h:o,s:i,v:a})),a=(a+s)%1;return r}Un.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},getLuminance:function(){var e,t,n,o=this.toRgb();return e=o.r/255,t=o.g/255,n=o.b/255,.2126*(e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4))+.7152*(t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4))+.0722*(n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4))},setAlpha:function(e){return this._a=no(e),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var e=Bn(this._r,this._g,this._b);return{h:360*e.h,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=Bn(this._r,this._g,this._b),t=Math.round(360*e.h),n=Math.round(100*e.s),o=Math.round(100*e.v);return 1==this._a?"hsv("+t+", "+n+"%, "+o+"%)":"hsva("+t+", "+n+"%, "+o+"%, "+this._roundA+")"},toHsl:function(){var e=Vn(this._r,this._g,this._b);return{h:360*e.h,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=Vn(this._r,this._g,this._b),t=Math.round(360*e.h),n=Math.round(100*e.s),o=Math.round(100*e.l);return 1==this._a?"hsl("+t+", "+n+"%, "+o+"%)":"hsla("+t+", "+n+"%, "+o+"%, "+this._roundA+")"},toHex:function(e){return Hn(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(e){return function(e,t,n,o,i){var a=[ro(Math.round(e).toString(16)),ro(Math.round(t).toString(16)),ro(Math.round(n).toString(16)),ro(lo(o))];if(i&&a[0].charAt(0)==a[0].charAt(1)&&a[1].charAt(0)==a[1].charAt(1)&&a[2].charAt(0)==a[2].charAt(1)&&a[3].charAt(0)==a[3].charAt(1))return a[0].charAt(0)+a[1].charAt(0)+a[2].charAt(0)+a[3].charAt(0);return a.join("")}(this._r,this._g,this._b,this._a,e)},toHex8String:function(e){return"#"+this.toHex8(e)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(100*oo(this._r,255))+"%",g:Math.round(100*oo(this._g,255))+"%",b:Math.round(100*oo(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+Math.round(100*oo(this._r,255))+"%, "+Math.round(100*oo(this._g,255))+"%, "+Math.round(100*oo(this._b,255))+"%)":"rgba("+Math.round(100*oo(this._r,255))+"%, "+Math.round(100*oo(this._g,255))+"%, "+Math.round(100*oo(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&(to[Hn(this._r,this._g,this._b,!0)]||!1)},toFilter:function(e){var t="#"+Wn(this._r,this._g,this._b,this._a),n=t,o=this._gradientType?"GradientType = 1, ":"";if(e){var i=Un(e);n="#"+Wn(i._r,i._g,i._b,i._a)}return"progid:DXImageTransform.Microsoft.gradient("+o+"startColorstr="+t+",endColorstr="+n+")"},toString:function(e){var t=!!e;e=e||this._format;var n=!1,o=this._a<1&&this._a>=0;return t||!o||"hex"!==e&&"hex6"!==e&&"hex3"!==e&&"hex4"!==e&&"hex8"!==e&&"name"!==e?("rgb"===e&&(n=this.toRgbString()),"prgb"===e&&(n=this.toPercentageRgbString()),"hex"!==e&&"hex6"!==e||(n=this.toHexString()),"hex3"===e&&(n=this.toHexString(!0)),"hex4"===e&&(n=this.toHex8String(!0)),"hex8"===e&&(n=this.toHex8String()),"name"===e&&(n=this.toName()),"hsl"===e&&(n=this.toHslString()),"hsv"===e&&(n=this.toHsvString()),n||this.toHexString()):"name"===e&&0===this._a?this.toName():this.toRgbString()},clone:function(){return Un(this.toString())},_applyModification:function(e,t){var n=e.apply(null,[this].concat([].slice.call(t)));return this._r=n._r,this._g=n._g,this._b=n._b,this.setAlpha(n._a),this},lighten:function(){return this._applyModification($n,arguments)},brighten:function(){return this._applyModification(zn,arguments)},darken:function(){return this._applyModification(qn,arguments)},desaturate:function(){return this._applyModification(Fn,arguments)},saturate:function(){return this._applyModification(jn,arguments)},greyscale:function(){return this._applyModification(Gn,arguments)},spin:function(){return this._applyModification(Zn,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(Jn,arguments)},complement:function(){return this._applyCombination(Kn,arguments)},monochromatic:function(){return this._applyCombination(Qn,arguments)},splitcomplement:function(){return this._applyCombination(Xn,arguments)},triad:function(){return this._applyCombination(Yn,[3])},tetrad:function(){return this._applyCombination(Yn,[4])}},Un.fromRatio=function(e,t){if("object"==Ln(e)){var n={};for(var o in e)e.hasOwnProperty(o)&&(n[o]="a"===o?e[o]:so(e[o]));e=n}return Un(e,t)},Un.equals=function(e,t){return!(!e||!t)&&Un(e).toRgbString()==Un(t).toRgbString()},Un.random=function(){return Un.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})},Un.mix=function(e,t,n){n=0===n?0:n||50;var o=Un(e).toRgb(),i=Un(t).toRgb(),a=n/100;return Un({r:(i.r-o.r)*a+o.r,g:(i.g-o.g)*a+o.g,b:(i.b-o.b)*a+o.b,a:(i.a-o.a)*a+o.a})},Un.readability=function(e,t){var n=Un(e),o=Un(t);return(Math.max(n.getLuminance(),o.getLuminance())+.05)/(Math.min(n.getLuminance(),o.getLuminance())+.05)},Un.isReadable=function(e,t,n){var o,i,a=Un.readability(e,t);switch(i=!1,(o=function(e){var t,n;t=((e=e||{level:"AA",size:"small"}).level||"AA").toUpperCase(),n=(e.size||"small").toLowerCase(),"AA"!==t&&"AAA"!==t&&(t="AA");"small"!==n&&"large"!==n&&(n="small");return{level:t,size:n}}(n)).level+o.size){case"AAsmall":case"AAAlarge":i=a>=4.5;break;case"AAlarge":i=a>=3;break;case"AAAsmall":i=a>=7}return i},Un.mostReadable=function(e,t,n){var o,i,a,r,s=null,l=0;i=(n=n||{}).includeFallbackColors,a=n.level,r=n.size;for(var d=0;d<t.length;d++)(o=Un.readability(e,t[d]))>l&&(l=o,s=Un(t[d]));return Un.isReadable(e,s,{level:a,size:r})||!i?s:(n.includeFallbackColors=!1,Un.mostReadable(e,["#fff","#000"],n))};var eo=Un.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},to=Un.hexNames=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[e[n]]=n);return t}(eo);function no(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function oo(e,t){(function(e){return"string"==typeof e&&-1!=e.indexOf(".")&&1===parseFloat(e)})(e)&&(e="100%");var n=function(e){return"string"==typeof e&&-1!=e.indexOf("%")}(e);return e=Math.min(t,Math.max(0,parseFloat(e))),n&&(e=parseInt(e*t,10)/100),Math.abs(e-t)<1e-6?1:e%t/parseFloat(t)}function io(e){return Math.min(1,Math.max(0,e))}function ao(e){return parseInt(e,16)}function ro(e){return 1==e.length?"0"+e:""+e}function so(e){return e<=1&&(e=100*e+"%"),e}function lo(e){return Math.round(255*parseFloat(e)).toString(16)}function co(e){return ao(e)/255}var ho,uo,go,po=(uo="[\\s|\\(]+("+(ho="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)")+")[,|\\s]+("+ho+")[,|\\s]+("+ho+")\\s*\\)?",go="[\\s|\\(]+("+ho+")[,|\\s]+("+ho+")[,|\\s]+("+ho+")[,|\\s]+("+ho+")\\s*\\)?",{CSS_UNIT:new RegExp(ho),rgb:new RegExp("rgb"+uo),rgba:new RegExp("rgba"+go),hsl:new RegExp("hsl"+uo),hsla:new RegExp("hsla"+go),hsv:new RegExp("hsv"+uo),hsva:new RegExp("hsva"+go),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/});function vo(e){return!!po.CSS_UNIT.exec(e)}var fo=function(e){var t=0,n=0;return kn(["r","g","b","a","h","s","l","v"],(function(o){if(e[o]&&(t+=1,isNaN(e[o])||(n+=1),"s"===o||"l"===o)){/^\d+%$/.test(e[o])&&(n+=1)}})),t===n&&e},mo=function(e,t){var n=e.hex?Un(e.hex):Un(e),o=n.toHsl(),i=n.toHsv(),a=n.toRgb(),r=n.toHex();return 0===o.s&&(o.h=t||0,i.h=t||0),{hsl:o,hex:"000000"===r&&0===a.a?"transparent":"#"+r,rgb:a,hsv:i,oldHue:e.h||t||o.h,source:e.source}},wo=function(e){if("transparent"===e)return!0;var t="#"===String(e).charAt(0)?1:0;return e.length!==4+t&&e.length<7+t&&Un(e).isValid()},Eo=function(e){if(!e)return"#fff";var t=mo(e);return"transparent"===t.hex?"rgba(0,0,0,0.4)":(299*t.rgb.r+587*t.rgb.g+114*t.rgb.b)/1e3>=128?"#000":"#fff"},bo=function(e,t){return Un(t+" ("+e.replace("°","")+")")._ok},yo=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},Io=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();const _o=function(e){var t=function(t){function n(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return t.handleChange=function(e,n){if(fo(e)){var o=mo(e,e.h||t.state.oldHue);t.setState(o),t.props.onChangeComplete&&t.debounce(t.props.onChangeComplete,o,n),t.props.onChange&&t.props.onChange(o,n)}},t.handleSwatchHover=function(e,n){if(fo(e)){var o=mo(e,e.h||t.state.oldHue);t.props.onSwatchHover&&t.props.onSwatchHover(o,n)}},t.state=yo({},mo(e.color,0)),t.debounce=yn((function(e,t,n){e(t,n)}),100),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,t),Io(n,[{key:"render",value:function(){var t={};return this.props.onSwatchHover&&(t.onSwatchHover=this.handleSwatchHover),o.createElement(e,yo({},this.props,this.state,{onChange:this.handleChange},t))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return yo({},mo(e.color,t.oldHue))}}]),n}(o.PureComponent||o.Component);return t.propTypes=yo({},e.propTypes),t.defaultProps=yo({},e.defaultProps,{color:{h:250,s:.5,l:.2,a:1}}),t};var Co=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},To=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();function So(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var xo=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e};const Do=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"span";return function(n){function i(){var e,t,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);for(var o=arguments.length,a=Array(o),r=0;r<o;r++)a[r]=arguments[r];return t=n=So(this,(e=i.__proto__||Object.getPrototypeOf(i)).call.apply(e,[this].concat(a))),n.state={focus:!1},n.handleFocus=function(){return n.setState({focus:!0})},n.handleBlur=function(){return n.setState({focus:!1})},So(n,t)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,n),To(i,[{key:"render",value:function(){return o.createElement(t,{onFocus:this.handleFocus,onBlur:this.handleBlur},o.createElement(e,Co({},this.props,this.state)))}}]),i}(o.Component)}((function(e){var t=e.color,n=e.style,a=e.onClick,r=void 0===a?function(){}:a,s=e.onHover,l=e.title,c=void 0===l?t:l,h=e.children,u=e.focus,g=e.focusStyle,p=void 0===g?{}:g,v="transparent"===t,f=(0,i.Ay)({default:{swatch:xo({background:t,height:"100%",width:"100%",cursor:"pointer",position:"relative",outline:"none"},n,u?p:{})}}),m={};return s&&(m.onMouseOver=function(e){return s(t,e)}),o.createElement("div",xo({style:f.swatch,onClick:function(e){return r(t,e)},title:c,tabIndex:0,onKeyDown:function(e){return 13===e.keyCode&&r(t,e)}},m),h,v&&o.createElement(d,{borderRadius:f.swatch.borderRadius,boxShadow:"inset 0 0 0 1px rgba(0,0,0,0.1)"}))}));const Ao=function(e){var t=e.direction,n=(0,i.Ay)({default:{picker:{width:"18px",height:"18px",borderRadius:"50%",transform:"translate(-9px, -1px)",backgroundColor:"rgb(248, 248, 248)",boxShadow:"0 1px 4px 0 rgba(0, 0, 0, 0.37)"}},vertical:{picker:{transform:"translate(-3px, -9px)"}}},{vertical:"vertical"===t});return o.createElement("div",{style:n.picker})};var Oo=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},Mo=function(e){var t=e.rgb,n=e.hsl,a=e.width,r=e.height,s=e.onChange,l=e.direction,d=e.style,c=e.renderers,h=e.pointer,u=e.className,p=void 0===u?"":u,v=(0,i.Ay)({default:{picker:{position:"relative",width:a,height:r},alpha:{radius:"2px",style:d}}});return o.createElement("div",{style:v.picker,className:"alpha-picker "+p},o.createElement(g,Oo({},v.alpha,{rgb:t,hsl:n,pointer:h,renderers:c,onChange:s,direction:l})))};Mo.defaultProps={width:"316px",height:"16px",direction:"horizontal",pointer:Ao};_o(Mo);const Ro=function(e,t){for(var n=-1,o=null==e?0:e.length,i=Array(o);++n<o;)i[n]=t(e[n],n,e);return i};const ko=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this};const Lo=function(e){return this.__data__.has(e)};function Po(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Re;++t<n;)this.add(e[t])}Po.prototype.add=Po.prototype.push=ko,Po.prototype.has=Lo;const No=Po;const Uo=function(e,t){for(var n=-1,o=null==e?0:e.length;++n<o;)if(t(e[n],n,e))return!0;return!1};const Vo=function(e,t){return e.has(t)};const Bo=function(e,t,n,o,i,a){var r=1&n,s=e.length,l=t.length;if(s!=l&&!(r&&l>s))return!1;var d=a.get(e),c=a.get(t);if(d&&c)return d==t&&c==e;var h=-1,u=!0,g=2&n?new No:void 0;for(a.set(e,t),a.set(t,e);++h<s;){var p=e[h],v=t[h];if(o)var f=r?o(v,p,h,t,e,a):o(p,v,h,e,t,a);if(void 0!==f){if(f)continue;u=!1;break}if(g){if(!Uo(t,(function(e,t){if(!Vo(g,t)&&(p===e||i(p,e,n,o,a)))return g.push(t)}))){u=!1;break}}else if(p!==v&&!i(p,v,n,o,a)){u=!1;break}}return a.delete(e),a.delete(t),u};const Ho=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,o){n[++t]=[o,e]})),n};const Wo=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n};var Fo=H?H.prototype:void 0,jo=Fo?Fo.valueOf:void 0;const Go=function(e,t,n,o,i,a,r){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!a(new $e(e),new $e(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return C(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var s=Ho;case"[object Set]":var l=1&o;if(s||(s=Wo),e.size!=t.size&&!l)return!1;var d=r.get(e);if(d)return d==t;o|=2,r.set(e,t);var c=Bo(s(e),s(t),o,i,a,r);return r.delete(e),c;case"[object Symbol]":if(jo)return jo.call(e)==jo.call(t)}return!1};const $o=function(e,t){for(var n=-1,o=t.length,i=e.length;++n<o;)e[i+n]=t[n];return e};const zo=function(e,t,n){var o=t(e);return lt(e)?o:$o(o,n(e))};const qo=function(e,t){for(var n=-1,o=null==e?0:e.length,i=0,a=[];++n<o;){var r=e[n];t(r,n,e)&&(a[i++]=r)}return a};const Zo=function(){return[]};var Ko=Object.prototype.propertyIsEnumerable,Yo=Object.getOwnPropertySymbols;const Xo=Yo?function(e){return null==e?[]:(e=Object(e),qo(Yo(e),(function(t){return Ko.call(e,t)})))}:Zo;const Jo=function(e){return zo(e,On,Xo)};var Qo=Object.prototype.hasOwnProperty;const ei=function(e,t,n,o,i,a){var r=1&n,s=Jo(e),l=s.length;if(l!=Jo(t).length&&!r)return!1;for(var d=l;d--;){var c=s[d];if(!(r?c in t:Qo.call(t,c)))return!1}var h=a.get(e),u=a.get(t);if(h&&u)return h==t&&u==e;var g=!0;a.set(e,t),a.set(t,e);for(var p=r;++d<l;){var v=e[c=s[d]],f=t[c];if(o)var m=r?o(f,v,c,t,e,a):o(v,f,c,e,t,a);if(!(void 0===m?v===f||i(v,f,n,o,a):m)){g=!1;break}p||(p="constructor"==c)}if(g&&!p){var w=e.constructor,E=t.constructor;w==E||!("constructor"in e)||!("constructor"in t)||"function"==typeof w&&w instanceof w&&"function"==typeof E&&E instanceof E||(g=!1)}return a.delete(e),a.delete(t),g};const ti=ue(B,"DataView");const ni=ue(B,"Promise");const oi=ue(B,"Set");const ii=ue(B,"WeakMap");var ai="[object Map]",ri="[object Promise]",si="[object Set]",li="[object WeakMap]",di="[object DataView]",ci=oe(ti),hi=oe(ge),ui=oe(ni),gi=oe(oi),pi=oe(ii),vi=K;(ti&&vi(new ti(new ArrayBuffer(1)))!=di||ge&&vi(new ge)!=ai||ni&&vi(ni.resolve())!=ri||oi&&vi(new oi)!=si||ii&&vi(new ii)!=li)&&(vi=function(e){var t=K(e),n="[object Object]"==t?e.constructor:void 0,o=n?oe(n):"";if(o)switch(o){case ci:return di;case hi:return ai;case ui:return ri;case gi:return si;case pi:return li}return t});const fi=vi;var mi="[object Arguments]",wi="[object Array]",Ei="[object Object]",bi=Object.prototype.hasOwnProperty;const yi=function(e,t,n,o,i,a){var r=lt(e),s=lt(t),l=r?wi:fi(e),d=s?wi:fi(t),c=(l=l==mi?Ei:l)==Ei,h=(d=d==mi?Ei:d)==Ei,u=l==d;if(u&&ft(e)){if(!ft(t))return!1;r=!0,c=!1}if(u&&!c)return a||(a=new Pe),r||Mt(e)?Bo(e,t,n,o,i,a):Go(e,t,l,n,o,i,a);if(!(1&n)){var g=c&&bi.call(e,"__wrapped__"),p=h&&bi.call(t,"__wrapped__");if(g||p){var v=g?e.value():e,f=p?t.value():t;return a||(a=new Pe),i(v,f,n,o,a)}}return!!u&&(a||(a=new Pe),ei(e,t,n,o,i,a))};const Ii=function e(t,n,o,i,a){return t===n||(null==t||null==n||!nt(t)&&!nt(n)?t!=t&&n!=n:yi(t,n,o,i,e,a))};const _i=function(e,t,n,o){var i=n.length,a=i,r=!o;if(null==e)return!a;for(e=Object(e);i--;){var s=n[i];if(r&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++i<a;){var l=(s=n[i])[0],d=e[l],c=s[1];if(r&&s[2]){if(void 0===d&&!(l in e))return!1}else{var h=new Pe;if(o)var u=o(d,c,l,e,t,h);if(!(void 0===u?Ii(c,d,3,o,h):u))return!1}}return!0};const Ci=function(e){return e==e&&!Y(e)};const Ti=function(e){for(var t=On(e),n=t.length;n--;){var o=t[n],i=e[o];t[n]=[o,i,Ci(i)]}return t};const Si=function(e,t){return function(n){return null!=n&&(n[e]===t&&(void 0!==t||e in Object(n)))}};const xi=function(e){var t=Ti(e);return 1==t.length&&t[0][2]?Si(t[0][0],t[0][1]):function(n){return n===e||_i(n,e,t)}};var Di=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ai=/^\w*$/;const Oi=function(e,t){if(lt(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!gn(e))||(Ai.test(e)||!Di.test(e)||null!=t&&e in Object(t))};function Mi(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var o=arguments,i=t?t.apply(this,o):o[0],a=n.cache;if(a.has(i))return a.get(i);var r=e.apply(this,o);return n.cache=a.set(i,r)||a,r};return n.cache=new(Mi.Cache||Re),n}Mi.Cache=Re;const Ri=Mi;var ki=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Li=/\\(\\)?/g;const Pi=function(e){var t=Ri(e,(function(e){return 500===n.size&&n.clear(),e})),n=t.cache;return t}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(ki,(function(e,n,o,i){t.push(o?i.replace(Li,"$1"):n||e)})),t}));var Ni=H?H.prototype:void 0,Ui=Ni?Ni.toString:void 0;const Vi=function e(t){if("string"==typeof t)return t;if(lt(t))return Ro(t,e)+"";if(gn(t))return Ui?Ui.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n};const Bi=function(e){return null==e?"":Vi(e)};const Hi=function(e,t){return lt(e)?e:Oi(e,t)?[e]:Pi(Bi(e))};const Wi=function(e){if("string"==typeof e||gn(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t};const Fi=function(e,t){for(var n=0,o=(t=Hi(t,e)).length;null!=e&&n<o;)e=e[Wi(t[n++])];return n&&n==o?e:void 0};const ji=function(e,t,n){var o=null==e?void 0:Fi(e,t);return void 0===o?n:o};const Gi=function(e,t){return null!=e&&t in Object(e)};const $i=function(e,t,n){for(var o=-1,i=(t=Hi(t,e)).length,a=!1;++o<i;){var r=Wi(t[o]);if(!(a=null!=e&&n(e,r)))break;e=e[r]}return a||++o!=i?a:!!(i=null==e?0:e.length)&&dt(i)&&Vt(r,i)&&(lt(e)||st(e))};const zi=function(e,t){return null!=e&&$i(e,t,Gi)};const qi=function(e,t){return Oi(e)&&Ci(t)?Si(Wi(e),t):function(n){var o=ji(n,e);return void 0===o&&o===t?zi(n,e):Ii(t,o,3)}};const Zi=function(e){return function(t){return null==t?void 0:t[e]}};const Ki=function(e){return function(t){return Fi(t,e)}};const Yi=function(e){return Oi(e)?Zi(Wi(e)):Ki(e)};const Xi=function(e){return"function"==typeof e?e:null==e?Zt:"object"==typeof e?lt(e)?qi(e[0],e[1]):xi(e):Yi(e)};const Ji=function(e,t){var n=-1,o=ct(e)?Array(e.length):[];return Mn(e,(function(e,i,a){o[++n]=t(e,i,a)})),o};const Qi=function(e,t){return(lt(e)?Ro:Ji)(e,Xi(t,3))};const ea=function(e){var t=e.colors,n=e.onClick,a=e.onSwatchHover,r=(0,i.Ay)({default:{swatches:{marginRight:"-10px"},swatch:{width:"22px",height:"22px",float:"left",marginRight:"10px",marginBottom:"10px",borderRadius:"4px"},clear:{clear:"both"}}});return o.createElement("div",{style:r.swatches},Qi(t,(function(e){return o.createElement(Do,{key:e,color:e,style:r.swatch,onClick:n,onHover:a,focusStyle:{boxShadow:"0 0 4px "+e}})})),o.createElement("div",{style:r.clear}))};var ta=function(e){var t=e.onChange,n=e.onSwatchHover,a=e.hex,r=e.colors,s=e.width,l=e.triangle,c=e.styles,h=void 0===c?{}:c,u=e.className,g=void 0===u?"":u,p="transparent"===a,v=function(e,n){wo(e)&&t({hex:e,source:"hex"},n)},f=(0,i.Ay)(an({default:{card:{width:s,background:"#fff",boxShadow:"0 1px rgba(0,0,0,.1)",borderRadius:"6px",position:"relative"},head:{height:"110px",background:a,borderRadius:"6px 6px 0 0",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},body:{padding:"10px"},label:{fontSize:"18px",color:Eo(a),position:"relative"},triangle:{width:"0px",height:"0px",borderStyle:"solid",borderWidth:"0 10px 10px 10px",borderColor:"transparent transparent "+a+" transparent",position:"absolute",top:"-10px",left:"50%",marginLeft:"-10px"},input:{width:"100%",fontSize:"12px",color:"#666",border:"0px",outline:"none",height:"22px",boxShadow:"inset 0 0 0 1px #ddd",borderRadius:"4px",padding:"0 7px",boxSizing:"border-box"}},"hide-triangle":{triangle:{display:"none"}}},h),{"hide-triangle":"hide"===l});return o.createElement("div",{style:f.card,className:"block-picker "+g},o.createElement("div",{style:f.triangle}),o.createElement("div",{style:f.head},p&&o.createElement(d,{borderRadius:"6px 6px 0 0"}),o.createElement("div",{style:f.label},a)),o.createElement("div",{style:f.body},o.createElement(ea,{colors:r,onClick:v,onSwatchHover:n}),o.createElement(m,{style:{input:f.input},value:a,onChange:v})))};ta.propTypes={width:I().oneOfType([I().string,I().number]),colors:I().arrayOf(I().string),triangle:I().oneOf(["top","hide"]),styles:I().object},ta.defaultProps={width:170,colors:["#D9E3F0","#F47373","#697689","#37D67A","#2CCCE4","#555555","#dce775","#ff8a65","#ba68c8"],triangle:"top",styles:{}};_o(ta);var na={50:"#ffebee",100:"#ffcdd2",200:"#ef9a9a",300:"#e57373",400:"#ef5350",500:"#f44336",600:"#e53935",700:"#d32f2f",800:"#c62828",900:"#b71c1c",a100:"#ff8a80",a200:"#ff5252",a400:"#ff1744",a700:"#d50000"},oa={50:"#fce4ec",100:"#f8bbd0",200:"#f48fb1",300:"#f06292",400:"#ec407a",500:"#e91e63",600:"#d81b60",700:"#c2185b",800:"#ad1457",900:"#880e4f",a100:"#ff80ab",a200:"#ff4081",a400:"#f50057",a700:"#c51162"},ia={50:"#f3e5f5",100:"#e1bee7",200:"#ce93d8",300:"#ba68c8",400:"#ab47bc",500:"#9c27b0",600:"#8e24aa",700:"#7b1fa2",800:"#6a1b9a",900:"#4a148c",a100:"#ea80fc",a200:"#e040fb",a400:"#d500f9",a700:"#aa00ff"},aa={50:"#ede7f6",100:"#d1c4e9",200:"#b39ddb",300:"#9575cd",400:"#7e57c2",500:"#673ab7",600:"#5e35b1",700:"#512da8",800:"#4527a0",900:"#311b92",a100:"#b388ff",a200:"#7c4dff",a400:"#651fff",a700:"#6200ea"},ra={50:"#e8eaf6",100:"#c5cae9",200:"#9fa8da",300:"#7986cb",400:"#5c6bc0",500:"#3f51b5",600:"#3949ab",700:"#303f9f",800:"#283593",900:"#1a237e",a100:"#8c9eff",a200:"#536dfe",a400:"#3d5afe",a700:"#304ffe"},sa={50:"#e3f2fd",100:"#bbdefb",200:"#90caf9",300:"#64b5f6",400:"#42a5f5",500:"#2196f3",600:"#1e88e5",700:"#1976d2",800:"#1565c0",900:"#0d47a1",a100:"#82b1ff",a200:"#448aff",a400:"#2979ff",a700:"#2962ff"},la={50:"#e1f5fe",100:"#b3e5fc",200:"#81d4fa",300:"#4fc3f7",400:"#29b6f6",500:"#03a9f4",600:"#039be5",700:"#0288d1",800:"#0277bd",900:"#01579b",a100:"#80d8ff",a200:"#40c4ff",a400:"#00b0ff",a700:"#0091ea"},da={50:"#e0f7fa",100:"#b2ebf2",200:"#80deea",300:"#4dd0e1",400:"#26c6da",500:"#00bcd4",600:"#00acc1",700:"#0097a7",800:"#00838f",900:"#006064",a100:"#84ffff",a200:"#18ffff",a400:"#00e5ff",a700:"#00b8d4"},ca={50:"#e0f2f1",100:"#b2dfdb",200:"#80cbc4",300:"#4db6ac",400:"#26a69a",500:"#009688",600:"#00897b",700:"#00796b",800:"#00695c",900:"#004d40",a100:"#a7ffeb",a200:"#64ffda",a400:"#1de9b6",a700:"#00bfa5"},ha={50:"#e8f5e9",100:"#c8e6c9",200:"#a5d6a7",300:"#81c784",400:"#66bb6a",500:"#4caf50",600:"#43a047",700:"#388e3c",800:"#2e7d32",900:"#1b5e20",a100:"#b9f6ca",a200:"#69f0ae",a400:"#00e676",a700:"#00c853"},ua={50:"#f1f8e9",100:"#dcedc8",200:"#c5e1a5",300:"#aed581",400:"#9ccc65",500:"#8bc34a",600:"#7cb342",700:"#689f38",800:"#558b2f",900:"#33691e",a100:"#ccff90",a200:"#b2ff59",a400:"#76ff03",a700:"#64dd17"},ga={50:"#f9fbe7",100:"#f0f4c3",200:"#e6ee9c",300:"#dce775",400:"#d4e157",500:"#cddc39",600:"#c0ca33",700:"#afb42b",800:"#9e9d24",900:"#827717",a100:"#f4ff81",a200:"#eeff41",a400:"#c6ff00",a700:"#aeea00"},pa={50:"#fffde7",100:"#fff9c4",200:"#fff59d",300:"#fff176",400:"#ffee58",500:"#ffeb3b",600:"#fdd835",700:"#fbc02d",800:"#f9a825",900:"#f57f17",a100:"#ffff8d",a200:"#ffff00",a400:"#ffea00",a700:"#ffd600"},va={50:"#fff8e1",100:"#ffecb3",200:"#ffe082",300:"#ffd54f",400:"#ffca28",500:"#ffc107",600:"#ffb300",700:"#ffa000",800:"#ff8f00",900:"#ff6f00",a100:"#ffe57f",a200:"#ffd740",a400:"#ffc400",a700:"#ffab00"},fa={50:"#fff3e0",100:"#ffe0b2",200:"#ffcc80",300:"#ffb74d",400:"#ffa726",500:"#ff9800",600:"#fb8c00",700:"#f57c00",800:"#ef6c00",900:"#e65100",a100:"#ffd180",a200:"#ffab40",a400:"#ff9100",a700:"#ff6d00"},ma={50:"#fbe9e7",100:"#ffccbc",200:"#ffab91",300:"#ff8a65",400:"#ff7043",500:"#ff5722",600:"#f4511e",700:"#e64a19",800:"#d84315",900:"#bf360c",a100:"#ff9e80",a200:"#ff6e40",a400:"#ff3d00",a700:"#dd2c00"},wa={50:"#efebe9",100:"#d7ccc8",200:"#bcaaa4",300:"#a1887f",400:"#8d6e63",500:"#795548",600:"#6d4c41",700:"#5d4037",800:"#4e342e",900:"#3e2723"},Ea={50:"#eceff1",100:"#cfd8dc",200:"#b0bec5",300:"#90a4ae",400:"#78909c",500:"#607d8b",600:"#546e7a",700:"#455a64",800:"#37474f",900:"#263238"};var ba=function(e){var t=e.color,n=e.onClick,a=e.onSwatchHover,r=e.hover,s=e.active,l=e.circleSize,d=e.circleSpacing,c=(0,i.Ay)({default:{swatch:{width:l,height:l,marginRight:d,marginBottom:d,transform:"scale(1)",transition:"100ms transform ease"},Swatch:{borderRadius:"50%",background:"transparent",boxShadow:"inset 0 0 0 "+(l/2+1)+"px "+t,transition:"100ms box-shadow ease"}},hover:{swatch:{transform:"scale(1.2)"}},active:{Swatch:{boxShadow:"inset 0 0 0 3px "+t}}},{hover:r,active:s});return o.createElement("div",{style:c.swatch},o.createElement(Do,{style:c.Swatch,color:t,onClick:n,onHover:a,focusStyle:{boxShadow:c.Swatch.boxShadow+", 0 0 5px "+t}}))};ba.defaultProps={circleSize:28,circleSpacing:14};const ya=(0,i.H8)(ba);var Ia=function(e){var t=e.width,n=e.onChange,a=e.onSwatchHover,r=e.colors,s=e.hex,l=e.circleSize,d=e.styles,c=void 0===d?{}:d,h=e.circleSpacing,u=e.className,g=void 0===u?"":u,p=(0,i.Ay)(an({default:{card:{width:t,display:"flex",flexWrap:"wrap",marginRight:-h,marginBottom:-h}}},c)),v=function(e,t){return n({hex:e,source:"hex"},t)};return o.createElement("div",{style:p.card,className:"circle-picker "+g},Qi(r,(function(e){return o.createElement(ya,{key:e,color:e,onClick:v,onSwatchHover:a,active:s===e.toLowerCase(),circleSize:l,circleSpacing:h})})))};Ia.propTypes={width:I().oneOfType([I().string,I().number]),circleSize:I().number,circleSpacing:I().number,styles:I().object},Ia.defaultProps={width:252,circleSize:28,circleSpacing:14,colors:[na[500],oa[500],ia[500],aa[500],ra[500],sa[500],la[500],da[500],ca[500],ha[500],ua[500],ga[500],pa[500],va[500],fa[500],ma[500],wa[500],Ea[500]],styles:{}};_o(Ia);const _a=function(e){return void 0===e};var Ca=n(69767),Ta=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var Sa=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.toggleViews=function(){"hex"===n.state.view?n.setState({view:"rgb"}):"rgb"===n.state.view?n.setState({view:"hsl"}):"hsl"===n.state.view&&(1===n.props.hsl.a?n.setState({view:"hex"}):n.setState({view:"rgb"}))},n.handleChange=function(e,t){e.hex?wo(e.hex)&&n.props.onChange({hex:e.hex,source:"hex"},t):e.r||e.g||e.b?n.props.onChange({r:e.r||n.props.rgb.r,g:e.g||n.props.rgb.g,b:e.b||n.props.rgb.b,source:"rgb"},t):e.a?(e.a<0?e.a=0:e.a>1&&(e.a=1),n.props.onChange({h:n.props.hsl.h,s:n.props.hsl.s,l:n.props.hsl.l,a:Math.round(100*e.a)/100,source:"rgb"},t)):(e.h||e.s||e.l)&&("string"==typeof e.s&&e.s.includes("%")&&(e.s=e.s.replace("%","")),"string"==typeof e.l&&e.l.includes("%")&&(e.l=e.l.replace("%","")),1==e.s?e.s=.01:1==e.l&&(e.l=.01),n.props.onChange({h:e.h||n.props.hsl.h,s:Number(_a(e.s)?n.props.hsl.s:e.s),l:Number(_a(e.l)?n.props.hsl.l:e.l),source:"hsl"},t))},n.showHighlight=function(e){e.currentTarget.style.background="#eee"},n.hideHighlight=function(e){e.currentTarget.style.background="transparent"},1!==e.hsl.a&&"hex"===e.view?n.state={view:"rgb"}:n.state={view:e.view},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),Ta(t,[{key:"render",value:function(){var e=this,t=(0,i.Ay)({default:{wrap:{paddingTop:"16px",display:"flex"},fields:{flex:"1",display:"flex",marginLeft:"-6px"},field:{paddingLeft:"6px",width:"100%"},alpha:{paddingLeft:"6px",width:"100%"},toggle:{width:"32px",textAlign:"right",position:"relative"},icon:{marginRight:"-4px",marginTop:"12px",cursor:"pointer",position:"relative"},iconHighlight:{position:"absolute",width:"24px",height:"28px",background:"#eee",borderRadius:"4px",top:"10px",left:"12px",display:"none"},input:{fontSize:"11px",color:"#333",width:"100%",borderRadius:"2px",border:"none",boxShadow:"inset 0 0 0 1px #dadada",height:"21px",textAlign:"center"},label:{textTransform:"uppercase",fontSize:"11px",lineHeight:"11px",color:"#969696",textAlign:"center",display:"block",marginTop:"12px"},svg:{fill:"#333",width:"24px",height:"24px",border:"1px transparent solid",borderRadius:"5px"}},disableAlpha:{alpha:{display:"none"}}},this.props,this.state),n=void 0;return"hex"===this.state.view?n=o.createElement("div",{style:t.fields,className:"flexbox-fix"},o.createElement("div",{style:t.field},o.createElement(m,{style:{input:t.input,label:t.label},label:"hex",value:this.props.hex,onChange:this.handleChange}))):"rgb"===this.state.view?n=o.createElement("div",{style:t.fields,className:"flexbox-fix"},o.createElement("div",{style:t.field},o.createElement(m,{style:{input:t.input,label:t.label},label:"r",value:this.props.rgb.r,onChange:this.handleChange})),o.createElement("div",{style:t.field},o.createElement(m,{style:{input:t.input,label:t.label},label:"g",value:this.props.rgb.g,onChange:this.handleChange})),o.createElement("div",{style:t.field},o.createElement(m,{style:{input:t.input,label:t.label},label:"b",value:this.props.rgb.b,onChange:this.handleChange})),o.createElement("div",{style:t.alpha},o.createElement(m,{style:{input:t.input,label:t.label},label:"a",value:this.props.rgb.a,arrowOffset:.01,onChange:this.handleChange}))):"hsl"===this.state.view&&(n=o.createElement("div",{style:t.fields,className:"flexbox-fix"},o.createElement("div",{style:t.field},o.createElement(m,{style:{input:t.input,label:t.label},label:"h",value:Math.round(this.props.hsl.h),onChange:this.handleChange})),o.createElement("div",{style:t.field},o.createElement(m,{style:{input:t.input,label:t.label},label:"s",value:Math.round(100*this.props.hsl.s)+"%",onChange:this.handleChange})),o.createElement("div",{style:t.field},o.createElement(m,{style:{input:t.input,label:t.label},label:"l",value:Math.round(100*this.props.hsl.l)+"%",onChange:this.handleChange})),o.createElement("div",{style:t.alpha},o.createElement(m,{style:{input:t.input,label:t.label},label:"a",value:this.props.hsl.a,arrowOffset:.01,onChange:this.handleChange})))),o.createElement("div",{style:t.wrap,className:"flexbox-fix"},n,o.createElement("div",{style:t.toggle},o.createElement("div",{style:t.icon,onClick:this.toggleViews,ref:function(t){return e.icon=t}},o.createElement(Ca.A,{style:t.svg,onMouseOver:this.showHighlight,onMouseEnter:this.showHighlight,onMouseOut:this.hideHighlight}))))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return 1!==e.hsl.a&&"hex"===t.view?{view:"rgb"}:null}}]),t}(o.Component);Sa.defaultProps={view:"hex"};const xa=Sa;const Da=function(){var e=(0,i.Ay)({default:{picker:{width:"12px",height:"12px",borderRadius:"6px",transform:"translate(-6px, -1px)",backgroundColor:"rgb(248, 248, 248)",boxShadow:"0 1px 4px 0 rgba(0, 0, 0, 0.37)"}}});return o.createElement("div",{style:e.picker})};const Aa=function(){var e=(0,i.Ay)({default:{picker:{width:"12px",height:"12px",borderRadius:"6px",boxShadow:"inset 0 0 0 1px #fff",transform:"translate(-6px, -6px)"}}});return o.createElement("div",{style:e.picker})};var Oa=function(e){var t=e.width,n=e.onChange,a=e.disableAlpha,r=e.rgb,s=e.hsl,l=e.hsv,c=e.hex,h=e.renderers,u=e.styles,p=void 0===u?{}:u,v=e.className,f=void 0===v?"":v,m=e.defaultView,w=(0,i.Ay)(an({default:{picker:{width:t,background:"#fff",borderRadius:"2px",boxShadow:"0 0 2px rgba(0,0,0,.3), 0 4px 8px rgba(0,0,0,.3)",boxSizing:"initial",fontFamily:"Menlo"},saturation:{width:"100%",paddingBottom:"55%",position:"relative",borderRadius:"2px 2px 0 0",overflow:"hidden"},Saturation:{radius:"2px 2px 0 0"},body:{padding:"16px 16px 12px"},controls:{display:"flex"},color:{width:"32px"},swatch:{marginTop:"6px",width:"16px",height:"16px",borderRadius:"8px",position:"relative",overflow:"hidden"},active:{absolute:"0px 0px 0px 0px",borderRadius:"8px",boxShadow:"inset 0 0 0 1px rgba(0,0,0,.1)",background:"rgba("+r.r+", "+r.g+", "+r.b+", "+r.a+")",zIndex:"2"},toggles:{flex:"1"},hue:{height:"10px",position:"relative",marginBottom:"8px"},Hue:{radius:"2px"},alpha:{height:"10px",position:"relative"},Alpha:{radius:"2px"}},disableAlpha:{color:{width:"22px"},alpha:{display:"none"},hue:{marginBottom:"0px"},swatch:{width:"10px",height:"10px",marginTop:"0px"}}},p),{disableAlpha:a});return o.createElement("div",{style:w.picker,className:"chrome-picker "+f},o.createElement("div",{style:w.saturation},o.createElement(Tn,{style:w.Saturation,hsl:s,hsv:l,pointer:Aa,onChange:n})),o.createElement("div",{style:w.body},o.createElement("div",{style:w.controls,className:"flexbox-fix"},o.createElement("div",{style:w.color},o.createElement("div",{style:w.swatch},o.createElement("div",{style:w.active}),o.createElement(d,{renderers:h}))),o.createElement("div",{style:w.toggles},o.createElement("div",{style:w.hue},o.createElement(b,{style:w.Hue,hsl:s,pointer:Da,onChange:n})),o.createElement("div",{style:w.alpha},o.createElement(g,{style:w.Alpha,rgb:r,hsl:s,pointer:Da,renderers:h,onChange:n})))),o.createElement(xa,{rgb:r,hsl:s,hex:c,view:m,onChange:n,disableAlpha:a})))};Oa.propTypes={width:I().oneOfType([I().string,I().number]),disableAlpha:I().bool,styles:I().object,defaultView:I().oneOf(["hex","rgb","hsl"])},Oa.defaultProps={width:225,disableAlpha:!1,styles:{}};const Ma=_o(Oa);const Ra=function(e){var t=e.color,n=e.onClick,a=void 0===n?function(){}:n,r=e.onSwatchHover,s=e.active,l=(0,i.Ay)({default:{color:{background:t,width:"15px",height:"15px",float:"left",marginRight:"5px",marginBottom:"5px",position:"relative",cursor:"pointer"},dot:{absolute:"5px 5px 5px 5px",background:Eo(t),borderRadius:"50%",opacity:"0"}},active:{dot:{opacity:"1"}},"color-#FFFFFF":{color:{boxShadow:"inset 0 0 0 1px #ddd"},dot:{background:"#000"}},transparent:{dot:{background:"#000"}}},{active:s,"color-#FFFFFF":"#FFFFFF"===t,transparent:"transparent"===t});return o.createElement(Do,{style:l.color,color:t,onClick:a,onHover:r,focusStyle:{boxShadow:"0 0 4px "+t}},o.createElement("div",{style:l.dot}))};const ka=function(e){var t=e.hex,n=e.rgb,a=e.onChange,r=(0,i.Ay)({default:{fields:{display:"flex",paddingBottom:"6px",paddingRight:"5px",position:"relative"},active:{position:"absolute",top:"6px",left:"5px",height:"9px",width:"9px",background:t},HEXwrap:{flex:"6",position:"relative"},HEXinput:{width:"80%",padding:"0px",paddingLeft:"20%",border:"none",outline:"none",background:"none",fontSize:"12px",color:"#333",height:"16px"},HEXlabel:{display:"none"},RGBwrap:{flex:"3",position:"relative"},RGBinput:{width:"70%",padding:"0px",paddingLeft:"30%",border:"none",outline:"none",background:"none",fontSize:"12px",color:"#333",height:"16px"},RGBlabel:{position:"absolute",top:"3px",left:"0px",lineHeight:"16px",textTransform:"uppercase",fontSize:"12px",color:"#999"}}}),s=function(e,t){e.r||e.g||e.b?a({r:e.r||n.r,g:e.g||n.g,b:e.b||n.b,source:"rgb"},t):a({hex:e.hex,source:"hex"},t)};return o.createElement("div",{style:r.fields,className:"flexbox-fix"},o.createElement("div",{style:r.active}),o.createElement(m,{style:{wrap:r.HEXwrap,input:r.HEXinput,label:r.HEXlabel},label:"hex",value:t,onChange:s}),o.createElement(m,{style:{wrap:r.RGBwrap,input:r.RGBinput,label:r.RGBlabel},label:"r",value:n.r,onChange:s}),o.createElement(m,{style:{wrap:r.RGBwrap,input:r.RGBinput,label:r.RGBlabel},label:"g",value:n.g,onChange:s}),o.createElement(m,{style:{wrap:r.RGBwrap,input:r.RGBinput,label:r.RGBlabel},label:"b",value:n.b,onChange:s}))};var La=function(e){var t=e.onChange,n=e.onSwatchHover,a=e.colors,r=e.hex,s=e.rgb,l=e.styles,d=void 0===l?{}:l,c=e.className,h=void 0===c?"":c,u=(0,i.Ay)(an({default:{Compact:{background:"#f6f6f6",radius:"4px"},compact:{paddingTop:"5px",paddingLeft:"5px",boxSizing:"initial",width:"240px"},clear:{clear:"both"}}},d)),g=function(e,n){e.hex?wo(e.hex)&&t({hex:e.hex,source:"hex"},n):t(e,n)};return o.createElement(sn,{style:u.Compact,styles:d},o.createElement("div",{style:u.compact,className:"compact-picker "+h},o.createElement("div",null,Qi(a,(function(e){return o.createElement(Ra,{key:e,color:e,active:e.toLowerCase()===r,onClick:g,onSwatchHover:n})})),o.createElement("div",{style:u.clear})),o.createElement(ka,{hex:r,rgb:s,onChange:g})))};La.propTypes={colors:I().arrayOf(I().string),styles:I().object},La.defaultProps={colors:["#4D4D4D","#999999","#FFFFFF","#F44E3B","#FE9200","#FCDC00","#DBDF00","#A4DD00","#68CCCA","#73D8FF","#AEA1FF","#FDA1FF","#333333","#808080","#cccccc","#D33115","#E27300","#FCC400","#B0BC00","#68BC00","#16A5A5","#009CE0","#7B64FF","#FA28FF","#000000","#666666","#B3B3B3","#9F0500","#C45100","#FB9E00","#808900","#194D33","#0C797D","#0062B1","#653294","#AB149E"],styles:{}};_o(La);const Pa=(0,i.H8)((function(e){var t=e.hover,n=e.color,a=e.onClick,r=e.onSwatchHover,s={position:"relative",zIndex:"2",outline:"2px solid #fff",boxShadow:"0 0 5px 2px rgba(0,0,0,0.25)"},l=(0,i.Ay)({default:{swatch:{width:"25px",height:"25px",fontSize:"0"}},hover:{swatch:s}},{hover:t});return o.createElement("div",{style:l.swatch},o.createElement(Do,{color:n,onClick:a,onHover:r,focusStyle:s}))}));var Na=function(e){var t=e.width,n=e.colors,a=e.onChange,r=e.onSwatchHover,s=e.triangle,l=e.styles,d=void 0===l?{}:l,c=e.className,h=void 0===c?"":c,u=(0,i.Ay)(an({default:{card:{width:t,background:"#fff",border:"1px solid rgba(0,0,0,0.2)",boxShadow:"0 3px 12px rgba(0,0,0,0.15)",borderRadius:"4px",position:"relative",padding:"5px",display:"flex",flexWrap:"wrap"},triangle:{position:"absolute",border:"7px solid transparent",borderBottomColor:"#fff"},triangleShadow:{position:"absolute",border:"8px solid transparent",borderBottomColor:"rgba(0,0,0,0.15)"}},"hide-triangle":{triangle:{display:"none"},triangleShadow:{display:"none"}},"top-left-triangle":{triangle:{top:"-14px",left:"10px"},triangleShadow:{top:"-16px",left:"9px"}},"top-right-triangle":{triangle:{top:"-14px",right:"10px"},triangleShadow:{top:"-16px",right:"9px"}},"bottom-left-triangle":{triangle:{top:"35px",left:"10px",transform:"rotate(180deg)"},triangleShadow:{top:"37px",left:"9px",transform:"rotate(180deg)"}},"bottom-right-triangle":{triangle:{top:"35px",right:"10px",transform:"rotate(180deg)"},triangleShadow:{top:"37px",right:"9px",transform:"rotate(180deg)"}}},d),{"hide-triangle":"hide"===s,"top-left-triangle":"top-left"===s,"top-right-triangle":"top-right"===s,"bottom-left-triangle":"bottom-left"===s,"bottom-right-triangle":"bottom-right"===s}),g=function(e,t){return a({hex:e,source:"hex"},t)};return o.createElement("div",{style:u.card,className:"github-picker "+h},o.createElement("div",{style:u.triangleShadow}),o.createElement("div",{style:u.triangle}),Qi(n,(function(e){return o.createElement(Pa,{color:e,key:e,onClick:g,onSwatchHover:r})})))};Na.propTypes={width:I().oneOfType([I().string,I().number]),colors:I().arrayOf(I().string),triangle:I().oneOf(["hide","top-left","top-right","bottom-left","bottom-right"]),styles:I().object},Na.defaultProps={width:200,colors:["#B80000","#DB3E00","#FCCB00","#008B02","#006B76","#1273DE","#004DCF","#5300EB","#EB9694","#FAD0C3","#FEF3BD","#C1E1C5","#BEDADC","#C4DEF6","#BED3F3","#D4C4FB"],triangle:"top-left",styles:{}};_o(Na);const Ua=function(e){var t=e.direction,n=(0,i.Ay)({default:{picker:{width:"18px",height:"18px",borderRadius:"50%",transform:"translate(-9px, -1px)",backgroundColor:"rgb(248, 248, 248)",boxShadow:"0 1px 4px 0 rgba(0, 0, 0, 0.37)"}},vertical:{picker:{transform:"translate(-3px, -9px)"}}},{vertical:"vertical"===t});return o.createElement("div",{style:n.picker})};var Va=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},Ba=function(e){var t=e.width,n=e.height,a=e.onChange,r=e.hsl,s=e.direction,l=e.pointer,d=e.styles,c=void 0===d?{}:d,h=e.className,u=void 0===h?"":h,g=(0,i.Ay)(an({default:{picker:{position:"relative",width:t,height:n},hue:{radius:"2px"}}},c));return o.createElement("div",{style:g.picker,className:"hue-picker "+u},o.createElement(b,Va({},g.hue,{hsl:r,pointer:l,onChange:function(e){return a({a:1,h:e.h,l:.5,s:1})},direction:s})))};Ba.propTypes={styles:I().object},Ba.defaultProps={width:"316px",height:"16px",direction:"horizontal",pointer:Ua,styles:{}};_o(Ba);_o((function(e){var t=e.onChange,n=e.hex,a=e.rgb,r=e.styles,s=void 0===r?{}:r,l=e.className,d=void 0===l?"":l,c=(0,i.Ay)(an({default:{material:{width:"98px",height:"98px",padding:"16px",fontFamily:"Roboto"},HEXwrap:{position:"relative"},HEXinput:{width:"100%",marginTop:"12px",fontSize:"15px",color:"#333",padding:"0px",border:"0px",borderBottom:"2px solid "+n,outline:"none",height:"30px"},HEXlabel:{position:"absolute",top:"0px",left:"0px",fontSize:"11px",color:"#999999",textTransform:"capitalize"},Hex:{style:{}},RGBwrap:{position:"relative"},RGBinput:{width:"100%",marginTop:"12px",fontSize:"15px",color:"#333",padding:"0px",border:"0px",borderBottom:"1px solid #eee",outline:"none",height:"30px"},RGBlabel:{position:"absolute",top:"0px",left:"0px",fontSize:"11px",color:"#999999",textTransform:"capitalize"},split:{display:"flex",marginRight:"-10px",paddingTop:"11px"},third:{flex:"1",paddingRight:"10px"}}},s)),h=function(e,n){e.hex?wo(e.hex)&&t({hex:e.hex,source:"hex"},n):(e.r||e.g||e.b)&&t({r:e.r||a.r,g:e.g||a.g,b:e.b||a.b,source:"rgb"},n)};return o.createElement(sn,{styles:s},o.createElement("div",{style:c.material,className:"material-picker "+d},o.createElement(m,{style:{wrap:c.HEXwrap,input:c.HEXinput,label:c.HEXlabel},label:"hex",value:n,onChange:h}),o.createElement("div",{style:c.split,className:"flexbox-fix"},o.createElement("div",{style:c.third},o.createElement(m,{style:{wrap:c.RGBwrap,input:c.RGBinput,label:c.RGBlabel},label:"r",value:a.r,onChange:h})),o.createElement("div",{style:c.third},o.createElement(m,{style:{wrap:c.RGBwrap,input:c.RGBinput,label:c.RGBlabel},label:"g",value:a.g,onChange:h})),o.createElement("div",{style:c.third},o.createElement(m,{style:{wrap:c.RGBwrap,input:c.RGBinput,label:c.RGBlabel},label:"b",value:a.b,onChange:h})))))}));const Ha=function(e){var t=e.onChange,n=e.rgb,a=e.hsv,r=e.hex,s=(0,i.Ay)({default:{fields:{paddingTop:"5px",paddingBottom:"9px",width:"80px",position:"relative"},divider:{height:"5px"},RGBwrap:{position:"relative"},RGBinput:{marginLeft:"40%",width:"40%",height:"18px",border:"1px solid #888888",boxShadow:"inset 0 1px 1px rgba(0,0,0,.1), 0 1px 0 0 #ECECEC",marginBottom:"5px",fontSize:"13px",paddingLeft:"3px",marginRight:"10px"},RGBlabel:{left:"0px",top:"0px",width:"34px",textTransform:"uppercase",fontSize:"13px",height:"18px",lineHeight:"22px",position:"absolute"},HEXwrap:{position:"relative"},HEXinput:{marginLeft:"20%",width:"80%",height:"18px",border:"1px solid #888888",boxShadow:"inset 0 1px 1px rgba(0,0,0,.1), 0 1px 0 0 #ECECEC",marginBottom:"6px",fontSize:"13px",paddingLeft:"3px"},HEXlabel:{position:"absolute",top:"0px",left:"0px",width:"14px",textTransform:"uppercase",fontSize:"13px",height:"18px",lineHeight:"22px"},fieldSymbols:{position:"absolute",top:"5px",right:"-7px",fontSize:"13px"},symbol:{height:"20px",lineHeight:"22px",paddingBottom:"7px"}}}),l=function(e,o){e["#"]?wo(e["#"])&&t({hex:e["#"],source:"hex"},o):e.r||e.g||e.b?t({r:e.r||n.r,g:e.g||n.g,b:e.b||n.b,source:"rgb"},o):(e.h||e.s||e.v)&&t({h:e.h||a.h,s:e.s||a.s,v:e.v||a.v,source:"hsv"},o)};return o.createElement("div",{style:s.fields},o.createElement(m,{style:{wrap:s.RGBwrap,input:s.RGBinput,label:s.RGBlabel},label:"h",value:Math.round(a.h),onChange:l}),o.createElement(m,{style:{wrap:s.RGBwrap,input:s.RGBinput,label:s.RGBlabel},label:"s",value:Math.round(100*a.s),onChange:l}),o.createElement(m,{style:{wrap:s.RGBwrap,input:s.RGBinput,label:s.RGBlabel},label:"v",value:Math.round(100*a.v),onChange:l}),o.createElement("div",{style:s.divider}),o.createElement(m,{style:{wrap:s.RGBwrap,input:s.RGBinput,label:s.RGBlabel},label:"r",value:n.r,onChange:l}),o.createElement(m,{style:{wrap:s.RGBwrap,input:s.RGBinput,label:s.RGBlabel},label:"g",value:n.g,onChange:l}),o.createElement(m,{style:{wrap:s.RGBwrap,input:s.RGBinput,label:s.RGBlabel},label:"b",value:n.b,onChange:l}),o.createElement("div",{style:s.divider}),o.createElement(m,{style:{wrap:s.HEXwrap,input:s.HEXinput,label:s.HEXlabel},label:"#",value:r.replace("#",""),onChange:l}),o.createElement("div",{style:s.fieldSymbols},o.createElement("div",{style:s.symbol},"°"),o.createElement("div",{style:s.symbol},"%"),o.createElement("div",{style:s.symbol},"%")))};const Wa=function(e){var t=e.hsl,n=(0,i.Ay)({default:{picker:{width:"12px",height:"12px",borderRadius:"6px",boxShadow:"inset 0 0 0 1px #fff",transform:"translate(-6px, -6px)"}},"black-outline":{picker:{boxShadow:"inset 0 0 0 1px #000"}}},{"black-outline":t.l>.5});return o.createElement("div",{style:n.picker})};const Fa=function(){var e=(0,i.Ay)({default:{triangle:{width:0,height:0,borderStyle:"solid",borderWidth:"4px 0 4px 6px",borderColor:"transparent transparent transparent #fff",position:"absolute",top:"1px",left:"1px"},triangleBorder:{width:0,height:0,borderStyle:"solid",borderWidth:"5px 0 5px 8px",borderColor:"transparent transparent transparent #555"},left:{Extend:"triangleBorder",transform:"translate(-13px, -4px)"},leftInside:{Extend:"triangle",transform:"translate(-8px, -5px)"},right:{Extend:"triangleBorder",transform:"translate(20px, -14px) rotate(180deg)"},rightInside:{Extend:"triangle",transform:"translate(-8px, -5px)"}}});return o.createElement("div",{style:e.pointer},o.createElement("div",{style:e.left},o.createElement("div",{style:e.leftInside})),o.createElement("div",{style:e.right},o.createElement("div",{style:e.rightInside})))};const ja=function(e){var t=e.onClick,n=e.label,a=e.children,r=e.active,s=(0,i.Ay)({default:{button:{backgroundImage:"linear-gradient(-180deg, #FFFFFF 0%, #E6E6E6 100%)",border:"1px solid #878787",borderRadius:"2px",height:"20px",boxShadow:"0 1px 0 0 #EAEAEA",fontSize:"14px",color:"#000",lineHeight:"20px",textAlign:"center",marginBottom:"10px",cursor:"pointer"}},active:{button:{boxShadow:"0 0 0 1px #878787"}}},{active:r});return o.createElement("div",{style:s.button,onClick:t},n||a)};const Ga=function(e){var t=e.rgb,n=e.currentColor,a=(0,i.Ay)({default:{swatches:{border:"1px solid #B3B3B3",borderBottom:"1px solid #F0F0F0",marginBottom:"2px",marginTop:"1px"},new:{height:"34px",background:"rgb("+t.r+","+t.g+", "+t.b+")",boxShadow:"inset 1px 0 0 #000, inset -1px 0 0 #000, inset 0 1px 0 #000"},current:{height:"34px",background:n,boxShadow:"inset 1px 0 0 #000, inset -1px 0 0 #000, inset 0 -1px 0 #000"},label:{fontSize:"14px",color:"#000",textAlign:"center"}}});return o.createElement("div",null,o.createElement("div",{style:a.label},"new"),o.createElement("div",{style:a.swatches},o.createElement("div",{style:a.new}),o.createElement("div",{style:a.current})),o.createElement("div",{style:a.label},"current"))};var $a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var za=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.state={currentColor:e.hex},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),$a(t,[{key:"render",value:function(){var e=this.props,t=e.styles,n=void 0===t?{}:t,a=e.className,r=void 0===a?"":a,s=(0,i.Ay)(an({default:{picker:{background:"#DCDCDC",borderRadius:"4px",boxShadow:"0 0 0 1px rgba(0,0,0,.25), 0 8px 16px rgba(0,0,0,.15)",boxSizing:"initial",width:"513px"},head:{backgroundImage:"linear-gradient(-180deg, #F0F0F0 0%, #D4D4D4 100%)",borderBottom:"1px solid #B1B1B1",boxShadow:"inset 0 1px 0 0 rgba(255,255,255,.2), inset 0 -1px 0 0 rgba(0,0,0,.02)",height:"23px",lineHeight:"24px",borderRadius:"4px 4px 0 0",fontSize:"13px",color:"#4D4D4D",textAlign:"center"},body:{padding:"15px 15px 0",display:"flex"},saturation:{width:"256px",height:"256px",position:"relative",border:"2px solid #B3B3B3",borderBottom:"2px solid #F0F0F0",overflow:"hidden"},hue:{position:"relative",height:"256px",width:"19px",marginLeft:"10px",border:"2px solid #B3B3B3",borderBottom:"2px solid #F0F0F0"},controls:{width:"180px",marginLeft:"10px"},top:{display:"flex"},previews:{width:"60px"},actions:{flex:"1",marginLeft:"20px"}}},n));return o.createElement("div",{style:s.picker,className:"photoshop-picker "+r},o.createElement("div",{style:s.head},this.props.header),o.createElement("div",{style:s.body,className:"flexbox-fix"},o.createElement("div",{style:s.saturation},o.createElement(Tn,{hsl:this.props.hsl,hsv:this.props.hsv,pointer:Wa,onChange:this.props.onChange})),o.createElement("div",{style:s.hue},o.createElement(b,{direction:"vertical",hsl:this.props.hsl,pointer:Fa,onChange:this.props.onChange})),o.createElement("div",{style:s.controls},o.createElement("div",{style:s.top,className:"flexbox-fix"},o.createElement("div",{style:s.previews},o.createElement(Ga,{rgb:this.props.rgb,currentColor:this.state.currentColor})),o.createElement("div",{style:s.actions},o.createElement(ja,{label:"OK",onClick:this.props.onAccept,active:!0}),o.createElement(ja,{label:"Cancel",onClick:this.props.onCancel}),o.createElement(Ha,{onChange:this.props.onChange,rgb:this.props.rgb,hsv:this.props.hsv,hex:this.props.hex}))))))}}]),t}(o.Component);za.propTypes={header:I().string,styles:I().object},za.defaultProps={header:"Color Picker",styles:{}};_o(za);const qa=function(e){var t=e.onChange,n=e.rgb,a=e.hsl,r=e.hex,s=e.disableAlpha,l=(0,i.Ay)({default:{fields:{display:"flex",paddingTop:"4px"},single:{flex:"1",paddingLeft:"6px"},alpha:{flex:"1",paddingLeft:"6px"},double:{flex:"2"},input:{width:"80%",padding:"4px 10% 3px",border:"none",boxShadow:"inset 0 0 0 1px #ccc",fontSize:"11px"},label:{display:"block",textAlign:"center",fontSize:"11px",color:"#222",paddingTop:"3px",paddingBottom:"4px",textTransform:"capitalize"}},disableAlpha:{alpha:{display:"none"}}},{disableAlpha:s}),d=function(e,o){e.hex?wo(e.hex)&&t({hex:e.hex,source:"hex"},o):e.r||e.g||e.b?t({r:e.r||n.r,g:e.g||n.g,b:e.b||n.b,a:n.a,source:"rgb"},o):e.a&&(e.a<0?e.a=0:e.a>100&&(e.a=100),e.a/=100,t({h:a.h,s:a.s,l:a.l,a:e.a,source:"rgb"},o))};return o.createElement("div",{style:l.fields,className:"flexbox-fix"},o.createElement("div",{style:l.double},o.createElement(m,{style:{input:l.input,label:l.label},label:"hex",value:r.replace("#",""),onChange:d})),o.createElement("div",{style:l.single},o.createElement(m,{style:{input:l.input,label:l.label},label:"r",value:n.r,onChange:d,dragLabel:"true",dragMax:"255"})),o.createElement("div",{style:l.single},o.createElement(m,{style:{input:l.input,label:l.label},label:"g",value:n.g,onChange:d,dragLabel:"true",dragMax:"255"})),o.createElement("div",{style:l.single},o.createElement(m,{style:{input:l.input,label:l.label},label:"b",value:n.b,onChange:d,dragLabel:"true",dragMax:"255"})),o.createElement("div",{style:l.alpha},o.createElement(m,{style:{input:l.input,label:l.label},label:"a",value:Math.round(100*n.a),onChange:d,dragLabel:"true",dragMax:"100"})))};var Za=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},Ka=function(e){var t=e.colors,n=e.onClick,a=void 0===n?function(){}:n,r=e.onSwatchHover,s=(0,i.Ay)({default:{colors:{margin:"0 -10px",padding:"10px 0 0 10px",borderTop:"1px solid #eee",display:"flex",flexWrap:"wrap",position:"relative"},swatchWrap:{width:"16px",height:"16px",margin:"0 10px 10px 0"},swatch:{borderRadius:"3px",boxShadow:"inset 0 0 0 1px rgba(0,0,0,.15)"}},"no-presets":{colors:{display:"none"}}},{"no-presets":!t||!t.length}),l=function(e,t){a({hex:e,source:"hex"},t)};return o.createElement("div",{style:s.colors,className:"flexbox-fix"},t.map((function(e){var t="string"==typeof e?{color:e}:e,n=""+t.color+(t.title||"");return o.createElement("div",{key:n,style:s.swatchWrap},o.createElement(Do,Za({},t,{style:s.swatch,onClick:l,onHover:r,focusStyle:{boxShadow:"inset 0 0 0 1px rgba(0,0,0,.15), 0 0 4px "+t.color}})))})))};Ka.propTypes={colors:I().arrayOf(I().oneOfType([I().string,I().shape({color:I().string,title:I().string})])).isRequired};const Ya=Ka;var Xa=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},Ja=function(e){var t=e.width,n=e.rgb,a=e.hex,r=e.hsv,s=e.hsl,l=e.onChange,c=e.onSwatchHover,h=e.disableAlpha,u=e.presetColors,p=e.renderers,v=e.styles,f=void 0===v?{}:v,m=e.className,w=void 0===m?"":m,E=(0,i.Ay)(an({default:Xa({picker:{width:t,padding:"10px 10px 0",boxSizing:"initial",background:"#fff",borderRadius:"4px",boxShadow:"0 0 0 1px rgba(0,0,0,.15), 0 8px 16px rgba(0,0,0,.15)"},saturation:{width:"100%",paddingBottom:"75%",position:"relative",overflow:"hidden"},Saturation:{radius:"3px",shadow:"inset 0 0 0 1px rgba(0,0,0,.15), inset 0 0 4px rgba(0,0,0,.25)"},controls:{display:"flex"},sliders:{padding:"4px 0",flex:"1"},color:{width:"24px",height:"24px",position:"relative",marginTop:"4px",marginLeft:"4px",borderRadius:"3px"},activeColor:{absolute:"0px 0px 0px 0px",borderRadius:"2px",background:"rgba("+n.r+","+n.g+","+n.b+","+n.a+")",boxShadow:"inset 0 0 0 1px rgba(0,0,0,.15), inset 0 0 4px rgba(0,0,0,.25)"},hue:{position:"relative",height:"10px",overflow:"hidden"},Hue:{radius:"2px",shadow:"inset 0 0 0 1px rgba(0,0,0,.15), inset 0 0 4px rgba(0,0,0,.25)"},alpha:{position:"relative",height:"10px",marginTop:"4px",overflow:"hidden"},Alpha:{radius:"2px",shadow:"inset 0 0 0 1px rgba(0,0,0,.15), inset 0 0 4px rgba(0,0,0,.25)"}},f),disableAlpha:{color:{height:"10px"},hue:{height:"10px"},alpha:{display:"none"}}},f),{disableAlpha:h});return o.createElement("div",{style:E.picker,className:"sketch-picker "+w},o.createElement("div",{style:E.saturation},o.createElement(Tn,{style:E.Saturation,hsl:s,hsv:r,onChange:l})),o.createElement("div",{style:E.controls,className:"flexbox-fix"},o.createElement("div",{style:E.sliders},o.createElement("div",{style:E.hue},o.createElement(b,{style:E.Hue,hsl:s,onChange:l})),o.createElement("div",{style:E.alpha},o.createElement(g,{style:E.Alpha,rgb:n,hsl:s,renderers:p,onChange:l}))),o.createElement("div",{style:E.color},o.createElement(d,null),o.createElement("div",{style:E.activeColor}))),o.createElement(qa,{rgb:n,hsl:s,hex:a,onChange:l,disableAlpha:h}),o.createElement(Ya,{colors:u,onClick:l,onSwatchHover:c}))};Ja.propTypes={disableAlpha:I().bool,width:I().oneOfType([I().string,I().number]),styles:I().object},Ja.defaultProps={disableAlpha:!1,width:200,styles:{},presetColors:["#D0021B","#F5A623","#F8E71C","#8B572A","#7ED321","#417505","#BD10E0","#9013FE","#4A90E2","#50E3C2","#B8E986","#000000","#4A4A4A","#9B9B9B","#FFFFFF"]};_o(Ja);const Qa=function(e){var t=e.hsl,n=e.offset,a=e.onClick,r=void 0===a?function(){}:a,s=e.active,l=e.first,d=e.last,c=(0,i.Ay)({default:{swatch:{height:"12px",background:"hsl("+t.h+", 50%, "+100*n+"%)",cursor:"pointer"}},first:{swatch:{borderRadius:"2px 0 0 2px"}},last:{swatch:{borderRadius:"0 2px 2px 0"}},active:{swatch:{transform:"scaleY(1.8)",borderRadius:"3.6px/2px"}}},{active:s,first:l,last:d});return o.createElement("div",{style:c.swatch,onClick:function(e){return r({h:t.h,s:.5,l:n,source:"hsl"},e)}})};const er=function(e){var t=e.onClick,n=e.hsl,a=(0,i.Ay)({default:{swatches:{marginTop:"20px"},swatch:{boxSizing:"border-box",width:"20%",paddingRight:"1px",float:"left"},clear:{clear:"both"}}}),r=.1;return o.createElement("div",{style:a.swatches},o.createElement("div",{style:a.swatch},o.createElement(Qa,{hsl:n,offset:".80",active:Math.abs(n.l-.8)<r&&Math.abs(n.s-.5)<r,onClick:t,first:!0})),o.createElement("div",{style:a.swatch},o.createElement(Qa,{hsl:n,offset:".65",active:Math.abs(n.l-.65)<r&&Math.abs(n.s-.5)<r,onClick:t})),o.createElement("div",{style:a.swatch},o.createElement(Qa,{hsl:n,offset:".50",active:Math.abs(n.l-.5)<r&&Math.abs(n.s-.5)<r,onClick:t})),o.createElement("div",{style:a.swatch},o.createElement(Qa,{hsl:n,offset:".35",active:Math.abs(n.l-.35)<r&&Math.abs(n.s-.5)<r,onClick:t})),o.createElement("div",{style:a.swatch},o.createElement(Qa,{hsl:n,offset:".20",active:Math.abs(n.l-.2)<r&&Math.abs(n.s-.5)<r,onClick:t,last:!0})),o.createElement("div",{style:a.clear}))};const tr=function(){var e=(0,i.Ay)({default:{picker:{width:"14px",height:"14px",borderRadius:"6px",transform:"translate(-7px, -1px)",backgroundColor:"rgb(248, 248, 248)",boxShadow:"0 1px 4px 0 rgba(0, 0, 0, 0.37)"}}});return o.createElement("div",{style:e.picker})};var nr=function(e){var t=e.hsl,n=e.onChange,a=e.pointer,r=e.styles,s=void 0===r?{}:r,l=e.className,d=void 0===l?"":l,c=(0,i.Ay)(an({default:{hue:{height:"12px",position:"relative"},Hue:{radius:"2px"}}},s));return o.createElement("div",{style:c.wrap||{},className:"slider-picker "+d},o.createElement("div",{style:c.hue},o.createElement(b,{style:c.Hue,hsl:t,pointer:a,onChange:n})),o.createElement("div",{style:c.swatches},o.createElement(er,{hsl:t,onClick:n})))};nr.propTypes={styles:I().object},nr.defaultProps={pointer:tr,styles:{}};_o(nr);var or=n(81810);const ir=function(e){var t=e.color,n=e.onClick,a=void 0===n?function(){}:n,r=e.onSwatchHover,s=e.first,l=e.last,d=e.active,c=(0,i.Ay)({default:{color:{width:"40px",height:"24px",cursor:"pointer",background:t,marginBottom:"1px"},check:{color:Eo(t),marginLeft:"8px",display:"none"}},first:{color:{overflow:"hidden",borderRadius:"2px 2px 0 0"}},last:{color:{overflow:"hidden",borderRadius:"0 0 2px 2px"}},active:{check:{display:"block"}},"color-#FFFFFF":{color:{boxShadow:"inset 0 0 0 1px #ddd"},check:{color:"#333"}},transparent:{check:{color:"#333"}}},{first:s,last:l,active:d,"color-#FFFFFF":"#FFFFFF"===t,transparent:"transparent"===t});return o.createElement(Do,{color:t,style:c.color,onClick:a,onHover:r,focusStyle:{boxShadow:"0 0 4px "+t}},o.createElement("div",{style:c.check},o.createElement(or.A,null)))};const ar=function(e){var t=e.onClick,n=e.onSwatchHover,a=e.group,r=e.active,s=(0,i.Ay)({default:{group:{paddingBottom:"10px",width:"40px",float:"left",marginRight:"10px"}}});return o.createElement("div",{style:s.group},Qi(a,(function(e,i){return o.createElement(ir,{key:e,color:e,active:e.toLowerCase()===r,first:0===i,last:i===a.length-1,onClick:t,onSwatchHover:n})})))};var rr=function(e){var t=e.width,n=e.height,a=e.onChange,r=e.onSwatchHover,s=e.colors,l=e.hex,d=e.styles,c=void 0===d?{}:d,h=e.className,u=void 0===h?"":h,g=(0,i.Ay)(an({default:{picker:{width:t,height:n},overflow:{height:n,overflowY:"scroll"},body:{padding:"16px 0 6px 16px"},clear:{clear:"both"}}},c)),p=function(e,t){return a({hex:e,source:"hex"},t)};return o.createElement("div",{style:g.picker,className:"swatches-picker "+u},o.createElement(sn,null,o.createElement("div",{style:g.overflow},o.createElement("div",{style:g.body},Qi(s,(function(e){return o.createElement(ar,{key:e.toString(),group:e,active:l,onClick:p,onSwatchHover:r})})),o.createElement("div",{style:g.clear})))))};rr.propTypes={width:I().oneOfType([I().string,I().number]),height:I().oneOfType([I().string,I().number]),colors:I().arrayOf(I().arrayOf(I().string)),styles:I().object},rr.defaultProps={width:320,height:240,colors:[[na[900],na[700],na[500],na[300],na[100]],[oa[900],oa[700],oa[500],oa[300],oa[100]],[ia[900],ia[700],ia[500],ia[300],ia[100]],[aa[900],aa[700],aa[500],aa[300],aa[100]],[ra[900],ra[700],ra[500],ra[300],ra[100]],[sa[900],sa[700],sa[500],sa[300],sa[100]],[la[900],la[700],la[500],la[300],la[100]],[da[900],da[700],da[500],da[300],da[100]],[ca[900],ca[700],ca[500],ca[300],ca[100]],["#194D33",ha[700],ha[500],ha[300],ha[100]],[ua[900],ua[700],ua[500],ua[300],ua[100]],[ga[900],ga[700],ga[500],ga[300],ga[100]],[pa[900],pa[700],pa[500],pa[300],pa[100]],[va[900],va[700],va[500],va[300],va[100]],[fa[900],fa[700],fa[500],fa[300],fa[100]],[ma[900],ma[700],ma[500],ma[300],ma[100]],[wa[900],wa[700],wa[500],wa[300],wa[100]],[Ea[900],Ea[700],Ea[500],Ea[300],Ea[100]],["#000000","#525252","#969696","#D9D9D9","#FFFFFF"]],styles:{}};_o(rr);var sr=function(e){var t=e.onChange,n=e.onSwatchHover,a=e.hex,r=e.colors,s=e.width,l=e.triangle,d=e.styles,c=void 0===d?{}:d,h=e.className,u=void 0===h?"":h,g=(0,i.Ay)(an({default:{card:{width:s,background:"#fff",border:"0 solid rgba(0,0,0,0.25)",boxShadow:"0 1px 4px rgba(0,0,0,0.25)",borderRadius:"4px",position:"relative"},body:{padding:"15px 9px 9px 15px"},label:{fontSize:"18px",color:"#fff"},triangle:{width:"0px",height:"0px",borderStyle:"solid",borderWidth:"0 9px 10px 9px",borderColor:"transparent transparent #fff transparent",position:"absolute"},triangleShadow:{width:"0px",height:"0px",borderStyle:"solid",borderWidth:"0 9px 10px 9px",borderColor:"transparent transparent rgba(0,0,0,.1) transparent",position:"absolute"},hash:{background:"#F0F0F0",height:"30px",width:"30px",borderRadius:"4px 0 0 4px",float:"left",color:"#98A1A4",display:"flex",alignItems:"center",justifyContent:"center"},input:{width:"100px",fontSize:"14px",color:"#666",border:"0px",outline:"none",height:"28px",boxShadow:"inset 0 0 0 1px #F0F0F0",boxSizing:"content-box",borderRadius:"0 4px 4px 0",float:"left",paddingLeft:"8px"},swatch:{width:"30px",height:"30px",float:"left",borderRadius:"4px",margin:"0 6px 6px 0"},clear:{clear:"both"}},"hide-triangle":{triangle:{display:"none"},triangleShadow:{display:"none"}},"top-left-triangle":{triangle:{top:"-10px",left:"12px"},triangleShadow:{top:"-11px",left:"12px"}},"top-right-triangle":{triangle:{top:"-10px",right:"12px"},triangleShadow:{top:"-11px",right:"12px"}}},c),{"hide-triangle":"hide"===l,"top-left-triangle":"top-left"===l,"top-right-triangle":"top-right"===l}),p=function(e,n){wo(e)&&t({hex:e,source:"hex"},n)};return o.createElement("div",{style:g.card,className:"twitter-picker "+u},o.createElement("div",{style:g.triangleShadow}),o.createElement("div",{style:g.triangle}),o.createElement("div",{style:g.body},Qi(r,(function(e,t){return o.createElement(Do,{key:t,color:e,hex:e,style:g.swatch,onClick:p,onHover:n,focusStyle:{boxShadow:"0 0 4px "+e}})})),o.createElement("div",{style:g.hash},"#"),o.createElement(m,{label:null,style:{input:g.input},value:a.replace("#",""),onChange:p}),o.createElement("div",{style:g.clear})))};sr.propTypes={width:I().oneOfType([I().string,I().number]),triangle:I().oneOf(["hide","top-left","top-right"]),colors:I().arrayOf(I().string),styles:I().object},sr.defaultProps={width:276,colors:["#FF6900","#FCB900","#7BDCB5","#00D084","#8ED1FC","#0693E3","#ABB8C3","#EB144C","#F78DA7","#9900EF"],triangle:"top-left",styles:{}};_o(sr);var lr=function(e){var t=(0,i.Ay)({default:{picker:{width:"20px",height:"20px",borderRadius:"22px",border:"2px #fff solid",transform:"translate(-12px, -13px)",background:"hsl("+Math.round(e.hsl.h)+", "+Math.round(100*e.hsl.s)+"%, "+Math.round(100*e.hsl.l)+"%)"}}});return o.createElement("div",{style:t.picker})};lr.propTypes={hsl:I().shape({h:I().number,s:I().number,l:I().number,a:I().number})},lr.defaultProps={hsl:{a:1,h:249.94,l:.2,s:.5}};const dr=lr;var cr=function(e){var t=(0,i.Ay)({default:{picker:{width:"20px",height:"20px",borderRadius:"22px",transform:"translate(-10px, -7px)",background:"hsl("+Math.round(e.hsl.h)+", 100%, 50%)",border:"2px white solid"}}});return o.createElement("div",{style:t.picker})};cr.propTypes={hsl:I().shape({h:I().number,s:I().number,l:I().number,a:I().number})},cr.defaultProps={hsl:{a:1,h:249.94,l:.2,s:.5}};const hr=cr;const ur=function(e){var t=e.onChange,n=e.rgb,a=e.hsl,r=e.hex,s=e.hsv,l=function(e,n){if(e.hex)wo(e.hex)&&t({hex:e.hex,source:"hex"},n);else if(e.rgb){var o=e.rgb.split(",");bo(e.rgb,"rgb")&&t({r:o[0],g:o[1],b:o[2],a:1,source:"rgb"},n)}else if(e.hsv){var i=e.hsv.split(",");bo(e.hsv,"hsv")&&(i[2]=i[2].replace("%",""),i[1]=i[1].replace("%",""),i[0]=i[0].replace("°",""),1==i[1]?i[1]=.01:1==i[2]&&(i[2]=.01),t({h:Number(i[0]),s:Number(i[1]),v:Number(i[2]),source:"hsv"},n))}else if(e.hsl){var a=e.hsl.split(",");bo(e.hsl,"hsl")&&(a[2]=a[2].replace("%",""),a[1]=a[1].replace("%",""),a[0]=a[0].replace("°",""),1==u[1]?u[1]=.01:1==u[2]&&(u[2]=.01),t({h:Number(a[0]),s:Number(a[1]),v:Number(a[2]),source:"hsl"},n))}},d=(0,i.Ay)({default:{wrap:{display:"flex",height:"100px",marginTop:"4px"},fields:{width:"100%"},column:{paddingTop:"10px",display:"flex",justifyContent:"space-between"},double:{padding:"0px 4.4px",boxSizing:"border-box"},input:{width:"100%",height:"38px",boxSizing:"border-box",padding:"4px 10% 3px",textAlign:"center",border:"1px solid #dadce0",fontSize:"11px",textTransform:"lowercase",borderRadius:"5px",outline:"none",fontFamily:"Roboto,Arial,sans-serif"},input2:{height:"38px",width:"100%",border:"1px solid #dadce0",boxSizing:"border-box",fontSize:"11px",textTransform:"lowercase",borderRadius:"5px",outline:"none",paddingLeft:"10px",fontFamily:"Roboto,Arial,sans-serif"},label:{textAlign:"center",fontSize:"12px",background:"#fff",position:"absolute",textTransform:"uppercase",color:"#3c4043",width:"35px",top:"-6px",left:"0",right:"0",marginLeft:"auto",marginRight:"auto",fontFamily:"Roboto,Arial,sans-serif"},label2:{left:"10px",textAlign:"center",fontSize:"12px",background:"#fff",position:"absolute",textTransform:"uppercase",color:"#3c4043",width:"32px",top:"-6px",fontFamily:"Roboto,Arial,sans-serif"},single:{flexGrow:"1",margin:"0px 4.4px"}}}),c=n.r+", "+n.g+", "+n.b,h=Math.round(a.h)+"°, "+Math.round(100*a.s)+"%, "+Math.round(100*a.l)+"%",u=Math.round(s.h)+"°, "+Math.round(100*s.s)+"%, "+Math.round(100*s.v)+"%";return o.createElement("div",{style:d.wrap,className:"flexbox-fix"},o.createElement("div",{style:d.fields},o.createElement("div",{style:d.double},o.createElement(m,{style:{input:d.input,label:d.label},label:"hex",value:r,onChange:l})),o.createElement("div",{style:d.column},o.createElement("div",{style:d.single},o.createElement(m,{style:{input:d.input2,label:d.label2},label:"rgb",value:c,onChange:l})),o.createElement("div",{style:d.single},o.createElement(m,{style:{input:d.input2,label:d.label2},label:"hsv",value:u,onChange:l})),o.createElement("div",{style:d.single},o.createElement(m,{style:{input:d.input2,label:d.label2},label:"hsl",value:h,onChange:l})))))};var gr=function(e){var t=e.width,n=e.onChange,a=e.rgb,r=e.hsl,s=e.hsv,l=e.hex,d=e.header,c=e.styles,h=void 0===c?{}:c,u=e.className,g=void 0===u?"":u,p=(0,i.Ay)(an({default:{picker:{width:t,background:"#fff",border:"1px solid #dfe1e5",boxSizing:"initial",display:"flex",flexWrap:"wrap",borderRadius:"8px 8px 0px 0px"},head:{height:"57px",width:"100%",paddingTop:"16px",paddingBottom:"16px",paddingLeft:"16px",fontSize:"20px",boxSizing:"border-box",fontFamily:"Roboto-Regular,HelveticaNeue,Arial,sans-serif"},saturation:{width:"70%",padding:"0px",position:"relative",overflow:"hidden"},swatch:{width:"30%",height:"228px",padding:"0px",background:"rgba("+a.r+", "+a.g+", "+a.b+", 1)",position:"relative",overflow:"hidden"},body:{margin:"auto",width:"95%"},controls:{display:"flex",boxSizing:"border-box",height:"52px",paddingTop:"22px"},color:{width:"32px"},hue:{height:"8px",position:"relative",margin:"0px 16px 0px 16px",width:"100%"},Hue:{radius:"2px"}}},h));return o.createElement("div",{style:p.picker,className:"google-picker "+g},o.createElement("div",{style:p.head},d),o.createElement("div",{style:p.swatch}),o.createElement("div",{style:p.saturation},o.createElement(Tn,{hsl:r,hsv:s,pointer:dr,onChange:n})),o.createElement("div",{style:p.body},o.createElement("div",{style:p.controls,className:"flexbox-fix"},o.createElement("div",{style:p.hue},o.createElement(b,{style:p.Hue,hsl:r,radius:"4px",pointer:hr,onChange:n}))),o.createElement(ur,{rgb:a,hsl:r,hex:l,hsv:s,onChange:n})))};gr.propTypes={width:I().oneOfType([I().string,I().number]),styles:I().object,header:I().string},gr.defaultProps={width:652,styles:{},header:"Color picker"};_o(gr)},28271:(e,t,n)=>{"use strict";n.d(t,{_m:()=>I});var o=n(77940),i=n(99805),a=n(51575),r=n(94717),s=n(86326),l=(n(61927),"object"==typeof performance&&"function"==typeof performance.now?function(){return performance.now()}:function(){return Date.now()});function d(e){cancelAnimationFrame(e.id)}function c(e,t){var n=l();var o={id:requestAnimationFrame((function i(){l()-n>=t?e.call(null):o.id=requestAnimationFrame(i)}))};return o}var h=-1;function u(e){if(void 0===e&&(e=!1),-1===h||e){var t=document.createElement("div"),n=t.style;n.width="50px",n.height="50px",n.overflow="scroll",document.body.appendChild(t),h=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return h}var g=null;function p(e){if(void 0===e&&(e=!1),null===g||e){var t=document.createElement("div"),n=t.style;n.width="50px",n.height="50px",n.overflow="scroll",n.direction="rtl";var o=document.createElement("div"),i=o.style;return i.width="100px",i.height="100px",t.appendChild(o),document.body.appendChild(t),t.scrollLeft>0?g="positive-descending":(t.scrollLeft=1,g=0===t.scrollLeft?"negative":"positive-ascending"),document.body.removeChild(t),g}return g}var v=function(e,t){return e};function f(e){var t,n=e.getItemOffset,l=e.getEstimatedTotalSize,h=e.getItemSize,g=e.getOffsetForIndexAndAlignment,f=e.getStartIndexForOffset,w=e.getStopIndexForStartIndex,E=e.initInstanceProps,b=e.shouldResetStyleCacheOnItemSizeChange,y=e.validateProps;return t=function(e){function t(t){var o;return(o=e.call(this,t)||this)._instanceProps=E(o.props,(0,i.A)(o)),o._outerRef=void 0,o._resetIsScrollingTimeoutId=null,o.state={instance:(0,i.A)(o),isScrolling:!1,scrollDirection:"forward",scrollOffset:"number"==typeof o.props.initialScrollOffset?o.props.initialScrollOffset:0,scrollUpdateWasRequested:!1},o._callOnItemsRendered=void 0,o._callOnItemsRendered=(0,r.A)((function(e,t,n,i){return o.props.onItemsRendered({overscanStartIndex:e,overscanStopIndex:t,visibleStartIndex:n,visibleStopIndex:i})})),o._callOnScroll=void 0,o._callOnScroll=(0,r.A)((function(e,t,n){return o.props.onScroll({scrollDirection:e,scrollOffset:t,scrollUpdateWasRequested:n})})),o._getItemStyle=void 0,o._getItemStyle=function(e){var t,i=o.props,a=i.direction,r=i.itemSize,s=i.layout,l=o._getItemStyleCache(b&&r,b&&s,b&&a);if(l.hasOwnProperty(e))t=l[e];else{var d=n(o.props,e,o._instanceProps),c=h(o.props,e,o._instanceProps),u="horizontal"===a||"horizontal"===s,g="rtl"===a,p=u?d:0;l[e]=t={position:"absolute",left:g?void 0:p,right:g?p:void 0,top:u?0:d,height:u?"100%":c,width:u?c:"100%"}}return t},o._getItemStyleCache=void 0,o._getItemStyleCache=(0,r.A)((function(e,t,n){return{}})),o._onScrollHorizontal=function(e){var t=e.currentTarget,n=t.clientWidth,i=t.scrollLeft,a=t.scrollWidth;o.setState((function(e){if(e.scrollOffset===i)return null;var t=o.props.direction,r=i;if("rtl"===t)switch(p()){case"negative":r=-i;break;case"positive-descending":r=a-n-i}return r=Math.max(0,Math.min(r,a-n)),{isScrolling:!0,scrollDirection:e.scrollOffset<r?"forward":"backward",scrollOffset:r,scrollUpdateWasRequested:!1}}),o._resetIsScrollingDebounced)},o._onScrollVertical=function(e){var t=e.currentTarget,n=t.clientHeight,i=t.scrollHeight,a=t.scrollTop;o.setState((function(e){if(e.scrollOffset===a)return null;var t=Math.max(0,Math.min(a,i-n));return{isScrolling:!0,scrollDirection:e.scrollOffset<t?"forward":"backward",scrollOffset:t,scrollUpdateWasRequested:!1}}),o._resetIsScrollingDebounced)},o._outerRefSetter=function(e){var t=o.props.outerRef;o._outerRef=e,"function"==typeof t?t(e):null!=t&&"object"==typeof t&&t.hasOwnProperty("current")&&(t.current=e)},o._resetIsScrollingDebounced=function(){null!==o._resetIsScrollingTimeoutId&&d(o._resetIsScrollingTimeoutId),o._resetIsScrollingTimeoutId=c(o._resetIsScrolling,150)},o._resetIsScrolling=function(){o._resetIsScrollingTimeoutId=null,o.setState({isScrolling:!1},(function(){o._getItemStyleCache(-1,null)}))},o}(0,a.A)(t,e),t.getDerivedStateFromProps=function(e,t){return m(e,t),y(e),null};var I=t.prototype;return I.scrollTo=function(e){e=Math.max(0,e),this.setState((function(t){return t.scrollOffset===e?null:{scrollDirection:t.scrollOffset<e?"forward":"backward",scrollOffset:e,scrollUpdateWasRequested:!0}}),this._resetIsScrollingDebounced)},I.scrollToItem=function(e,t){void 0===t&&(t="auto");var n=this.props,o=n.itemCount,i=n.layout,a=this.state.scrollOffset;e=Math.max(0,Math.min(e,o-1));var r=0;if(this._outerRef){var s=this._outerRef;r="vertical"===i?s.scrollWidth>s.clientWidth?u():0:s.scrollHeight>s.clientHeight?u():0}this.scrollTo(g(this.props,e,t,a,this._instanceProps,r))},I.componentDidMount=function(){var e=this.props,t=e.direction,n=e.initialScrollOffset,o=e.layout;if("number"==typeof n&&null!=this._outerRef){var i=this._outerRef;"horizontal"===t||"horizontal"===o?i.scrollLeft=n:i.scrollTop=n}this._callPropsCallbacks()},I.componentDidUpdate=function(){var e=this.props,t=e.direction,n=e.layout,o=this.state,i=o.scrollOffset;if(o.scrollUpdateWasRequested&&null!=this._outerRef){var a=this._outerRef;if("horizontal"===t||"horizontal"===n)if("rtl"===t)switch(p()){case"negative":a.scrollLeft=-i;break;case"positive-ascending":a.scrollLeft=i;break;default:var r=a.clientWidth,s=a.scrollWidth;a.scrollLeft=s-r-i}else a.scrollLeft=i;else a.scrollTop=i}this._callPropsCallbacks()},I.componentWillUnmount=function(){null!==this._resetIsScrollingTimeoutId&&d(this._resetIsScrollingTimeoutId)},I.render=function(){var e=this.props,t=e.children,n=e.className,i=e.direction,a=e.height,r=e.innerRef,d=e.innerElementType,c=e.innerTagName,h=e.itemCount,u=e.itemData,g=e.itemKey,p=void 0===g?v:g,f=e.layout,m=e.outerElementType,w=e.outerTagName,E=e.style,b=e.useIsScrolling,y=e.width,I=this.state.isScrolling,_="horizontal"===i||"horizontal"===f,C=_?this._onScrollHorizontal:this._onScrollVertical,T=this._getRangeToRender(),S=T[0],x=T[1],D=[];if(h>0)for(var A=S;A<=x;A++)D.push((0,s.createElement)(t,{data:u,key:p(A,u),index:A,isScrolling:b?I:void 0,style:this._getItemStyle(A)}));var O=l(this.props,this._instanceProps);return(0,s.createElement)(m||w||"div",{className:n,onScroll:C,ref:this._outerRefSetter,style:(0,o.A)({position:"relative",height:a,width:y,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:i},E)},(0,s.createElement)(d||c||"div",{children:D,ref:r,style:{height:_?"100%":O,pointerEvents:I?"none":void 0,width:_?O:"100%"}}))},I._callPropsCallbacks=function(){if("function"==typeof this.props.onItemsRendered&&this.props.itemCount>0){var e=this._getRangeToRender(),t=e[0],n=e[1],o=e[2],i=e[3];this._callOnItemsRendered(t,n,o,i)}if("function"==typeof this.props.onScroll){var a=this.state,r=a.scrollDirection,s=a.scrollOffset,l=a.scrollUpdateWasRequested;this._callOnScroll(r,s,l)}},I._getRangeToRender=function(){var e=this.props,t=e.itemCount,n=e.overscanCount,o=this.state,i=o.isScrolling,a=o.scrollDirection,r=o.scrollOffset;if(0===t)return[0,0,0,0];var s=f(this.props,r,this._instanceProps),l=w(this.props,s,r,this._instanceProps),d=i&&"backward"!==a?1:Math.max(1,n),c=i&&"forward"!==a?1:Math.max(1,n);return[Math.max(0,s-d),Math.max(0,Math.min(t-1,l+c)),s,l]},t}(s.PureComponent),t.defaultProps={direction:"ltr",itemData:void 0,layout:"vertical",overscanCount:2,useIsScrolling:!1},t}var m=function(e,t){e.children,e.direction,e.height,e.layout,e.innerTagName,e.outerTagName,e.width,t.instance},w=function(e,t,n){var o=e.itemSize,i=n.itemMetadataMap,a=n.lastMeasuredIndex;if(t>a){var r=0;if(a>=0){var s=i[a];r=s.offset+s.size}for(var l=a+1;l<=t;l++){var d=o(l);i[l]={offset:r,size:d},r+=d}n.lastMeasuredIndex=t}return i[t]},E=function(e,t,n,o,i){for(;o<=n;){var a=o+Math.floor((n-o)/2),r=w(e,a,t).offset;if(r===i)return a;r<i?o=a+1:r>i&&(n=a-1)}return o>0?o-1:0},b=function(e,t,n,o){for(var i=e.itemCount,a=1;n<i&&w(e,n,t).offset<o;)n+=a,a*=2;return E(e,t,Math.min(n,i-1),Math.floor(n/2),o)},y=function(e,t){var n=e.itemCount,o=t.itemMetadataMap,i=t.estimatedItemSize,a=t.lastMeasuredIndex,r=0;if(a>=n&&(a=n-1),a>=0){var s=o[a];r=s.offset+s.size}return r+(n-a-1)*i},I=f({getItemOffset:function(e,t,n){return w(e,t,n).offset},getItemSize:function(e,t,n){return n.itemMetadataMap[t].size},getEstimatedTotalSize:y,getOffsetForIndexAndAlignment:function(e,t,n,o,i,a){var r=e.direction,s=e.height,l=e.layout,d=e.width,c="horizontal"===r||"horizontal"===l?d:s,h=w(e,t,i),u=y(e,i),g=Math.max(0,Math.min(u-c,h.offset)),p=Math.max(0,h.offset-c+h.size+a);switch("smart"===n&&(n=o>=p-c&&o<=g+c?"auto":"center"),n){case"start":return g;case"end":return p;case"center":return Math.round(p+(g-p)/2);default:return o>=p&&o<=g?o:o<p?p:g}},getStartIndexForOffset:function(e,t,n){return function(e,t,n){var o=t.itemMetadataMap,i=t.lastMeasuredIndex;return(i>0?o[i].offset:0)>=n?E(e,t,i,0,n):b(e,t,Math.max(0,i),n)}(e,n,t)},getStopIndexForStartIndex:function(e,t,n,o){for(var i=e.direction,a=e.height,r=e.itemCount,s=e.layout,l=e.width,d="horizontal"===i||"horizontal"===s?l:a,c=w(e,t,o),h=n+d,u=c.offset+c.size,g=t;g<r-1&&u<h;)g++,u+=w(e,g,o).size;return g},initInstanceProps:function(e,t){var n={itemMetadataMap:{},estimatedItemSize:e.estimatedItemSize||50,lastMeasuredIndex:-1};return t.resetAfterIndex=function(e,o){void 0===o&&(o=!0),n.lastMeasuredIndex=Math.min(n.lastMeasuredIndex,e-1),t._getItemStyleCache(-1),o&&t.forceUpdate()},n},shouldResetStyleCacheOnItemSizeChange:!1,validateProps:function(e){e.itemSize}})},97002:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.autoprefix=void 0;var o,i=n(59741),a=(o=i)&&o.__esModule?o:{default:o},r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e};var s={borderRadius:function(e){return{msBorderRadius:e,MozBorderRadius:e,OBorderRadius:e,WebkitBorderRadius:e,borderRadius:e}},boxShadow:function(e){return{msBoxShadow:e,MozBoxShadow:e,OBoxShadow:e,WebkitBoxShadow:e,boxShadow:e}},userSelect:function(e){return{WebkitTouchCallout:e,KhtmlUserSelect:e,MozUserSelect:e,msUserSelect:e,WebkitUserSelect:e,userSelect:e}},flex:function(e){return{WebkitBoxFlex:e,MozBoxFlex:e,WebkitFlex:e,msFlex:e,flex:e}},flexBasis:function(e){return{WebkitFlexBasis:e,flexBasis:e}},justifyContent:function(e){return{WebkitJustifyContent:e,justifyContent:e}},transition:function(e){return{msTransition:e,MozTransition:e,OTransition:e,WebkitTransition:e,transition:e}},transform:function(e){return{msTransform:e,MozTransform:e,OTransform:e,WebkitTransform:e,transform:e}},absolute:function(e){var t=e&&e.split(" ");return{position:"absolute",top:t&&t[0],right:t&&t[1],bottom:t&&t[2],left:t&&t[3]}},extend:function(e,t){var n=t[e];return n||{extend:e}}},l=t.autoprefix=function(e){var t={};return(0,a.default)(e,(function(e,n){var o={};(0,a.default)(e,(function(e,t){var n=s[t];n?o=r({},o,n(e)):o[t]=e})),t[n]=o})),t};t.default=l},2990:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.active=void 0;var o,i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},a=n(86326),r=(o=a)&&o.__esModule?o:{default:o};function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var l=t.active=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"span";return function(n){function o(){var n,a,l;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o);for(var d=arguments.length,c=Array(d),h=0;h<d;h++)c[h]=arguments[h];return a=l=s(this,(n=o.__proto__||Object.getPrototypeOf(o)).call.apply(n,[this].concat(c))),l.state={active:!1},l.handleMouseDown=function(){return l.setState({active:!0})},l.handleMouseUp=function(){return l.setState({active:!1})},l.render=function(){return r.default.createElement(t,{onMouseDown:l.handleMouseDown,onMouseUp:l.handleMouseUp},r.default.createElement(e,i({},l.props,l.state)))},s(l,a)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(o,n),o}(r.default.Component)};t.default=l},77136:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hover=void 0;var o,i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},a=n(86326),r=(o=a)&&o.__esModule?o:{default:o};function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var l=t.hover=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"span";return function(n){function o(){var n,a,l;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o);for(var d=arguments.length,c=Array(d),h=0;h<d;h++)c[h]=arguments[h];return a=l=s(this,(n=o.__proto__||Object.getPrototypeOf(o)).call.apply(n,[this].concat(c))),l.state={hover:!1},l.handleMouseOver=function(){return l.setState({hover:!0})},l.handleMouseOut=function(){return l.setState({hover:!1})},l.render=function(){return r.default.createElement(t,{onMouseOver:l.handleMouseOver,onMouseOut:l.handleMouseOut},r.default.createElement(e,i({},l.props,l.state)))},s(l,a)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(o,n),o}(r.default.Component)};t.default=l},23003:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.flattenNames=void 0;var o=s(n(87561)),i=s(n(59741)),a=s(n(5229)),r=s(n(764));function s(e){return e&&e.__esModule?e:{default:e}}var l=t.flattenNames=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=[];return(0,r.default)(t,(function(t){Array.isArray(t)?e(t).map((function(e){return n.push(e)})):(0,a.default)(t)?(0,i.default)(t,(function(e,t){!0===e&&n.push(t),n.push(t+"-"+e)})):(0,o.default)(t)&&n.push(t)})),n};t.default=l},56457:(e,t,n)=>{"use strict";t.H8=void 0;var o=d(n(23003)),i=d(n(70101)),a=d(n(97002)),r=d(n(77136)),s=d(n(2990)),l=d(n(26431));function d(e){return e&&e.__esModule?e:{default:e}}r.default,t.H8=r.default,s.default,l.default;var c=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var s=(0,o.default)(n),l=(0,i.default)(e,s);return(0,a.default)(l)};t.Ay=c},26431:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=function(e,t){var n={},o=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];n[e]=t};return 0===e&&o("first-child"),e===t-1&&o("last-child"),(0===e||e%2==0)&&o("even"),1===Math.abs(e%2)&&o("odd"),o("nth-child",e),n}},70101:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mergeClasses=void 0;var o=r(n(59741)),i=r(n(81285)),a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e};function r(e){return e&&e.__esModule?e:{default:e}}var s=t.mergeClasses=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=e.default&&(0,i.default)(e.default)||{};return t.map((function(t){var i=e[t];return i&&(0,o.default)(i,(function(e,t){n[t]||(n[t]={}),n[t]=a({},n[t],i[t])})),t})),n};t.default=s},76785:(e,t,n)=>{"use strict";var o=n(86326);var i="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},a=o.useState,r=o.useEffect,s=o.useLayoutEffect,l=o.useDebugValue;function d(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!i(e,n)}catch(e){return!0}}var c="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var n=t(),o=a({inst:{value:n,getSnapshot:t}}),i=o[0].inst,c=o[1];return s((function(){i.value=n,i.getSnapshot=t,d(i)&&c({inst:i})}),[e,n,t]),r((function(){return d(i)&&c({inst:i}),e((function(){d(i)&&c({inst:i})}))}),[e]),l(n),n};t.useSyncExternalStore=void 0!==o.useSyncExternalStore?o.useSyncExternalStore:c},92462:(e,t,n)=>{"use strict";var o=n(86326),i=n(73634);var a="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},r=i.useSyncExternalStore,s=o.useRef,l=o.useEffect,d=o.useMemo,c=o.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,n,o,i){var h=s(null);if(null===h.current){var u={hasValue:!1,value:null};h.current=u}else u=h.current;h=d((function(){function e(e){if(!l){if(l=!0,r=e,e=o(e),void 0!==i&&u.hasValue){var t=u.value;if(i(t,e))return s=t}return s=e}if(t=s,a(r,e))return t;var n=o(e);return void 0!==i&&i(t,n)?t:(r=e,s=n)}var r,s,l=!1,d=void 0===n?null:n;return[function(){return e(t())},null===d?void 0:function(){return e(d())}]}),[t,n,o,i]);var g=r(e,h[0],h[1]);return l((function(){u.hasValue=!0,u.value=g}),[g]),c(g),g}},73634:(e,t,n)=>{"use strict";e.exports=n(76785)},61100:(e,t,n)=>{"use strict";e.exports=n(92462)},93366:(e,t,n)=>{"use strict";n.d(t,{vt:()=>h});var o=n(19167),i=n(86326),a=n(61100);const{useDebugValue:r}=i,{useSyncExternalStoreWithSelector:s}=a;let l=!1;const d=e=>e;const c=e=>{"function"!=typeof e&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const t="function"==typeof e?(0,o.y)(e):e,n=(e,n)=>function(e,t=d,n){n&&!l&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),l=!0);const o=s(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return r(o),o}(t,e,n);return Object.assign(n,t),n},h=e=>e?c(e):c},21978:(e,t,n)=>{"use strict";n.d(t,{lt:()=>a});const o=new Map,i=e=>{const t=o.get(e);return t?Object.fromEntries(Object.entries(t.stores).map((([e,t])=>[e,t.getState()]))):{}},a=(e,t={})=>(n,a,s)=>{const{enabled:l,anonymousActionType:d,store:c,...h}=t;let u;try{u=(null==l||l)&&window.__REDUX_DEVTOOLS_EXTENSION__}catch(e){}if(!u)return l&&console.warn("[zustand devtools middleware] Please install/enable Redux devtools extension"),e(n,a,s);const{connection:g,...p}=((e,t,n)=>{if(void 0===e)return{type:"untracked",connection:t.connect(n)};const i=o.get(n.name);if(i)return{type:"tracked",store:e,...i};const a={connection:t.connect(n),stores:{}};return o.set(n.name,a),{type:"tracked",store:e,...a}})(c,u,h);let v=!0;s.setState=(e,t,o)=>{const r=n(e,t);if(!v)return r;const l=void 0===o?{type:d||"anonymous"}:"string"==typeof o?{type:o}:o;return void 0===c?(null==g||g.send(l,a()),r):(null==g||g.send({...l,type:`${c}/${l.type}`},{...i(h.name),[c]:s.getState()}),r)};const f=(...e)=>{const t=v;v=!1,n(...e),v=t},m=e(s.setState,a,s);if("untracked"===p.type?null==g||g.init(m):(p.stores[p.store]=s,null==g||g.init(Object.fromEntries(Object.entries(p.stores).map((([e,t])=>[e,e===p.store?m:t.getState()]))))),s.dispatchFromDevtools&&"function"==typeof s.dispatch){let e=!1;const t=s.dispatch;s.dispatch=(...n)=>{"__setState"!==n[0].type||e||(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),e=!0),t(...n)}}return g.subscribe((e=>{var t;switch(e.type){case"ACTION":return"string"!=typeof e.payload?void console.error("[zustand devtools middleware] Unsupported action format"):r(e.payload,(e=>{if("__setState"!==e.type)s.dispatchFromDevtools&&"function"==typeof s.dispatch&&s.dispatch(e);else{if(void 0===c)return void f(e.state);1!==Object.keys(e.state).length&&console.error('\n                    [zustand devtools middleware] Unsupported __setState action format. \n                    When using \'store\' option in devtools(), the \'state\' should have only one key, which is a value of \'store\' that was passed in devtools(),\n                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }\n                    ');const t=e.state[c];if(null==t)return;JSON.stringify(s.getState())!==JSON.stringify(t)&&f(t)}}));case"DISPATCH":switch(e.payload.type){case"RESET":return f(m),void 0===c?null==g?void 0:g.init(s.getState()):null==g?void 0:g.init(i(h.name));case"COMMIT":return void 0===c?void(null==g||g.init(s.getState())):null==g?void 0:g.init(i(h.name));case"ROLLBACK":return r(e.state,(e=>{if(void 0===c)return f(e),void(null==g||g.init(s.getState()));f(e[c]),null==g||g.init(i(h.name))}));case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return r(e.state,(e=>{void 0!==c?JSON.stringify(s.getState())!==JSON.stringify(e[c])&&f(e[c]):f(e)}));case"IMPORT_STATE":{const{nextLiftedState:n}=e.payload,o=null==(t=n.computedStates.slice(-1)[0])?void 0:t.state;if(!o)return;return f(void 0===c?o:o[c]),void(null==g||g.send(null,n))}case"PAUSE_RECORDING":return v=!v}return}})),m},r=(e,t)=>{let n;try{n=JSON.parse(e)}catch(e){console.error("[zustand devtools middleware] Could not parse the received json",e)}void 0!==n&&t(n)}},19167:(e,t,n)=>{"use strict";n.d(t,{y:()=>i});const o=e=>{let t;const n=new Set,o=(e,o)=>{const i="function"==typeof e?e(t):e;if(!Object.is(i,t)){const e=t;t=(null!=o?o:"object"!=typeof i||null===i)?i:Object.assign({},t,i),n.forEach((n=>n(t,e)))}},i=()=>t,a={setState:o,getState:i,getInitialState:()=>r,subscribe:e=>(n.add(e),()=>n.delete(e)),destroy:()=>{console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},r=t=e(o,i,a);return a},i=e=>e?o(e):o}}]);
//# sourceMappingURL=3671.bundle.4847b338a5ee339afadf.js.map