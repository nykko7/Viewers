"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[4688,2591,4182,1801],{67062:(e,t,n)=>{n.r(t),n.d(t,{default:()=>_});const a=JSON.parse('{"UU":"extension-t-chaii"}').UU,l={id:"tchaii",name:"T-CHAII",locked:!0,hasUpdatedPriorsInformation:!1,protocolMatchingRules:[],toolGroupIds:["default"],displaySetSelectors:{ctDisplaySet:{seriesMatchingRules:[{weight:1,attribute:"Modality",constraint:{equals:"CT"}}]},segDisplaySet:{seriesMatchingRules:[{weight:1,attribute:"Modality",constraint:{equals:"SEG"}}]}},stages:[{id:"ctSeg",name:"CT + SEG",viewportStructure:{layoutType:"grid",properties:{rows:1,columns:1}},viewports:[{viewportOptions:{viewportType:"stack",toolGroupId:"default",allowUnmatchedView:!0,syncGroups:[{type:"image",id:"ctSync",source:!0,target:!0}]},displaySets:[{id:"ctDisplaySet",matchedDisplaySetsIndex:-1},{id:"segDisplaySet",matchedDisplaySetsIndex:-1,options:{visibility:!0,renderOutline:!0}}]}]}],numberOfPriorsReferenced:0};const i=function(){return[{id:`${a}.hangingProtocolModule.default`,name:`${a}.hangingProtocolModule.default`,protocol:l}]};var o=n(86326),s=n(43494),r=n(11185),m=n(81985),d=n(21370);n(72721);const c={lesion:({data:e,id:t})=>{const n=e,[a,l]=(0,o.useState)(!1),i=n.isCurrent&&n.isSelected?"rgb(37, 99, 235)":"white",s=n.isCurrent&&n.isSelected?"white":"black",r=n.isSelected?"rgb(37, 99, 235)":"rgb(156, 163, 175)";return o.createElement(o.Fragment,null,o.createElement(d.ER,{isVisible:a,position:d.yX.Bottom,offset:10,className:"bg-background border-input z-99 rounded-lg border p-4 text-white shadow-lg",style:{zIndex:999,overflow:"visible"}},o.createElement("div",{className:"space-y-1"},o.createElement("div",{className:"text-center font-bold text-white"},n.label),o.createElement("div",{className:"text-gray-200"},"Volume:"," ",o.createElement("span",{className:"font-bold"},n.volume,"mm",o.createElement("sup",null,"3"))),o.createElement("div",{className:"text-gray-200"},"Diameter: ",o.createElement("span",{className:"font-bold"},n.max_diameter,"mm")))),o.createElement("div",{className:"flex h-12 w-12 cursor-pointer items-center justify-center rounded-full border-4 transition-all duration-200 hover:scale-110",style:{background:i,borderColor:r},onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1)},o.createElement(d.h7,{type:"target",position:d.yX.Top,style:{background:"transparent"}}),o.createElement("div",{className:`text-sm font-bold text-${s}`},n.label),o.createElement(d.h7,{type:"source",position:d.yX.Bottom,style:{background:"transparent"}})))}};function g({type:e,currentControl:t,selectedLesionId:n,onLesionSelect:a,lesionInfo:l}){const i=(0,o.useCallback)((()=>{const e=[],a=[],i=l?.studySegments||[];return[{id:"L1",studies:i.map((e=>({created_at:e.created_at,updated_at:e.updated_at,name:e.name,axial_diameter:e.axial_diameter,coronal_diameter:e.coronal_diameter,sagittal_diameter:e.sagittal_diameter,volume:e.volume,max_diameter:Math.max(e.coronal_diameter,e.sagittal_diameter)})))},{id:"L2",studies:i.map((e=>({created_at:e.created_at,updated_at:e.updated_at,name:e.name,axial_diameter:e.axial_diameter,coronal_diameter:e.coronal_diameter,sagittal_diameter:e.sagittal_diameter,volume:e.volume,max_diameter:Math.max(e.coronal_diameter,e.sagittal_diameter)})))},{id:"L3",studies:i.map((e=>({created_at:e.created_at,updated_at:e.updated_at,name:e.name,axial_diameter:e.axial_diameter,coronal_diameter:e.coronal_diameter,sagittal_diameter:e.sagittal_diameter,volume:e.volume,max_diameter:Math.max(e.coronal_diameter,e.sagittal_diameter)})))}].forEach(((l,i)=>{const o=150*i;l.studies.forEach(((i,s)=>{e.push({id:`${l.id}-${s}`,type:"lesion",position:{x:o,y:100*s},data:{label:l.id,created_at:i.created_at,updated_at:i.updated_at,name:i.name,axial_diameter:i.axial_diameter,coronal_diameter:i.coronal_diameter,sagittal_diameter:i.sagittal_diameter,volume:i.volume,max_diameter:Math.max(i.coronal_diameter,i.sagittal_diameter),isCurrent:s===t,isSelected:l.id===n,type:"maintained"}}),s>0&&a.push({id:`e${l.id}-${s}`,source:`${l.id}-${s-1}`,target:`${l.id}-${s}`,type:"smoothstep",style:{stroke:l.id===n?"#3b82f6":"#9ca3af"}})}))})),{nodes:e,edges:a}}),[e,t,n,l]),{nodes:s,edges:r}=i();return o.createElement("div",{style:{height:600}},o.createElement(d.Gc,{nodes:s,edges:r,nodeTypes:c,onNodeClick:(e,t)=>{const n=t.data.label;a?.(n)},defaultEdgeOptions:{type:"smoothstep",animated:!0},fitView:!0,fitViewOptions:{padding:.3},proOptions:{hideAttribution:!0},colorMode:"dark"},o.createElement(d.VS,null),o.createElement(d.H2,null)))}const u=[{created_at:"01/08/2024",updated_at:"01/08/2024",volume:100,name:"Study 1",axial_diameter:5,coronal_diameter:8,sagittal_diameter:8,is_target_lession:!0,classification:"Target",lesion_segments:["L1","L2","L3"]},{created_at:"01/08/2024",updated_at:"01/08/2024",volume:100,name:"Study 2",axial_diameter:5,coronal_diameter:8,sagittal_diameter:8,is_target_lession:!0,classification:"Target",lesion_segments:["L1","L2","L3"]},{created_at:"01/08/2024",updated_at:"01/08/2024",volume:100,name:"Study 3",axial_diameter:5,coronal_diameter:8,sagittal_diameter:8,is_target_lession:!0,classification:"Target",lesion_segments:["L1","L2","L3"]}];function p({open:e,onOpenChange:t,segmentIndex:n,initialData:a,onSave:l}){const[i,r]=(0,o.useState)({name:a?.name??`Lesion ${n+1}`,organ:a?.organ??"Right lung",type:a?.type??"Lymph node",classification:a?.classification??"Target",studySegments:a?.studySegments??u}),[m,d]=(0,o.useState)("L1");return o.createElement(s.lG,{open:e,onOpenChange:t},o.createElement(s.Cf,{className:"max-w-6xl"},o.createElement(s.Bc,null,o.createElement(s.c7,null,o.createElement(s.L3,{className:"text-primary-light"},"Lesion Information"),o.createElement(s.rr,null,"Select the lesion to edit and update the information below."),o.createElement("div",{className:"mt-4"},o.createElement(s.JU,null,"Select Lesion:"),o.createElement(s.l6,{value:m,onValueChange:d},o.createElement(s.bq,{className:"w-[200px]"},o.createElement(s.yv,null)),o.createElement(s.gC,null,o.createElement(s.eb,{value:"L1"},"Lesion 1"),o.createElement(s.eb,{value:"L2"},"Lesion 2"))))),o.createElement("div",{className:"grid grid-cols-2 gap-8"},o.createElement("div",{className:"space-y-4"},o.createElement("div",{className:"space-y-2"},o.createElement(s.JU,null,"Name:"),o.createElement(s.pd,{value:i.name,onChange:e=>r((t=>({...t,name:e.target.value})))})),o.createElement("div",{className:"space-y-2"},o.createElement(s.JU,null,"Affected Organ:"),o.createElement(s.l6,{value:i.organ,onValueChange:e=>r((t=>({...t,organ:e})))},o.createElement(s.bq,null,o.createElement(s.yv,null)),o.createElement(s.gC,null,o.createElement(s.s3,null,o.createElement(s.eb,{value:"Right lung"},"Right lung"),o.createElement(s.eb,{value:"Left lung"},"Left lung"),o.createElement(s.eb,{value:"Liver"},"Liver"),o.createElement(s.eb,{value:"Brain"},"Brain"))))),o.createElement("div",{className:"space-y-2"},o.createElement(s.JU,null,"Type:"),o.createElement(s.l6,{value:i.type,onValueChange:e=>r((t=>({...t,type:e})))},o.createElement(s.bq,null,o.createElement(s.yv,null)),o.createElement(s.gC,null,o.createElement(s.s3,null,o.createElement(s.eb,{value:"Lymph node"},"Lymph node"),o.createElement(s.eb,{value:"Tumor"},"Tumor"),o.createElement(s.eb,{value:"Mass"},"Mass"),o.createElement(s.eb,{value:"Nodule"},"Nodule"))))),o.createElement("div",{className:"space-y-2"},o.createElement(s.JU,null,"Classification:"),o.createElement(s.l6,{value:i.classification,onValueChange:e=>r((t=>({...t,classification:e})))},o.createElement(s.bq,null,o.createElement(s.yv,null)),o.createElement(s.gC,null,o.createElement(s.s3,null,o.createElement(s.eb,{value:"Target"},"Target"),o.createElement(s.eb,{value:"Non-Target"},"Non-Target"),o.createElement(s.eb,{value:"New Lesion"},"New Lesion"))))),o.createElement("div",{className:"space-y-2"},o.createElement(s.JU,null,"Lesion Follow-up:"),o.createElement("div",{className:"overflow-hidden rounded border"},o.createElement("div",{className:"min-w-full divide-y divide-gray-200"},o.createElement("div",{className:"bg-secondary-dark border-secondary-light"},o.createElement("div",{className:"text-secondary-foreground grid grid-cols-4 gap-4 px-4 py-3 text-sm font-semibold"},o.createElement("div",null,"Study Date"),o.createElement("div",null,"Volume (cm",o.createElement("sup",null,"3"),")"),o.createElement("div",null,"Major Axial Diameter (mm)"),o.createElement("div",null,"Major Diameter (mm)"))),o.createElement("div",{className:"divide-y divide-gray-200"},i.studySegments.map(((e,t)=>o.createElement("div",{key:t,className:"text-secondary-foreground grid grid-cols-4 gap-4 px-4 py-3 text-sm"},o.createElement("div",null,e.created_at),o.createElement("div",null,e.volume),o.createElement("div",null,e.axial_diameter),o.createElement("div",null,Math.max(e.coronal_diameter,e.sagittal_diameter)))))))))),o.createElement("div",{className:"space-y-2 border-l pl-4"},o.createElement(s.JU,null,"Lesion Follow-up Graph:"),o.createElement("div",{className:"border-input rounded-lg border"},o.createElement(g,{type:"separated",currentControl:2,selectedLesionId:m,onLesionSelect:d,lesionInfo:i})))),o.createElement(s.Es,null,o.createElement(s.$n,{onClick:()=>t(!1),variant:"outline",size:"lg"},"Cancel"),o.createElement(s.$n,{onClick:()=>{l?.(i),t(!1)},variant:"default",size:"lg"},"Confirm")))))}function S({stats:e,showChangeValues:t=!0}){return o.createElement("div",{className:"ml-7 flex flex-col px-2 py-2"},Object.entries({volume:{label:"Volume",unit:"mmÂ³"},diameter:{label:"Diameter",unit:"mm"},affected_organs:{label:"Organ",unit:null}}).map((([n,a])=>{return o.createElement("div",{key:n,className:"text-secondary-foreground flex h-full items-center justify-between text-base leading-normal"},o.createElement("span",{className:"flex-1"},a.label,":"),o.createElement("span",{className:"flex-1 font-bold"},e[n]," ",a.unit,e[`${n}_change`]&&(l=e[`${n}_change`],t?l>0?o.createElement("span",{className:"ml-2 text-red-500"},"(+",l,"%)"):l<0?o.createElement("span",{className:"ml-2 text-green-500"},"(",l,"%)"):0===l?o.createElement("span",{className:"ml-2 text-gray-500"},"(",l,"%)"):null:null)));var l})))}function E({segmentationId:e,segmentIndex:t,label:n,displayText:a,color:l,visible:i,locked:r,active:m,disableEditing:d,cachedStats:c,representationType:g,onEditInfo:u,onSegmentColorClick:p,onToggleVisibility:E,onToggleLock:v,onSelect:y,onRename:b,onDelete:f}){const I=`rgb(${l[0]},${l[1]},${l[2]})`;return o.createElement("div",{className:"flex flex-col"},o.createElement(s.x3,{number:t,title:n,description:a,details:{primary:[],secondary:[]},colorHex:I,isSelected:m,isVisible:i,isLocked:r,disableEditing:d,onColor:()=>p(e,t),onToggleVisibility:()=>E(e,t,g),onToggleLocked:()=>v(e,t),onSelect:()=>y(e,t),onRename:()=>b(e,t),onDelete:()=>f(e,t)}),o.createElement(S,{stats:c}),o.createElement(s.$n,{variant:"outline",size:"sm",className:"ml-8 mb-2",onClick:()=>u(e,t)},"Edit info"))}var v=n(55758);function y({title:e,segments:t,segmentationId:n,disableEditing:a,representationType:l,onEditInfo:i,onSegmentColorClick:s,onToggleVisibility:r,onToggleLock:m,onSelect:d,onRename:c,onDelete:g,className:u}){return o.createElement("div",{className:(0,v.cn)("mb-4",u)},o.createElement("h3",{className:"text-primary-light p-2 text-lg font-semibold"},e,":"),t&&t.length>=0&&t.map((({segment:e,segmentFromSegmentation:t})=>{const{segmentIndex:u,color:p,visible:S}=e,{locked:v,active:y,label:b,displayText:f,cachedStats:I}=t;return o.createElement(E,{key:u,segmentationId:n,segmentIndex:u,label:b,displayText:f,color:p,visible:S,locked:v,active:y,disableEditing:a,cachedStats:I,representationType:l,onEditInfo:i,onSegmentColorClick:s,onToggleVisibility:r,onToggleLock:m,onSelect:d,onRename:c,onDelete:g})})))}function b({segmentation:e,representation:t}){const{activeSegmentationId:n,disableEditing:a,onSegmentColorClick:l,onToggleSegmentVisibility:i,onToggleSegmentLock:r,onSegmentClick:m,mode:d,onSegmentEdit:c,onSegmentDelete:g,data:u}=(0,s.dQ)("SegmentationTable.Segments");let S=e,E=t,b=n;if(!S||!E){const e=u.find((e=>e.segmentation.segmentationId===n));S=e?.segmentation,E=e?.representation,b=e?.segmentation.segmentationId}if(!E||!S)return null;const[f,I]=(0,o.useState)(!1),[h,x]=(0,o.useState)(null),_=(e,t)=>{x(t),I(!0)},w=(Object.keys(E.segments||{}).length,"collapsed"===d?"h-[600px]":"h-[560px]"),C=(T=E.segments||{},R=S.segments||{},(0,o.useMemo)((()=>Object.values(T).reduce(((e,t)=>{if(!t)return e;const n=R[t.segmentIndex];if(!n)return e;const a=n.classification||"Target";return e[a]||(e[a]=[]),e[a].push({segment:t,segmentFromSegmentation:n}),e}),{})),[T,R]));var T,R;return o.createElement(o.Fragment,null,o.createElement(s.FK,{className:(0,v.cn)(`ohif-scrollbar invisible-scrollbar bg-bkg-low space-y-px ${w}`),showArrows:!0},o.createElement(y,{title:"Target Lesions",segments:C.Target||[],segmentationId:b,disableEditing:a,representationType:E.type,onEditInfo:_,onSegmentColorClick:l,onToggleVisibility:i,onToggleLock:r,onSelect:m,onRename:c,onDelete:g}),o.createElement(y,{title:"Non-Target Lesions",segments:C["Non-Target"]||[],segmentationId:b,disableEditing:a,representationType:E.type,onEditInfo:_,onSegmentColorClick:l,onToggleVisibility:i,onToggleLock:r,onSelect:m,onRename:c,onDelete:g}),o.createElement(y,{title:"New Lesions",segments:C["New Lesion"]||[],segmentationId:b,disableEditing:a,representationType:E.type,onEditInfo:_,onSegmentColorClick:l,onToggleVisibility:i,onToggleLock:r,onSelect:m,onRename:c,onDelete:g,className:"mb-2"})),null!==h&&o.createElement(p,{open:f,onOpenChange:I,segmentIndex:h}))}function f({servicesManager:e,commandsManager:t,children:n}){const{viewportGridService:a,customizationService:l,displaySetService:i}=e.services,{segmentationsWithRepresentations:d,disabled:c}=(0,r.useActiveViewportSegmentationRepresentations)({servicesManager:e}),g=function({servicesManager:e,commandsManager:t}){const{viewportGridService:n}=e.services;return{onSegmentationAdd:async()=>{const e=n.getState().activeViewportId;t.run("createLabelmapForViewport",{viewportId:e})},onSegmentationClick:e=>{t.run("setActiveSegmentation",{segmentationId:e})},onSegmentAdd:e=>{t.run("addSegment",{segmentationId:e})},onSegmentClick:(e,n)=>{t.run("setActiveSegmentAndCenter",{segmentationId:e,segmentIndex:n})},onSegmentEdit:(e,n)=>{t.run("editSegmentLabel",{segmentationId:e,segmentIndex:n})},onSegmentationEdit:e=>{t.run("editSegmentationLabel",{segmentationId:e})},onSegmentColorClick:(e,n)=>{t.run("editSegmentColor",{segmentationId:e,segmentIndex:n})},onSegmentDelete:(e,n)=>{t.run("deleteSegment",{segmentationId:e,segmentIndex:n})},onToggleSegmentVisibility:(e,n,a)=>{console.log("segmentationId",e),console.log("segmentIndex",n),console.log("type",a),t.run("toggleSegmentVisibility",{segmentationId:e,segmentIndex:n,type:a})},onToggleSegmentLock:(e,n)=>{t.run("toggleSegmentLock",{segmentationId:e,segmentIndex:n})},onToggleSegmentationRepresentationVisibility:e=>{t.run("toggleSegmentationVisibility",{segmentationId:e})},onSegmentationDownload:e=>{t.run("downloadSegmentation",{segmentationId:e})},storeSegmentation:async e=>{t.run("storeSegmentation",{segmentationId:e})},onSegmentationDownloadRTSS:e=>{t.run("downloadRTSS",{segmentationId:e})},setStyle:(e,n,a,l)=>{t.run("setSegmentationStyle",{segmentationId:e,type:n,key:a,value:l})},toggleRenderInactiveSegmentations:()=>{t.run("toggleRenderInactiveSegmentations")},onSegmentationRemoveFromViewport:e=>{t.run("removeSegmentationFromViewport",{segmentationId:e})},onSegmentationDelete:e=>{t.run("deleteSegmentation",{segmentationId:e})},setFillAlpha:({type:e},n)=>{t.run("setFillAlpha",{type:e,value:n})},setOutlineWidth:({type:e},n)=>{t.run("setOutlineWidth",{type:e,value:n})},setRenderFill:({type:e},n)=>{t.run("setRenderFill",{type:e,value:n})},setRenderOutline:({type:e},n)=>{t.run("setRenderOutline",{type:e,value:n})},setFillAlphaInactive:({type:e},n)=>{t.run("setFillAlphaInactive",{type:e,value:n})},getRenderInactiveSegmentations:()=>t.run("getRenderInactiveSegmentations"),setRenderInactiveSegmentations:(e,n)=>{t.run("setRenderInactiveSegmentations",{segmentationId:e,value:n})}}}({servicesManager:e,commandsManager:t}),{mode:u}=l.getCustomization("PanelSegmentation.tableMode",{id:"default.segmentationTable.mode",mode:"collapsed"}),{onSegmentationAdd:p}=l.getCustomization("PanelSegmentation.onSegmentationAdd",{id:"segmentation.onSegmentationAdd",onSegmentationAdd:g.onSegmentationAdd}),{disableEditing:S}=l.getCustomization("PanelSegmentation.disableEditing",{id:"default.disableEditing",disableEditing:!1}),{showAddSegment:E}=l.getCustomization("PanelSegmentation.showAddSegment",{id:"default.showAddSegment",showAddSegment:!0}),v=d.map((({segmentation:e})=>{const{representationData:t,segmentationId:n}=e,{Labelmap:a}=t;if(!a)return{segmentationId:n,isExportable:!0};const l=a.referencedImageIds[0],o=m.metaData.get("instance",l),{SOPInstanceUID:s,SeriesInstanceUID:r}=o,d=i.getDisplaySetForSOPInstanceUID(s,r);return{segmentationId:n,isExportable:d?.isReconstructable??!1}}));(0,o.useEffect)((()=>{const e=async e=>{const{viewportId:n}=e;if(n)try{const e=(0,m.getRenderingEngine)("cornerstone"),a=(0,m.getEnabledElement)(n);if(!e||!a){e&&e.disableElement(n),await t.run("initializeViewport",{viewportId:n});const a=(0,m.getRenderingEngine)("cornerstone");a&&a.enableElement(n)}}catch(e){console.warn("Error handling viewport change:",e)}},n=a.subscribe(a.EVENTS.ACTIVE_VIEWPORT_ID_CHANGED,e),l=a.getState().activeViewportId;return l&&e({viewportId:l}),()=>{n()}}),[a,t]);return o.createElement(s.R4,{disabled:c,data:d,mode:u,title:"Segmentations",exportOptions:v,disableEditing:S,onSegmentationAdd:p,onSegmentationClick:g.onSegmentationClick,onSegmentationDelete:g.onSegmentationDelete,showAddSegment:E,onSegmentAdd:g.onSegmentAdd,onSegmentClick:g.onSegmentClick,onSegmentEdit:g.onSegmentEdit,onSegmentationEdit:g.onSegmentationEdit,onSegmentColorClick:g.onSegmentColorClick,onSegmentDelete:g.onSegmentDelete,onToggleSegmentVisibility:g.onToggleSegmentVisibility,onToggleSegmentLock:g.onToggleSegmentLock,onToggleSegmentationRepresentationVisibility:g.onToggleSegmentationRepresentationVisibility,onSegmentationDownload:g.onSegmentationDownload,storeSegmentation:g.storeSegmentation,onSegmentationDownloadRTSS:g.onSegmentationDownloadRTSS,setStyle:g.setStyle,toggleRenderInactiveSegmentations:g.toggleRenderInactiveSegmentations,onSegmentationRemoveFromViewport:g.onSegmentationRemoveFromViewport,setFillAlpha:g.setFillAlpha,setOutlineWidth:g.setOutlineWidth,setRenderFill:g.setRenderFill,setRenderOutline:g.setRenderOutline,setFillAlphaInactive:g.setFillAlphaInactive,renderInactiveSegmentations:g.getRenderInactiveSegmentations()},n,o.createElement(s.R4.Config,null),"collapsed"===u?o.createElement(s.R4.Collapsed,null,o.createElement(s.R4.SelectorHeader,null),o.createElement(s.R4.AddSegmentRow,null),o.createElement(b,null)):o.createElement(s.R4.Expanded,null,o.createElement(s.R4.Header,null),o.createElement(s.R4.AddSegmentRow,null),o.createElement(b,null)),d.length>0&&o.createElement("div",{className:"flex flex-col gap-2 p-2"},o.createElement("div",{className:"bg-secondary-dark text-secondary-foreground grid grid-cols-2 gap-2 p-2"},o.createElement("span",null,"Total volume:"),o.createElement("span",{className:"text-right font-bold"},"0 mm",o.createElement("sup",null,"3")),o.createElement("span",null,"Total diameter:"),o.createElement("span",{className:"text-right font-bold"},"0 mm")),o.createElement(s.$n,{onClick:()=>{console.log("save changes")},className:"w-full",variant:"default",size:"lg",disabled:!0},"Save Changes")))}const I=function({commandsManager:e,extensionManager:t,servicesManager:n}){return[{name:"segmentation",iconName:"tab-segmentation",iconLabel:"Segmentation",label:"Segmentation",component:()=>o.createElement("div",null,o.createElement(s.OO,{commandsManager:e,servicesManager:n,extensionManager:t,buttonSectionId:"segmentationToolbox",title:"Segmentation Tools"}),o.createElement(f,{servicesManager:n,commandsManager:e}))}]};var h=n(79715);const x=({servicesManager:e,commandsManager:t})=>{const{viewportGridService:n,displaySetService:a,segmentationService:l}=e.services,i={openDICOMTagViewer({displaySetInstanceUID:t}){const{activeViewportId:l,viewports:i}=n.getState(),o=i.get(l),{displaySetInstanceUIDs:s}=o,r=a.activeDisplaySets,{UIModalService:m}=e.services,d=t||s[0];m.show({content:h.A,contentProps:{displaySets:r,displaySetInstanceUID:d,onClose:m.hide},containerDimensions:"w-[70%] max-w-[900px]",title:"DICOM Tag Browser"})},updateSegmentationInfo:({segmentationId:n})=>(async({segmentationId:e,commandsManager:t,segmentationService:n})=>{const a=n.getSegmentation(e);if(!a)return;(0,m.triggerEvent)(m.eventTarget,m.Enums.Events.WEB_WORKER_PROGRESS,{progress:0,type:"Calculate Segment Stats",id:e});const l=n.getLabelmapVolume(e),{imageData:i,spacing:o}=l,s=i.getPointData().getScalars().getData();for(const[e,t]of Object.entries(a.segments)){if(!t)continue;const n=Number(e);let l=0;for(let e=0;e<s.length;e++)s[e]===n&&l++;const i=l*o[0]*o[1]*o[2]*.001,r=Math.pow(3*i/(4*Math.PI),1/3),m={diameter:parseFloat((2*r*10).toFixed(1)),volume:parseFloat(i.toFixed(1)),affectedOrgan:"Unknown"},d={...t,cachedStats:{...t.cachedStats,...m}};a.segments[e]=d}const r={...a,segments:{...a.segments}};(0,m.triggerEvent)(m.eventTarget,m.Enums.Events.WEB_WORKER_PROGRESS,{progress:100,type:"Calculate Segment Stats",id:e}),n.addOrUpdateSegmentation(r)})({segmentationId:n,commandsManager:t,segmentationService:l,servicesManager:e})};return{actions:i,definitions:{openDICOMTagViewer:{commandFn:i.openDICOMTagViewer},updateSegmentationInfo:{commandFn:i.updateSegmentationInfo}},defaultContext:"VIEWER"}},_={id:a,preRegistration({servicesManager:e,commandsManager:t,extensionManager:n,configuration:a={}}){},getPanelModule:I,getHangingProtocolModule:i,getCommandsModule:x}}}]);
//# sourceMappingURL=4688.bundle.b0d61783381ed921d572.js.map