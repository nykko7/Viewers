"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[5172],{79715:(e,t,a)=>{a.d(t,{A:()=>x});var n=a(5842),s=a(14867),r=a.n(s),i=a(86326),o=a(29463),c=a(58851),l=a(62051),u=a.n(l),d=a(43494),m=a(28271),p=a(55530),g=a.n(p);const f={padding:"10px 0"},S={borderBottomWidth:"1px",...f};function I({tagRef:e,vrRef:t,keywordRef:a,valueRef:n}){return i.createElement("div",{className:g()("bg-secondary-dark ohif-scrollbar flex w-full flex-row overflow-y-scroll"),style:f},i.createElement("div",{className:"w-4/24 px-3"},i.createElement("label",{ref:e,className:"flex flex-1 select-none flex-col pl-1 text-lg text-white"},i.createElement("span",{className:"flex flex-row items-center focus:outline-none"},"Tag"))),i.createElement("div",{className:"w-2/24 px-3"},i.createElement("label",{ref:t,className:"flex flex-1 select-none flex-col pl-1 text-lg text-white"},i.createElement("span",{className:"flex flex-row items-center focus:outline-none"},"VR"))),i.createElement("div",{className:"w-6/24 px-3"},i.createElement("label",{ref:a,className:"flex flex-1 select-none flex-col pl-1 text-lg text-white"},i.createElement("span",{className:"flex flex-row items-center focus:outline-none"},"Keyword"))),i.createElement("div",{className:"w-5/24 grow px-3"},i.createElement("label",{ref:n,className:"flex flex-1 select-none flex-col pl-1 text-lg text-white"},i.createElement("span",{className:"flex flex-row items-center focus:outline-none"},"Value"))))}const y=function({rows:e}){const t=(0,i.useRef)(),a=(0,i.useRef)(),[n,s]=(0,i.useState)(null),[r,o]=(0,i.useState)(null),[c,l]=(0,i.useState)(null),[d,p]=(0,i.useState)(null);(0,i.useEffect)((()=>{t?.current&&(t.current.scrollTo(0),t.current.resetAfterIndex(0))}),[e]),(0,i.useEffect)((()=>{const e=u()((()=>t.current.resetAfterIndex(0)),100);return window.addEventListener("resize",e),()=>{e.cancel(),window.removeEventListener("resize",e)}}),[]);const f=(0,i.useCallback)((({index:t,style:a})=>{const n=e[t];return i.createElement("div",{style:{...a,...S},className:g()("hover:bg-secondary-main border-secondary-light flex w-full flex-row items-center break-all bg-black text-base transition duration-300","leading-[20px]"),key:`DICOMTagRow-${t}`},i.createElement("div",{className:"w-4/24 px-3"},n[0]),i.createElement("div",{className:"w-2/24 px-3"},n[1]),i.createElement("div",{className:"w-6/24 px-3"},n[2]),i.createElement("div",{className:"w-5/24 grow px-3"},n[3]))}),[e]),y=(0,i.useCallback)((()=>null!==n),[n]),h=(0,i.useCallback)((t=>{const s=[n.offsetWidth,r.offsetWidth,c.offsetWidth,d.offsetWidth],i=a.current.getContext("2d");return i.font=getComputedStyle(a.current).font,e[t].map(((e,t)=>{const a=i.measureText(e).width;return 20*Math.ceil(a/s[t])+20+1})).reduce(((e,t)=>Math.max(e,t)))}),[e,c,n,d,r]);return i.createElement("div",null,i.createElement("canvas",{style:{visibility:"hidden",position:"absolute"},className:"text-base",ref:a}),i.createElement(I,{tagRef:e=>{e&&s(e)},vrRef:e=>{e&&o(e)},keywordRef:e=>{e&&l(e)},valueRef:e=>{e&&p(e)}}),i.createElement("div",{className:"relative m-auto border-2 border-black bg-black",style:{height:"32rem"}},y()&&i.createElement(m._m,{ref:t,height:500,itemCount:e.length,itemSize:h,width:"100%",className:"ohif-scrollbar"},f)))},{ImageSet:h}=o.Ly,{DicomMetaDictionary:v}=n.Ay.data,{nameMap:D}=v;function w(e,t){const a=[];return e.forEach((e=>{if("SQ"===e.vr){a.push([`${e.tagIndent}${e.tag}`,e.vr,e.keyword,""]);const{values:n}=e;n.forEach(((e,n)=>{const s=w(e,t);a.push([`${e[0].tagIndent}(FFFE,E000)`,"",`Item #${n}`,""]),a.push(...s)}))}else{if("xs"===e.vr)try{const a=n.Ay.data.Tag.fromPString(e.tag).toCleanString(),s=t[a];e.vr=s.vr}catch(t){console.error(`Failed to parse value representation for tag '${e.keyword}'`)}a.push([`${e.tagIndent}${e.tag}`,e.vr,e.keyword,e.value])}})),a}function b(e,t=0){const a=Object.keys(e);let n="";for(let e=0;e<t;e++)n+=">";t>0&&(n+=" ");const s=[];for(let i=0;i<a.length;i++){let o=a[i];if("_vrMap"===o)continue;const c=D[o];let l=e[o];if(c&&"SQ"===c.vr){const e=(r=l,Array.isArray(r)?r:[r]),a={tag:c.tag,tagIndent:n,vr:c.vr,keyword:o,values:[]};if(s.push(a),null===l)continue;e.forEach((e=>{const n=b(e,t+1);n.length&&(E(n),a.values.push(n))}))}else if(Array.isArray(l)&&l.length>0&&"object"!=typeof l[0]&&(l=l.join("\\")),"number"==typeof l&&(l=l.toString()),"string"!=typeof l&&(null===l?l=" ":"object"==typeof l?l.InlineBinary?l="Inline Binary":l.BulkDataURI?l="Bulk Data URI":l.Alphabetic?l=l.Alphabetic:(console.warn(`Unrecognised Value: ${l} for ${o}:`),console.warn(l),l=" "):(console.warn(`Unrecognised Value: ${l} for ${o}:`),l=" ")),o=o.replace("RETIRED_",""),c)s.push({tag:c.tag,tagIndent:n,vr:c.vr,keyword:o,value:l});else{const e=/[0-9A-Fa-f]{6}/g;if(o.match(e)){const e=`(${o.substring(0,4)},${o.substring(4,8)})`;s.push({tag:e,tagIndent:n,vr:"",keyword:"Private Tag",value:l})}}}var r;return s}function E(e){e.sort(((e,t)=>e.tag<t.tag?-1:1))}const x=({displaySets:e,displaySetInstanceUID:t})=>{const a=new Set([1]),[n,s]=(0,i.useState)(t),[o,l]=(0,i.useState)(1),[m,p]=(0,i.useState)(""),g=e.find((e=>e.displaySetInstanceUID===n)),f=g instanceof h;const S=f&&g.images.length>1,I=(0,i.useMemo)((()=>(e.sort(((e,t)=>e.SeriesNumber-t.SeriesNumber)),e.map((e=>{const{displaySetInstanceUID:t,SeriesDate:a,SeriesTime:n,SeriesNumber:s,SeriesDescription:i,Modality:o}=e,c=`${a}:${n}`.split(".")[0];return{value:t,label:`${s} (${o}):  ${i}`,description:r()(c,"YYYYMMDD:HHmmss").format("ddd, MMM Do YYYY")}})))),[e]),v=(0,i.useMemo)((()=>{let e;e=f?g.images[o-1]:g.instance||g;const t=function(e){const t=b(e);return E(t),t}(e);return w(t,e)}),[o,n]),D=(0,i.useMemo)((()=>{if(!m)return v;const e=m.toLowerCase();return v.filter((t=>t.reduce(((t,n,s)=>t||(a.has(s)?t:t||n.toLowerCase().includes(e))),!1)))}),[v,m]),x=(0,i.useMemo)((()=>u()(p,200)),[]);return(0,i.useEffect)((()=>()=>{x?.cancel()}),[]),i.createElement("div",{className:"dicom-tag-browser-content bg-muted"},i.createElement("div",{className:"mb-6 flex flex-row items-start pl-1"},i.createElement("div",{className:"flex w-full flex-row items-start gap-4"},i.createElement("div",{className:"flex w-1/3 flex-col"},i.createElement("span",{className:"text-muted-foreground flex h-6 items-center text-xs"},"Series"),i.createElement(d.l6,{value:n,onValueChange:e=>(e=>{s(e.value),l(1)})({value:e})},i.createElement(d.bq,null,I.find((e=>e.value===n))?.label||"Select Series"),i.createElement(d.gC,null,I.map((e=>i.createElement(d.eb,{key:e.value,value:e.value},e.label,i.createElement("span",{className:"text-muted-foreground ml-1 text-xs"},e.description))))))),S&&i.createElement("div",{className:"mx-auto flex w-1/5 flex-col"},i.createElement("span",{className:"text-muted-foreground flex h-6 items-center text-xs"},"Instance Number (",o," of ",g.images.length,")"),i.createElement(d.Ap,{value:[o],onValueChange:([e])=>{l(e)},min:1,max:g.images.length,step:1,className:"pt-4"})),i.createElement("div",{className:"ml-auto flex w-1/3 flex-col"},i.createElement("span",{className:"text-muted-foreground flex h-6 items-center text-xs"},"Search metadata"),i.createElement(c.Cv,{placeholder:"Search metadata...",onDebounceChange:p})))),i.createElement(y,{rows:D}))}},55172:(e,t,a)=>{a.r(t),a.d(t,{ContextMenuController:()=>Qt,CustomizableContextMenuTypes:()=>n,PanelStudyBrowserHeader:()=>Be,StaticWadoClient:()=>T,callInputDialog:()=>gn,callLabelAutocompleteDialog:()=>fn,cleanDenaturalizedDataset:()=>on,colorPickerDialog:()=>yn,createReportAsync:()=>dn,createReportDialogPrompt:()=>st,default:()=>En,dicomWebUtils:()=>s,getStudiesForPatientByMRN:()=>Ze,promptLabelAnnotation:()=>Dn,promptSaveReport:()=>vn,showLabelAnnotationPopup:()=>Sn,useDisplaySetSelectorStore:()=>ia,useHangingProtocolStageIndexStore:()=>ca,usePatientInfo:()=>Re,useToggleHangingProtocolStore:()=>Sa,useToggleOneUpViewportGridStore:()=>Ia.Y,useUIStateStore:()=>pn,useViewportGridStore:()=>sa,useViewportsByPositionStore:()=>da,utils:()=>r});var n={};a.r(n);var s={};a.r(s),a.d(s,{cleanDenaturalizedDataset:()=>on,fixBulkDataURI:()=>F,fixMultiValueKeys:()=>ln,transferDenaturalizedDataset:()=>cn});var r={};a.r(r),a.d(r,{addIcon:()=>wn});var i=a(83562),o=a(29463),c=a(45476);const{getString:l,getName:u,getModalities:d}=o.ll;function m(e){if(!e||!e.length)return[];const t=[];return e.forEach((e=>t.push({studyInstanceUid:l(e["0020000D"]),date:l(e["00080020"]),time:l(e["00080030"]),accession:l(e["00080050"])||"",mrn:l(e["00100020"])||"",patientName:o.Wp.formatPN(u(e["00100010"]))||"",instances:Number(l(e["00201208"]))||0,description:l(e["00081030"])||"",modalities:l(d(e["00080060"],e["00080061"]))||""}))),t}async function p(e,t,a,n){return await e.searchForStudies({studyInstanceUid:void 0,queryParams:n})}function g(e,t={}){if(!e)return;const a=["00081030","00080060"].join(","),n=void 0!==e?.disableWildcard?!e.disableWildcard:t.supportsWildcard,s=e=>n&&e?`*${e}*`:e,r={PatientName:s(e.patientName),"00100020":s(e.patientId),AccessionNumber:s(e.accessionNumber),StudyDescription:s(e.studyDescription),ModalitiesInStudy:e.modalitiesInStudy,limit:e.limit||101,offset:e.offset||0,fuzzymatching:!0===t.supportsFuzzyMatching,includefield:a};if(e.startDate&&e.endDate)r.StudyDate=`${e.startDate}-${e.endDate}`;else if(e.startDate){const t=new Date,a=String(t.getDate()).padStart(2,"0"),n=String(t.getMonth()+1).padStart(2,"0"),s=`${t.getFullYear()}${n}${a}`;r.StudyDate=`${e.startDate}-${s}`}else if(e.endDate){const t="19700102";r.StudyDate=`${t}-${e.endDate}`}if(e.studyInstanceUid){let t=e.studyInstanceUid;t=Array.isArray(t)?t.join():t,t=t.replace(/[^0-9.]+/g,"\\"),r.StudyInstanceUID=t}const i={};return Object.keys(r).forEach((e=>{void 0!==r[e]&&""!==r[e]&&(i[e]=r[e])})),i}function f({instance:e,frame:t,config:a,thumbnail:n=!1}){if(!e)return;if(e.imageId&&void 0===t)return e.imageId;if(e.url)return e.url;const s=n?"thumbnailRendering":"imageRendering";if(a[s]&&"wadouri"!==a[s])return function(e,t,a){const n=function(e,t,a){const n=function(e,t){const{StudyInstanceUID:a,SeriesInstanceUID:n,SOPInstanceUID:s}=e;return`${t.wadoRoot}/studies/${a}/series/${n}/instances/${s}`}(e,t);return`${n}/frames/${a=a||1}`}(e,t,a);if(n)return`wadors:${n}`}(e,a,t);{const n=function(e,t){const{StudyInstanceUID:a,SeriesInstanceUID:n,SOPInstanceUID:s}=t,r=[];r.push("requestType=WADO"),r.push(`studyUID=${a}`),r.push(`seriesUID=${n}`),r.push(`objectUID=${s}`),r.push("contentType=application/dicom"),r.push("transferSyntax=*");const i=r.join("&");return`${e.wadoUriRoot}?${i}`}(a,e);let s="dicomweb:"+n;return void 0!==t&&(s+="&frame="+t),s}}var S=a(5842);class I{constructor(e,t,a={},n=void 0,s=void 0){this.client=e,this.studyInstanceUID=t,this.filters=a,this.sortCriteria=n,this.sortFunction=s}async execLoad(){const e=await this.preLoad(),t=await this.load(e);return await this.posLoad(t)}async runLoaders(e){let t;for(const a of e)if(t=await a(),t&&t.length)break;if(e.next().done&&!t)throw new Error("RetrieveMetadataLoader failed");return t}async configLoad(){}async preLoad(){}async load(e){}async posLoad(e){}}class y extends I{getOptions(){const{studyInstanceUID:e,filters:t}=this,a={studyInstanceUID:e},{seriesInstanceUID:n}=t;return n&&(a.seriesInstanceUID=n),a}*getLoaders(){const e=[],{studyInstanceUID:t,filters:{seriesInstanceUID:a}={},client:n}=this;a&&e.push(n.retrieveSeriesMetadata.bind(n,{studyInstanceUID:t,seriesInstanceUID:a})),e.push(n.retrieveStudyMetadata.bind(n,{studyInstanceUID:t})),yield*e}async load(e){const t=this.getLoaders();return this.runLoaders(t)}async posLoad(e){return e}}const h=["00080021","00080031","0008103E","00200011"].join(",");class v{constructor(){this.metadata=void 0,this.processFunction=void 0,this.internalPromise=void 0,this.thenFunction=void 0,this.rejectFunction=void 0}setMetadata(e){this.metadata=e}setProcessFunction(e){this.processFunction=e}getPromise(){return this.start()}start(){return this.internalPromise||(this.internalPromise=this.processFunction(),this.thenFunction&&(this.then(this.thenFunction),this.thenFunction=void 0),this.rejectFunction&&(this.reject(this.rejectFunction),this.rejectFunction=void 0)),this.internalPromise}then(e){if(this.internalPromise)return this.internalPromise.then(e);this.thenFunction=e}reject(e){if(this.internalPromise)return this.internalPromise.reject(e);this.rejectFunction=e}}class D extends I{*getPreLoaders(){const e=[],{studyInstanceUID:t,filters:{seriesInstanceUID:a}={},client:n}=this;let s={studyInstanceUID:t,queryParams:{includefield:h}};a&&(s.queryParams.SeriesInstanceUID=a,e.push(n.searchForSeries.bind(n,s))),e.push(n.searchForSeries.bind(n,s)),yield*e}async preLoad(){const e=this.getPreLoaders(),t=await this.runLoaders(e),a=this.sortCriteria,n=this.sortFunction,{naturalizeDataset:s}=S.Ay.data.DicomMetaDictionary,r=t.map(s);return(0,c.LM)(r,a,n)}async load(e){const{client:t,studyInstanceUID:a}=this,n=function(e,t,a){return Object.freeze({hasNext:()=>a.length>0,next(){const{seriesInstanceUID:n,metadata:s}=a.shift(),r=new v;return r.setMetadata(s),r.setProcessFunction((()=>e.retrieveSeriesMetadata({studyInstanceUID:t,seriesInstanceUID:n}))),r}})}(t,a,e.map((e=>({seriesInstanceUID:e.SeriesInstanceUID,metadata:e})))),s=[];for(;n.hasNext();){const e=n.next();s.push(e)}return{preLoadData:e,promises:s}}async posLoad({preLoadData:e,promises:t}){return{preLoadData:e,promises:t}}}const w=async function(e,t,a,n={},s,r){const i=new(!1!==a?D:y)(e,t,n,s,r);return await i.execLoad()};const b=function(e,t,a,n,s,r){const{seriesInstanceUID:i}=n;return new Promise(((o,c)=>{const l=i.map((i=>{const o=Object.assign({},n,{seriesInstanceUID:i});return w(e,t,a,o,s,r)}));!0===a?Promise.all(l).then((e=>{const t={preLoadData:[],promises:[]};e.forEach((({preLoadData:e,promises:a})=>{t.preLoadData=t.preLoadData.concat(e),t.promises=t.promises.concat(a)})),o(t)}),c):Promise.all(l).then((e=>{o(e.flat())}),c)}))},E="RetrieveStudyMetadata",x=new Map;function M(e,t,a,n,s,r,i={}){if(!e)throw new Error(`${E}: Required 'dicomWebClient' parameter not provided.`);if(!t)throw new Error(`${E}: Required 'StudyInstanceUID' parameter not provided.`);const o=`${i.name}:${t}`;if(x.has(o))return x.get(o);let c;return c=n&&n.seriesInstanceUID&&Array.isArray(n.seriesInstanceUID)?b(e,t,a,n,s,r):new Promise(((i,o)=>{w(e,t,a,n,s,r).then((function(e){i(e)}),o)})),x.set(o,c),c}function U(e){x.has(e)&&x.delete(e)}function P(e,t,a){if(a+e.length>t.length)return!1;let n=a;for(let a=0;a<e.length;a++)if(e[a]!==t[n++])return!1;return!0}const C=function(e,t,a){a=a||0;const n=function(e){const t=new Uint8Array(e.length);for(let a=0,n=e.length;a<n;a++)t[a]=e.charCodeAt(a);return t}(t);for(let t=a;t<e.length;t++)if(n[0]===e[t]&&P(n,e,t))return t;return-1};function N(e){const t=new Uint8Array(e[0]);if(t.length<25)return e;const a=C(t,"--");if(a>6)return e;const n=C(t,"\r\n\r\n",a);if(n>512)return e;const s=function(e,t,a){t=t||0,a=a||e.length-t;let n="";for(let s=t;s<t+a;s++)n+=String.fromCharCode(e[s]);return n}(t,0,n),r=function(e){for(let t=0;t<e.length;t++)if("--"===e[t].substr(0,2))return e[t]}(s.split("\r\n"));if(!r)return e;const i=n+4,o=C(t,r,i);return-1===o?e:[t.slice(i,o-2).buffer]}const{DICOMwebClient:R}=i.FH,O=R;O._orig_buildMultipartAcceptHeaderFieldValue||(O._orig_buildMultipartAcceptHeaderFieldValue=O._buildMultipartAcceptHeaderFieldValue,O._buildMultipartAcceptHeaderFieldValue=function(e,t){return 1===e.length&&e[0].mediaType.endsWith("/*")?"*/*":O._orig_buildMultipartAcceptHeaderFieldValue(e,t)});class T extends i.FH.DICOMwebClient{constructor(e){super(e),this.config=void 0,this.staticWado=void 0,this.staticWado=e.staticWado,this.config=e}retrieveBulkData(e){const t=!1!==this.config.fixBulkdataMultipart,a={...e};return this.staticWado&&(a.mediaTypes=[{mediaType:"application/*"}]),super.retrieveBulkData(a).then((e=>t?N(e):e))}retrieveInstanceFrames(e){return this.staticWado?super.retrieveInstanceFrames({...e,mediaTypes:[{mediaType:"image/*"}]}):super.retrieveInstanceFrames(e)}async searchForStudies(e){if(!this.staticWado)return super.searchForStudies(e);const t=await super.searchForStudies(e),{queryParams:a}=e;if(!a)return t;const n=this.toLowerParams(a);return t.filter((e=>{for(const t of Object.keys(T.studyFilterKeys))if(!this.filterItem(t,n,e,T.studyFilterKeys))return!1;return!0}))}async searchForSeries(e){if(!this.staticWado)return super.searchForSeries(e);const t=await super.searchForSeries(e),{queryParams:a}=e;if(!a)return t;const n=this.toLowerParams(a);return t.filter((e=>{for(const t of Object.keys(T.seriesFilterKeys))if(!this.filterItem(t,n,e,T.seriesFilterKeys))return!1;return!0}))}compareValues(e,t){if(Array.isArray(e))return e.find((e=>this.compareValues(e,t)));if(Array.isArray(t))return t.find((t=>this.compareValues(e,t)));if(t?.Alphabetic&&(t=t.Alphabetic),"string"==typeof t){if(0===t.length)return!0;if(0===e.length||"*"===e)return!0;if("*"===e[0]&&"*"===e[e.length-1])return-1!=t.indexOf(e.substring(1,e.length-1));if("*"===e[e.length-1])return-1!=t.indexOf(e.substring(0,e.length-1));if("*"===e[0])return t.indexOf(e.substring(1))===t.length-e.length+1}return e===t}compareDateRange(e,t){if(!t)return!0;const a=e.indexOf("-");if(-1===a)return this.compareValues(e,t);const n=e.substring(0,a),s=e.substring(a+1);return(!n||t>=n)&&(!s||t<=s)}filterItem(e,t,a,n){const s=n[e]||e;if(!t)return!0;const r=t[e]||t[s];if(!r)return!0;const i=a[e]||a[s];if(!i)return!1;if("DA"===i.vr&&i.Value?.[0])return this.compareDateRange(r,i.Value[0]);const o=i.Value;return this.compareValues(r,o)}toLowerParams(e){const t={};return Object.entries(e).forEach((([e,a])=>{t[e.toLowerCase()]=a})),t}}T.studyFilterKeys={studyinstanceuid:"0020000D",patientname:"00100010","00100020":"mrn",studydescription:"00081030",studydate:"00080020",modalitiesinstudy:"00080061",accessionnumber:"00080050"},T.seriesFilterKeys={seriesinstanceuid:"0020000E",seriesnumber:"00200011",modality:"00080060"};const A=(e,t)=>{const{instance:a,tag:n="PixelData",defaultPath:s="/pixeldata",defaultType:r="video/mp4"}=t,i=a[n],{StudyInstanceUID:o,SeriesInstanceUID:c,SOPInstanceUID:l}=a,u=i&&i.BulkDataURI||`series/${c}/instances/${l}${s}`,d=-1!==u.indexOf("?"),m=-1!==u.indexOf("accept="),p=u+(m?"":(d?"&":"?")+`accept=${r}`);if(p.startsWith("series/")){const{wadoRoot:t}=e;return`${t}/studies/${o}/${p}`}return p},L=(e,t)=>{const{wadoRoot:a}=e,{instance:n,tag:s="PixelData"}=t,{StudyInstanceUID:r,SeriesInstanceUID:i,SOPInstanceUID:o}=n,c=n[s]?.BulkDataURI??"";if(-1===c?.indexOf("?"))return"PixelData"===s||"EncapsulatedDocument"===s?`${a}/studies/${r}/series/${i}/instances/${o}/rendered`:void 0},V=(e,t)=>{const{singlepart:a}=e,{instance:n,tag:s="PixelData",defaultType:r="video/mp4",singlepart:i="video",url:c=null}=t;if(c)return c;const l=n[s];if(l){if(l.DirectRetrieveURL)return l.DirectRetrieveURL;if(l.InlineBinary){const e=o.Wp.b64toBlob(l.InlineBinary,r);return l.DirectRetrieveURL=URL.createObjectURL(e),l.DirectRetrieveURL}if(!a||!0!==a&&-1===a.indexOf(i)){if(l.retrieveBulkData){const e={mediaType:r};return l.retrieveBulkData(e).then((e=>(l.DirectRetrieveURL=URL.createObjectURL(new Blob([e],{type:r})),l.DirectRetrieveURL)))}return void console.warn("Unable to retrieve",s,"from",n)}}return L(e,t)||A(e,t)};function F(e,t,a){let{BulkDataURI:n}=e;const{bulkDataURI:s={}}=a;n=s.transform?.(n)||n;const{startsWith:r,prefixWith:i=""}=s;if(r&&n.startsWith(r)&&(n=i+n.substring(r.length),e.BulkDataURI=n),n.startsWith("http")||e.BulkDataURI.startsWith("/")){if("/"===n[0]&&a.wadoRoot.startsWith("http")){const t=new URL(a.wadoRoot);e.BulkDataURI=`${t.origin}${n}`}}else{const{StudyInstanceUID:r,SeriesInstanceUID:i}=t,o=n.startsWith("instances/")||n.startsWith("../");n.startsWith("series/")||n.startsWith("bulkdata/")||"studies"===s.relativeResolution&&!o?e.BulkDataURI=`${a.wadoRoot}/studies/${r}/${n}`:!o&&"series"!==s.relativeResolution&&s.relativeResolution||(e.BulkDataURI=`${a.wadoRoot}/studies/${r}/series/${i}/${n}`)}}const{DicomMetaDictionary:k,DicomDict:q}=S.Ay.data,{naturalizeDataset:H,denaturalizeDataset:$}=k,_="2.25.270695996825855179949881587723571202391.2.0.0",B="OHIF-VIEWER-2.0.0",j="1.2.840.10008.1.2.1",G=o.Ly.MetadataProvider;function W(e,t){const{userAuthenticationService:a,customizationService:n}=t.services;let s,r,u,d,S,I,y;const h={initialize:({params:t,query:n})=>{e.onConfiguration&&"function"==typeof e.onConfiguration&&(e=e.onConfiguration(e,{params:t,query:n})),s=JSON.parse(JSON.stringify(e)),I=()=>{const e={},t=a.getAuthorizationHeader();return t&&t.Authorization&&(e.Authorization=t.Authorization),e},y=()=>({...I(),Accept:o.Wp.generateAcceptHeader(e.acceptHeader,e.requestTransferSyntaxUID,e.omitQuotationForMultipartRequest)}),r={url:e.qidoRoot,staticWado:e.staticWado,singlepart:e.singlepart,headers:a.getAuthorizationHeader(),errorInterceptor:o.r_.getHTTPErrorHandler()},u={url:e.wadoRoot,staticWado:e.staticWado,singlepart:e.singlepart,headers:a.getAuthorizationHeader(),errorInterceptor:o.r_.getHTTPErrorHandler()},d=e.staticWado?new T(r):new i.FH.DICOMwebClient(r),S=e.staticWado?new T(u):new i.FH.DICOMwebClient(u)},query:{studies:{mapParams:g.bind(),search:async function(t){d.headers=I();const{studyInstanceUid:a,seriesInstanceUid:n,...s}=g(t,{supportsFuzzyMatching:e.supportsFuzzyMatching,supportsWildcard:e.supportsWildcard})||{};return m(await p(d,0,0,s))},processResults:m.bind()},series:{search:async function(e){d.headers=I();return function(e){const t=[];return e&&e.length&&e.forEach((e=>t.push({studyInstanceUid:l(e["0020000D"]),seriesInstanceUid:l(e["0020000E"]),modality:l(e["00080060"]),seriesNumber:l(e["00200011"]),seriesDate:o.Wp.formatDate(l(e["00080021"])),numSeriesInstances:Number(l(e["00201209"])),description:l(e["0008103E"])}))),(0,c.LM)(t),t}(await function(e,t){const a={includefield:["0008103E","00080021"].join(",")};return e.searchForSeries({studyInstanceUID:t,queryParams:a})}(d,e))}},instances:{search:(e,t)=>(d.headers=I(),p.call(void 0,d,e,null,t))}},retrieve:{directURL:t=>V({wadoRoot:e.wadoRoot,singlepart:e.singlepart},t),getWadoDicomWebClient:()=>S,bulkDataURI:async({StudyInstanceUID:e,BulkDataURI:t})=>{d.headers=I();const a={multipart:!1,BulkDataURI:t,StudyInstanceUID:e};return d.retrieveBulkData(a).then((e=>e&&e[0]||void 0))},series:{metadata:async({StudyInstanceUID:t,filters:a,sortCriteria:n,sortFunction:s,madeInClient:r=!1,returnPromises:i=!1}={})=>{if(!t)throw new Error("Unable to query for SeriesMetadata without StudyInstanceUID");return e.enableStudyLazyLoad?h._retrieveSeriesMetadataAsync(t,a,n,s,r,i):h._retrieveSeriesMetadataSync(t,a,n,s,r)}}},store:{dicom:async(e,t,a)=>{if(S.headers=I(),e instanceof ArrayBuffer){const a={datasets:[e],request:t};await S.storeInstances(a)}else{let n=a;if(!a){const t={FileMetaInformationVersion:e._meta?.FileMetaInformationVersion?.Value,MediaStorageSOPClassUID:e.SOPClassUID,MediaStorageSOPInstanceUID:e.SOPInstanceUID,TransferSyntaxUID:j,ImplementationClassUID:_,ImplementationVersionName:B},a=$(t),s=new q(a);s.dict=$(e),n=s}const s={datasets:[n.write()],request:t};await S.storeInstances(s)}}},_retrieveSeriesMetadataSync:async(t,a,n,s,r)=>{S.headers=y();const i=(await M(S,t,!1,a,n,s,e)).map(H),c={},l={};i.forEach((a=>{c[a.SeriesInstanceUID]||(c[a.SeriesInstanceUID]={StudyInstanceUID:a.StudyInstanceUID,StudyDescription:a.StudyDescription,SeriesInstanceUID:a.SeriesInstanceUID,SeriesDescription:a.SeriesDescription,SeriesNumber:a.SeriesNumber,SeriesTime:a.SeriesTime,SOPClassUID:a.SOPClassUID,ProtocolName:a.ProtocolName,Modality:a.Modality}),l[a.SeriesInstanceUID]||(l[a.SeriesInstanceUID]=[]);const n=h.getImageIdsForInstance({instance:a});a.imageId=n,a.wadoRoot=e.wadoRoot,a.wadoUri=e.wadoUri,G.addImageIdToUIDs(n,{StudyInstanceUID:t,SeriesInstanceUID:a.SeriesInstanceUID,SOPInstanceUID:a.SOPInstanceUID}),l[a.SeriesInstanceUID].push(a)}));const u=Object.values(c);return o.H8.addSeriesMetadata(u,r),Object.keys(l).forEach((e=>o.H8.addInstances(l[e],r))),c},_retrieveSeriesMetadataAsync:async(t,a,n,s,r=!1,i=!1)=>{S.headers=y();const{preLoadData:c,promises:l}=await M(S,t,!0,a,n,s,e),u=(t,a=t)=>{for(const n of Object.keys(t)){const s=t[n];Array.isArray(s)&&"object"==typeof s[0]?s.forEach((e=>u(e,a))):s&&s.BulkDataURI&&!s.Value&&(F(s,a,e),s.retrieveBulkData=z.bind(d,s))}return t},m=t=>{const a=H(t);return e.bulkDataURI?.enabled?u(a):a};function p(){const e=o.H8.getStudy(t);e&&(e.isLoaded=!0)}c.forEach((e=>{e.StudyInstanceUID=t})),o.H8.addSeriesMetadata(c,r);const g=l.map((a=>(i||a?.start(),a.then((a=>{!function(a){const n=a.map(m);n.forEach((a=>{a.wadoRoot=e.wadoRoot,a.wadoUri=e.wadoUri;const n=h.getImageIdsForInstance({instance:a});a.imageId=n,G.addImageIdToUIDs(n,{StudyInstanceUID:t,SeriesInstanceUID:a.SeriesInstanceUID,SOPInstanceUID:a.SOPInstanceUID})})),o.H8.addInstances(n,r)}(a)})))));return i?(Promise.all(g).then((()=>p())),l):(await Promise.all(g),p(),c)},deleteStudyMetadataPromise:U,getImageIdsForDisplaySet(e){const t=e.images,a=[];return t?(e.images.forEach((e=>{const t=e.NumberOfFrames;if(t>1)for(let n=1;n<=t;n++){const t=this.getImageIdsForInstance({instance:e,frame:n});a.push(t)}else{const t=this.getImageIdsForInstance({instance:e});a.push(t)}})),a):a},getImageIdsForInstance:({instance:t,frame:a})=>f({instance:t,frame:a,config:e}),getConfig:()=>s,getStudyInstanceUIDs({params:e,query:t}){const{StudyInstanceUIDs:a}=e,n=o.Wp.splitComma(t.getAll("StudyInstanceUIDs")),s=n.length&&n||a;return s&&Array.isArray(s)?s:[s]}};var v;return e.supportsReject&&(h.reject=(v=e.wadoRoot,{series:(e,t)=>new Promise(((a,n)=>{const s=`${v}/studies/${e}/series/${t}/reject/113001%5EDCM`,r=new XMLHttpRequest;r.open("POST",s,!0),console.log(r),r.onreadystatechange=function(){if(4==r.readyState)switch(r.status){case 204:a(r.responseText);break;case 404:n("Your dataSource does not support reject functionality")}},r.send()}))})),o.pt.create(h)}function z(e,t={}){const{mediaType:a}=t,n={multipart:!1,BulkDataURI:e.BulkDataURI,mediaTypes:a?[{mediaType:a},{mediaType:"application/octet-stream"}]:void 0,...t};return this.retrieveBulkData(n).then((t=>{const a=t instanceof Array&&t.find((e=>e?.byteLength))||void 0;return e.Value=a,a}))}var Y=a(98985);const X=o.Ay.classes.MetadataProvider,J={studyInstanceUid:"StudyInstanceUID",patientId:"PatientID"};let K={urls:[],studyInstanceUIDMap:new Map};function Q(e){return Object.keys(e).reduce(((t,a)=>("object"==typeof e[a]&&null!==e[a]?t[a]=Q(e[a]):t[a]=e[a],a.endsWith("Sequence")&&(t[a]=o.Ay.utils.addAccessors(t[a])),t)),Array.isArray(e)?[]:{})}const Z=e=>K.urls.find((t=>t.url===e)),ee=(e,t)=>{let a=[];return K.urls.map((n=>{n.studies.map((n=>{n[e]===t&&a.push(n)}))})),a};function te(e){const t={initialize:async({query:t,url:a})=>{a||(a=t.get("url"));let n=Z(a);if(n)return n.studies.map((e=>e.StudyInstanceUID));const s=await fetch(a),r=await s.json();let i,o;r.studies.forEach((t=>{i=t.StudyInstanceUID,t.series.forEach((t=>{o=t.SeriesInstanceUID,t.instances.forEach((t=>{const{metadata:a}=t,n=f({instance:t,config:e}),{query:s}=Y.parseUrl(t.url);X.addImageIdToUIDs(n,{StudyInstanceUID:i,SeriesInstanceUID:o,SOPInstanceUID:a.SOPInstanceUID,frameNumber:s.frame?parseInt(s.frame):void 0})}))}))})),K.urls.push({url:a,studies:[...r.studies]}),K.studyInstanceUIDMap.set(a,r.studies.map((e=>e.StudyInstanceUID)))},query:{studies:{mapParams:()=>{},search:async e=>{const[t,a]=Object.entries(e)[0],n=J[t];return ee(n,a).map((e=>({accession:e.AccessionNumber,date:e.StudyDate,description:e.StudyDescription,instances:e.NumInstances,modalities:e.Modalities,mrn:e.PatientID,patientName:e.PatientName,studyInstanceUid:e.StudyInstanceUID,NumInstances:e.NumInstances,time:e.StudyTime})))},processResults:()=>{console.warn(" DICOMJson QUERY processResults not implemented")}},series:{search:()=>{console.warn(" DICOMJson QUERY SERIES SEARCH not implemented")}},instances:{search:()=>{console.warn(" DICOMJson QUERY instances SEARCH not implemented")}}},retrieve:{directURL:t=>V(e,t),series:{metadata:async({filters:t,StudyInstanceUID:a,madeInClient:n=!1,customSort:s}={})=>{if(!a)throw new Error("Unable to query for SeriesMetadata without StudyInstanceUID");const r=ee("StudyInstanceUID",a)[0];let i;i=s?s(r.series):r.series;const c=["SeriesInstanceUID","SeriesInstanceUIDs","seriesInstanceUID","seriesInstanceUIDs"].find((e=>t[e]));if(c){const e=t[c];i=i.filter((t=>e.includes(t.SeriesInstanceUID)))}const l=i.map((e=>{const t={StudyInstanceUID:r.StudyInstanceUID,...e};return delete t.instances,t}));o.H8.addSeriesMetadata(l,n);const u=i.length;i.forEach(((t,s)=>{const i=t.instances.map((a=>{const n={...Q(a.metadata),url:a.url,imageId:f({instance:a,config:e}),...t,...r};return delete n.instances,delete n.series,n}));var c;c=i,o.H8.addInstances(c,n),s===u-1&&(o.H8.getStudy(a,n).isLoaded=!0)}))}}},store:{dicom:()=>{console.warn(" DICOMJson store dicom not implemented")}},getImageIdsForDisplaySet(t){const a=t.images,n=[];if(!a)return n;const{StudyInstanceUID:s,SeriesInstanceUID:r}=t,i=ee("StudyInstanceUID",s)[0].series.find((e=>e.SeriesInstanceUID===r))||[],o=new Map;return i.instances.forEach((e=>{if(e?.metadata?.SOPInstanceUID){const{metadata:t,url:a}=e,n=o.get(t.SOPInstanceUID)||[];n.push({...t,url:a}),o.set(t.SOPInstanceUID,n)}})),t.images.forEach((t=>{const a=t.NumberOfFrames||1,s=o.get(t.SOPInstanceUID)||[t];for(let t=0;t<a;t++){const r=f({instance:s[Math.min(t,s.length-1)],frame:a>1?t:void 0,config:e});n.push(r)}})),n},getImageIdsForInstance:({instance:e,frame:t})=>f({instance:e,frame:t}),getStudyInstanceUIDs:({params:e,query:t})=>{const a=t.get("url");return K.studyInstanceUIDMap.get(a)}};return o.pt.create(t)}const ae=o.Ay.classes.MetadataProvider,{EVENTS:ne}=o.H8,se={SR:!0,SEG:!0,DOC:!0},re=(e,t,a=0)=>e===t?a:e<t?-1:1,ie=(e,t)=>{const a=e.instances[0],n=t.instances[0],s=a.Modality,r=n.Modality,i=se[s],o=se[r];return i&&o?re(a.SeriesNumber,n.SeriesNumber):i||o?i?-1:1:re(n.SeriesNumber,a.SeriesNumber)};function oe(e){const{name:t}=e,a={initialize:({params:e,query:t})=>{},query:{studies:{mapParams:()=>{},search:e=>o.H8.getStudyInstanceUIDs().map((e=>{let t=0;const a=new Set,n=o.H8.getStudy(e);n.series.forEach((e=>{t+=e.instances.length,a.add(e.instances[0].Modality)}));const s=n?.series[0]?.instances[0];if(s)return{accession:s.AccessionNumber,date:s.StudyDate,description:s.StudyDescription,mrn:s.PatientID,patientName:o.Wp.formatPN(s.PatientName),studyInstanceUid:s.StudyInstanceUID,time:s.StudyTime,instances:t,modalities:Array.from(a).join("/"),NumInstances:t}})),processResults:()=>{console.warn(" DICOMLocal QUERY processResults not implemented")}},series:{search:e=>o.H8.getStudy(e).series.map((t=>{const a=t?.instances[0];return{studyInstanceUid:e,seriesInstanceUid:a.SeriesInstanceUID,modality:a.Modality,seriesNumber:a.SeriesNumber,seriesDate:a.SeriesDate,numSeriesInstances:t.instances.length,description:a.SeriesDescription}}))},instances:{search:()=>{console.warn(" DICOMLocal QUERY instances SEARCH not implemented")}}},retrieve:{directURL:e=>{const{instance:t,tag:a,defaultType:n}=e,s=t[a];if(s instanceof Array&&s[0]instanceof ArrayBuffer)return URL.createObjectURL(new Blob([s[0]],{type:n}))},series:{metadata:async({StudyInstanceUID:e,madeInClient:t=!1}={})=>{if(!e)throw new Error("Unable to query for SeriesMetadata without StudyInstanceUID");const a=o.H8.getStudy(e,t);o.H8._broadcastEvent(ne.SERIES_ADDED,{StudyInstanceUID:e,madeInClient:t}),a.series.forEach((a=>{const{SeriesInstanceUID:n}=a,s=a.instances[0].NumberOfFrames>1;a.instances.forEach(((e,t)=>{const{url:a,StudyInstanceUID:n,SeriesInstanceUID:r,SOPInstanceUID:i}=e;e.imageId=a,ae.addImageIdToUIDs(a,{StudyInstanceUID:n,SeriesInstanceUID:r,SOPInstanceUID:i,frameIndex:s?t:1})})),o.H8._broadcastEvent(ne.INSTANCES_ADDED,{StudyInstanceUID:e,SeriesInstanceUID:n,madeInClient:t})}))}}},store:{dicom:e=>{const t=S.Ay.data.datasetToBlob(e);var a=URL.createObjectURL(t);window.location.assign(a)}},getImageIdsForDisplaySet(e){const t=e.images,a=[];return t?(e.images.forEach((e=>{const t=e.NumberOfFrames;if(t>1)for(let n=1;n<=t;n++){const t=this.getImageIdsForInstance({instance:e,frame:n});a.push(t)}else{const t=this.getImageIdsForInstance({instance:e});a.push(t)}})),a):a},getImageIdsForInstance({instance:e,frame:t}){if(e.imageId)return e.imageId;const{StudyInstanceUID:a,SeriesInstanceUID:n,SOPInstanceUID:s}=e;let r=o.H8.getInstance(a,n,s).url;return void 0!==t&&(r+=`&frame=${t}`),r},deleteStudyMetadataPromise(){console.log("deleteStudyMetadataPromise not implemented")},getStudyInstanceUIDs:({params:e,query:t})=>{const{StudyInstanceUIDs:a}=e,n=t.getAll("StudyInstanceUIDs")||a,s=n&&Array.isArray(n)?n:[n];let r=!1;return s.forEach((e=>{const t=o.H8.getStudy(e);t&&(t.series=t.series.sort(ie),r=!0)})),r?s:[]}};return o.pt.create(a)}function ce(e,t){const{name:a}=e;let n;const s={initialize:async({params:e,query:s})=>{const r=s.get("url");if(!r)throw new Error(`No url for '${a}'`);{const a=await fetch(r),i=await a.json();if(!i.servers?.dicomWeb?.[0])throw new Error("Invalid configuration returned by url");n=W(i.servers.dicomWeb[0].configuration||i.servers.dicomWeb[0],t),n.initialize({params:e,query:s})}},query:{studies:{search:e=>n.query.studies.search(e)},series:{search:(...e)=>n.query.series.search(...e)},instances:{search:(e,t)=>n.query.instances.search(e,t)}},retrieve:{directURL:(...e)=>n.retrieve.directURL(...e),series:{metadata:async(...e)=>n.retrieve.series.metadata(...e)}},store:{dicom:(...e)=>n.store(...e)},deleteStudyMetadataPromise:(...e)=>n.deleteStudyMetadataPromise(...e),getImageIdsForDisplaySet:(...e)=>n.getImageIdsForDisplaySet(...e),getImageIdsForInstance:(...e)=>n.getImageIdsForInstance(...e),getStudyInstanceUIDs({params:e,query:t}){let n=[];const s=t.get("studyInstanceUIDs")||t.get("studyInstanceUids");if(!s)throw new Error(`No studyInstanceUids in request for '${a}'`);return n=s.split(";"),n}};return o.pt.create(s)}var le=a(637);const ue={"query.studies.search":{mergeKey:"studyInstanceUid",tagFunc:e=>e},"query.series.search":{mergeKey:"seriesInstanceUid",tagFunc:(e,t)=>(e.forEach((e=>{e.RetrieveAETitle=t,o.H8.updateSeriesMetadata(e)})),e)}},de=async({mergeMap:e,path:t,args:a,extensionManager:n,dataSourceNames:s,defaultDataSourceName:r})=>{const{mergeKey:i,tagFunc:o}=e[t]||{tagFunc:e=>e},c=Object.values(n.dataSourceDefs),l=c.find((e=>e.sourceName===r)),u=c.filter((e=>e.sourceName!==r));l&&u.unshift(l);const d=[],m=[];for(const e of u){const{configuration:r,sourceName:i}=e;if(r&&s.includes(i)){const[e]=n.getDataSources(i),s=(0,le.get)(e,t).apply(e,a);d.push(s),m.push(i)}}const p=(await Promise.allSettled(d)).map(((e,t)=>o(e.value,m[t])));let g=[];return g=i?(0,le.uniqBy)(p.flat(),(e=>(0,le.get)(e,i))):p.flat(),g},me=({path:e,args:t,extensionManager:a,dataSourceNames:n,defaultDataSourceName:s})=>{const r=Object.values(a.dataSourceDefs),i=r.find((e=>e.sourceName===s)),o=r.filter((e=>e.sourceName!==s));i&&o.unshift(i);const c=[];for(const s of o){const{configuration:r,sourceName:i}=s;if(r&&n.includes(i)){const[n]=a.getDataSources(i),s=(0,le.get)(n,e).apply(n,t);c.push(s)}}return c.flat()},pe=({path:e,args:t,defaultDataSourceName:a,extensionManager:n})=>{const[s]=n.getDataSources(a);return(0,le.get)(s,e).apply(s,t)},ge=({path:e,args:t,defaultDataSourceName:a,extensionManager:n})=>{const[s]=t,r=o.H8.getSeries(s.StudyInstanceUID,s.SeriesInstanceUID),[i]=n.getDataSources(r.RetrieveAETitle||a);return i[e](...t)};function fe(e,t,a){const{seriesMerge:n}=e,{dataSourceNames:s,defaultDataSourceName:r}=n,i={initialize:(...e)=>me({path:"initialize",args:e,extensionManager:a,dataSourceNames:s,defaultDataSourceName:r}),query:{studies:{search:(...e)=>de({mergeMap:ue,path:"query.studies.search",args:e,extensionManager:a,dataSourceNames:s,defaultDataSourceName:r})},series:{search:(...e)=>de({mergeMap:ue,path:"query.series.search",args:e,extensionManager:a,dataSourceNames:s,defaultDataSourceName:r})},instances:{search:(...e)=>de({mergeMap:ue,path:"query.instances.search",args:e,extensionManager:a,dataSourceNames:s,defaultDataSourceName:r})}},retrieve:{bulkDataURI:(...e)=>de({mergeMap:ue,path:"retrieve.bulkDataURI",args:e,extensionManager:a,dataSourceNames:s,defaultDataSourceName:r}),directURL:(...e)=>pe({path:"retrieve.directURL",args:e,defaultDataSourceName:r,extensionManager:a}),series:{metadata:(...e)=>de({mergeMap:ue,path:"retrieve.series.metadata",args:e,extensionManager:a,dataSourceNames:s,defaultDataSourceName:r})}},store:{dicom:(...e)=>pe({path:"store.dicom",args:e,defaultDataSourceName:r,extensionManager:a})},deleteStudyMetadataPromise:(...e)=>me({path:"deleteStudyMetadataPromise",args:e,extensionManager:a,dataSourceNames:s,defaultDataSourceName:r}),getImageIdsForDisplaySet:(...e)=>ge({path:"getImageIdsForDisplaySet",args:e,defaultDataSourceName:r,extensionManager:a}),getImageIdsForInstance:(...e)=>ge({path:"getImageIdsForDisplaySet",args:e,defaultDataSourceName:r,extensionManager:a}),getStudyInstanceUIDs:(...e)=>me({path:"getStudyInstanceUIDs",args:e,extensionManager:a,dataSourceNames:s,defaultDataSourceName:r})};return o.pt.create(i)}const Se=function(){return[{name:"dicomweb",type:"webApi",createDataSource:W},{name:"dicomwebproxy",type:"webApi",createDataSource:ce},{name:"dicomjson",type:"jsonApi",createDataSource:te},{name:"dicomlocal",type:"localApi",createDataSource:oe},{name:"merge",type:"mergeApi",createDataSource:fe}]};var Ie=a(86326),ye=a(97598),he=a.n(ye),ve=a(58851),De=a(45981),we=a(49348),be=a(99993),Ee=a(67435),xe=a(43494),Me=a(16076);function Ue(){return Ue=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Ue.apply(null,arguments)}function Pe({servicesManager:e,buttonSection:t="primary"}){const{toolbarButtons:a,onInteraction:n}=(0,o.tR)({servicesManager:e,buttonSection:t});return a.length?Ie.createElement(Ie.Fragment,null,a.map((t=>{if(!t)return null;const{id:a,Component:s,componentProps:r}=t,i=Ie.createElement(s,Ue({key:a,id:a,onInteraction:n,servicesManager:e},r));return Ie.createElement("div",{key:a},i)}))):null}const{formatPN:Ce,formatDate:Ne}=o.Wp;const Re=function(e){const{displaySetService:t}=e.services,[a,n]=(0,Ie.useState)({PatientName:"",PatientID:"",PatientSex:"",PatientDOB:""}),[s,r]=(0,Ie.useState)(!1),i=t.getActiveDisplaySets(),o=()=>{const e=i[0],a=e?.instances?.[0]||e?.instance;a&&(n({PatientID:a.PatientID||null,PatientName:a.PatientName?Ce(a.PatientName.Alphabetic):null,PatientSex:a.PatientSex||null,PatientDOB:Ne(a.PatientBirthDate)||null}),(e=>{const a=t.getActiveDisplaySets();let n=!1;a.forEach((t=>{const a=t?.instances?.[0]||t?.instance;a&&a.PatientID!==e&&(n=!0)})),r(n)})(a.PatientID||null))};return(0,Ie.useEffect)((()=>{const e=t.subscribe(t.EVENTS.DISPLAY_SETS_ADDED,(()=>o()));return()=>e.unsubscribe()}),[]),(0,Ie.useEffect)((()=>{o()}),[i]),{patientInfo:a,isMixedPatients:s}};let Oe=function(e){return e.VISIBLE="visible",e.VISIBLE_COLLAPSED="visibleCollapsed",e.DISABLED="disabled",e.VISIBLE_READONLY="visibleReadOnly",e}({});const Te=(e,t)=>e?.length>t?e.substring(0,t)+"...":e;const Ae=function({servicesManager:e,appConfig:t}){const a=t.showPatientInfo===Oe.VISIBLE||t.showPatientInfo===Oe.VISIBLE_READONLY,[n,s]=(0,Ie.useState)(a),{patientInfo:r,isMixedPatients:i}=Re(e);(0,Ie.useEffect)((()=>{i&&n&&s(!1)}),[i,n]);const o=Te(r.PatientName,27),c=Te(r.PatientID,15);return Ie.createElement("div",{className:"hover:bg-primary-dark flex cursor-pointer items-center justify-center gap-1 rounded-lg",onClick:()=>{i||t.showPatientInfo===Oe.VISIBLE_READONLY||s(!n)}},i?Ie.createElement(xe.FI.MultiplePatients,{className:"text-primary-active"}):Ie.createElement(xe.FI.Patient,{className:"text-primary-active"}),Ie.createElement("div",{className:"flex flex-col justify-center"},n?Ie.createElement(Ie.Fragment,null,Ie.createElement("div",{className:"self-start text-[13px] font-bold text-white"},o),Ie.createElement("div",{className:"text-aqua-pale flex gap-2 text-[11px]"},Ie.createElement("div",null,c),Ie.createElement("div",null,r.PatientSex),Ie.createElement("div",null,r.PatientDOB))):Ie.createElement("div",{className:"text-primary-active self-center text-[13px]"},i?"Multiple Patients":"Patient")),Ie.createElement(xe.FI.ChevronPatient,{className:"text-primary-active "+(n?"rotate-180":"")}))},{availableLanguages:Le,defaultLanguage:Ve,currentLanguage:Fe}=Me.A;const ke=function({hotkeysManager:e,extensionManager:t,servicesManager:a,appConfig:n}){const s=(0,we.Zp)(),r=(0,Ee.zy)(),{t:i}=(0,be.Bd)(),{show:c,hide:l}=(0,ve.hS)(),{hotkeyDefinitions:u,hotkeyDefaults:d}=e,m=[{title:i("Header:About"),icon:"info",onClick:()=>c({content:ve.VT,title:i("AboutModal:About OHIF Viewer"),contentProps:{versionNumber:"3.10.0-beta.5",commitHash:"32fe2623cfb5129a19ee07031dd50e79b530c7e0"},containerDimensions:"max-w-4xl max-h-4xl"})},{title:i("Header:Preferences"),icon:"settings",onClick:()=>c({title:i("UserPreferencesModal:User preferences"),content:ve.im,containerDimensions:"w-[70%] max-w-[900px]",contentProps:{hotkeyDefaults:e.getValidHotkeyDefinitions(d),hotkeyDefinitions:u,currentLanguage:Fe(),availableLanguages:Le,defaultLanguage:Ve,onCancel:()=>{o.ot.stopRecord(),o.ot.unpause(),l()},onSubmit:({hotkeyDefinitions:t,language:a})=>{a.value!==Fe().value&&Me.A.changeLanguage(a.value),e.setHotkeys(t),l()},onReset:()=>e.restoreDefaultBindings(),hotkeysModule:o.ot}})}];return n.oidc&&m.push({title:i("Header:Logout"),icon:"power-off",onClick:async()=>{s(`/logout?redirect_uri=${encodeURIComponent(window.location.href)}`)}}),Ie.createElement(xe.Y9,{menuOptions:m,isReturnEnabled:!!n.showStudyList,onClickReturnButton:()=>{const{pathname:e}=r,a=e.indexOf("/",1),n=new URLSearchParams(window.location.search).get("configUrl"),i=e.substring(a+1),o=t.getDataSources(i),c=new URLSearchParams;-1!==a&&o&&c.append("datasources",e.substring(a+1)),n&&c.append("configUrl",n),s({pathname:"/",search:decodeURIComponent(c.toString())})},WhiteLabeling:n.whiteLabeling,Secondary:Ie.createElement(Pe,{servicesManager:a,buttonSection:"secondary"}),PatientInfo:n.showPatientInfo!==Oe.DISABLED&&Ie.createElement(Ae,{servicesManager:a,appConfig:n})},Ie.createElement("div",{className:"relative flex justify-center gap-[4px]"},Ie.createElement(Pe,{servicesManager:a})))};function qe(){return qe=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},qe.apply(null,arguments)}const He=({servicesManager:e,side:t,activeTabIndex:a,tabs:n,expandedWidth:s,...r})=>{const i=e?.services?.panelService,[o,c]=(0,Ie.useState)(null!==a),[l,u]=(0,Ie.useState)(a),[d,m]=(0,Ie.useState)(n??i.getPanels(t)),p=(0,Ie.useCallback)((({activeTabIndex:e})=>{u(e),c(null!==e)}),[]),g=(0,Ie.useCallback)((()=>{c(!0),null===l&&d.length>0&&u(0)}),[l,d]),f=(0,Ie.useCallback)((()=>{c(!1),u(null)}),[]);return(0,Ie.useEffect)((()=>{u(a)}),[a]),(0,Ie.useEffect)((()=>{const{unsubscribe:e}=i.subscribe(i.EVENTS.PANELS_CHANGED,(e=>{e.position===t&&m(i.getPanels(t))}));return()=>{e()}}),[i,t]),(0,Ie.useEffect)((()=>{const e=i.subscribe(i.EVENTS.ACTIVATE_PANEL,(e=>{if(o||e.forceActive){const t=d.findIndex((t=>t.id===e.panelId));-1!==t&&u(t)}}));return()=>{e.unsubscribe()}}),[d,o,i]),Ie.createElement(xe.d_,qe({},r,{side:t,tabs:d,activeTabIndex:l,onOpen:g,onClose:f,onActiveTabIndexChange:p,expandedWidth:s}))};function $e({extensionManager:e,servicesManager:t,hotkeysManager:a,commandsManager:n,viewports:s,ViewportGridComp:r,leftPanelClosed:i=!1,rightPanelClosed:c=!1}){const[l]=(0,De.r)(),{panelService:u,hangingProtocolService:d}=t.services,[m,p]=(0,Ie.useState)(l.showLoadingIndicator),g=(0,Ie.useCallback)((e=>!!u.getPanels(e).length),[u]),[f,S]=(0,Ie.useState)(g("right")),[I,y]=(0,Ie.useState)(g("left")),[h,v]=(0,Ie.useState)(i),[D,w]=(0,Ie.useState)(c);(0,Ie.useEffect)((()=>(document.body.classList.add("bg-black"),document.body.classList.add("overflow-hidden"),()=>{document.body.classList.remove("bg-black"),document.body.classList.remove("overflow-hidden")})),[]);(0,Ie.useEffect)((()=>{const{unsubscribe:e}=d.subscribe(o.Qe.EVENTS.PROTOCOL_CHANGED,(()=>{p(!1)}));return()=>{e()}}),[d]);(0,Ie.useEffect)((()=>{const{unsubscribe:e}=u.subscribe(u.EVENTS.PANELS_CHANGED,(({options:e})=>{y(g("left")),S(g("right")),void 0!==e?.leftPanelClosed&&v(e.leftPanelClosed),void 0!==e?.rightPanelClosed&&w(e.rightPanelClosed)}));return()=>{e()}}),[u,g]);const b=s.map((t=>{const{entry:a}=(t=>{const a=e.getModuleEntry(t);if(!a||!a.component)throw new Error(`${t} is not valid for an extension module or no component found from extension ${t}. Please verify your configuration or ensure that the extension is properly registered. It's also possible that your mode is utilizing a module from an extension that hasn't been included in its dependencies (add the extension to the "extensionDependencies" array in your mode's index.js file). Check the reference string to the extension in your Mode configuration`);return{entry:a,content:a.component}})(t.namespace);return{component:a.component,displaySetsToDisplay:t.displaySetsToDisplay}}));return Ie.createElement("div",null,Ie.createElement(ke,{hotkeysManager:a,extensionManager:e,servicesManager:t,appConfig:l}),Ie.createElement("div",{className:"relative flex w-full flex-row flex-nowrap items-stretch overflow-hidden bg-black",style:{height:"calc(100vh - 52px"}},Ie.createElement(Ie.Fragment,null,m&&Ie.createElement(ve.Jx,{className:"h-full w-full bg-black"}),I?Ie.createElement(He,{side:"left",activeTabIndex:h?null:0,servicesManager:t}):null,Ie.createElement("div",{className:"flex h-full flex-1 flex-col"},Ie.createElement("div",{className:"relative flex h-full flex-1 items-center justify-center overflow-hidden bg-black"},Ie.createElement(r,{servicesManager:t,viewportComponents:b,commandsManager:n}))),f?Ie.createElement(He,{side:"right",activeTabIndex:D?null:0,servicesManager:t}):null)),Ie.createElement(xe.M7,null),Ie.createElement(ve.j,{dialogConfiguration:l?.investigationalUseDialog}))}$e.propTypes={extensionManager:he().shape({getModuleEntry:he().func.isRequired}).isRequired,commandsManager:he().instanceOf(o.Sp),servicesManager:he().object.isRequired,leftPanels:he().array,rightPanels:he().array,leftPanelClosed:he().bool.isRequired,rightPanelClosed:he().bool.isRequired,children:he().oneOfType([he().node,he().func]).isRequired,viewports:he().array};const _e=$e;function Be({viewPresets:e,updateViewPresetValue:t,actionIcons:a,updateActionIconValue:n}){return Ie.createElement(Ie.Fragment,null,Ie.createElement("div",{className:"bg-muted flex h-[40px] select-none rounded-t p-2"},Ie.createElement("div",{className:"flex h-[24px] w-full select-none justify-center self-center text-[14px]"},Ie.createElement("div",{className:"flex w-full items-center gap-[10px]"},Ie.createElement("div",{className:"flex items-center justify-center"},Ie.createElement("div",{className:"text-primary-active flex items-center space-x-1"},a.map(((e,t)=>Ie.createElement(xe.FI[e.iconName]||xe.FI.MissingIcon,{key:t,onClick:()=>n(e),className:"cursor-pointer"}))))),Ie.createElement("div",{className:"ml-auto flex h-full items-center justify-center"},Ie.createElement(xe.OY,{type:"single",value:e.filter((e=>e.selected))[0].id,onValueChange:a=>{const n=e.find((e=>e.id===a));t(n)}},e.map(((e,t)=>Ie.createElement(xe.dz,{key:t,"aria-label":e.id,value:e.id,className:"text-actions-primary"},Ie.createElement(xe.FI[e.iconName]||xe.FI.MissingIcon))))))))))}const je=[{id:"settings",iconName:"Settings",value:!1}],Ge=[{id:"list",iconName:"ListView",selected:!1},{id:"thumbnails",iconName:"ThumbnailView",selected:!0}],{sortStudyInstances:We,formatDate:ze,createStudyBrowserTabs:Ye}=o.Wp;const Xe=function({servicesManager:e,getImageSrc:t,getStudiesForPatientByMRN:a,requestDisplaySetCreationForStudy:n,dataSource:s,commandsManager:r}){const{hangingProtocolService:i,displaySetService:o,uiNotificationService:c,customizationService:l}=e.services,u=(0,we.Zp)(),{StudyInstanceUIDs:d}=(0,ve.Bz)(),[{activeViewportId:m,viewports:p,isHangingProtocolLayout:g},f]=(0,ve.ih)(),[S,I]=(0,Ie.useState)("all"),[y,h]=(0,Ie.useState)([...d]),[v,D]=(0,Ie.useState)(!1),[w,b]=(0,Ie.useState)([]),[E,x]=(0,Ie.useState)([]),[M,U]=(0,Ie.useState)({}),[P,C]=(0,Ie.useState)(l.getCustomization("studyBrowser.viewPresets")?.value||Ge),[N,R]=(0,Ie.useState)(je);(0,Ie.useEffect)((()=>{d.forEach((e=>async function(e){const t=await s.query.studies.search({studyInstanceUid:e});if(!t?.length)throw u("/notfoundstudy","_self"),new Error("Invalid study URL");let n=t;try{n=await a(t)}catch(e){console.warn(e)}const r=n.map((e=>({AccessionNumber:e.accession,StudyDate:e.date,StudyDescription:e.description,NumInstances:e.instances,ModalitiesInStudy:e.modalities,PatientID:e.mrn,PatientName:e.patientName,StudyInstanceUID:e.studyInstanceUid,StudyTime:e.time}))).map((e=>({studyInstanceUid:e.StudyInstanceUID,date:ze(e.StudyDate),description:e.StudyDescription,modalities:e.ModalitiesInStudy,numInstances:e.NumInstances})));b((e=>{const t=[...e];for(const a of r)e.find((e=>e.studyInstanceUid===a.studyInstanceUid))||t.push(a);return t}))}(e)))}),[d,s,a,u]),(0,Ie.useEffect)((()=>{if(!v)return void(m&&window.setTimeout((()=>D(!0)),250));o.activeDisplaySets.forEach((async e=>{const a={},n=o.getDisplaySetByUID(e.displaySetInstanceUID),r=s.getImageIdsForDisplaySet(n),i=r[Math.floor(r.length/2)];i&&!n?.unsupported&&(a[e.displaySetInstanceUID]=await t(i),U((e=>({...e,...a}))))}))}),[d,s,o,t,v,m]),(0,Ie.useEffect)((()=>{const e=Je(o.activeDisplaySets,M);We(e),x(e)}),[d,M,o]),(0,Ie.useEffect)((()=>{const e=o.subscribe(o.EVENTS.DISPLAY_SETS_ADDED,(e=>{const{displaySetsAdded:a}=e;a.forEach((async e=>{const a={},n=o.getDisplaySetByUID(e.displaySetInstanceUID);if(n?.unsupported)return;const r=s.getImageIdsForDisplaySet(n),i=r[Math.floor(r.length/2)];i&&(a[e.displaySetInstanceUID]=await t(i,e.initialViewport),U((e=>({...e,...a}))))}))}));return()=>{e.unsubscribe()}}),[t,s,o]),(0,Ie.useEffect)((()=>{const e=o.subscribe(o.EVENTS.DISPLAY_SETS_CHANGED,(e=>{const t=Je(e,M);x(t)})),t=o.subscribe(o.EVENTS.DISPLAY_SET_SERIES_METADATA_INVALIDATED,(()=>{const e=Je(o.getActiveDisplaySets(),M);x(e)}));return()=>{e.unsubscribe(),t.unsubscribe()}}),[d,M,o]);const O=Ye(d,w,E),T=p.get(m)?.displaySetInstanceUIDs;return Ie.createElement(Ie.Fragment,null,Ie.createElement(Ie.Fragment,null,Ie.createElement(Be,{viewPresets:P,updateViewPresetValue:e=>{if(!e)return;const t=P.map((t=>(t.selected=t.id===e.id,t)));C(t)},actionIcons:N,updateActionIconValue:e=>{e.value=!e.value;const t=[...N];R(t)}}),Ie.createElement(xe.wv,{orientation:"horizontal",className:"bg-black",thickness:"2px"})),Ie.createElement(xe.M4,{tabs:O,servicesManager:e,activeTabName:S,onDoubleClickThumbnail:e=>{let t=[];const a=m;try{t=i.getViewportsRequireUpdate(a,e,g)}catch(e){console.warn(e),c.show({title:"Thumbnail Double Click",message:"The selected display sets could not be added to the viewport.",type:"error",duration:3e3})}f.setDisplaySetsForViewports(t)},activeDisplaySetInstanceUIDs:T,expandedStudyInstanceUIDs:y,onClickStudy:function(e){const t=y.includes(e),a=t?[...y.filter((t=>t!==e))]:[...y,e];if(h(a),!t){n(o,e,!0)}},onClickTab:e=>{I(e)},showSettings:N.find((e=>"settings"===e.id)).value,viewPresets:P,onThumbnailContextMenu:(e,t)=>{r.runCommand(e,t)}}))};function Je(e,t){const a=[],n=[];return e.filter((e=>!e.excludeFromThumbnailBrowser)).forEach((e=>{const s=t[e.displaySetInstanceUID],r=function(e){if(Ke.includes(e.Modality)||e?.unsupported)return"thumbnailNoImage";return"thumbnail"}(e);("thumbnail"===r?a:n).push({displaySetInstanceUID:e.displaySetInstanceUID,description:e.SeriesDescription||"",seriesNumber:e.SeriesNumber,modality:e.Modality,seriesDate:e.SeriesDate,seriesTime:e.SeriesTime,numInstances:e.numImageFrames,countIcon:e.countIcon,StudyInstanceUID:e.StudyInstanceUID,messages:e.messages,componentType:r,imageSrc:s,dragData:{type:"displayset",displaySetInstanceUID:e.displaySetInstanceUID},isHydratedForDerivedDisplaySet:e.isHydrated})})),[...a,...n]}const Ke=["SR","SEG","SM","RTSTRUCT","RTPLAN","RTDOSE"];const Qe=function(e,t){return new Promise(((a,n)=>{const s=document.createElement("canvas");e.utilities.loadImageToCanvas({canvas:s,imageId:t,thumbnail:!0}).then((e=>{a(s.toDataURL())})).catch(n)}))};const Ze=async function(e,t){return t&&t.length&&t[0].mrn?e.query.studies.search({patientId:t[0].mrn,disableWildcard:!0}):(console.log("No mrn found for",t),t)};const et=function(e,t,a,n){t.activeDisplaySets.some((e=>e.StudyInstanceUID===a))||e.retrieve.series.metadata({StudyInstanceUID:a,madeInClient:n})};function tt({commandsManager:e,extensionManager:t,servicesManager:a}){const n=t.getDataSources()[0],s=Ze.bind(null,n),r=(0,Ie.useCallback)(function(e){const t=e.getModuleEntry("@ohif/extension-cornerstone.utilityModule.common");try{const{cornerstone:e}=t.exports.getCornerstoneLibraries();return Qe.bind(null,e)}catch(e){throw new Error("Required command not found")}}(t),[]),i=et.bind(null,n);return Ie.createElement(Xe,{servicesManager:a,dataSource:n,getImageSrc:r,getStudiesForPatientByMRN:s,requestDisplaySetCreationForStudy:i})}tt.propTypes={commandsManager:he().object.isRequired,extensionManager:he().object.isRequired,servicesManager:he().object.isRequired};const at=tt,nt={NO_NEVER:-1,CANCEL:0,CREATE_REPORT:1,ADD_SERIES:2,SET_STUDY_AND_SERIES:3,NO_NOT_FOR_SERIES:4};function st(e,{extensionManager:t}){return new Promise((function(a,n){let s;const r=Object.keys(t.dataSourceMap).filter((e=>{const a=t.dataSourceDefs[e]?.configuration;return a?.supportsStow??a?.wadoRoot})).map((e=>({value:e,label:e,placeHolder:e})));s=e.create({centralize:!0,isDraggable:!1,content:ve.lG,useLastPosition:!1,showOverlay:!0,contentProps:{title:"Create Report",value:{label:"",dataSourceName:t.activeDataSource},noCloseButton:!0,onClose:()=>{e.dismiss({id:s}),a({action:nt.CANCEL,value:void 0,dataSourceName:void 0})},actions:[{id:"cancel",text:"Cancel",type:ve.Ny.NW.secondary},{id:"save",text:"Save",type:ve.Ny.NW.primary}],onSubmit:({action:t,value:n})=>{switch(e.dismiss({id:s}),t.id){case"save":a({action:nt.CREATE_REPORT,value:n.label,dataSourceName:n.dataSourceName});break;case"cancel":a({action:nt.CANCEL,value:void 0,dataSourceName:void 0})}},body:({value:t,setValue:n})=>Ie.createElement(Ie.Fragment,null,r.length>1&&window.config?.allowMultiSelectExport&&Ie.createElement("div",null,Ie.createElement("label",{className:"text-[14px] leading-[1.2] text-white"},"Data Source"),Ie.createElement(ve.l6,{closeMenuOnSelect:!0,className:"border-primary-main mt-2 bg-black",options:r,placeholder:r.find((e=>e.value===t.dataSourceName)).placeHolder,value:t.dataSourceName,onChange:e=>{n((t=>({...t,dataSourceName:e.value})))},isClearable:!1})),Ie.createElement("div",{className:"mt-3"},Ie.createElement(ve.pd,{autoFocus:!0,label:"Enter the report name",labelClassName:"text-white text-[14px] leading-[1.2]",className:"border-primary-main bg-black",type:"text",value:t.label,onChange:e=>{e.persist(),n((t=>({...t,label:e.target.value})))},onKeyPress:n=>{"Enter"===n.key&&(e.dismiss({id:s}),a({action:nt.CREATE_REPORT,value:t.label}))},required:!0})))}})}))}var rt=a(40680);function it(){return it=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},it.apply(null,arguments)}const ot=function({commandsManager:e,extensionManager:t,servicesManager:a}){return[{name:"seriesList",iconName:"tab-studies",iconLabel:"Studies",label:rt.A.t("SidePanel:Studies"),component:n=>Ie.createElement(at,it({},n,{commandsManager:e,extensionManager:t,servicesManager:a}))}]},ct=JSON.parse('{"UU":"@ohif/extension-default"}').UU;var lt=a(44563),ut=a(67803);var dt=a(37827);var mt=a(3823);function pt(e,t,a,n){const s=mt.eR.scaleAndAdd(mt.eR.create(),e,a,n);return mt.eR.distance(t,s)>n}function gt(e){if(!e?.length)return!1;const t=(0,dt.A)(e[0].ImageOrientationPatient);if(!t)return!1;const a=function(e){const t=mt.eR.fromValues(e[0],e[1],e[2]),a=mt.eR.fromValues(e[3],e[4],e[5]);return mt.eR.cross(mt.eR.create(),t,a)}(t),n=(0,dt.A)(e[0].ImagePositionPatient),s=(0,dt.A)(e[e.length-1].ImagePositionPatient),r=(0,ut.jj)(n,s)/(e.length-1);let i=n;for(let t=1;t<e.length;t++){const n=e[t],s=(0,dt.A)(n.ImagePositionPatient);if(pt(i,s,a,r))return!1;i=s}return!0}function ft(e,t){e.length>2&&(function(e){if(!e?.length)return!1;const t=e[0],a=(0,dt.A)(t.Rows),n=(0,dt.A)(t.Columns);for(let t=1;t<e.length;t++){const s=e[t],{Rows:r,Columns:i}=s;if(r!==a||i!==n)return!1}return!0}(e)||t.addMessage(o.Ob.CODES.INCONSISTENT_DIMENSIONS),function(e){if(!e?.length)return!1;const t=e[0],a=(0,dt.A)(t.SamplesPerPixel);for(let t=1;t<e.length;t++){const n=e[t],{SamplesPerPixel:s}=n;if(s!==a)return!1}return!0}(e)||t.addMessage(o.Ob.CODES.INCONSISTENT_COMPONENTS),function(e){if(!e?.length)return!1;const t=e[0],a=(0,dt.A)(t.ImageOrientationPatient);for(let t=1;t<e.length;t++){const n=e[t],s=(0,dt.A)(n.ImageOrientationPatient);if(!(0,ut.sW)(s,a))return!1}return!0}(e)||t.addMessage(o.Ob.CODES.INCONSISTENT_ORIENTATIONS),gt(e)||t.addMessage(o.Ob.CODES.INCONSISTENT_POSITION_INFORMATION),function(e,t){if(!e?.length)return;const a=(0,dt.A)(e[0].ImagePositionPatient);if(!a)return;const n=(0,dt.A)(e[e.length-1].ImagePositionPatient),s=(0,ut.jj)(a,n)/(e.length-1);let r=a;const i=[];for(let a=1;a<e.length;a++){const n=e[a],c=(0,dt.A)(n.ImagePositionPatient),l=(0,ut.jj)(c,r),u=(0,ut.Op)(l,s);if(u){const e=u.issue;if(i.includes(e)||(i.push(e),e===ut.JG.MISSING_FRAMES?t.addMessage(o.Ob.CODES.MISSING_FRAMES):e===ut.JG.IRREGULAR_SPACING&&t.addMessage(o.Ob.CODES.IRREGULAR_SPACING)),i.length>1)break}r=c}}(e,t))}function St(e,t,a){const n=new o.WZ;if(a)return n;if(!e.length)return void n.addMessage(o.Ob.CODES.NO_VALID_INSTANCES);const s=e[0],{Modality:r,ImageType:i,NumberOfFrames:c}=s;if(i?.includes("LOCALIZER"))return n;if(!ut.Hf.includes(r))return n;const l=c>1;l||e.every((e=>e.ImagePositionPatient))||n.addMessage(o.Ob.CODES.NO_POSITION_INFORMATION);const u=(0,lt.A)(e);return l?function(e,t){(0,ut.Yt)(e)||t.addMessage(o.Ob.CODES.MULTIFRAME_NO_PIXEL_MEASUREMENTS),(0,ut.VX)(e)||t.addMessage(o.Ob.CODES.MULTIFRAME_NO_ORIENTATION),(0,ut.sL)(e)||t.addMessage(o.Ob.CODES.MULTIFRAME_NO_POSITION_INFORMATION)}(u[0],n):ft(u,n),t||n.addMessage(o.Ob.CODES.NOT_RECONSTRUCTABLE),n}var It=a(14169);function yt(e){const t=new It.A(e),a=new o.WZ;a.addMessage(o.Ob.CODES.UNSUPPORTED_DISPLAYSET);const n=e[0];return t.setAttributes({displaySetInstanceUID:t.uid,SeriesDate:n.SeriesDate,SeriesTime:n.SeriesTime,SeriesInstanceUID:n.SeriesInstanceUID,StudyInstanceUID:n.StudyInstanceUID,SeriesNumber:n.SeriesNumber||0,FrameRate:n.FrameTime,SOPClassUID:n.SOPClassUID,SeriesDescription:n.SeriesDescription||"",Modality:n.Modality,numImageFrames:e.length,unsupported:!0,SOPClassHandlerId:"unsupported",isReconstructable:!1,messages:a}),[t]}const ht="chart",vt=(e,t)=>{const{StudyInstanceUID:a,SeriesInstanceUID:n,SOPInstanceUID:s,SeriesDescription:r,SeriesNumber:i,SeriesDate:c,SOPClassUID:l}=e;return{Modality:"CHT",loading:!1,isReconstructable:!1,displaySetInstanceUID:o.Wp.guid(),SeriesDescription:r,SeriesNumber:i,SeriesDate:c,SOPInstanceUID:s,SeriesInstanceUID:n,StudyInstanceUID:a,SOPClassHandlerId:`${ct}.sopClassHandlerModule.${ht}`,SOPClassUID:l,isDerivedDisplaySet:!0,isLoaded:!0,sopClassUids:t,instance:e,instances:[e],addInstances:function(e,t){return this.instances.push(...e),this.instance=this.instances[this.instances.length-1],this}}};function Dt(e){if(!e||!e.length)throw new Error("No instances were provided");const t=function(e){const t=new Set;return e.forEach((e=>{t.add(e.SOPClassUID)})),Array.from(t)}(e);return e.map((e=>{if("CHT"===e.Modality)return vt(e,t);throw new Error("Unsupported modality")}))}const wt={name:ht,sopClassUids:["1.9.451.13215.7.3.2.7.6.1"],getDisplaySetsFromSeries:e=>Dt(e)},{isImage:bt,sopClassDictionary:Et,isDisplaySetReconstructable:xt}=o.Wp,{ImageSet:Mt}=o.Ly,Ut="stack";let Pt={};const Ct=e=>e.NumberOfFrames>1;function Nt(e){const t=(e=>{const{extensionManager:t}=Pt;if(!t)throw new Error("extensionManager is not available");const a=e.map((({imageId:e})=>e)),n=t.getModuleEntry("@ohif/extension-cornerstone.utilityModule.volumeLoader"),{getDynamicVolumeInfo:s}=n.exports;return s(a)})(e),{isDynamicVolume:a,timePoints:n}=t;let s;const{appConfig:r}=Pt;if(a){const t=n[0],a=new Map;e.forEach((e=>a.set(e.imageId,e)));const i=t.map((e=>a.get(e)));s=xt(i,r)}else s=xt(e,r);return{isDynamicVolume:a,...s,dynamicVolumeInfo:t}}const Rt=e=>{const t=e[0],a=new Mt(e),{isDynamicVolume:n,value:s,averageSpacingBetweenFrames:r,dynamicVolumeInfo:i}=Nt(e),o=n?"cornerstoneStreamingDynamicImageVolume":"cornerstoneStreamingImageVolume",c=St(e,s,n);a.setAttributes({volumeLoaderSchema:o,displaySetInstanceUID:a.uid,SeriesDate:t.SeriesDate,SeriesTime:t.SeriesTime,SeriesInstanceUID:t.SeriesInstanceUID,StudyInstanceUID:t.StudyInstanceUID,SeriesNumber:t.SeriesNumber||0,FrameRate:t.FrameTime,SOPClassUID:t.SOPClassUID,SeriesDescription:t.SeriesDescription||"",Modality:t.Modality,isMultiFrame:Ct(t),countIcon:s?"icon-mpr":void 0,numImageFrames:e.length,SOPClassHandlerId:`${ct}.sopClassHandlerModule.${Ut}`,isReconstructable:s,messages:c,averageSpacingBetweenFrames:r||null,isDynamicVolume:n,dynamicVolumeInfo:i});return a.sortBy(((e,t)=>(parseInt(e.InstanceNumber)||0)-(parseInt(t.InstanceNumber)||0))),a},Ot=e=>"CR"===e||"MG"===e||"DX"===e;function Tt(e){if(!e||!e.length)throw new Error("No instances were provided");const t=[],a=function(e){const t=new Set;return e.forEach((e=>{t.add(e.SOPClassUID)})),Array.from(t)}(e),n=[];if(e.forEach((e=>{if(!bt(e.SOPClassUID)&&!e.Rows)return;let s;Ct(e)?(s=Rt([e]),s.setAttributes({sopClassUids:a,numImageFrames:e.NumberOfFrames,instanceNumber:e.InstanceNumber,acquisitionDatetime:e.AcquisitionDateTime}),t.push(s)):Ot(e.Modality)?(s=Rt([e]),s.setAttributes({sopClassUids:a,instanceNumber:e.InstanceNumber,acquisitionDatetime:e.AcquisitionDateTime}),t.push(s)):n.push(e)})),n.length){const s=Rt(n);s.setAttribute("studyInstanceUid",e[0].StudyInstanceUID),s.setAttributes({sopClassUids:a}),t.push(s)}return t}const At=[Et.ComputedRadiographyImageStorage,Et.DigitalXRayImageStorageForPresentation,Et.DigitalXRayImageStorageForProcessing,Et.DigitalMammographyXRayImageStorageForPresentation,Et.DigitalMammographyXRayImageStorageForProcessing,Et.DigitalIntraOralXRayImageStorageForPresentation,Et.DigitalIntraOralXRayImageStorageForProcessing,Et.CTImageStorage,Et.EnhancedCTImageStorage,Et.LegacyConvertedEnhancedCTImageStorage,Et.UltrasoundMultiframeImageStorage,Et.MRImageStorage,Et.EnhancedMRImageStorage,Et.EnhancedMRColorImageStorage,Et.LegacyConvertedEnhancedMRImageStorage,Et.UltrasoundImageStorage,Et.UltrasoundImageStorageRET,Et.SecondaryCaptureImageStorage,Et.MultiframeSingleBitSecondaryCaptureImageStorage,Et.MultiframeGrayscaleByteSecondaryCaptureImageStorage,Et.MultiframeGrayscaleWordSecondaryCaptureImageStorage,Et.MultiframeTrueColorSecondaryCaptureImageStorage,Et.XRayAngiographicImageStorage,Et.EnhancedXAImageStorage,Et.XRayRadiofluoroscopicImageStorage,Et.EnhancedXRFImageStorage,Et.XRay3DAngiographicImageStorage,Et.XRay3DCraniofacialImageStorage,Et.BreastTomosynthesisImageStorage,Et.BreastProjectionXRayImageStorageForPresentation,Et.BreastProjectionXRayImageStorageForProcessing,Et.IntravascularOpticalCoherenceTomographyImageStorageForPresentation,Et.IntravascularOpticalCoherenceTomographyImageStorageForProcessing,Et.NuclearMedicineImageStorage,Et.VLEndoscopicImageStorage,Et.VideoEndoscopicImageStorage,Et.VLMicroscopicImageStorage,Et.VideoMicroscopicImageStorage,Et.VLSlideCoordinatesMicroscopicImageStorage,Et.VLPhotographicImageStorage,Et.VideoPhotographicImageStorage,Et.OphthalmicPhotography8BitImageStorage,Et.OphthalmicPhotography16BitImageStorage,Et.OphthalmicTomographyImageStorage,Et.PositronEmissionTomographyImageStorage,Et.EnhancedPETImageStorage,Et.LegacyConvertedEnhancedPETImageStorage,Et.RTImageStorage,Et.EnhancedUSVolumeStorage];const Lt=function(e){return Pt=e,[{name:Ut,sopClassUids:At,getDisplaySetsFromSeries:Tt},{name:"not-supported-display-sets-handler",sopClassUids:[],getDisplaySetsFromSeries:yt},{name:wt.name,sopClassUids:wt.sopClassUids,getDisplaySetsFromSeries:wt.getDisplaySetsFromSeries}]};function Vt(){return Ie.createElement("span",{className:"border-common-dark mx-2 h-8 w-4 self-center border-l"})}function Ft(){return Ft=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Ft.apply(null,arguments)}const kt=[{icon:"layout-common-1x1",commandOptions:{numRows:1,numCols:1}},{icon:"layout-common-1x2",commandOptions:{numRows:1,numCols:2}},{icon:"layout-common-2x2",commandOptions:{numRows:2,numCols:2}},{icon:"layout-common-2x3",commandOptions:{numRows:2,numCols:3}}],qt=({servicesManager:e})=>{const{hangingProtocolService:t,viewportGridService:a,displaySetService:n}=e.services,s=Array.from(t.protocols.values()),r=a.getActiveViewportId();if(!r)return[];const i=a.getDisplaySetsUIDsForViewport(r);if(!i)return[];const o=i.map((e=>n.getDisplaySetByUID(e)));return s.map((e=>{if(!e.isPreset)return null;const a=((e,t,a)=>!e.displaySetSelectors||0===Object.values(e.displaySetSelectors).length||a.areRequiredSelectorsValid(Object.values(e.displaySetSelectors),t[0]))(e,o,t);return{icon:e.icon,title:e.name,commandOptions:{protocolId:e.id},disabled:!a}})).filter((e=>null!==e))};function Ht({rows:e=3,columns:t=4,onLayoutChange:a=(()=>{}),className:n,onSelection:s,onSelectionPreset:r,servicesManager:i,tooltipDisabled:o,...c}){const[l,u]=(0,Ie.useState)(!1),d=(0,Ie.useRef)(null),{customizationService:m}=i.services,p=m.get("commonPresets")||kt,g=m.get("advancedPresets")||qt({servicesManager:i}),f=e=>{l&&d.current&&u(!1)};(0,Ie.useEffect)((()=>{if(l)return setTimeout((()=>{window.addEventListener("click",f)}),0),()=>{window.removeEventListener("click",f),d.current=null}}),[l]);const S=l?ve.sG:null;return Ie.createElement(ve.IB,{id:"Layout",label:"Layout",icon:"tool-layout",onInteraction:()=>{u(!l)},className:n,rounded:c.rounded,disableToolTip:o,dropdownContent:null!==S&&Ie.createElement("div",{className:"flex",ref:d},Ie.createElement("div",{className:"bg-secondary-dark flex flex-col gap-2.5 p-2"},Ie.createElement("div",{className:"text-aqua-pale text-xs"},"Common"),Ie.createElement("div",{className:"flex gap-4"},p.map(((e,t)=>Ie.createElement(ve.qu,{key:t,classNames:"hover:bg-primary-dark group p-1 cursor-pointer",icon:e.icon,commandOptions:e.commandOptions,onSelection:s})))),Ie.createElement("div",{className:"h-[2px] bg-black"}),Ie.createElement("div",{className:"text-aqua-pale text-xs"},"Advanced"),Ie.createElement("div",{className:"flex flex-col gap-2.5"},g.map(((e,t)=>Ie.createElement(ve.qu,{key:t+p.length,classNames:"hover:bg-primary-dark group flex gap-2 p-1 cursor-pointer",icon:e.icon,title:e.title,disabled:e.disabled,commandOptions:e.commandOptions,onSelection:r}))))),Ie.createElement("div",{className:"bg-primary-dark flex flex-col gap-2.5 border-l-2 border-solid border-black  p-2"},Ie.createElement("div",{className:"text-aqua-pale text-xs"},"Custom"),Ie.createElement(S,{rows:e,columns:t,onSelection:s}),Ie.createElement("p",{className:"text-aqua-pale text-xs leading-tight"},"Hover to select ",Ie.createElement("br",null),"rows and columns ",Ie.createElement("br",null)," Click to apply"))),isActive:l,type:"toggle"})}Ht.propTypes={rows:he().number,columns:he().number,onLayoutChange:he().func,servicesManager:he().object.isRequired};const $t=function({commandsManager:e,servicesManager:t,...a}){const[n,s]=(0,Ie.useState)(!1),r=(0,Ie.useCallback)((t=>{e.run({commandName:"setViewportGridLayout",commandOptions:{...t}}),s(!0)}),[]),i=(0,Ie.useCallback)((t=>{e.run({commandName:"setHangingProtocol",commandOptions:{...t}}),s(!0)}),[]);return Ie.createElement("div",{onMouseEnter:()=>{s(!1)}},Ie.createElement(Ht,Ft({},a,{onSelection:r,onSelectionPreset:i,servicesManager:t,tooltipDisabled:n})))};function _t(){return _t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)({}).hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},_t.apply(null,arguments)}function Bt({groupId:e,primary:t,secondary:a,items:n,renderer:s,onInteraction:r,servicesManager:i}){const{toolbarService:o}=i?.services,c=(0,Ie.useCallback)((t=>t.map(((t,a)=>({...t,index:a,onClick:()=>{r({groupId:e,itemId:t.id,commands:t.commands})}})))),[e,r]),l=o?.getButtonComponentForUIType(t.uiType)??ve.IB,u=s;return Ie.createElement(ve.fk,{primary:t,secondary:a,items:c(n),groupId:e,renderer:u,onInteraction:r,Component:e=>Ie.createElement(l,_t({},e,{servicesManager:i}))})}Bt.propTypes={groupId:he().string,primary:he().shape({id:he().string.isRequired,uiType:he().string}),secondary:he().shape({id:he().string,icon:he().string.isRequired,label:he().string,tooltip:he().string.isRequired,disabled:he().bool,className:he().string}),items:he().arrayOf(he().shape({id:he().string.isRequired,icon:he().string,label:he().string,tooltip:he().string,disabled:he().bool,className:he().string})),renderer:he().func,onInteraction:he().func.isRequired,servicesManager:he().shape({services:he().shape({toolbarService:he().object})})};const jt=Bt;const Gt=function({groupId:e,items:t,onInteraction:a,size:n}){const s=(0,Ie.useCallback)((t=>t.map(((t,s)=>Ie.createElement(ve.IB,{key:t.id,icon:t.icon,label:t.label,disabled:t.disabled,className:t.className,disabledText:t.disabledText,id:t.id,size:n,onClick:()=>{a({groupId:e,itemId:t.id,commands:t.commands})},toolTipClassName:""})))),[a,e]);return Ie.createElement(ve.e2,null,s(t))},Wt=(e=[])=>e.map((e=>({label:e.name,value:e.id,info:e.info,activated:!1,completed:!1})));function zt({servicesManager:e}){const{workflowStepsService:t}=e.services,[a,n]=(0,Ie.useState)(t.activeWorkflowStep?.id),[s,r]=(0,Ie.useState)(Wt(t.workflowSteps)),i=(0,Ie.useCallback)((e=>{e.completed||r((t=>{const a=[...t];for(let t=a.findIndex((t=>t.value===e.value));t>=0;t--){const e=a[t];if(e.completed)break;a[t]={...e,completed:!0}}return a}))}),[]),o=(0,Ie.useCallback)((({selectedOption:e})=>{e&&(i(e),n(e.value))}),[i]);return(0,Ie.useEffect)((()=>(a&&t.setActiveWorkflowStep(a),()=>clearTimeout(undefined))),[a,t]),(0,Ie.useEffect)((()=>{const{unsubscribe:e}=t.subscribe(t.EVENTS.STEPS_CHANGED,(()=>r(Wt(t.workflowSteps)))),{unsubscribe:a}=t.subscribe(t.EVENTS.ACTIVE_STEP_CHANGED,(()=>n(t.activeWorkflowStep.id)));return()=>{e(),a()}}),[e,t]),Ie.createElement(ve.LW,{options:s,value:a,onChange:o})}function Yt(e,t,a,n){const s={selectorProps:e,event:t},r=function(e,t,a){const{subMenu:n}=t,s=function*(){yield function(e,t){if(t)return e.find((e=>e.id===t))}(e,a||n),yield function(e,t){return e?e.find((e=>!e.selector||e.selector(t.selectorProps))):null}(e,t)}();let r=s.next(),i=r.value;for(;!r.done;)i=r.value,i&&s.return(),r=s.next();return i}(a,s,n);if(!r)return;if(!r.items)return console.warn("Must define items in menu",r),[];let i=[];return r.items.forEach((n=>{const{delegating:r,selector:o,subMenu:c}=n;if(!o||o(e))if(r)i=[...i,...Yt(e,t,a,c)];else{const e=function(e,t){const a={...e,value:t.selectorProps?.value};"ShowSubMenu"!==e.actionType||a.iconRight||(a.iconRight="chevron-menu");e.action||(a.action=(e,n)=>{const{event:s={}}=n,{detail:r={}}=s;a.element=r.element,n.onClose();const i=n[`on${e.actionType||"Default"}`];i?i.call(n,a,e,t):console.warn("No action defined for",e)});return a}(n,s);i.push(e)}})),i}var Xt,Jt=a(59852),Kt=a(55139);class Qt{constructor(e,t){this.commandsManager=void 0,this.services=void 0,this.menuItems=void 0,this.services=e.services,this.commandsManager=t}closeContextMenu(){this.services.uiDialogService.dismiss({id:"context-menu"})}showContextMenu(e,t,a){if(!this.services.uiDialogService)return void console.warn("Unable to show dialog; no UI Dialog Service available.");const{event:n,subMenu:s,menuId:r,menus:i,selectorProps:o}=e,c=Kt.annotation.state.getAnnotationManager(),{locking:l}=Kt.annotation,u=o?.nearbyToolData?.annotationUID;if(l.isAnnotationLocked(c.getAnnotation(u)))return void console.warn("Annotation is locked.");const d=Yt(o||e,n,i,r);this.services.uiDialogService.dismiss({id:"context-menu"}),this.services.uiDialogService.create({id:"context-menu",isDraggable:!1,preservePosition:!1,preventCutOf:!0,defaultPosition:Qt._getDefaultPosition(a,n?.detail,t),event:n,content:Jt.A,onClickOutside:()=>this.services.uiDialogService.dismiss({id:"context-menu"}),contentProps:{items:d,selectorProps:o,menus:i,event:n,subMenu:s,eventData:n?.detail,onClose:()=>{this.services.uiDialogService.dismiss({id:"context-menu"})},onShowSubMenu:(n,s,r)=>{s.subMenu?this.showContextMenu({...e,menuId:s.subMenu},t,a):console.warn("No submenu defined for",n,s,r)},onDefault:(e,t,a)=>{this.commandsManager.run(e,{...o,...t,subProps:a})}}})}}Xt=Qt,Qt.getDefaultPosition=()=>({x:0,y:0}),Qt._getEventDefaultPosition=e=>({x:e&&e.currentPoints.client[0],y:e&&e.currentPoints.client[1]}),Qt._getElementDefaultPosition=e=>{if(e){const t=e.getBoundingClientRect();return{x:t.x,y:t.y}}return{x:void 0,y:void 0}},Qt._getCanvasPointsPosition=(e=[],t)=>{const a=Xt._getElementDefaultPosition(t);for(let t=0;t<e.length;t++){const n={x:e[t][0]||e[t].x,y:e[t][1]||e[t].y};if(Xt._isValidPosition(n)&&Xt._isValidPosition(a))return{x:n.x+a.x,y:n.y+a.y}}},Qt._isValidPosition=e=>e&&"number"==typeof e.x&&"number"==typeof e.y,Qt._getDefaultPosition=(e,t,a)=>{const n=function*(){yield Xt._getCanvasPointsPosition(e,a),yield Xt._getEventDefaultPosition(t),yield Xt._getElementDefaultPosition(a),yield Xt.getDefaultPosition()}();let s=n.next(),r=s.value;for(;!s.done;)r=s.value,Xt._isValidPosition(r)&&n.return(),s=n.next();return r};const Zt={id:"measurementsContextMenu",customizationType:"ohif.contextMenu",menus:[{id:"forExistingMeasurement",selector:({nearbyToolData:e})=>!!e,items:[{label:"Delete measurement",commands:[{commandName:"deleteMeasurement",context:"CORNERSTONE"}]},{label:"Add Label",commands:[{commandName:"setMeasurementLabel"}]}]}]};var ea=a(79715),ta=a(93366),aa=a(21978);const na=e=>({type:"viewportGridId",viewportGridState:{},setViewportGridState:(t,a)=>e((e=>({viewportGridState:{...e.viewportGridState,[t]:a}})),!1,"setViewportGridState"),clearViewportGridState:()=>e({viewportGridState:{}},!1,"clearViewportGridState")}),sa=(0,ta.vt)()(na),ra=e=>({type:"displaySetSelectorId",displaySetSelectorMap:{},setDisplaySetSelector:(t,a)=>e((e=>({displaySetSelectorMap:{...e.displaySetSelectorMap,[t]:a}})),!1,"setDisplaySetSelector"),clearDisplaySetSelectorMap:()=>e({displaySetSelectorMap:{}},!1,"clearDisplaySetSelectorMap")}),ia=(0,ta.vt)()(ra),oa=e=>({hangingProtocolStageIndexMap:{},type:"hangingProtocolStageIndexId",setHangingProtocolStageIndex:(t,a)=>e((e=>({hangingProtocolStageIndexMap:{...e.hangingProtocolStageIndexMap,[t]:a}})),!1,"setHangingProtocolStageIndex"),clearHangingProtocolStageIndexMap:()=>e({hangingProtocolStageIndexMap:{}},!1,"clearHangingProtocolStageIndexMap")}),ca=(0,ta.vt)()(oa),la=(e,t)=>{const{activeViewportId:a}=e,{protocol:n}=t.getActiveProtocol();if(!n)return;const s=t.getState(),{protocolId:r,stageIndex:i,activeStudyUID:o}=s,{viewportGridState:c,setViewportGridState:l}=sa.getState(),{displaySetSelectorMap:u,setDisplaySetSelector:d}=ia.getState(),{hangingProtocolStageIndexMap:m,setHangingProtocolStageIndex:p}=ca.getState(),g=n.stages[i],f=`${o}:${r}:${i}`,S=`${o}:${r}`,{rows:I,columns:y}=g.viewportStructure.properties,h=g.viewports.length!==e.viewports.size||e.layout.numRows!==I||e.layout.numCols!==y;return m[S]=s,f&&h&&l(f,{...e}),e.viewports.forEach(((e,t)=>{const{displaySetOptions:n,displaySetInstanceUIDs:s}=e;if(n)for(let e=0;e<n.length;e++){const r=s[e];r&&(t===a&&0===e&&d(`${o}:activeDisplaySet:0`,r),n[e]?.id&&d(`${o}:${n[e].id}:${n[e].matchedDisplaySetsIndex||0}`,r))}})),p(S,s),{hangingProtocolStageIndexMap:m,viewportGridStore:c,displaySetSelectorMap:u}},ua=e=>({type:"viewportsByPositionId",viewportsByPosition:{},initialInDisplay:[],setViewportsByPosition:(t,a)=>e((e=>({viewportsByPosition:{...e.viewportsByPosition,[t]:a}})),!1,"setViewportsByPosition"),clearViewportsByPosition:()=>e({viewportsByPosition:{}},!1,"clearViewportsByPosition"),addInitialInDisplay:t=>e((e=>({initialInDisplay:[...e.initialInDisplay,t]})),!1,"addInitialInDisplay")}),da=(0,ta.vt)()((0,aa.lt)(ua,{name:"ViewportsByPositionStore"})),ma=(e,t,a,n,s,r)=>{const i=a?.[s];if(i)return{...i};const{protocolId:o,stageIndex:c}=e.getState();r.inDisplay||(r.inDisplay=[...a.initialInDisplay]);const l=e.getMissingViewport(t?o:"default",c,r);if(l){const e=l.displaySetsInfo.map((e=>e.displaySetInstanceUID));return r.inDisplay.push(...e),{displaySetInstanceUIDs:e,displaySetOptions:l.displaySetsInfo.map((e=>e.displaySetOptions)),viewportOptions:{...l.viewportOptions}}}return{}},pa=(e,{numRows:t,numCols:a})=>{const{viewports:n}=e,{setViewportsByPosition:s,addInitialInDisplay:r}=da.getState(),i=[],o={};n.forEach((e=>{if(e.positionId){const t={...e,viewportOptions:{...e.viewportOptions}};o[e.positionId]=t,s(e.positionId,t)}}));for(let e=0;e<t;e++)for(let t=0;t<a;t++){const a=o[`${t}-${e}`];a?.displaySetInstanceUIDs&&i.push(...a.displaySetInstanceUIDs)}i.forEach((e=>r(e)))};var ga=a(16265);const fa=e=>({toggleHangingProtocol:{},type:"toggleHangingProtocolId",setToggleHangingProtocol:(t,a)=>e((e=>({toggleHangingProtocol:{...e.toggleHangingProtocol,[t]:a}})),!1,"setToggleHangingProtocol"),clearToggleHangingProtocol:()=>e({toggleHangingProtocol:{}},!1,"clearToggleHangingProtocol")}),Sa=(0,ta.vt)()(fa);var Ia=a(73325);const ya=({servicesManager:e,commandsManager:t})=>{const{customizationService:a,measurementService:n,hangingProtocolService:s,uiNotificationService:r,viewportGridService:i,displaySetService:o}=e.services,c=new Qt(e,t),l={showContextMenu:e=>{const{menuCustomizationId:t,element:n,event:r,selectorProps:i,defaultPointsPosition:o=[]}=e,l={...e};t&&Object.assign(l,a.get(t,Zt));const{protocol:u,stage:d}=s.getActiveProtocol();l.selectorProps={event:r,protocol:u,stage:d,...i},c.showContextMenu(l,n,o)},closeContextMenu:()=>{c.closeContextMenu()},displayNotification:({text:e,title:t,type:a})=>{r.show({title:t,message:e,type:a})},clearMeasurements:()=>{n.clear()},setHangingProtocol:({activeStudyUID:e="",protocolId:t,stageId:a,stageIndex:n,reset:o=!1})=>{try{const r=i.getState(),c=s.getState();la(r,s);const{hangingProtocolStageIndexMap:l}=ca.getState(),{displaySetSelectorMap:u}=ia.getState();if(t){if(void 0===n&&void 0===a){const a=`${e||c.activeStudyUID}:${t}`;n=l[a]?.stageIndex}}else t=c.protocolId,void 0===a&&void 0===n&&(n=c.stageIndex);const d=n??s.getStageIndex(t,{stageId:a,stageIndex:n});e&&s.setActiveStudyUID(e);const m=`${s.getState().activeStudyUID}:${t}:${d||0}`,{viewportGridState:p}=sa.getState(),g=!o&&p[m];t!==c.protocolId||d!==c.stageIndex||e?(s.setProtocol(t,{displaySetSelectorMap:u,stageId:a,stageIndex:d,restoreProtocol:g}),g&&i.set(p[m])):s.setProtocol(t,{stageId:a,stageIndex:d});const{setDisplaySetSelector:f}=ia.getState();return f(`${e||c.activeStudyUID}:activeDisplaySet:0`,null),!0}catch(e){return console.error(e),r.show({title:"Apply Hanging Protocol",message:"The hanging protocol could not be applied.",type:"error",duration:3e3}),!1}},toggleHangingProtocol:({protocolId:e,stageIndex:t})=>{const{protocol:a,stageIndex:n,activeStudy:r}=s.getActiveProtocol(),{toggleHangingProtocol:i,setToggleHangingProtocol:o}=Sa.getState(),c=`${r.StudyInstanceUID}:${e}:${0|t}`;if(a.id!==e||void 0!==t&&t!==n)return o(c,{protocolId:a.id,stageIndex:n}),l.setHangingProtocol({protocolId:e,stageIndex:t,reset:!0});{const e=i[c]||{protocolId:"default"};return l.setHangingProtocol(e)}},deltaStage:({direction:e})=>{const{protocolId:t,stageIndex:a}=s.getState(),{protocol:n}=s.getActiveProtocol();for(let s=a+e;s>=0&&s<n.stages.length;s+=e)if("disabled"!==n.stages[s].status)return l.setHangingProtocol({protocolId:t,stageIndex:s});r.show({title:"Change Stage",message:"The hanging protocol has no more applicable stages",type:"info",duration:3e3})},setViewportGridLayout:({numRows:e,numCols:a,isHangingProtocolLayout:n=!1})=>{const{protocol:r}=s.getActiveProtocol(),o=r.callbacks?.onLayoutChange;if(!1===t.run(o,{numRows:e,numCols:a}))return void console.log("setViewportGridLayout running",o,e,a);window.setTimeout((()=>{const t=i.getState();pa(t,{numRows:e,numCols:a});const{viewportsByPosition:r,initialInDisplay:o}=da.getState(),c=ma.bind(null,s,n,{...r,initialInDisplay:o});i.setLayout({numRows:e,numCols:a,findOrCreateViewport:c,isHangingProtocolLayout:n})}),0)},toggleOneUp(){const e=i.getState(),{activeViewportId:a,viewports:n,layout:r,isHangingProtocolLayout:o}=e,{displaySetInstanceUIDs:c,displaySetOptions:l,viewportOptions:u}=n.get(a);if(1===r.numCols&&1===r.numRows){const{toggleOneUpViewportGridStore:e}=Ia.Y.getState();if(!e)return;const a=e.activeViewportId,n=c.length>1?[]:c.map((e=>s.getViewportsRequireUpdate(a,e,o))).flat(),r=(t,a)=>{const s=Array.from(e.viewports.values()).find((e=>e.positionId===a)),r=n.find((e=>e.viewportId===s.viewportId));return r?{viewportOptions:u,displaySetOptions:l,...r}:s},d=i.getLayoutOptionsFromState(e);i.setLayout({numRows:e.layout.numRows,numCols:e.layout.numCols,activeViewportId:a,layoutOptions:d,findOrCreateViewport:r,isHangingProtocolLayout:!0}),setTimeout((()=>{t.runCommand("resetCrosshairs")}),0)}else{const{setToggleOneUpViewportGridStore:t}=Ia.Y.getState();t(e);const a=()=>({displaySetInstanceUIDs:c,displaySetOptions:l,viewportOptions:u});i.setLayout({numRows:1,numCols:1,findOrCreateViewport:a,isHangingProtocolLayout:!0})}},navigateHistory(e){ga.b.navigate(e.to,e.options)},openDICOMTagViewer({displaySetInstanceUID:t}){const{activeViewportId:a,viewports:n}=i.getState(),s=n.get(a),{displaySetInstanceUIDs:r}=s,c=o.activeDisplaySets,{UIModalService:l}=e.services,u=t||r[0];l.show({content:ea.A,contentProps:{displaySets:c,displaySetInstanceUID:u,onClose:l.hide},containerDimensions:"w-[70%] max-w-[900px]",title:"DICOM Tag Browser"})},toggleOverlays:()=>{const e=document.getElementsByClassName("viewport-overlay");for(let t=0;t<e.length;t++)e.item(t).classList.toggle("hidden")},scrollActiveThumbnailIntoView:()=>{const{activeViewportId:e,viewports:t}=i.getState(),a=t.get(e).displaySetInstanceUIDs[0],n=document.querySelector("#ohif-thumbnail-list");if(!n)return;const s=n.getBoundingClientRect(),r=document.querySelector(`#thumbnail-${a}`);if(!r)return;const o=r.getBoundingClientRect();o.top>=s.top&&o.top<=s.bottom||r.scrollIntoView({behavior:"smooth"})},updateViewportDisplaySet:({direction:e,excludeNonImageModalities:t})=>{const a=["SR","SEG","SM","RTSTRUCT","RTPLAN","RTDOSE"],n=[...o.activeDisplaySets],{activeViewportId:c,viewports:u,isHangingProtocolLayout:d}=i.getState(),{displaySetInstanceUIDs:m}=u.get(c);let p;for(p=n.findIndex((e=>m.includes(e.displaySetInstanceUID)))+e;p>-1&&p<n.length&&(t&&a.includes(n[p].Modality));p+=e);if(p<0||p>=n.length)return;const{displaySetInstanceUID:g}=n[p];let f=[];try{f=s.getViewportsRequireUpdate(c,g,d)}catch(e){console.warn(e),r.show({title:"Navigate Viewport Display Set",message:"The requested display sets could not be added to the viewport due to a mismatch in the Hanging Protocol rules.",type:"info",duration:3e3})}i.setDisplaySetsForViewports(f),setTimeout((()=>l.scrollActiveThumbnailIntoView()),0)}},u={showContextMenu:{commandFn:l.showContextMenu},closeContextMenu:{commandFn:l.closeContextMenu},clearMeasurements:{commandFn:l.clearMeasurements},displayNotification:{commandFn:l.displayNotification},setHangingProtocol:{commandFn:l.setHangingProtocol},toggleHangingProtocol:{commandFn:l.toggleHangingProtocol},navigateHistory:{commandFn:l.navigateHistory},nextStage:{commandFn:l.deltaStage,options:{direction:1}},previousStage:{commandFn:l.deltaStage,options:{direction:-1}},setViewportGridLayout:{commandFn:l.setViewportGridLayout},toggleOneUp:{commandFn:l.toggleOneUp},openDICOMTagViewer:{commandFn:l.openDICOMTagViewer},updateViewportDisplaySet:{commandFn:l.updateViewportDisplaySet}};return{actions:l,definitions:u,defaultContext:"DEFAULT"}},ha={id:"@ohif/mnGrid",description:"Has various hanging protocol grid layouts",name:"2x2",protocolMatchingRules:[{id:"OneOrMoreSeries",weight:25,attribute:"numberOfDisplaySetsWithImages",constraint:{greaterThan:0}}],toolGroupIds:["default"],displaySetSelectors:{defaultDisplaySetId:{seriesMatchingRules:[{attribute:"numImageFrames",constraint:{greaterThan:{value:0}},required:!0},{attribute:"isDisplaySetFromUrl",weight:10,constraint:{equals:!0}}]}},defaultViewport:{viewportOptions:{viewportType:"stack",toolGroupId:"default",allowUnmatchedView:!0,syncGroups:[{type:"hydrateseg",id:"sameFORId",source:!0,target:!0,options:{matchingRules:["sameFOR"]}}]},displaySets:[{id:"defaultDisplaySetId",matchedDisplaySetsIndex:-1}]},stages:[{id:"2x2",name:"2x2",stageActivation:{enabled:{minViewportsMatched:4}},viewportStructure:{layoutType:"grid",properties:{rows:2,columns:2}},viewports:[{viewportOptions:{toolGroupId:"default",allowUnmatchedView:!0,syncGroups:[{type:"hydrateseg",id:"sameFORId",source:!0,target:!0,options:{matchingRules:["sameFOR"]}}]},displaySets:[{id:"defaultDisplaySetId"}]},{viewportOptions:{toolGroupId:"default",allowUnmatchedView:!0},displaySets:[{matchedDisplaySetsIndex:1,id:"defaultDisplaySetId"}]},{viewportOptions:{toolGroupId:"default",allowUnmatchedView:!0,syncGroups:[{type:"hydrateseg",id:"sameFORId",source:!0,target:!0}]},displaySets:[{matchedDisplaySetsIndex:2,id:"defaultDisplaySetId"}]},{viewportOptions:{toolGroupId:"default",allowUnmatchedView:!0,syncGroups:[{type:"hydrateseg",id:"sameFORId",source:!0,target:!0}]},displaySets:[{matchedDisplaySetsIndex:3,id:"defaultDisplaySetId"}]}]},{id:"3x1",requiredViewports:1,preferredViewports:3,stageActivation:{enabled:{minViewportsMatched:3}},viewportStructure:{layoutType:"grid",properties:{rows:1,columns:3}},viewports:[{viewportOptions:{toolGroupId:"default",allowUnmatchedView:!0},displaySets:[{id:"defaultDisplaySetId"}]},{viewportOptions:{toolGroupId:"default",allowUnmatchedView:!0},displaySets:[{id:"defaultDisplaySetId",matchedDisplaySetsIndex:1}]},{viewportOptions:{toolGroupId:"default",allowUnmatchedView:!0},displaySets:[{id:"defaultDisplaySetId",matchedDisplaySetsIndex:2}]}]},{id:"2x1",requiredViewports:1,preferredViewports:2,stageActivation:{enabled:{minViewportsMatched:2}},viewportStructure:{layoutType:"grid",properties:{rows:1,columns:2}},viewports:[{viewportOptions:{toolGroupId:"default",allowUnmatchedView:!0},displaySets:[{id:"defaultDisplaySetId"}]},{viewportOptions:{toolGroupId:"default",allowUnmatchedView:!0},displaySets:[{matchedDisplaySetsIndex:1,id:"defaultDisplaySetId"}]}]},{id:"1x1",requiredViewports:1,preferredViewports:1,stageActivation:{enabled:{minViewportsMatched:1}},viewportStructure:{layoutType:"grid",properties:{rows:1,columns:1}},viewports:[{viewportOptions:{toolGroupId:"default",allowUnmatchedView:!0},displaySets:[{id:"defaultDisplaySetId"}]}]}],numberOfPriorsReferenced:-1},va={id:"defaultDisplaySetId"},Da={id:"priorDisplaySetId"},wa={viewportOptions:{toolGroupId:"default",allowUnmatchedView:!0},displaySets:[va]},ba={...wa,displaySets:[{...va,matchedDisplaySetsIndex:1}]},Ea={...wa,displaySets:[Da]},xa={id:"@ohif/hpCompare",description:"Compare two studies in various layouts",name:"Compare Two Studies",numberOfPriorsReferenced:1,protocolMatchingRules:[{id:"Two Studies",weight:1e3,attribute:"StudyInstanceUID",from:"prior",required:!0,constraint:{notNull:!0}}],toolGroupIds:["default"],displaySetSelectors:{defaultDisplaySetId:{studyMatchingRules:[{attribute:"studyInstanceUIDsIndex",from:"options",required:!0,constraint:{equals:{value:0}}}],seriesMatchingRules:[{attribute:"numImageFrames",constraint:{greaterThan:{value:0}}},{attribute:"isDisplaySetFromUrl",weight:10,constraint:{equals:!0}}]},priorDisplaySetId:{studyMatchingRules:[{attribute:"studyInstanceUIDsIndex",from:"options",required:!0,constraint:{equals:{value:1}}}],seriesMatchingRules:[{attribute:"numImageFrames",constraint:{greaterThan:{value:0}}},{attribute:"isDisplaySetFromUrl",weight:10,constraint:{equals:!0}}]}},defaultViewport:{viewportOptions:{viewportType:"stack",toolGroupId:"default",allowUnmatchedView:!0},displaySets:[{id:"defaultDisplaySetId",matchedDisplaySetsIndex:-1}]},stages:[{name:"2x2",stageActivation:{enabled:{minViewportsMatched:4}},viewportStructure:{layoutType:"grid",properties:{rows:2,columns:2}},viewports:[wa,Ea,ba,{...Ea,displaySets:[{...Da,matchedDisplaySetsIndex:1}]}]},{name:"2x1",stageActivation:{enabled:{minViewportsMatched:2}},viewportStructure:{layoutType:"grid",properties:{rows:1,columns:2}},viewports:[wa,Ea]}]},Ma=[{attribute:"studyInstanceUIDsIndex",from:"options",required:!0,constraint:{equals:{value:1}}}],Ua=[{attribute:"studyInstanceUIDsIndex",from:"options",required:!0,constraint:{equals:{value:0}}}],Pa=[{weight:10,attribute:"ViewCode",constraint:{contains:"SCT:399162004"}},{weight:5,attribute:"PatientOrientation",constraint:{contains:"L"}},{weight:20,attribute:"SeriesDescription",constraint:{contains:"L CC"}}],Ca=[{weight:10,attribute:"ViewCode",constraint:{contains:"SCT:399162004"}},{weight:5,attribute:"PatientOrientation",constraint:{equals:["P","L"]}},{attribute:"PatientOrientation",constraint:{doesNotEqual:["A","R"]},required:!0},{weight:20,attribute:"SeriesDescription",constraint:{contains:"CC"}}],Na=[{weight:10,attribute:"ViewCode",constraint:{contains:"SCT:399368009"}},{weight:0,attribute:"ViewCode",constraint:{doesNotEqual:"SCT:399162004"},required:!0},{weight:5,attribute:"PatientOrientation",constraint:{equals:["A","R"]}},{weight:20,attribute:"SeriesDescription",constraint:{contains:"L MLO"}}],Ra=[{weight:10,attribute:"ViewCode",constraint:{contains:"SCT:399368009"}},{attribute:"ViewCode",constraint:{doesNotEqual:"SCT:399162004"},required:!0},{attribute:"PatientOrientation",constraint:{doesNotContain:["P","FL"]},required:!0},{weight:5,attribute:"PatientOrientation",constraint:{equals:["P","L"]}},{weight:5,attribute:"PatientOrientation",constraint:{equals:["A","FR"]}},{weight:20,attribute:"SeriesDescription",constraint:{contains:"R MLO"}},{attribute:"SeriesDescription",required:!0,constraint:{doesNotContain:"CC"}},{attribute:"SeriesDescription",required:!0,constraint:{doesNotEqual:"L MLO"},required:!0}],Oa={storeAsInitialCamera:!0,imageArea:[.8,.8],imageCanvasPoint:{imagePoint:[0,.5],canvasPoint:[0,.5]}},Ta={storeAsInitialCamera:!0,imageArea:[.8,.8],imageCanvasPoint:{imagePoint:[1,.5],canvasPoint:[1,.5]}},Aa={id:"@ohif/hpMammo",hasUpdatedPriorsInformation:!1,name:"Mammography Breast Screening",protocolMatchingRules:[{id:"Mammography",weight:150,attribute:"ModalitiesInStudy",constraint:{contains:"MG"},required:!0},{id:"numberOfImages",attribute:"numberOfDisplaySetsWithImages",constraint:{greaterThan:2},required:!0}],toolGroupIds:["default"],displaySetSelectors:{RCC:{seriesMatchingRules:Ca,studyMatchingRules:Ua},LCC:{seriesMatchingRules:Pa,studyMatchingRules:Ua},RMLO:{seriesMatchingRules:Ra,studyMatchingRules:Ua},LMLO:{seriesMatchingRules:Na,studyMatchingRules:Ua},RCCPrior:{seriesMatchingRules:Ca,studyMatchingRules:Ma},LCCPrior:{seriesMatchingRules:Pa,studyMatchingRules:Ma},RMLOPrior:{seriesMatchingRules:Ra,studyMatchingRules:Ma},LMLOPrior:{seriesMatchingRules:Na,studyMatchingRules:Ma}},stages:[{name:"CC/MLO",viewportStructure:{type:"grid",layoutType:"grid",properties:{rows:2,columns:2}},viewports:[{viewportOptions:{toolGroupId:"default",displayArea:Ta,allowUnmatchedView:!0},displaySets:[{id:"RCC"}]},{viewportOptions:{toolGroupId:"default",displayArea:Oa,allowUnmatchedView:!0},displaySets:[{id:"LCC"}]},{viewportOptions:{toolGroupId:"default",displayArea:Ta,allowUnmatchedView:!0},displaySets:[{id:"RMLO"}]},{viewportOptions:{toolGroupId:"default",displayArea:Oa,allowUnmatchedView:!0},displaySets:[{id:"LMLO"}]}]},{name:"CC compare",viewportStructure:{type:"grid",layoutType:"grid",properties:{rows:2,columns:2}},viewports:[{viewportOptions:{toolGroupId:"default",displayArea:Ta,flipHorizontal:!0,rotation:180},displaySets:[{id:"RCC"}]},{viewportOptions:{toolGroupId:"default",flipHorizontal:!0,displayArea:Oa},displaySets:[{id:"LCC"}]},{viewportOptions:{toolGroupId:"default",displayArea:Ta,flipHorizontal:!0},displaySets:[{id:"RCCPrior"}]},{viewportOptions:{toolGroupId:"default",displayArea:Oa},displaySets:[{id:"LCCPrior"}]}]}],numberOfPriorsReferenced:0},La={type:"SCALE",scale:1,storeAsInitialCamera:!0},Va={id:"@ohif/hpScale",description:"Has various hanging protocol grid layouts",name:"Scale Images",protocolMatchingRules:[{id:"OneOrMoreSeries",weight:25,attribute:"numberOfDisplaySetsWithImages",constraint:{greaterThan:0}}],toolGroupIds:["default"],displaySetSelectors:{defaultDisplaySetId:{seriesMatchingRules:[{weight:1,attribute:"numImageFrames",constraint:{greaterThan:{value:0}},required:!0},{attribute:"isDisplaySetFromUrl",weight:10,constraint:{equals:!0}}]}},defaultViewport:{viewportOptions:{viewportType:"stack",toolGroupId:"default",displayArea:La,allowUnmatchedView:!0},displaySets:[{id:"defaultDisplaySetId",matchedDisplaySetsIndex:-1}]},stages:[{name:"Scale 1:1",stageActivation:{enabled:{minViewportsMatched:1}},viewportStructure:{layoutType:"grid",properties:{rows:1,columns:1}},viewports:[{viewportOptions:{toolGroupId:"default",allowUnmatchedView:!0,displayArea:La},displaySets:[{id:"defaultDisplaySetId"}]}]},{name:"Scale 1:15",stageActivation:{enabled:{minViewportsMatched:1}},viewportStructure:{layoutType:"grid",properties:{rows:1,columns:1}},viewports:[{viewportOptions:{toolGroupId:"default",allowUnmatchedView:!0,displayArea:{...La,scale:15}},displaySets:[{id:"defaultDisplaySetId"}]}]}],numberOfPriorsReferenced:-1},Fa={id:"default",locked:!0,name:"Default",createdDate:"2021-02-23T19:22:08.894Z",modifiedDate:"2023-04-01",availableTo:{},editableBy:{},protocolMatchingRules:[],toolGroupIds:["default"],numberOfPriorsReferenced:0,defaultViewport:{viewportOptions:{viewportType:"stack",toolGroupId:"default",allowUnmatchedView:!0,syncGroups:[{type:"hydrateseg",id:"sameFORId",source:!0,target:!0,options:{matchingRules:["sameFOR"]}}]},displaySets:[{id:"defaultDisplaySetId",matchedDisplaySetsIndex:-1}]},displaySetSelectors:{defaultDisplaySetId:{seriesMatchingRules:[{weight:10,attribute:"numImageFrames",constraint:{greaterThan:{value:0}}},{attribute:"isDisplaySetFromUrl",weight:10,constraint:{equals:!0}}]}},stages:[{name:"default",viewportStructure:{layoutType:"grid",properties:{rows:1,columns:1}},viewports:[{viewportOptions:{viewportType:"stack",viewportId:"default",toolGroupId:"default",initialImageOptions:{custom:"sopInstanceLocation"},syncGroups:[{type:"hydrateseg",id:"sameFORId",source:!0,target:!0}]},displaySets:[{id:"defaultDisplaySetId"}]}],createdDate:"2021-02-23T18:32:42.850Z"}]};const ka=function(){return[{name:Fa.id,protocol:Fa},{name:xa.id,protocol:xa},{name:Aa.id,protocol:Aa},{name:Va.id,protocol:Va},{name:ha.id,protocol:ha}]};var qa=a(55530),Ha=a.n(qa);const $a=function(){const[e]=(0,De.r)(),t=(0,we.Zp)(),a=e.dataSources;return Ie.createElement("div",{style:{width:"100%",height:"100%"}},Ie.createElement("div",{className:"flex h-screen w-screen items-center justify-center "},Ie.createElement("div",{className:"bg-secondary-dark mx-auto space-y-2 rounded-lg py-8 px-8 drop-shadow-md"},Ie.createElement("img",{className:"mx-auto block h-14",src:"./ohif-logo.svg",alt:"OHIF"}),Ie.createElement("div",{className:"space-y-2 pt-4 text-center"},a.filter((e=>"dicomjson"!==e.sourceName&&"dicomlocal"!==e.sourceName)).map((e=>Ie.createElement("div",{key:e.sourceName},Ie.createElement("h1",{className:"text-white"},e.configuration?.friendlyName||e.friendlyName),Ie.createElement(ve.$n,{type:ve.Ny.NW.primary,className:Ha()("ml-2"),onClick:()=>{t({pathname:"/",search:`datasources=${e.sourceName}`})}},e.sourceName),Ie.createElement("br",null))))))))};const _a=function({itemLabel:e,itemList:t,onItemClicked:a}){const{t:n}=(0,be.Bd)("DataSourceConfiguration"),[s,r]=(0,Ie.useState)("");return(0,Ie.useEffect)((()=>{r("")}),[t]),Ie.createElement("div",{className:"flex min-h-[1px] grow flex-col gap-4"},Ie.createElement("div",{className:"flex items-center justify-between"},Ie.createElement("div",{className:"text-primary-light text-[20px]"},n(`Select ${e}`)),Ie.createElement(ve.Cv,{className:"max-w-[40%] grow",value:s,onDebounceChange:r,placeholder:n(`Search ${e} list`)})),Ie.createElement("div",{className:"relative flex min-h-[1px] grow flex-col bg-black text-[14px]"},null==t?Ie.createElement(ve.Jx,{className:"h-full w-full"}):0===t.length?Ie.createElement("div",{className:"text-primary-light flex h-full flex-col items-center justify-center px-6 py-4"},Ie.createElement(ve.In,{name:"magnifier",className:"mb-4"}),Ie.createElement("span",null,n(`No ${e} available`))):Ie.createElement(Ie.Fragment,null,Ie.createElement("div",{className:"bg-secondary-dark px-3 py-1.5 text-white"},n(e)),Ie.createElement("div",{className:"ohif-scrollbar overflow-auto"},t.filter((e=>!s||e.name.toLowerCase().includes(s.toLowerCase()))).map((e=>Ie.createElement("div",{className:Ha()("hover:text-primary-light hover:bg-primary-dark group mx-2 flex items-center justify-between px-6 py-2","rounded border-transparent border-b-secondary-light border-[1px] hover:border-primary-light"),key:e.id},Ie.createElement("div",null,e.name),Ie.createElement(ve.$n,{onClick:()=>a(e),className:"invisible group-hover:visible",endIcon:Ie.createElement(ve.In,{name:"arrow-left"})},n("Select")))))))))},Ba="text-ellipsis whitespace-nowrap overflow-hidden";const ja=function({configurationAPI:e,configuredItems:t,onHide:a}){const{t:n}=(0,be.Bd)("DataSourceConfiguration"),[s,r]=(0,Ie.useState)(),[i,o]=(0,Ie.useState)(t),[c,l]=(0,Ie.useState)(),[u]=(0,Ie.useState)(e.getItemLabels()),[d,m]=(0,Ie.useState)(u.length===t.length),p=d?i.length-2:i.length-1;(0,Ie.useEffect)((()=>{let t=!0;return l(null),r(null),0===i.length?e.initialize().then((e=>{t&&r(e)})).catch((e=>l(e.message))):d||i.length!==u.length?e.setCurrentItem(i[p]).then((e=>{t&&r(e)})).catch((e=>l(e.message))):(e.setCurrentItem(i[i.length-1]),a()),()=>{t=!1}}),[i,e,a,u,d,p]);const g=e=>e<i.length?Ha()("bg-black/[.4]",e!==u.length-1?"hover:bg-transparent active:bg-secondary-dark":""):"bg-transparent",f=e=>e===p+1?Ha()("border-2","border-solid","border-primary-light"):e<i.length?"border border-solid border-primary-active hover:border-primary-light active:border-white":"border border-dashed border-secondary-light",S=e=>e<=i.length?"text-primary-light":"text-primary-active";return Ie.createElement("div",{className:"flex h-[calc(100vh-300px)] select-none flex-col gap-4 pt-0.5"},Ie.createElement("div",{className:"flex gap-4"},u.map(((e,t)=>{return Ie.createElement("div",{key:e,className:Ha()("flex min-w-[1px] shrink basis-[200px] flex-col gap-1 rounded-md p-3.5",(a=t,a!==u.length-1&&a<i.length?"cursor-pointer":"cursor-auto"),g(t),f(t),S(t)),onClick:d&&t<p||t<=p?()=>{m(!1),o((e=>e.slice(0,t)))}:void 0},Ie.createElement("div",{className:"text- flex items-center gap-2"},t<i.length?Ie.createElement(ve.In,{name:"status-tracked"}):Ie.createElement(ve.In,{name:"status-untracked"}),Ie.createElement("div",{className:Ha()(Ba)},n(e))),t<i.length?Ie.createElement("div",{className:Ha()("text-[14px] text-white",Ba)},i[t].name):Ie.createElement("br",null));var a}))),Ie.createElement("div",{className:"h-0.5 w-full shrink-0 bg-black"}),c?Ie.createElement("div",{className:"flex min-h-[1px] grow flex-col gap-4"},Ie.createElement("div",{className:"text-primary-light text-[20px]"},n(`Error fetching ${u[i.length]} list`)),Ie.createElement("div",{className:"grow bg-black p-4 text-[14px]"},c)):Ie.createElement(_a,{itemLabel:u[p+1],itemList:s,onItemClicked:e=>{m(!1),o((t=>[...t.slice(0,p+1),e]))}}))};const Ga=function({servicesManager:e,extensionManager:t}){const{t:a}=(0,be.Bd)("DataSourceConfiguration"),{show:n,hide:s}=(0,ve.hS)(),{customizationService:r}=e.services,[i,o]=(0,Ie.useState)(),[c,l]=(0,Ie.useState)();(0,Ie.useEffect)((()=>{let e=!0;const a=async()=>{const a=t.getActiveDataSourceDefinition();if(!a.configuration.configurationAPI)return;const{factory:n}=r.get(a.configuration.configurationAPI)??{};if(!n)return;const s=n(a.sourceName);o(s),l(null),s.getConfiguredItems().then((t=>{e&&l(t)}))},n=t.subscribe(t.EVENTS.ACTIVE_DATA_SOURCE_CHANGED,a);return a(),()=>{e=!1,n.unsubscribe()}}),[]);const u=(0,Ie.useCallback)((()=>{n({content:ja,title:a("Configure Data Source"),contentProps:{configurationAPI:i,configuredItems:c,onHide:s}})}),[i,c]);return(0,Ie.useEffect)((()=>{i&&c&&c.length!==i.getItemLabels().length&&u()}),[i,c,u]),c?Ie.createElement("div",{className:"text-aqua-pale flex items-center overflow-hidden"},Ie.createElement(ve.In,{name:"settings",className:"mr-2.5 h-3.5 w-3.5 shrink-0 cursor-pointer",onClick:u}),c.map(((e,t)=>Ie.createElement("div",{key:t,className:"flex overflow-hidden"},Ie.createElement("div",{key:t,className:"overflow-hidden text-ellipsis whitespace-nowrap"},e.name),t!==c.length-1&&Ie.createElement("div",{className:"px-2.5"},"|"))))):Ie.createElement(Ie.Fragment,null)};var Wa=function(e){return e[e.projects=0]="projects",e[e.locations=1]="locations",e[e.datasets=2]="datasets",e[e.dicomStores=3]="dicomStores",e}(Wa||{});const za="https://cloudresourcemanager.googleapis.com/v1",Ya="https://healthcare.googleapis.com/v1";class Xa{constructor(e,t,a){this._extensionManager=void 0,this._fetchOptions=void 0,this._dataSourceName=void 0,this.getItemLabels=()=>["Project","Location","Data set","DICOM store"],this._dataSourceName=e,this._extensionManager=a;const n=t.services.userAuthenticationService;this._fetchOptions={method:"GET",headers:n.getAuthorizationHeader()}}async initialize(){const e=`${za}/projects`,t=await Xa._doFetch(e,Wa.projects,this._fetchOptions);if(!t?.length)return[];return t.map((e=>({id:e.projectId,name:e.name,itemType:Wa.projects,url:`${Ya}/projects/${e.projectId}`})))}async setCurrentItem(e){const t=e;if(t.itemType===Wa.dicomStores){const e=`${t.url}/dicomWeb`,a=JSON.parse(JSON.stringify(this._extensionManager.getDataSourceDefinition(this._dataSourceName)));return a.configuration={...a.configuration,wadoUriRoot:e,qidoRoot:e,wadoRoot:e},this._extensionManager.updateDataSourceConfiguration(a.sourceName,a.configuration),[]}const a=t.itemType+1,n=`${Wa[a]}`,s=`${t.url}/${n}`,r=await Xa._doFetch(s,a,this._fetchOptions);if(!r?.length)return[];return r.map((e=>{const t=e.name.split("/");return{id:e.name,name:t[t.length-1],itemType:a,url:`${Ya}/${e.name}`}}))}async getConfiguredItems(){const e=this._extensionManager.getDataSourceDefinition(this._dataSourceName).configuration.wadoUriRoot,t=e.indexOf("projects"),a=e.substring(t).split("/"),n=[];for(let e=0;e<4&&2*(e+1)<a.length;e+=1)if(e===Wa.projects){const t=a[1],s=`${za}/projects/${t}`,r=(await Xa._doFetch(s,Wa.projects,this._fetchOptions))[0];n.push({id:r.projectId,name:r.name,itemType:e,url:`${Ya}/projects/${r.projectId}`})}else{const t=a.slice(0,2*e+2).join("/");n.push({id:t,name:a[2*e+1],itemType:e,url:`${Ya}/${t}`})}return n}static async _doFetch(e,t,a={},n={}){try{const s=new URL(e);s.search=new URLSearchParams(n).toString();const r=await fetch(s,a),i=await r.json();if(r.status>=200&&r.status<300&&null!=i){if(null!=i.nextPageToken){n.pageToken=i.nextPageToken;const s=await this._doFetch(e,t,a,n);i[Wa[t]]=i[Wa[t]].concat(s)}return i[Wa[t]]?i[Wa[t]]:i.name?[i]:[]}{const e=i?.error?.message||`Error returned from Google Cloud Healthcare: ${r.status} - ${r.statusText}`;throw new Error(e)}}catch(e){throw new Error(e?.message||"Error occurred during fetch request.")}}}const Ja=o.Wp.formatDate;const Ka=({displaySets:e})=>{const t=e[0],{axis:a,series:n}=t.instance.chartData;return Ie.createElement(ve.bl,{showLegend:!0,legendWidth:150,axis:{x:{label:a.x.label,indexRef:0,type:"x",range:{min:0}},y:{label:a.y.label,indexRef:1,type:"y"}},series:n})};var Qa=a(48405);const Za=o.Ay.classes.MetadataProvider;const en=e=>{const t=e?.images[0]?.ViewCodeSequence[0];if(!t)return;const{CodingSchemeDesignator:a,CodeValue:n}=t;return a&&n?`${a}:${n}`:void 0},tn=e=>{const t=e?.images?.[0]?.SharedFunctionalGroupsSequence?.[0]?.FrameAnatomySequence?.[0];if(!t)return;const a=t?.FrameLaterality;return a};const an=o.Ly.MetadataProvider;const nn=({SeriesInstanceUID:e,StudyInstanceUID:t})=>{const{instances:a}=o.H8.getSeries(t,e);if(!a?.length)return;const n=a[0].Modality;if(!n||"PT"!==n)return;const s=a.map((e=>e.imageId)),r=[];try{if(s.forEach((e=>{const t=function(e){const t=Za.get("instance",e);if(!t)throw new Error("dicom metadata are required");if(void 0===t.SeriesDate||void 0===t.SeriesTime||void 0===t.CorrectedImage||void 0===t.Units||!t.RadiopharmaceuticalInformationSequence||void 0===t.RadiopharmaceuticalInformationSequence.RadionuclideHalfLife||void 0===t.RadiopharmaceuticalInformationSequence.RadionuclideTotalDose||void 0===t.DecayCorrection||void 0===t.AcquisitionDate||void 0===t.AcquisitionTime||void 0===t.RadiopharmaceuticalInformationSequence.RadiopharmaceuticalStartDateTime&&void 0===t.RadiopharmaceuticalInformationSequence.RadiopharmaceuticalStartTime)throw new Error("required metadata are missing");void 0===t.PatientWeight&&console.warn("PatientWeight missing from PT instance metadata");const a={CorrectedImage:t.CorrectedImage,Units:t.Units,RadionuclideHalfLife:t.RadiopharmaceuticalInformationSequence.RadionuclideHalfLife,RadionuclideTotalDose:t.RadiopharmaceuticalInformationSequence.RadionuclideTotalDose,RadiopharmaceuticalStartDateTime:t.RadiopharmaceuticalInformationSequence.RadiopharmaceuticalStartDateTime,RadiopharmaceuticalStartTime:t.RadiopharmaceuticalInformationSequence.RadiopharmaceuticalStartTime,DecayCorrection:t.DecayCorrection,PatientWeight:t.PatientWeight,SeriesDate:t.SeriesDate,SeriesTime:t.SeriesTime,AcquisitionDate:t.AcquisitionDate,AcquisitionTime:t.AcquisitionTime};if(t[70531e3]||void 0!==t[70531e3]||t[70531009]||void 0!==t[70531009]){const e={SUVScaleFactor:t[70531e3],ActivityConcentrationScaleFactor:t[70531009]};a.PhilipsPETPrivateGroup=e}return t["0009100d"]&&void 0!==t["0009100d"]&&(a.GEPrivatePostInjectionDateTime=t["0009100d"]),t.FrameReferenceTime&&void 0!==t.FrameReferenceTime&&(a.FrameReferenceTime=t.FrameReferenceTime),t.ActualFrameDuration&&void 0!==t.ActualFrameDuration&&(a.ActualFrameDuration=t.ActualFrameDuration),t.PatientSex&&void 0!==t.PatientSex&&(a.PatientSex=t.PatientSex),t.PatientSize&&void 0!==t.PatientSize&&(a.PatientSize=t.PatientSize),a}(e);t&&r.push(t)})),!r.length)return;const e=(0,Qa.C)(r);r.forEach(((t,a)=>{an.addCustomMetadata(s[a],"scalingModule",e[a])}))}catch(e){console.log(e)}};function sn(e){return!("object"==typeof e||Array.isArray(e))}const rn=new Set(["DS","FL","FD","IS","OD","OF","OL","OV","SL","SS","SV","UL","US","UV"]);function on(e,t){if(Array.isArray(e)){return e.map((e=>sn(e)?e:on(e,t)))}return sn(e)||Object.keys(e).forEach((a=>{null===e[a].Value&&e[a].vr?delete e[a].Value:Array.isArray(e[a].Value)&&e[a].vr&&(1===e[a].Value.length&&e[a].Value[0].BulkDataURI?(t?.dataSourceConfig&&F(e[a].Value[0],t,t.dataSourceConfig),e[a].BulkDataURI=e[a].Value[0].BulkDataURI,"https:"===window.location.protocol&&e[a].BulkDataURI.startsWith("http:")&&(e[a].BulkDataURI=e[a].BulkDataURI.replace("http:","https:")),delete e[a].Value):rn.has(e[a].vr)?e[a].Value=e[a].Value.map((e=>+e)):e[a].Value=e[a].Value.map((e=>on(e,t))))})),e}function cn(e){const t=on(e);return JSON.parse(JSON.stringify(t))}function ln(e,t=["ImageType"]){for(const a of t)"string"==typeof e[a]&&(e[a]=e[a].split("\\"));return e}function un(){return Ie.createElement("div",{className:"text-primary-active"},"Loading...")}const dn=async function({servicesManager:e,getReport:t,reportType:a="measurement"}){const{displaySetService:n,uiNotificationService:s,uiDialogService:r}=e.services,i=r.create({showOverlay:!0,isDraggable:!1,centralize:!0,content:un});try{const e=await t();if(!e)return;o.H8.addInstances([e],!0);const r=n.getMostRecentDisplaySet().displaySetInstanceUID;return s.show({title:"Create Report",message:`${a} saved successfully`,type:"success"}),[r]}catch(e){throw s.show({title:"Create Report",message:e.message||`Failed to store ${a}`,type:"error"}),new Error(`Failed to store ${a}. Error: ${e.message||"Unknown error"}`)}finally{r.dismiss({id:i})}},mn=e=>({type:"uiStateId",uiState:{},setUIState:(t,a)=>e((e=>({uiState:{...e.uiState,[t]:a}})),!1,"setUIState"),clearUIState:()=>e({uiState:{}},!1,"clearUIState")}),pn=(0,ta.vt)()(mn);function gn(e,t,a,n=!0,s={}){const r="dialog-enter-annotation",i=t?n?t.text:t.label:"",{dialogTitle:o="Annotation",inputLabel:c="Enter your annotation",validateFunc:l=(e=>!0)}=s,u=({action:t,value:n})=>{switch(t.id){case"save":if("function"==typeof l&&!l(n.label))return;a(n.label,t.id);break;case"cancel":a("",t.id)}e.dismiss({id:r})};e&&e.create({id:r,centralize:!0,isDraggable:!1,showOverlay:!0,content:ve.lG,contentProps:{title:o,value:{label:i},noCloseButton:!0,onClose:()=>e.dismiss({id:r}),actions:[{id:"cancel",text:"Cancel",type:ve.Ny.NW.secondary},{id:"save",text:"Save",type:ve.Ny.NW.primary}],onSubmit:u,body:({value:e,setValue:t})=>Ie.createElement(ve.pd,{autoFocus:!0,className:"border-primary-main bg-black",type:"text",id:"annotation",label:c,labelClassName:"text-white text-[14px] leading-[1.2]",value:e.label,onChange:e=>{e.persist(),t((t=>({...t,label:e.target.value})))},onKeyPress:t=>{"Enter"===t.key&&u({value:e,action:{id:"save"}})}})}})}function fn(e,t,a,n){const s=!!n&&n.exclusive,r=n?n.items:[],{validateFunc:i=(e=>!0)}=a;e.create({id:"select-annotation",centralize:!0,isDraggable:!1,showOverlay:!0,content:ve.nd,contentProps:{labellingDoneCallback:a=>{if("string"==typeof a){if("function"==typeof i&&!i(a))return;t(a,"save")}else t("","cancel");e.dismiss({id:"select-annotation"})},measurementData:{label:""},componentClassName:{},labelData:r,exclusive:s}})}function Sn(e,t,a){const n=!!a&&a.exclusive,s=a?a.items:[];return new Promise(((a,r)=>{t.create({id:"select-annotation",isDraggable:!1,showOverlay:!0,content:ve.nd,defaultPosition:{x:window.innerWidth/2,y:window.innerHeight/2},contentProps:{labellingDoneCallback:n=>{t.dismiss({id:"select-annotation"}),"string"==typeof n&&(e.label=n),a(e)},measurementData:e,componentClassName:{},labelData:s,exclusive:n}})}))}var In=a(69175);const yn=function(e,t,a){const n="pick-color",s=({action:t,value:s})=>{switch(t.id){case"save":a(s.rgbaColor,t.id);break;case"cancel":a("",t.id)}e.dismiss({id:n})};e&&e.create({id:n,centralize:!0,isDraggable:!1,showOverlay:!0,content:ve.lG,contentProps:{title:"Segment Color",value:{rgbaColor:t},noCloseButton:!0,onClose:()=>e.dismiss({id:n}),actions:[{id:"cancel",text:"Cancel",type:"primary"},{id:"save",text:"Save",type:"secondary"}],onSubmit:s,body:({value:e,setValue:t})=>Ie.createElement(In.xk,{color:e.rgbaColor,onChange:e=>{t({rgbaColor:e.rgb})},presetColors:[],width:300})}})},hn=4700;const vn=async function({servicesManager:e,commandsManager:t,extensionManager:a},n,s){const{uiDialogService:r,measurementService:i,displaySetService:o}=e.services,c=void 0===s.viewportId?s.data.viewportId:s.viewportId,l=void 0===s.isBackupSave?s.data.isBackupSave:s.isBackupSave,u=s?.data?.StudyInstanceUID,d=s?.data?.SeriesInstanceUID,{trackedStudy:m,trackedSeries:p}=n;let g;try{const n=await st(r,{extensionManager:a});if(n.action===nt.CREATE_REPORT){const s=a.getDataSources()[0],r=i.getMeasurements().filter((e=>m===e.referenceStudyUID&&p.includes(e.referenceSeriesUID))).filter((e=>null!=e.referencedImageId)),c=void 0===n.value||""===n.value?"Research Derived Series":n.value,l=function(e){const t=e.getActiveDisplaySets().filter((e=>"SR"===e.Modality)).map((e=>e.SeriesNumber));return Math.max(...t,hn)+1}(o),u=async()=>t.runCommand("storeMeasurements",{measurementData:r,dataSource:s,additionalFindingTypes:["ArrowAnnotate"],options:{SeriesDescription:c,SeriesNumber:l}},"CORNERSTONE_STRUCTURED_REPORT");g=await dn({servicesManager:e,getReport:u})}else n.action,RESPONSE.CANCEL;return{userResponse:n.action,createdDisplaySetInstanceUIDs:g,StudyInstanceUID:u,SeriesInstanceUID:d,viewportId:c,isBackupSave:l}}catch(e){return null}};const Dn=function({servicesManager:e},t,a){const{measurementService:n,customizationService:s}=e.services,{viewportId:r,StudyInstanceUID:i,SeriesInstanceUID:o,measurementId:c}=a;return new Promise((async function(t){const a=s.get("measurementLabels"),l=n.getMeasurement(c),u=await Sn(l,e.services.uiDialogService,a);n.update(c,{...u},!0),t({StudyInstanceUID:i,SeriesInstanceUID:o,viewportId:r})}))};function wn(e,t){(0,ve.Xv)(e,t),xe.FI.addIcon(e,t)}const bn={id:ct,preRegistration:function({servicesManager:e,configuration:t={},commandsManager:a}){const{toolbarService:n,cineService:s,viewportGridService:r}=e.services;n.registerEventForToolbarUpdate(s,[s.EVENTS.CINE_STATE_CHANGED]),o.H8.subscribe(o.H8.EVENTS.INSTANCES_ADDED,nn),o.H8.subscribe(o.H8.EVENTS.SERIES_UPDATED,nn),function({servicesManager:e}){const{hangingProtocolService:t}=e.services;t.addCustomAttribute("ViewCode","View Code Designator:Value",en),t.addCustomAttribute("Laterality","Laterality of object",tn)}({servicesManager:e});const i=e=>{Object.entries(e).forEach((([e,t])=>{[r.EVENTS.ACTIVE_VIEWPORT_ID_CHANGED,r.EVENTS.VIEWPORTS_READY].includes(e)&&r.subscribe(e,(e=>{const n=e?.viewportId??r.getActiveViewportId();a.run(t,{viewportId:n})}))}))};n.subscribe(n.EVENTS.TOOL_BAR_MODIFIED,(e=>{const{buttons:t}=e;for(const[e,a]of Object.entries(t)){const{groupId:e,items:t,listeners:n}=a.props||{};e&&t&&t.forEach((e=>{e.listeners&&i(e.listeners)})),n&&i(n)}}))},onModeExit(){sa.getState().clearViewportGridState(),pn.getState().clearUIState(),ia.getState().clearDisplaySetSelectorMap(),ca.getState().clearHangingProtocolStageIndexMap(),Sa.getState().clearToggleHangingProtocol(),da.getState().clearViewportsByPosition()},getDataSourcesModule:Se,getViewportModule:({servicesManager:e,commandsManager:t,extensionManager:a})=>[{name:"chartViewport",component:Ka}],getLayoutTemplateModule:function({servicesManager:e,extensionManager:t,commandsManager:a,hotkeysManager:n}){return[{name:"viewerLayout",id:"viewerLayout",component:function(s){return _e({servicesManager:e,extensionManager:t,commandsManager:a,hotkeysManager:n,...s})}}]},getPanelModule:ot,getHangingProtocolModule:ka,getSopClassHandlerModule:Lt,getToolbarModule:function({commandsManager:e,servicesManager:t}){const{cineService:a}=t.services;return[{name:"ohif.radioGroup",defaultComponent:ve.IB},{name:"ohif.divider",defaultComponent:Vt},{name:"ohif.splitButton",defaultComponent:jt},{name:"ohif.layoutSelector",defaultComponent:a=>$t({...a,commandsManager:e,servicesManager:t})},{name:"ohif.buttonGroup",defaultComponent:Gt},{name:"ohif.progressDropdown",defaultComponent:zt},{name:"evaluate.group.promoteToPrimary",evaluate:({viewportId:e,button:t,itemId:a})=>{const{items:n}=t.props;if(!a)return{primary:t.props.primary,items:n};return{primary:n.find((e=>e.id===a||e.itemId===a)),items:n}}},{name:"evaluate.cine",evaluate:()=>(e=>({className:e?"!text-primary-active":"!text-common-bright hover:!bg-primary-dark hover:text-primary-light"}))(a.getState().isCineEnabled)}]},getCommandsModule:ya,getUtilityModule:({servicesManager:e})=>[{name:"common",exports:{getStudiesForPatientByMRN:Ze}}],getCustomizationModule:function({servicesManager:e,extensionManager:t}){return[{name:"helloPage",merge:"Append",value:{id:"customRoutes",routes:[{path:"/custom",children:()=>Ie.createElement("h1",{style:{color:"white"}},"Hello Custom Route")}]}},{name:"datasources",merge:"Append",value:{id:"customRoutes",routes:[{path:"/datasources",children:$a}]}},{name:"default",value:[{id:"ohif.overlayItem",content:function(e){if(this.condition&&!this.condition(e))return null;const{instance:t}=e,a=t&&this.attribute?t[this.attribute]:this.contentF&&"function"==typeof this.contentF?this.contentF(e):null;return a?Ie.createElement("span",{className:"overlay-item flex flex-row",style:{color:this.color||void 0},title:this.title||""},this.label&&Ie.createElement("span",{className:"mr-1 shrink-0"},this.label),Ie.createElement("span",{className:"font-light"},a)):null}},{id:"ohif.contextMenu",transform:function(e){const t={...this};t.menus=this.menus.map((e=>({...e})));for(const a of t.menus){const{items:t}=a;a.items=[];for(const n of t)a.items.push(e.transform(n))}return t}},{id:"ohif.dataSourceConfigurationComponent",component:Ga.bind(null,{servicesManager:e,extensionManager:t})},{id:"ohif.dataSourceConfigurationAPI.google",factory:a=>new Xa(a,e,t)},{id:"progressDropdownWithServiceComponent",component:zt},{id:"studyBrowser.sortFunctions",values:[{label:"Series Number",sortFunction:(e,t)=>e?.SeriesNumber-t?.SeriesNumber},{label:"Series Date",sortFunction:(e,t)=>{const a=new Date(Ja(e?.SeriesDate));return new Date(Ja(t?.SeriesDate)).getTime()-a.getTime()}}]},{id:"studyBrowser.viewPresets",value:[{id:"list",iconName:"ListView",selected:!1},{id:"thumbnails",iconName:"ThumbnailView",selected:!0}]}]}]}},En=bn},73325:(e,t,a)=>{a.d(t,{Y:()=>s});var n=a(93366);const s=(0,n.vt)((e=>({toggleOneUpViewportGridStore:null,type:"toggleOneUpViewportGridId",setToggleOneUpViewportGridStore:t=>e({toggleOneUpViewportGridStore:t}),clearToggleOneUpViewportGridStore:()=>e({toggleOneUpViewportGridStore:null})})))}}]);
//# sourceMappingURL=5172.bundle.eea0c0e7d489612e94ba.js.map