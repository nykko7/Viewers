{"version":3,"file":"717.bundle.62a970506376d6b2604e.js","mappings":"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","sources":["webpack:///../../../extensions/cornerstone-dynamic-volume/src/id.js","webpack:///../../../extensions/cornerstone-dynamic-volume/src/actions/updateSegmentationsChartDisplaySet.ts","webpack:///../../../extensions/cornerstone-dynamic-volume/src/commandsModule.ts","webpack:///../../../extensions/cornerstone-dynamic-volume/src/panels/DynamicVolumeControls.tsx","webpack:///../../../extensions/cornerstone-dynamic-volume/src/panels/PanelGenerateImage.tsx","webpack:///../../../extensions/cornerstone-dynamic-volume/src/panels/DynamicDataPanel.tsx","webpack:///../../../extensions/cornerstone-dynamic-volume/src/panels/DynamicExport.tsx","webpack:///../../../extensions/cornerstone-dynamic-volume/src/getPanelModule.tsx","webpack:///../../../extensions/cornerstone-dynamic-volume/src/getHangingProtocolModule.ts","webpack:///../../../extensions/cornerstone-dynamic-volume/src/index.ts"],"sourcesContent":["import packageJson from '../package.json';\n\nconst id = packageJson.name;\nconst SOPClassHandlerName = 'dynamic-volume';\n\nexport { id, SOPClassHandlerName };\n","import { DicomMetadataStore, utils } from '@ohif/core';\n\nimport * as cs from '@cornerstonejs/core';\nimport * as csTools from '@cornerstonejs/tools';\n\nconst CHART_MODALITY = 'CHT';\nconst SEG_CHART_INSTANCE_UID = utils.guid();\n\n// Private SOPClassUid for chart data\nconst ChartDataSOPClassUid = '1.9.451.13215.7.3.2.7.6.1';\n\nconst { utilities: csToolsUtils } = csTools;\n\nfunction _getDateTimeStr() {\n  const now = new Date();\n  const date =\n    now.getFullYear() + ('0' + now.getUTCMonth()).slice(-2) + ('0' + now.getUTCDate()).slice(-2);\n  const time =\n    ('0' + now.getUTCHours()).slice(-2) +\n    ('0' + now.getUTCMinutes()).slice(-2) +\n    ('0' + now.getUTCSeconds()).slice(-2);\n\n  return { date, time };\n}\n\nfunction _getTimePointsDataByTagName(volume, timePointsTag) {\n  const uniqueTimePoints = volume.imageIds.reduce((timePoints, imageId) => {\n    const instance = DicomMetadataStore.getInstanceByImageId(imageId);\n    const timePointValue = instance[timePointsTag];\n\n    if (timePointValue !== undefined) {\n      timePoints.add(timePointValue);\n    }\n\n    return timePoints;\n  }, new Set());\n\n  return Array.from(uniqueTimePoints).sort((a: number, b: number) => a - b);\n}\n\nfunction _convertTimePointsUnit(timePoints, timePointsUnit) {\n  const validUnits = ['ms', 's', 'm', 'h'];\n  const divisors = [1000, 60, 60];\n  const currentUnitIndex = validUnits.indexOf(timePointsUnit);\n  let divisor = 1;\n\n  if (currentUnitIndex !== -1) {\n    for (let i = currentUnitIndex; i < validUnits.length - 1; i++) {\n      const newDivisor = divisor * divisors[i];\n      const greaterThanDivisorCount = timePoints.filter(timePoint => timePoint > newDivisor).length;\n\n      // Change the scale only if more than 50% of the time points are\n      // greater than the new divisor.\n      if (greaterThanDivisorCount <= timePoints.length / 2) {\n        break;\n      }\n\n      divisor = newDivisor;\n      timePointsUnit = validUnits[i + 1];\n    }\n\n    if (divisor > 1) {\n      timePoints = timePoints.map(timePoint => timePoint / divisor);\n    }\n  }\n\n  return { timePoints, timePointsUnit };\n}\n\n// It currently supports only one tag but a few other will be added soon\n// Supported 4D Tags\n//   (0018,1060) Trigger Time                   [NOK]\n//   (0018,0081) Echo Time                      [NOK]\n//   (0018,0086) Echo Number                    [NOK]\n//   (0020,0100) Temporal Position Identifier   [NOK]\n//   (0054,1300) FrameReferenceTime             [OK]\nfunction _getTimePointsData(volume) {\n  const timePointsTags = {\n    FrameReferenceTime: {\n      unit: 'ms',\n    },\n  };\n\n  const timePointsTagNames = Object.keys(timePointsTags);\n  let timePoints;\n  let timePointsUnit;\n\n  for (let i = 0; i < timePointsTagNames.length; i++) {\n    const tagName = timePointsTagNames[i];\n    const curTimePoints = _getTimePointsDataByTagName(volume, tagName);\n\n    if (curTimePoints.length) {\n      timePoints = curTimePoints;\n      timePointsUnit = timePointsTags[tagName].unit;\n      break;\n    }\n  }\n\n  if (!timePoints.length) {\n    const concatTagNames = timePointsTagNames.join(', ');\n\n    throw new Error(`Could not extract time points data for the following tags: ${concatTagNames}`);\n  }\n\n  const convertedTimePoints = _convertTimePointsUnit(timePoints, timePointsUnit);\n\n  timePoints = convertedTimePoints.timePoints;\n  timePointsUnit = convertedTimePoints.timePointsUnit;\n\n  return { timePoints, timePointsUnit };\n}\n\nfunction _getSegmentationData(\n  segmentation,\n  volumesTimePointsCache,\n  { servicesManager }: { servicesManager: AppTypes.ServicesManager }\n) {\n  const { displaySetService, segmentationService, viewportGridService } = servicesManager.services;\n  const displaySets = displaySetService.getActiveDisplaySets();\n\n  const dynamic4DDisplaySet = displaySets.find(displaySet => {\n    const anInstance = displaySet.instances?.[0];\n\n    if (anInstance) {\n      return (\n        anInstance.FrameReferenceTime !== undefined || anInstance.NumberOfTimeSlices !== undefined\n      );\n    }\n\n    return false;\n  });\n\n  // const referencedDynamicVolume = cs.cache.getVolume(dynamic4DDisplaySet.displaySetInstanceUID);\n  let volumeCacheKey: string | undefined;\n  const volumeId = dynamic4DDisplaySet.displaySetInstanceUID;\n\n  for (const [key] of cs.cache._volumeCache) {\n    if (key.includes(volumeId)) {\n      volumeCacheKey = key;\n      break;\n    }\n  }\n\n  let referencedDynamicVolume;\n  if (volumeCacheKey) {\n    referencedDynamicVolume = cs.cache.getVolume(volumeCacheKey);\n  }\n\n  const { StudyInstanceUID, StudyDescription } = DicomMetadataStore.getInstanceByImageId(\n    referencedDynamicVolume.imageIds[0]\n  );\n\n  const segmentationVolume = segmentationService.getLabelmapVolume(segmentation.segmentationId);\n  const maskVolumeId = segmentationVolume?.volumeId;\n\n  const [timeData, _] = csToolsUtils.dynamicVolume.getDataInTime(referencedDynamicVolume, {\n    maskVolumeId,\n  }) as number[][];\n\n  const pixelCount = timeData.length;\n\n  if (pixelCount === 0) {\n    return [];\n  }\n\n  // Todo: this is useless we should be able to grab color with just segRepUID and segmentIndex\n  // const color = csTools.segmentation.config.color.getSegmentIndexColor(\n  //   segmentationRepresentationUID,\n  //   1 // segmentIndex\n  // );\n  const viewportId = viewportGridService.getActiveViewportId();\n  const color = segmentationService.getSegmentColor(viewportId, segmentation.segmentationId, 1);\n\n  const hexColor = cs.utilities.color.rgbToHex(color[0], color[1], color[2]);\n  let timePointsData = volumesTimePointsCache.get(referencedDynamicVolume);\n\n  if (!timePointsData) {\n    timePointsData = _getTimePointsData(referencedDynamicVolume);\n    volumesTimePointsCache.set(referencedDynamicVolume, timePointsData);\n  }\n\n  const { timePoints, timePointsUnit } = timePointsData;\n\n  if (timePoints.length !== timeData[0].length) {\n    throw new Error('Invalid number of time points returned');\n  }\n\n  const timepointsCount = timePoints.length;\n  const chartSeriesData = new Array(timepointsCount);\n\n  for (let i = 0; i < timepointsCount; i++) {\n    const average = timeData.reduce((acc, cur) => acc + cur[i] / pixelCount, 0);\n\n    chartSeriesData[i] = [timePoints[i], average];\n  }\n\n  return {\n    StudyInstanceUID,\n    StudyDescription,\n    chartData: {\n      series: {\n        label: segmentation.label,\n        points: chartSeriesData,\n        color: hexColor,\n      },\n      axis: {\n        x: {\n          label: `Time (${timePointsUnit})`,\n        },\n        y: {\n          label: `Vl (Bq/ml)`,\n        },\n      },\n    },\n  };\n}\n\nfunction _getInstanceFromSegmentations(segmentations, { servicesManager }) {\n  if (!segmentations.length) {\n    return;\n  }\n\n  const volumesTimePointsCache = new WeakMap();\n  const segmentationsData = segmentations.map(segmentation =>\n    _getSegmentationData(segmentation, volumesTimePointsCache, { servicesManager })\n  );\n\n  const { date: seriesDate, time: seriesTime } = _getDateTimeStr();\n  const series = segmentationsData.reduce((allSeries, curSegData) => {\n    return [...allSeries, curSegData.chartData.series];\n  }, []);\n\n  const instance = {\n    SOPClassUID: ChartDataSOPClassUid,\n    Modality: CHART_MODALITY,\n    SOPInstanceUID: utils.guid(),\n    SeriesDate: seriesDate,\n    SeriesTime: seriesTime,\n    SeriesInstanceUID: SEG_CHART_INSTANCE_UID,\n    StudyInstanceUID: segmentationsData[0].StudyInstanceUID,\n    StudyDescription: segmentationsData[0].StudyDescription,\n    SeriesNumber: 100,\n    SeriesDescription: 'Segmentation chart series data',\n    chartData: {\n      series,\n      axis: { ...segmentationsData[0].chartData.axis },\n    },\n  };\n\n  const seriesMetadata = {\n    StudyInstanceUID: instance.StudyInstanceUID,\n    StudyDescription: instance.StudyDescription,\n    SeriesInstanceUID: instance.SeriesInstanceUID,\n    SeriesDescription: instance.SeriesDescription,\n    SeriesNumber: instance.SeriesNumber,\n    SeriesTime: instance.SeriesTime,\n    SOPClassUID: instance.SOPClassUID,\n    Modality: instance.Modality,\n  };\n\n  return { seriesMetadata, instance };\n}\n\nfunction updateSegmentationsChartDisplaySet({ servicesManager }: withAppTypes): void {\n  debugger;\n  const { segmentationService } = servicesManager.services;\n  const segmentations = segmentationService.getSegmentations();\n  const { seriesMetadata, instance } =\n    _getInstanceFromSegmentations(segmentations, { servicesManager }) ?? {};\n\n  if (seriesMetadata && instance) {\n    // An event is triggered after adding the instance and the displaySet is created\n    DicomMetadataStore.addSeriesMetadata([seriesMetadata], true);\n    DicomMetadataStore.addInstances([instance], true);\n  }\n}\n\nexport { updateSegmentationsChartDisplaySet as default };\n","import * as importedActions from './actions';\nimport { utilities, Enums } from '@cornerstonejs/tools';\nimport { cache } from '@cornerstonejs/core';\n\nconst LABELMAP = Enums.SegmentationRepresentations.Labelmap;\n\nconst commandsModule = ({ commandsManager, servicesManager }: withAppTypes) => {\n  const services = servicesManager.services;\n  const { displaySetService, viewportGridService, segmentationService } = services;\n\n  const actions = {\n    ...importedActions,\n    getDynamic4DDisplaySet: () => {\n      const displaySets = displaySetService.getActiveDisplaySets();\n\n      const dynamic4DDisplaySet = displaySets.find(displaySet => {\n        const anInstance = displaySet.instances?.[0];\n\n        if (anInstance) {\n          return (\n            anInstance.FrameReferenceTime !== undefined ||\n            anInstance.NumberOfTimeSlices !== undefined ||\n            anInstance.TemporalPositionIdentifier !== undefined\n          );\n        }\n\n        return false;\n      });\n\n      return dynamic4DDisplaySet;\n    },\n    getComputedDisplaySets: () => {\n      const displaySetCache = displaySetService.getDisplaySetCache();\n      const cachedDisplaySets = [...displaySetCache.values()];\n      const computedDisplaySets = cachedDisplaySets.filter(displaySet => {\n        return displaySet.isDerived;\n      });\n      return computedDisplaySets;\n    },\n    exportTimeReportCSV: ({ segmentations, config, options, summaryStats }) => {\n      const dynamic4DDisplaySet = actions.getDynamic4DDisplaySet();\n\n      const volumeId = dynamic4DDisplaySet?.displaySetInstanceUID;\n\n      // cache._volumeCache is a map that has a key that includes the volumeId\n      // it is not exactly the volumeId, but it is the key that includes the volumeId\n      // so we can't do cache._volumeCache.get(volumeId) we should iterate\n      // over the keys and find the one that includes the volumeId\n      let volumeCacheKey: string | undefined;\n\n      for (const [key] of cache._volumeCache) {\n        if (key.includes(volumeId)) {\n          volumeCacheKey = key;\n          break;\n        }\n      }\n\n      let dynamicVolume;\n      if (volumeCacheKey) {\n        dynamicVolume = cache.getVolume(volumeCacheKey);\n      }\n\n      const instance = dynamic4DDisplaySet.instances[0];\n\n      const csv = [];\n\n      // CSV header information with placeholder empty values for the metadata lines\n      csv.push(`Patient ID,${instance.PatientID},`);\n      csv.push(`Study Date,${instance.StudyDate},`);\n      csv.push(`StudyInstanceUID,${instance.StudyInstanceUID},`);\n      csv.push(`StudyDescription,${instance.StudyDescription},`);\n      csv.push(`SeriesInstanceUID,${instance.SeriesInstanceUID},`);\n\n      // empty line\n      csv.push('');\n      csv.push('');\n\n      // Helper function to calculate standard deviation\n      function calculateStandardDeviation(data) {\n        const n = data.length;\n        const mean = data.reduce((acc, value) => acc + value, 0) / n;\n        const squaredDifferences = data.map(value => (value - mean) ** 2);\n        const variance = squaredDifferences.reduce((acc, value) => acc + value, 0) / n;\n        const stdDeviation = Math.sqrt(variance);\n        return stdDeviation;\n      }\n      // Iterate through each segmentation to get the timeData and ijkCoords\n      segmentations.forEach(segmentation => {\n        const volume = segmentationService.getLabelmapVolume(segmentation.segmentationId);\n        const [timeData, ijkCoords] = utilities.dynamicVolume.getDataInTime(dynamicVolume, {\n          maskVolumeId: volume.volumeId,\n        }) as number[][];\n\n        if (summaryStats) {\n          // Adding column headers for pixel identifier and segmentation label ids\n          let headers = 'Operation,Segmentation Label ID';\n          const maxLength = dynamicVolume.numTimePoints;\n          for (let t = 0; t < maxLength; t++) {\n            headers += `,Time Point ${t}`;\n          }\n          csv.push(headers);\n          // // perform summary statistics on the timeData including for each time point, mean, median, min, max, and standard deviation for\n          // // all the voxels in the ROI\n          const mean = [];\n          const min = [];\n          const minIJK = [];\n          const max = [];\n          const maxIJK = [];\n          const std = [];\n\n          const numVoxels = timeData.length;\n          // Helper function to calculate standard deviation\n          for (let timeIndex = 0; timeIndex < maxLength; timeIndex++) {\n            // for each voxel in the ROI, get the value at the current time point\n            const voxelValues = [];\n            let sum = 0;\n            let minValue = Infinity;\n            let maxValue = -Infinity;\n            let minIndex = 0;\n            let maxIndex = 0;\n\n            // Single pass through the data to collect all needed values\n            for (let voxelIndex = 0; voxelIndex < numVoxels; voxelIndex++) {\n              const value = timeData[voxelIndex][timeIndex];\n              voxelValues.push(value);\n              sum += value;\n\n              if (value < minValue) {\n                minValue = value;\n                minIndex = voxelIndex;\n              }\n              if (value > maxValue) {\n                maxValue = value;\n                maxIndex = voxelIndex;\n              }\n            }\n\n            mean.push(sum / numVoxels);\n            min.push(minValue);\n            minIJK.push(ijkCoords[minIndex]);\n            max.push(maxValue);\n            maxIJK.push(ijkCoords[maxIndex]);\n            std.push(calculateStandardDeviation(voxelValues));\n          }\n\n          let row = `Mean,${segmentation.label}`;\n          // Generate separate rows for each statistic\n          for (let t = 0; t < maxLength; t++) {\n            row += `,${mean[t]}`;\n          }\n\n          csv.push(row);\n\n          row = `Standard Deviation,${segmentation.label}`;\n          for (let t = 0; t < maxLength; t++) {\n            row += `,${std[t]}`;\n          }\n\n          csv.push(row);\n\n          row = `Min,${segmentation.label}`;\n          for (let t = 0; t < maxLength; t++) {\n            row += `,${min[t]}`;\n          }\n\n          csv.push(row);\n\n          row = `Max,${segmentation.label}`;\n          for (let t = 0; t < maxLength; t++) {\n            row += `,${max[t]}`;\n          }\n\n          csv.push(row);\n        } else {\n          // Adding column headers for pixel identifier and segmentation label ids\n          let headers = 'Pixel Identifier (IJK),Segmentation Label ID';\n          const maxLength = dynamicVolume.numTimePoints;\n          for (let t = 0; t < maxLength; t++) {\n            headers += `,Time Point ${t}`;\n          }\n          csv.push(headers);\n          // Assuming timeData and ijkCoords are of the same length\n          for (let i = 0; i < timeData.length; i++) {\n            // Generate the pixel identifier\n            const pixelIdentifier = `${ijkCoords[i][0]}_${ijkCoords[i][1]}_${ijkCoords[i][2]}`;\n\n            // Start a new row for the current pixel\n            let row = `${pixelIdentifier},${segmentation.label}`;\n\n            // Add time data points for this pixel\n            for (let t = 0; t < timeData[i].length; t++) {\n              row += `,${timeData[i][t]}`;\n            }\n\n            // Append the row to the CSV array\n            csv.push(row);\n          }\n        }\n      });\n\n      // Convert to CSV string\n      const csvContent = csv.join('\\n');\n\n      // Generate filename and trigger download\n      const filename = `${instance.PatientID}.csv`;\n      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\n      const link = document.createElement('a');\n      const url = URL.createObjectURL(blob);\n      link.setAttribute('href', url);\n      link.setAttribute('download', filename);\n      link.style.visibility = 'hidden';\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n    },\n    swapDynamicWithComputedDisplaySet: ({ displaySet }) => {\n      const computedDisplaySet = displaySet;\n\n      const displaySetCache = displaySetService.getDisplaySetCache();\n      const cachedDisplaySetKeys = [displaySetCache.keys()];\n      const { displaySetInstanceUID } = computedDisplaySet;\n      // Check to see if computed display set is already in cache\n      if (!cachedDisplaySetKeys.includes(displaySetInstanceUID)) {\n        displaySetCache.set(displaySetInstanceUID, computedDisplaySet);\n      }\n\n      // Get all viewports and their corresponding indices\n      const { viewports } = viewportGridService.getState();\n\n      // get the viewports in the grid\n      // iterate over them and find the ones that are showing a dynamic\n      // volume (displaySet), and replace that exact displaySet with the\n      // computed displaySet\n\n      const dynamic4DDisplaySet = actions.getDynamic4DDisplaySet();\n\n      const viewportsToUpdate = [];\n\n      for (const [key, value] of viewports) {\n        const viewport = value;\n        const viewportOptions = viewport.viewportOptions;\n        const { displaySetInstanceUIDs } = viewport;\n        const displaySetInstanceUIDIndex = displaySetInstanceUIDs.indexOf(\n          dynamic4DDisplaySet.displaySetInstanceUID\n        );\n        if (displaySetInstanceUIDIndex !== -1) {\n          const newViewport = {\n            viewportId: viewport.viewportId,\n            // merge the other displaySetInstanceUIDs with the new one\n            displaySetInstanceUIDs: [\n              ...displaySetInstanceUIDs.slice(0, displaySetInstanceUIDIndex),\n              displaySetInstanceUID,\n              ...displaySetInstanceUIDs.slice(displaySetInstanceUIDIndex + 1),\n            ],\n            viewportOptions: {\n              initialImageOptions: viewportOptions.initialImageOptions,\n              viewportType: 'volume',\n              orientation: viewportOptions.orientation,\n              background: viewportOptions.background,\n            },\n          };\n          viewportsToUpdate.push(newViewport);\n        }\n      }\n\n      viewportGridService.setDisplaySetsForViewports(viewportsToUpdate);\n    },\n    swapComputedWithDynamicDisplaySet: () => {\n      // Todo: this assumes there is only one dynamic display set in the viewer\n      const dynamicDisplaySet = actions.getDynamic4DDisplaySet();\n\n      const displaySetCache = displaySetService.getDisplaySetCache();\n      const cachedDisplaySetKeys = [...displaySetCache.keys()]; // Fix: Spread to get the array\n      const { displaySetInstanceUID } = dynamicDisplaySet;\n\n      // Check to see if dynamic display set is already in cache\n      if (!cachedDisplaySetKeys.includes(displaySetInstanceUID)) {\n        displaySetCache.set(displaySetInstanceUID, dynamicDisplaySet);\n      }\n\n      // Get all viewports and their corresponding indices\n      const { viewports } = viewportGridService.getState();\n\n      // Get the computed 4D display set\n      const computed4DDisplaySet = actions.getComputedDisplaySets()[0];\n\n      const viewportsToUpdate = [];\n\n      for (const [key, value] of viewports) {\n        const viewport = value;\n        const viewportOptions = viewport.viewportOptions;\n        const { displaySetInstanceUIDs } = viewport;\n        const displaySetInstanceUIDIndex = displaySetInstanceUIDs.indexOf(\n          computed4DDisplaySet.displaySetInstanceUID\n        );\n        if (displaySetInstanceUIDIndex !== -1) {\n          const newViewport = {\n            viewportId: viewport.viewportId,\n            // merge the other displaySetInstanceUIDs with the new one\n            displaySetInstanceUIDs: [\n              ...displaySetInstanceUIDs.slice(0, displaySetInstanceUIDIndex),\n              displaySetInstanceUID,\n              ...displaySetInstanceUIDs.slice(displaySetInstanceUIDIndex + 1),\n            ],\n            viewportOptions: {\n              initialImageOptions: viewportOptions.initialImageOptions,\n              viewportType: 'volume',\n              orientation: viewportOptions.orientation,\n              background: viewportOptions.background,\n            },\n          };\n          viewportsToUpdate.push(newViewport);\n        }\n      }\n\n      viewportGridService.setDisplaySetsForViewports(viewportsToUpdate);\n    },\n    createNewLabelMapForDynamicVolume: async ({ label }) => {\n      const { viewports, activeViewportId } = viewportGridService.getState();\n\n      // get the dynamic 4D display set\n      const dynamic4DDisplaySet = actions.getDynamic4DDisplaySet();\n      const dynamic4DDisplaySetInstanceUID = dynamic4DDisplaySet.displaySetInstanceUID;\n\n      // check if the dynamic 4D display set is in the display, if not we might have\n      // the computed volumes and we should choose them for the segmentation\n      // creation\n\n      let referenceDisplaySet;\n\n      const activeViewport = viewports.get(activeViewportId);\n      const activeDisplaySetInstanceUIDs = activeViewport.displaySetInstanceUIDs;\n      const dynamicIsInActiveViewport = activeDisplaySetInstanceUIDs.includes(\n        dynamic4DDisplaySetInstanceUID\n      );\n\n      if (dynamicIsInActiveViewport) {\n        referenceDisplaySet = dynamic4DDisplaySet;\n      }\n\n      if (!referenceDisplaySet) {\n        // try to see if there is any derived displaySet in the active viewport\n        // which is referencing the dynamic 4D display set\n\n        // Todo: this is wrong but I don't have time to fix it now\n        const cachedDisplaySets = displaySetService.getDisplaySetCache();\n        for (const [key, displaySet] of cachedDisplaySets) {\n          if (displaySet.referenceDisplaySetUID === dynamic4DDisplaySetInstanceUID) {\n            referenceDisplaySet = displaySet;\n            break;\n          }\n        }\n      }\n\n      if (!referenceDisplaySet) {\n        throw new Error('No reference display set found based on the dynamic data');\n      }\n\n      const displaySet = displaySetService.getDisplaySetByUID(\n        referenceDisplaySet.displaySetInstanceUID\n      );\n\n      const segmentationId = await segmentationService.createLabelmapForDisplaySet(displaySet, {\n        label,\n      });\n\n      const firstViewport = viewports.values().next().value;\n\n      await segmentationService.addSegmentationRepresentation(firstViewport.viewportId, {\n        segmentationId,\n      });\n\n      return segmentationId;\n    },\n  };\n\n  const definitions = {\n    updateSegmentationsChartDisplaySet: {\n      commandFn: actions.updateSegmentationsChartDisplaySet,\n      storeContexts: [],\n      options: {},\n    },\n    exportTimeReportCSV: {\n      commandFn: actions.exportTimeReportCSV,\n      storeContexts: [],\n      options: {},\n    },\n    swapDynamicWithComputedDisplaySet: {\n      commandFn: actions.swapDynamicWithComputedDisplaySet,\n      storeContexts: [],\n      options: {},\n    },\n    createNewLabelMapForDynamicVolume: {\n      commandFn: actions.createNewLabelMapForDynamicVolume,\n      storeContexts: [],\n      options: {},\n    },\n    swapComputedWithDynamicDisplaySet: {\n      commandFn: actions.swapComputedWithDynamicDisplaySet,\n      storeContexts: [],\n      options: {},\n    },\n  };\n\n  return {\n    actions,\n    definitions,\n    defaultContext: 'DYNAMIC-VOLUME:CORNERSTONE',\n  };\n};\n\nexport default commandsModule;\n","import React, { useEffect, useState } from 'react';\nimport {\n  Button,\n  PanelSection,\n  ButtonGroup,\n  IconButton,\n  InputNumber,\n  Icon,\n  Tooltip,\n} from '@ohif/ui';\n\nimport { DoubleSlider } from '@ohif/ui-next';\n\nimport { Enums } from '@cornerstonejs/core';\n\nconst controlClassNames = {\n  sizeClassName: 'w-[58px] h-[28px]',\n  arrowsDirection: 'horizontal',\n  labelPosition: 'bottom',\n};\n\nconst Header = ({ title, tooltip }) => (\n  <div className=\"flex items-center space-x-1\">\n    <Tooltip\n      content={<div className=\"text-white\">{tooltip}</div>}\n      position=\"bottom-left\"\n      tight={true}\n      tooltipBoxClassName=\"max-w-xs p-2\"\n    >\n      <Icon\n        name=\"info-link\"\n        className=\"text-primary-active h-[14px] w-[14px]\"\n      />\n    </Tooltip>\n    <span className=\"text-aqua-pale text-[11px] uppercase\">{title}</span>\n  </div>\n);\n\nconst DynamicVolumeControls = ({\n  isPlaying,\n  onPlayPauseChange,\n  // fps\n  fps,\n  onFpsChange,\n  minFps,\n  maxFps,\n  // Frames\n  currentFrameIndex,\n  onFrameChange,\n  framesLength,\n  onGenerate,\n  onDoubleRangeChange,\n  onDynamicClick,\n}) => {\n  const [computedView, setComputedView] = useState(false);\n\n  const [computeViewMode, setComputeViewMode] = useState(Enums.DynamicOperatorType.SUM);\n\n  const [sliderRangeValues, setSliderRangeValues] = useState([0, framesLength - 1]);\n\n  const handleSliderChange = newValues => {\n    onDoubleRangeChange(newValues);\n    setSliderRangeValues(newValues);\n  };\n\n  const formatLabel = value => Math.round(value);\n\n  return (\n    <div className=\"flex select-none flex-col\">\n      <PanelSection\n        title=\"Controls\"\n        childrenClassName=\"space-y-4 pb-5 px-5\"\n      >\n        <div className=\"mt-2\">\n          <Header\n            title=\"View\"\n            tooltip={\n              'Select the view mode, 4D to view the dynamic volume or Computed to view the computed volume'\n            }\n          />\n          <ButtonGroup className=\"mt-2 w-full\">\n            <button\n              className=\"w-1/2\"\n              onClick={() => {\n                setComputedView(false);\n                onDynamicClick?.();\n              }}\n            >\n              4D\n            </button>\n            <button\n              className=\"w-1/2\"\n              onClick={() => {\n                setComputedView(true);\n              }}\n            >\n              Computed\n            </button>\n          </ButtonGroup>\n        </div>\n        <div>\n          <FrameControls\n            onPlayPauseChange={onPlayPauseChange}\n            isPlaying={isPlaying}\n            computedView={computedView}\n            // fps\n            fps={fps}\n            onFpsChange={onFpsChange}\n            minFps={minFps}\n            maxFps={maxFps}\n            //\n            framesLength={framesLength}\n            onFrameChange={onFrameChange}\n            currentFrameIndex={currentFrameIndex}\n          />\n        </div>\n        <div className={`mt-6 flex flex-col ${computedView ? '' : 'ohif-disabled'}`}>\n          <Header\n            title=\"Computed Operation\"\n            tooltip={\n              <div>\n                Operation Buttons (SUM, AVERAGE, SUBTRACT): Select the mathematical operation to be\n                applied to the data set.\n                <br></br> Range Slider: Choose the numeric range within which the operation will be\n                performed.\n                <br></br>Generate Button: Execute the chosen operation on the specified range of\n                data.{' '}\n              </div>\n            }\n          />\n          <ButtonGroup\n            className={`mt-2 w-full`}\n            separated={true}\n          >\n            <button\n              className=\"w-1/2\"\n              onClick={() => setComputeViewMode(Enums.DynamicOperatorType.SUM)}\n            >\n              {Enums.DynamicOperatorType.SUM.toString().toUpperCase()}\n            </button>\n            <button\n              className=\"w-1/2\"\n              onClick={() => setComputeViewMode(Enums.DynamicOperatorType.AVERAGE)}\n            >\n              {Enums.DynamicOperatorType.AVERAGE.toString().toUpperCase()}\n            </button>\n            <button\n              className=\"w-1/2\"\n              onClick={() => setComputeViewMode(Enums.DynamicOperatorType.SUBTRACT)}\n            >\n              {Enums.DynamicOperatorType.SUBTRACT.toString().toUpperCase()}\n            </button>\n          </ButtonGroup>\n          <div className=\"mt-2 w-full\">\n            <DoubleSlider\n              min={0}\n              max={framesLength - 1}\n              step={1}\n              defaultValue={sliderRangeValues}\n              onValueChange={handleSliderChange}\n              formatLabel={formatLabel}\n              className=\"w-full\"\n            />\n          </div>\n          <Button\n            className=\"mt-2 !h-[26px] !w-[115px] self-start !p-0\"\n            onClick={() => {\n              onGenerate(computeViewMode);\n            }}\n          >\n            Generate\n          </Button>\n        </div>\n      </PanelSection>\n    </div>\n  );\n};\n\nexport default DynamicVolumeControls;\n\nfunction FrameControls({\n  isPlaying,\n  onPlayPauseChange,\n  fps,\n  minFps,\n  maxFps,\n  onFpsChange,\n  framesLength,\n  onFrameChange,\n  currentFrameIndex,\n  computedView,\n}) {\n  const getPlayPauseIconName = () => (isPlaying ? 'icon-pause' : 'icon-play');\n\n  return (\n    <div className={computedView && 'ohif-disabled'}>\n      <Header\n        title=\"4D Controls\"\n        tooltip={\n          <div>\n            Play/Pause Button: Begin or pause the animation of the 4D visualization. <br></br> Frame\n            Selector: Navigate through individual frames of the 4D data. <br></br> FPS (Frames Per\n            Second) Selector: Adjust the playback speed of the animation.\n          </div>\n        }\n      />\n      <div className=\"mt-3 flex justify-between\">\n        <IconButton\n          className=\"bg-customblue-30 h-[26px] w-[58px] rounded-[4px]\"\n          onClick={() => onPlayPauseChange(!isPlaying)}\n        >\n          <Icon\n            name={getPlayPauseIconName()}\n            className=\"active:text-primary-light hover:bg-customblue-300 h-[24px] w-[24px] cursor-pointer text-white\"\n          />\n        </IconButton>\n        <InputNumber\n          value={currentFrameIndex}\n          onChange={onFrameChange}\n          minValue={0}\n          maxValue={framesLength - 1}\n          label=\"Frame\"\n          {...controlClassNames}\n        />\n        <InputNumber\n          value={fps}\n          onChange={onFpsChange}\n          minValue={minFps}\n          maxValue={maxFps}\n          {...controlClassNames}\n          label=\"FPS\"\n        />\n      </div>\n    </div>\n  );\n}\n","import React, { useEffect, useState, useRef } from 'react';\nimport { useCine, useViewportGrid } from '@ohif/ui';\nimport { utilities as csUtils, volumeLoader, eventTarget, Enums, cache } from '@cornerstonejs/core';\nimport { utilities as cstUtils } from '@cornerstonejs/tools';\nimport DynamicVolumeControls from './DynamicVolumeControls';\n\nconst SOPClassHandlerId = '@ohif/extension-default.sopClassHandlerModule.stack';\n\nexport default function PanelGenerateImage({ servicesManager, commandsManager }: withAppTypes) {\n  const { cornerstoneViewportService, viewportGridService, displaySetService } =\n    servicesManager.services;\n\n  const [{ isCineEnabled }, cineService] = useCine();\n  const [{ activeViewportId }] = useViewportGrid();\n\n  //\n  const [timePointsRange, setTimePointsRange] = useState([0, 0]);\n  const [timePointsRangeToUseForGenerate, setTimePointsRangeToUseForGenerate] = useState([0, 0]);\n  const [computedDisplaySet, setComputedDisplaySet] = useState(null);\n  const [dynamicVolume, setDynamicVolume] = useState(null);\n  const [frameRate, setFrameRate] = useState(20);\n  const [isPlaying, setIsPlaying] = useState(isCineEnabled);\n  const [timePointRendered, setTimePointRendered] = useState(null);\n  const [displayingComputed, setDisplayingComputed] = useState(false);\n\n  //\n  const uuidComputedVolume = useRef(csUtils.uuidv4());\n  const uuidDynamicVolume = useRef(null);\n  const computedVolumeId = `cornerstoneStreamingImageVolume:${uuidComputedVolume.current}`;\n\n  useEffect(() => {\n    const viewportDataChangedEvt = cornerstoneViewportService.EVENTS.VIEWPORT_DATA_CHANGED;\n    const cineStateChangedEvt = servicesManager.services.cineService.EVENTS.CINE_STATE_CHANGED;\n\n    const viewportDataChangedCallback = evtDetails => {\n      evtDetails.viewportData.data.forEach(volumeData => {\n        if (volumeData.volume?.isDynamicVolume()) {\n          setDynamicVolume(volumeData.volume);\n          uuidDynamicVolume.current = volumeData.displaySetInstanceUID;\n          const newRange = [1, volumeData.volume.numTimePoints];\n          setTimePointsRange(newRange);\n          setTimePointsRangeToUseForGenerate(newRange);\n        }\n      });\n    };\n\n    const cineStateChangedCallback = evt => {\n      setIsPlaying(evt.isPlaying);\n    };\n\n    const { unsubscribe: unsubscribeViewportData } = cornerstoneViewportService.subscribe(\n      viewportDataChangedEvt,\n      viewportDataChangedCallback\n    );\n    const { unsubscribe: unsubscribeCineState } = servicesManager.services.cineService.subscribe(\n      cineStateChangedEvt,\n      cineStateChangedCallback\n    );\n\n    return () => {\n      unsubscribeViewportData();\n      unsubscribeCineState();\n    };\n  }, [cornerstoneViewportService, cineService, servicesManager.services.cineService]);\n\n  useEffect(() => {\n    const evt = Enums.Events.DYNAMIC_VOLUME_TIME_POINT_INDEX_CHANGED;\n\n    const callback = evt => {\n      setTimePointRendered(evt.detail.timePointIndex);\n    };\n\n    eventTarget.addEventListener(evt, callback);\n\n    return () => {\n      eventTarget.removeEventListener(evt, callback);\n    };\n  }, [cornerstoneViewportService]);\n\n  useEffect(() => {\n    const displaySetUIDs = viewportGridService.getDisplaySetsUIDsForViewport(activeViewportId);\n\n    if (!displaySetUIDs?.length) {\n      return;\n    }\n\n    const displaySets = displaySetUIDs.map(displaySetService.getDisplaySetByUID);\n    const dynamicVolumeDisplaySet = displaySets.find(displaySet => displaySet.isDynamicVolume);\n\n    if (!dynamicVolumeDisplaySet) {\n      return;\n    }\n\n    const dynamicVolume = cache\n      .getVolumes()\n      .find(volume => volume.volumeId.includes(dynamicVolumeDisplaySet.displaySetInstanceUID));\n\n    if (!dynamicVolume) {\n      return;\n    }\n\n    setDynamicVolume(dynamicVolume);\n    uuidDynamicVolume.current = dynamicVolumeDisplaySet.displaySetInstanceUID;\n    const newRange = [1, dynamicVolume.numTimePoints];\n    setTimePointsRange(newRange);\n    setTimePointsRangeToUseForGenerate(newRange);\n  }, [\n    activeViewportId,\n    viewportGridService,\n    displaySetService,\n    cornerstoneViewportService,\n    cineService,\n  ]);\n\n  function renderGeneratedImage(displaySet) {\n    commandsManager.runCommand('swapDynamicWithComputedDisplaySet', {\n      displaySet,\n    });\n\n    setDisplayingComputed(true);\n  }\n\n  function renderDynamicImage(displaySet) {\n    commandsManager.runCommand('swapComputedWithDynamicDisplaySet');\n  }\n\n  // Get computed volume from cache, calculate the data across the time frames,\n  // set the scalar data to the computedVolume, and create displaySet\n  async function onGenerateImage(operationName) {\n    const dynamicVolumeId = dynamicVolume.volumeId;\n\n    if (!dynamicVolumeId) {\n      return;\n    }\n\n    let computedVolume = cache.getVolume(computedVolumeId);\n\n    if (!computedVolume) {\n      computedVolume = await volumeLoader.createAndCacheDerivedVolume(dynamicVolumeId, {\n        volumeId: computedVolumeId,\n      });\n    }\n    const [start, end] = timePointsRangeToUseForGenerate;\n    const frameNumbers = Array.from({ length: end - start + 1 }, (_, i) => i + start - 1);\n\n    const options = {\n      frameNumbers: operationName === 'SUBTRACT' ? [start, end - 1] : frameNumbers,\n      targetVolume: computedVolume,\n    };\n\n    cstUtils.dynamicVolume.updateVolumeFromTimeData(dynamicVolume, operationName, options);\n\n    // If computed display set does not exist, create an object to be used as\n    // the displaySet. If it does exist, update the image data and vtkTexture\n    if (!computedDisplaySet) {\n      const displaySet = {\n        volumeLoaderSchema: computedVolume.volumeId.split(':')[0],\n        displaySetInstanceUID: uuidComputedVolume.current,\n        SOPClassHandlerId: SOPClassHandlerId,\n        Modality: dynamicVolume.metadata.Modality,\n        isMultiFrame: false,\n        numImageFrames: 1,\n        uid: uuidComputedVolume.current,\n        referenceDisplaySetUID: dynamicVolume.volumeId.split(':')[1],\n        madeInClient: true,\n        FrameOfReferenceUID: dynamicVolume.metadata.FrameOfReferenceUID,\n        isDerived: true,\n        imageIds: computedVolume.imageIds,\n      };\n      setComputedDisplaySet(displaySet);\n      renderGeneratedImage(displaySet);\n    } else {\n      commandsManager.runCommand('updateVolumeData', {\n        volume: computedVolume,\n      });\n      cornerstoneViewportService.getRenderingEngine().render();\n      renderGeneratedImage(computedDisplaySet);\n    }\n  }\n\n  const onPlayPauseChange = isPlaying => {\n    isPlaying ? handlePlay() : handleStop();\n  };\n\n  const handlePlay = () => {\n    setIsPlaying(true);\n    const viewportInfo = cornerstoneViewportService.getViewportInfo(activeViewportId);\n\n    if (!viewportInfo) {\n      return;\n    }\n\n    const { element } = viewportInfo;\n    cineService.playClip(element, { framesPerSecond: frameRate, viewportId: activeViewportId });\n  };\n\n  const handleStop = () => {\n    setIsPlaying(false);\n    const { element } = cornerstoneViewportService.getViewportInfo(activeViewportId);\n    cineService.stopClip(element);\n  };\n\n  const handleSetFrameRate = newFrameRate => {\n    setFrameRate(newFrameRate);\n    handleStop();\n    handlePlay();\n  };\n\n  function handleSliderChange(newValues) {\n    if (\n      newValues[0] === timePointsRangeToUseForGenerate[0] &&\n      newValues[1] === timePointsRangeToUseForGenerate[1]\n    ) {\n      return;\n    }\n\n    setTimePointsRangeToUseForGenerate(newValues);\n  }\n\n  if (!dynamicVolume || timePointsRange.length === 0) {\n    return null;\n  }\n\n  return (\n    <DynamicVolumeControls\n      fps={frameRate}\n      isPlaying={isPlaying}\n      onPlayPauseChange={onPlayPauseChange}\n      minFps={1}\n      maxFps={50}\n      currentFrameIndex={timePointRendered}\n      onFpsChange={handleSetFrameRate}\n      framesLength={timePointsRange[1]}\n      onFrameChange={timePointIndex => {\n        dynamicVolume.timePointIndex = timePointIndex;\n      }}\n      onGenerate={onGenerateImage}\n      onDynamicClick={displayingComputed ? () => renderDynamicImage(computedDisplaySet) : null}\n      onDoubleRangeChange={handleSliderChange}\n      initialRangeValues={timePointsRangeToUseForGenerate}\n    />\n  );\n}\n","import React from 'react';\nimport PanelGenerateImage from './PanelGenerateImage';\n\nfunction DynamicDataPanel({ servicesManager, commandsManager, tab }: withAppTypes) {\n  return (\n    <>\n      <div\n        className=\"flex flex-col text-white\"\n        data-cy={'dynamic-volume-panel'}\n      >\n        <PanelGenerateImage\n          commandsManager={commandsManager}\n          servicesManager={servicesManager}\n        ></PanelGenerateImage>\n      </div>\n    </>\n  );\n}\n\nexport default DynamicDataPanel;\n","import React from 'react';\nimport { Button, Icons } from '@ohif/ui-next';\nimport { useSegmentations } from '@ohif/extension-cornerstone';\n\nfunction DynamicExport({ commandsManager, servicesManager }: withAppTypes) {\n  const segmentations = useSegmentations({ servicesManager });\n\n  if (!segmentations?.length) {\n    return null;\n  }\n\n  return (\n    <div className=\"flex gap-2\">\n      <div className=\"flex h-8 w-full items-center rounded pr-0.5\">\n        <Button\n          size=\"sm\"\n          variant=\"ghost\"\n          className=\"pl-1.5\"\n          onClick={() => {\n            commandsManager.runCommand('exportTimeReportCSV', {\n              segmentations,\n              options: {\n                filename: 'TimeData.csv',\n              },\n            });\n          }}\n        >\n          <Icons.Export />\n          <span className=\"pl-1\">Time Data</span>\n        </Button>\n      </div>\n      <div className=\"flex h-8 w-full items-center rounded pr-0.5\">\n        <Button\n          size=\"sm\"\n          variant=\"ghost\"\n          className=\"pl-1.5\"\n          onClick={() => {\n            commandsManager.runCommand('exportTimeReportCSV', {\n              segmentations,\n              summaryStats: true,\n              options: {\n                filename: 'ROIStats.csv',\n              },\n            });\n          }}\n        >\n          <Icons.Export />\n          <span className=\"pl-1\">ROI Stats</span>\n        </Button>\n      </div>\n    </div>\n  );\n}\n\nexport default DynamicExport;\n","import React from 'react';\nimport { DynamicDataPanel } from './panels';\nimport { Toolbox } from '@ohif/ui-next';\nimport { PanelSegmentation } from '@ohif/extension-cornerstone';\nimport DynamicExport from './panels/DynamicExport';\n\nfunction getPanelModule({ commandsManager, extensionManager, servicesManager, configuration }) {\n  const wrappedDynamicDataPanel = () => {\n    return (\n      <DynamicDataPanel\n        commandsManager={commandsManager}\n        servicesManager={servicesManager}\n        extensionManager={extensionManager}\n      />\n    );\n  };\n\n  const wrappedDynamicSegmentation = () => {\n    return (\n      <>\n        <Toolbox\n          commandsManager={commandsManager}\n          servicesManager={servicesManager}\n          extensionManager={extensionManager}\n          buttonSectionId=\"dynamic-toolbox\"\n          title=\"Threshold Tools\"\n        />\n        <PanelSegmentation\n          servicesManager={servicesManager}\n          commandsManager={commandsManager}\n          extensionManager={extensionManager}\n          configuration={configuration}\n        >\n          <DynamicExport\n            servicesManager={servicesManager}\n            commandsManager={commandsManager}\n          />\n        </PanelSegmentation>\n      </>\n    );\n  };\n\n  return [\n    {\n      name: 'dynamic-volume',\n      iconName: 'tab-4d',\n      iconLabel: '4D Workflow',\n      label: '4D Workflow',\n      component: wrappedDynamicDataPanel,\n    },\n    {\n      name: 'dynamic-segmentation',\n      iconName: 'tab-segmentation',\n      iconLabel: 'Segmentation',\n      label: 'Segmentation',\n      component: wrappedDynamicSegmentation,\n    },\n  ];\n}\n\nexport default getPanelModule;\n","const DEFAULT_COLORMAP = '2hot';\nconst toolGroupIds = {\n  pt: 'dynamic4D-pt',\n  fusion: 'dynamic4D-fusion',\n  ct: 'dynamic4D-ct',\n};\n\nfunction getPTOptions({\n  colormap,\n  voiInverted,\n}: {\n  colormap?: {\n    name: string;\n    opacity:\n      | number\n      | {\n          value: number;\n          opacity: number;\n        }[];\n  };\n  voiInverted?: boolean;\n} = {}) {\n  return {\n    blendMode: 'MIP',\n    colormap,\n    voi: {\n      windowWidth: 5,\n      windowCenter: 2.5,\n    },\n    voiInverted,\n  };\n}\n\nfunction getPTViewports() {\n  const ptOptionsParams = {\n    colormap: {\n      name: DEFAULT_COLORMAP,\n      opacity: [\n        { value: 0, opacity: 0 },\n        { value: 0.1, opacity: 1 },\n        { value: 1, opacity: 1 },\n      ],\n    },\n    voiInverted: false,\n  };\n\n  return [\n    {\n      viewportOptions: {\n        viewportId: 'ptAxial',\n        viewportType: 'volume',\n        orientation: 'axial',\n        toolGroupId: toolGroupIds.pt,\n        initialImageOptions: {\n          preset: 'middle', // 'first', 'last', 'middle'\n        },\n        syncGroups: [\n          {\n            type: 'cameraPosition',\n            id: 'axialSync',\n            source: true,\n            target: true,\n          },\n          {\n            type: 'voi',\n            id: 'ptWLSync',\n            source: true,\n            target: true,\n          },\n        ],\n      },\n      displaySets: [\n        {\n          id: 'ptDisplaySet',\n          options: { ...getPTOptions(ptOptionsParams) },\n        },\n      ],\n    },\n    {\n      viewportOptions: {\n        viewportId: 'ptSagittal',\n        viewportType: 'volume',\n        orientation: 'sagittal',\n        toolGroupId: toolGroupIds.pt,\n        initialImageOptions: {\n          preset: 'middle', // 'first', 'last', 'middle'\n        },\n        syncGroups: [\n          {\n            type: 'cameraPosition',\n            id: 'sagittalSync',\n            source: true,\n            target: true,\n          },\n          {\n            type: 'voi',\n            id: 'ptWLSync',\n            source: true,\n            target: true,\n          },\n        ],\n      },\n      displaySets: [\n        {\n          id: 'ptDisplaySet',\n          options: { ...getPTOptions(ptOptionsParams) },\n        },\n      ],\n    },\n    {\n      viewportOptions: {\n        viewportId: 'ptCoronal',\n        viewportType: 'volume',\n        orientation: 'coronal',\n        toolGroupId: toolGroupIds.pt,\n        initialImageOptions: {\n          preset: 'middle', // 'first', 'last', 'middle'\n        },\n        syncGroups: [\n          {\n            type: 'cameraPosition',\n            id: 'coronalSync',\n            source: true,\n            target: true,\n          },\n          {\n            type: 'voi',\n            id: 'ptWLSync',\n            source: true,\n            target: true,\n          },\n        ],\n      },\n      displaySets: [\n        {\n          id: 'ptDisplaySet',\n          options: { ...getPTOptions(ptOptionsParams) },\n        },\n      ],\n    },\n  ];\n}\n\nfunction getFusionViewports() {\n  const ptOptionsParams = {\n    colormap: {\n      name: DEFAULT_COLORMAP,\n      opacity: [\n        { value: 0, opacity: 0 },\n        { value: 0.1, opacity: 0.8 },\n        { value: 1, opacity: 0.8 },\n      ],\n    },\n  };\n\n  return [\n    {\n      viewportOptions: {\n        viewportId: 'fusionAxial',\n        viewportType: 'volume',\n        orientation: 'axial',\n        toolGroupId: toolGroupIds.fusion,\n        initialImageOptions: {\n          preset: 'middle', // 'first', 'last', 'middle'\n        },\n        syncGroups: [\n          {\n            type: 'cameraPosition',\n            id: 'axialSync',\n            source: true,\n            target: true,\n          },\n          {\n            type: 'voi',\n            id: 'ctWLSync',\n            source: false,\n            target: true,\n          },\n          {\n            type: 'voi',\n            id: 'fusionWLSync',\n            source: true,\n            target: true,\n          },\n          {\n            type: 'voi',\n            id: 'ptFusionWLSync',\n            source: false,\n            target: true,\n            options: {\n              syncInvertState: false,\n            },\n          },\n          {\n            type: 'hydrateseg',\n            id: 'sameFORId',\n            source: true,\n            target: true,\n            options: {\n              matchingRules: ['sameFOR'],\n            },\n          },\n        ],\n      },\n      displaySets: [\n        {\n          id: 'ctDisplaySet',\n        },\n        {\n          options: { ...getPTOptions(ptOptionsParams) },\n          id: 'ptDisplaySet',\n        },\n      ],\n    },\n    {\n      viewportOptions: {\n        viewportId: 'fusionSagittal',\n        viewportType: 'volume',\n        orientation: 'sagittal',\n        toolGroupId: toolGroupIds.fusion,\n        initialImageOptions: {\n          preset: 'middle', // 'first', 'last', 'middle'\n        },\n        syncGroups: [\n          {\n            type: 'cameraPosition',\n            id: 'sagittalSync',\n            source: true,\n            target: true,\n          },\n          {\n            type: 'voi',\n            id: 'ctWLSync',\n            source: false,\n            target: true,\n          },\n          {\n            type: 'voi',\n            id: 'fusionWLSync',\n            source: true,\n            target: true,\n          },\n          {\n            type: 'voi',\n            id: 'ptFusionWLSync',\n            source: false,\n            target: true,\n            options: {\n              syncInvertState: false,\n            },\n          },\n          {\n            type: 'hydrateseg',\n            id: 'sameFORId',\n            source: true,\n            target: true,\n            options: {\n              matchingRules: ['sameFOR'],\n            },\n          },\n        ],\n      },\n      displaySets: [\n        {\n          id: 'ctDisplaySet',\n        },\n        {\n          options: { ...getPTOptions(ptOptionsParams) },\n          id: 'ptDisplaySet',\n        },\n      ],\n    },\n    {\n      viewportOptions: {\n        viewportId: 'fusionCoronal',\n        viewportType: 'volume',\n        orientation: 'coronal',\n        toolGroupId: toolGroupIds.fusion,\n        initialImageOptions: {\n          preset: 'middle', // 'first', 'last', 'middle'\n        },\n        syncGroups: [\n          {\n            type: 'cameraPosition',\n            id: 'coronalSync',\n            source: true,\n            target: true,\n          },\n          {\n            type: 'voi',\n            id: 'ctWLSync',\n            source: false,\n            target: true,\n          },\n          {\n            type: 'voi',\n            id: 'fusionWLSync',\n            source: true,\n            target: true,\n          },\n          {\n            type: 'voi',\n            id: 'ptFusionWLSync',\n            source: false,\n            target: true,\n            options: {\n              syncInvertState: false,\n            },\n          },\n          {\n            type: 'hydrateseg',\n            id: 'sameFORId',\n            source: true,\n            target: true,\n            options: {\n              matchingRules: ['sameFOR'],\n            },\n          },\n        ],\n      },\n      displaySets: [\n        {\n          id: 'ctDisplaySet',\n        },\n        {\n          options: { ...getPTOptions(ptOptionsParams) },\n          id: 'ptDisplaySet',\n        },\n      ],\n    },\n  ];\n}\n\nfunction getSeriesChartViewport() {\n  return {\n    viewportOptions: {\n      viewportId: 'seriesChart',\n    },\n    displaySets: [\n      {\n        id: 'chartDisplaySet',\n        options: {\n          // This dataset does not require the download of any instance since it is pre-computed locally,\n          // but interleaveTopToBottom.ts was not loading any series because it consider that all viewports\n          // are a Cornerstone viewport which is not true in this case and it waits for all viewports to\n          // have called interleaveTopToBottom(...).\n          skipLoading: true,\n        },\n      },\n    ],\n  };\n}\n\nfunction getCTViewports() {\n  return [\n    {\n      viewportOptions: {\n        viewportId: 'ctAxial',\n        viewportType: 'volume',\n        orientation: 'axial',\n        toolGroupId: toolGroupIds.ct,\n        initialImageOptions: {\n          preset: 'middle', // 'first', 'last', 'middle'\n        },\n        syncGroups: [\n          {\n            type: 'cameraPosition',\n            id: 'axialSync',\n            source: true,\n            target: true,\n          },\n          {\n            type: 'voi',\n            id: 'ctWLSync',\n            source: true,\n            target: true,\n          },\n        ],\n      },\n      displaySets: [\n        {\n          id: 'ctDisplaySet',\n        },\n      ],\n    },\n    {\n      viewportOptions: {\n        viewportId: 'ctSagittal',\n        viewportType: 'volume',\n        orientation: 'sagittal',\n        toolGroupId: toolGroupIds.ct,\n        initialImageOptions: {\n          preset: 'middle',\n        },\n        syncGroups: [\n          {\n            type: 'cameraPosition',\n            id: 'sagittalSync',\n            source: true,\n            target: true,\n          },\n          {\n            type: 'voi',\n            id: 'ctWLSync',\n            source: true,\n            target: true,\n          },\n        ],\n      },\n      displaySets: [\n        {\n          id: 'ctDisplaySet',\n        },\n      ],\n    },\n    {\n      viewportOptions: {\n        viewportId: 'ctCoronal',\n        viewportType: 'volume',\n        orientation: 'coronal',\n        toolGroupId: toolGroupIds.ct,\n        initialImageOptions: {\n          preset: 'middle',\n        },\n        syncGroups: [\n          {\n            type: 'cameraPosition',\n            id: 'coronalSync',\n            source: true,\n            target: true,\n          },\n          {\n            type: 'voi',\n            id: 'ctWLSync',\n            source: true,\n            target: true,\n          },\n        ],\n      },\n      displaySets: [\n        {\n          id: 'ctDisplaySet',\n        },\n      ],\n    },\n  ];\n}\n\nconst defaultProtocol = {\n  id: 'default4D',\n  locked: true,\n  // Don't store this hanging protocol as it applies to the currently active\n  // display set by default\n  // cacheId: null,\n  hasUpdatedPriorsInformation: false,\n  name: 'Default',\n  createdDate: '2023-01-01T00:00:00.000Z',\n  modifiedDate: '2023-01-01T00:00:00.000Z',\n  availableTo: {},\n  editableBy: {},\n  imageLoadStrategy: 'default', // \"default\" , \"interleaveTopToBottom\",  \"interleaveCenter\"\n  protocolMatchingRules: [\n    {\n      attribute: 'ModalitiesInStudy',\n      constraint: {\n        contains: ['CT', 'PT'],\n      },\n    },\n  ],\n  // -1 would be used to indicate active only, whereas other values are\n  // the number of required priors referenced - so 0 means active with\n  // 0 or more priors.\n  numberOfPriorsReferenced: -1,\n  displaySetSelectors: {\n    defaultDisplaySetId: {\n      // Unused currently\n      imageMatchingRules: [],\n      // Matches displaysets, NOT series\n      seriesMatchingRules: [\n        // Try to match series with images by default, to prevent weird display\n        // on SEG/SR containing studies\n        {\n          attribute: 'numImageFrames',\n          constraint: {\n            greaterThan: { value: 0 },\n          },\n        },\n      ],\n      // Can be used to select matching studies\n      // studyMatchingRules: [],\n    },\n    ctDisplaySet: {\n      // Unused currently\n      imageMatchingRules: [],\n      // Matches displaysets, NOT series\n      seriesMatchingRules: [\n        {\n          attribute: 'Modality',\n          constraint: {\n            equals: {\n              value: 'CT',\n            },\n          },\n          required: true,\n        },\n        {\n          attribute: 'isReconstructable',\n          constraint: {\n            equals: {\n              value: true,\n            },\n          },\n          required: true,\n        },\n      ],\n      // Can be used to select matching studies\n      // studyMatchingRules: [],\n    },\n    ptDisplaySet: {\n      // Unused currently\n      imageMatchingRules: [],\n      // Matches displaysets, NOT series\n      seriesMatchingRules: [\n        {\n          attribute: 'Modality',\n          constraint: {\n            equals: 'PT',\n          },\n          required: true,\n        },\n        {\n          attribute: 'isReconstructable',\n          constraint: {\n            equals: {\n              value: true,\n            },\n          },\n          required: true,\n        },\n        {\n          attribute: 'SeriesDescription',\n          constraint: {\n            contains: 'Corrected',\n          },\n        },\n        {\n          weight: 2,\n          attribute: 'SeriesDescription',\n          constraint: {\n            doesNotContain: {\n              value: 'Uncorrected',\n            },\n          },\n        },\n\n        // Should we check if CorrectedImage contains ATTN?\n        // (0028,0051) (CorrectedImage): NORM\\DTIM\\ATTN\\SCAT\\RADL\\DECY\n      ],\n      // Can be used to select matching studies\n      // studyMatchingRules: [],\n    },\n    chartDisplaySet: {\n      // Unused currently\n      imageMatchingRules: [],\n      // Matches displaysets, NOT series\n      seriesMatchingRules: [\n        {\n          attribute: 'Modality',\n          constraint: {\n            equals: {\n              value: 'CHT',\n            },\n          },\n          required: true,\n        },\n      ],\n    },\n  },\n  stages: [\n    {\n      id: 'dataPreparation',\n      name: 'Data Preparation',\n      viewportStructure: {\n        layoutType: 'grid',\n        properties: {\n          rows: 1,\n          columns: 3,\n        },\n      },\n      viewports: [...getPTViewports()],\n      createdDate: '2023-01-01T00:00:00.000Z',\n    },\n\n    {\n      id: 'registration',\n      name: 'Registration',\n      viewportStructure: {\n        layoutType: 'grid',\n        properties: {\n          rows: 3,\n          columns: 3,\n        },\n      },\n      viewports: [...getFusionViewports(), ...getCTViewports(), ...getPTViewports()],\n      createdDate: '2023-01-01T00:00:00.000Z',\n    },\n\n    {\n      id: 'roiQuantification',\n      name: 'ROI Quantification',\n      viewportStructure: {\n        layoutType: 'grid',\n        properties: {\n          rows: 1,\n          columns: 3,\n        },\n      },\n      viewports: [...getFusionViewports()],\n      createdDate: '2023-01-01T00:00:00.000Z',\n    },\n\n    {\n      id: 'kineticAnalysis',\n      name: 'Kinetic Analysis',\n      viewportStructure: {\n        layoutType: 'grid',\n        properties: {\n          rows: 2,\n          columns: 3,\n          layoutOptions: [\n            {\n              x: 0,\n              y: 0,\n              width: 1 / 3,\n              height: 1 / 2,\n            },\n            {\n              x: 1 / 3,\n              y: 0,\n              width: 1 / 3,\n              height: 1 / 2,\n            },\n            {\n              x: 2 / 3,\n              y: 0,\n              width: 1 / 3,\n              height: 1 / 2,\n            },\n            {\n              x: 0,\n              y: 1 / 2,\n              width: 1,\n              height: 1 / 2,\n            },\n          ],\n        },\n      },\n      viewports: [...getFusionViewports(), getSeriesChartViewport()],\n      createdDate: '2023-01-01T00:00:00.000Z',\n    },\n  ],\n};\n\n/**\n * HangingProtocolModule should provide a list of hanging protocols that will be\n * available in OHIF for Modes to use to decide on the structure of the viewports\n * and also the series that hung in the viewports. Each hanging protocol is defined by\n * { name, protocols}. Examples include the default hanging protocol provided by\n * the default extension that shows 2x2 viewports.\n */\n\nfunction getHangingProtocolModule() {\n  return [\n    {\n      name: defaultProtocol.id,\n      protocol: defaultProtocol,\n    },\n  ];\n}\n\nexport default getHangingProtocolModule;\n","import { id } from './id';\nimport commandsModule from './commandsModule';\nimport getPanelModule from './getPanelModule';\nimport getHangingProtocolModule from './getHangingProtocolModule';\nimport { cache } from '@cornerstonejs/core';\n\n/**\n * You can remove any of the following modules if you don't need them.\n */\nconst dynamicVolumeExtension = {\n  /**\n   * Only required property. Should be a unique value across all extensions.\n   * You ID can be anything you want, but it should be unique.\n   */\n  id,\n\n  /**\n   * Perform any pre-registration tasks here. This is called before the extension\n   * is registered. Usually we run tasks such as: configuring the libraries\n   * (e.g. cornerstone, cornerstoneTools, ...) or registering any services that\n   * this extension is providing.\n   */\n  preRegistration: ({ servicesManager, commandsManager, configuration = {} }) => {\n    // TODO: look for the right fix\n    cache.setMaxCacheSize(5 * 1024 * 1024 * 1024);\n  },\n  /**\n   * PanelModule should provide a list of panels that will be available in OHIF\n   * for Modes to consume and render. Each panel is defined by a {name,\n   * iconName, iconLabel, label, component} object. Example of a panel module\n   * is the StudyBrowserPanel that is provided by the default extension in OHIF.\n   */\n  getPanelModule,\n  /**\n   * ViewportModule should provide a list of viewports that will be available in OHIF\n   * for Modes to consume and use in the viewports. Each viewport is defined by\n   * {name, component} object. Example of a viewport module is the CornerstoneViewport\n   * that is provided by the Cornerstone extension in OHIF.\n   */\n  getHangingProtocolModule,\n  /**\n   * CommandsModule should provide a list of commands that will be available in OHIF\n   * for Modes to consume and use in the viewports. Each command is defined by\n   * an object of { actions, definitions, defaultContext } where actions is an\n   * object of functions, definitions is an object of available commands, their\n   * options, and defaultContext is the default context for the command to run against.\n   */\n  getCommandsModule: ({ servicesManager, commandsManager, extensionManager }) => {\n    return commandsModule({\n      servicesManager,\n      commandsManager,\n      extensionManager,\n    });\n  },\n};\n\nexport { dynamicVolumeExtension as default };\n"],"names":["id","packageJson","CHART_MODALITY","SEG_CHART_INSTANCE_UID","utils","guid","ChartDataSOPClassUid","utilities","csToolsUtils","csTools","_getTimePointsDataByTagName","volume","timePointsTag","uniqueTimePoints","imageIds","reduce","timePoints","imageId","timePointValue","DicomMetadataStore","getInstanceByImageId","undefined","add","Set","Array","from","sort","a","b","_getSegmentationData","segmentation","volumesTimePointsCache","servicesManager","displaySetService","segmentationService","viewportGridService","services","volumeCacheKey","volumeId","getActiveDisplaySets","find","displaySet","anInstance","instances","FrameReferenceTime","NumberOfTimeSlices","displaySetInstanceUID","key","cs","_volumeCache","includes","referencedDynamicVolume","getVolume","StudyInstanceUID","StudyDescription","segmentationVolume","getLabelmapVolume","segmentationId","maskVolumeId","timeData","_","dynamicVolume","getDataInTime","pixelCount","length","viewportId","getActiveViewportId","color","getSegmentColor","hexColor","timePointsData","get","timePointsTags","unit","timePointsTagNames","Object","keys","timePointsUnit","i","tagName","curTimePoints","concatTagNames","join","Error","convertedTimePoints","validUnits","divisors","currentUnitIndex","indexOf","divisor","newDivisor","filter","timePoint","map","_convertTimePointsUnit","_getTimePointsData","set","timepointsCount","chartSeriesData","average","acc","cur","chartData","series","label","points","axis","x","y","_getInstanceFromSegmentations","segmentations","WeakMap","segmentationsData","date","seriesDate","time","seriesTime","now","Date","getFullYear","getUTCMonth","slice","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","_getDateTimeStr","allSeries","curSegData","instance","SOPClassUID","Modality","SOPInstanceUID","SeriesDate","SeriesTime","SeriesInstanceUID","SeriesNumber","SeriesDescription","seriesMetadata","updateSegmentationsChartDisplaySet","getSegmentations","addSeriesMetadata","addInstances","Enums","Labelmap","commandsModule","commandsManager","actions","importedActions","getDynamic4DDisplaySet","TemporalPositionIdentifier","getComputedDisplaySets","getDisplaySetCache","values","isDerived","exportTimeReportCSV","config","options","summaryStats","dynamic4DDisplaySet","cache","csv","calculateStandardDeviation","data","n","mean","value","variance","Math","sqrt","push","PatientID","StudyDate","forEach","ijkCoords","headers","maxLength","numTimePoints","t","min","minIJK","max","maxIJK","std","numVoxels","timeIndex","voxelValues","sum","minValue","Infinity","maxValue","minIndex","maxIndex","voxelIndex","row","csvContent","filename","blob","Blob","type","link","document","createElement","url","URL","createObjectURL","setAttribute","style","visibility","body","appendChild","click","removeChild","swapDynamicWithComputedDisplaySet","computedDisplaySet","displaySetCache","cachedDisplaySetKeys","viewports","getState","viewportsToUpdate","viewport","viewportOptions","displaySetInstanceUIDs","displaySetInstanceUIDIndex","newViewport","initialImageOptions","viewportType","orientation","background","setDisplaySetsForViewports","swapComputedWithDynamicDisplaySet","dynamicDisplaySet","computed4DDisplaySet","createNewLabelMapForDynamicVolume","async","activeViewportId","dynamic4DDisplaySetInstanceUID","referenceDisplaySet","cachedDisplaySets","referenceDisplaySetUID","getDisplaySetByUID","createLabelmapForDisplaySet","firstViewport","next","addSegmentationRepresentation","definitions","commandFn","storeContexts","defaultContext","controlClassNames","sizeClassName","arrowsDirection","labelPosition","Header","title","tooltip","React","className","Tooltip","content","position","tight","tooltipBoxClassName","Icon","name","DynamicVolumeControls","isPlaying","onPlayPauseChange","fps","onFpsChange","minFps","maxFps","currentFrameIndex","onFrameChange","framesLength","onGenerate","onDoubleRangeChange","onDynamicClick","computedView","setComputedView","useState","computeViewMode","setComputeViewMode","SUM","sliderRangeValues","setSliderRangeValues","PanelSection","childrenClassName","ButtonGroup","onClick","FrameControls","separated","toString","toUpperCase","AVERAGE","SUBTRACT","DoubleSlider","step","defaultValue","onValueChange","newValues","formatLabel","round","Button","IconButton","InputNumber","_extends","onChange","SOPClassHandlerId","PanelGenerateImage","cornerstoneViewportService","isCineEnabled","cineService","useCine","useViewportGrid","timePointsRange","setTimePointsRange","timePointsRangeToUseForGenerate","setTimePointsRangeToUseForGenerate","setComputedDisplaySet","setDynamicVolume","frameRate","setFrameRate","setIsPlaying","timePointRendered","setTimePointRendered","displayingComputed","setDisplayingComputed","uuidComputedVolume","useRef","csUtils","uuidDynamicVolume","computedVolumeId","current","renderGeneratedImage","runCommand","useEffect","viewportDataChangedEvt","EVENTS","VIEWPORT_DATA_CHANGED","cineStateChangedEvt","CINE_STATE_CHANGED","unsubscribe","unsubscribeViewportData","subscribe","evtDetails","viewportData","volumeData","isDynamicVolume","newRange","unsubscribeCineState","evt","DYNAMIC_VOLUME_TIME_POINT_INDEX_CHANGED","callback","detail","timePointIndex","eventTarget","addEventListener","removeEventListener","displaySetUIDs","getDisplaySetsUIDsForViewport","dynamicVolumeDisplaySet","getVolumes","handlePlay","viewportInfo","getViewportInfo","element","playClip","framesPerSecond","handleStop","stopClip","newFrameRate","operationName","dynamicVolumeId","computedVolume","volumeLoader","start","end","frameNumbers","targetVolume","cstUtils","getRenderingEngine","render","volumeLoaderSchema","split","metadata","isMultiFrame","numImageFrames","uid","madeInClient","FrameOfReferenceUID","initialRangeValues","tab","useSegmentations","size","variant","Icons","Export","extensionManager","configuration","iconName","iconLabel","component","wrappedDynamicDataPanel","DynamicDataPanel","wrappedDynamicSegmentation","Toolbox","buttonSectionId","PanelSegmentation","DynamicExport","DEFAULT_COLORMAP","toolGroupIds","getPTOptions","colormap","voiInverted","blendMode","voi","windowWidth","windowCenter","getPTViewports","ptOptionsParams","opacity","toolGroupId","preset","syncGroups","source","target","displaySets","getFusionViewports","syncInvertState","matchingRules","defaultProtocol","locked","hasUpdatedPriorsInformation","createdDate","modifiedDate","availableTo","editableBy","imageLoadStrategy","protocolMatchingRules","attribute","constraint","contains","numberOfPriorsReferenced","displaySetSelectors","defaultDisplaySetId","imageMatchingRules","seriesMatchingRules","greaterThan","ctDisplaySet","equals","required","ptDisplaySet","weight","doesNotContain","chartDisplaySet","stages","viewportStructure","layoutType","properties","rows","columns","layoutOptions","width","height","skipLoading","dynamicVolumeExtension","preRegistration","setMaxCacheSize","getPanelModule","getHangingProtocolModule","protocol","getCommandsModule"],"sourceRoot":""}