"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8295],{58295:(e,t,n)=>{n.r(t),n.d(t,{default:()=>d});var a=n(86326),s=n(99993),r=n(58851);const o=function(e,t,n){const{tools:a}=t.get("cornerstone.overlayViewportTools")??{};return e.createToolGroupAndAddTools(n,a)},i={NO_NEVER:-1,CANCEL:0,HYDRATE_SEG:5};const l=function({servicesManager:e,segDisplaySet:t,viewportId:n,preHydrateCallbacks:a,hydrateCallback:s}){const{uiViewportDialogService:o}=e.services,l=e._extensionManager._appConfig;return new Promise((async function(e,c){const p=l?.disableConfirmationPrompts?i.HYDRATE_SEG:await function(e,t){return new Promise((function(n,a){const s="Do you want to open this Segmentation?",o=[{id:"no-hydrate",type:r.Ny.NW.secondary,text:"No",value:i.CANCEL},{id:"yes-hydrate",type:r.Ny.NW.primary,text:"Yes",value:i.HYDRATE_SEG}],l=t=>{e.hide(),n(t)};e.show({viewportId:t,type:"info",message:s,actions:o,onSubmit:l,onOutsideClick:()=>{e.hide(),n(i.CANCEL)},onKeyPress:e=>{"Enter"===e.key&&l(i.HYDRATE_SEG)}})}))}(o,n);p===i.HYDRATE_SEG&&(a?.forEach((e=>{e()})),window.setTimeout((async()=>{const a=await s({segDisplaySet:t,viewportId:n});e(a)}),0))}))};function c({isHydrated:e,onStatusClick:t}){let n=null,o=null;switch(e){case!0:o=()=>a.createElement(r.In,{name:"status-alert"}),n=()=>a.createElement("div",null,"This Segmentation is loaded in the segmentation panel");break;case!1:o=()=>a.createElement(r.In,{className:"text-aqua-pale",name:"status-untracked"}),n=()=>a.createElement("div",null,"Click LOAD to load segmentation.")}const i=()=>{const{t:n}=(0,s.Bd)("Common"),r=n("LOAD");return a.createElement("div",{className:"flex h-6 cursor-default text-sm leading-6 text-white"},a.createElement("div",{className:"bg-customgray-100 flex min-w-[45px] items-center rounded-l-xl rounded-r p-1"},a.createElement(o,null),a.createElement("span",{className:"ml-1"},"SEG")),!e&&a.createElement("div",{className:"bg-primary-main hover:bg-primary-light ml-1 cursor-pointer rounded px-1.5 hover:text-black",onMouseUp:t},r))};return a.createElement(a.Fragment,null,n&&a.createElement(r.m_,{content:a.createElement(n,null),position:"bottom-left"},a.createElement(i,null)),!n&&a.createElement(i,null))}var p=n(99737);function u(){return u=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)({}).hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},u.apply(null,arguments)}const d=function(e){const{children:t,displaySets:n,viewportOptions:i,servicesManager:d,extensionManager:m,commandsManager:S}=e,{t:y}=(0,s.Bd)("SEGViewport"),E=i.viewportId,{displaySetService:g,toolGroupService:v,segmentationService:I,customizationService:w,viewportActionCornersService:f}=d.services,b=`SEGToolGroup-${E}`;if(n.length>1)throw new Error("SEG viewport should only have a single display set");const D=n[0],[C,h]=(0,r.ih)(),[N,T]=(0,a.useState)(1),[A,k]=(0,a.useState)(D.isHydrated),[P,x]=(0,a.useState)(!D.isLoaded),[G,O]=(0,a.useState)(null),[M,L]=(0,a.useState)({percentComplete:null,totalSegments:null}),U=(0,a.useRef)(null),{viewports:_,activeViewportId:R}=C,V=D.referencedDisplaySetInstanceUID,H=g.getDisplaySetByUID(V),Y=function(e,t){const{SharedFunctionalGroupsSequence:n}=t.instance,a=Array.isArray(n)?n[0]:n,{PixelMeasuresSequence:s}=a,r=Array.isArray(s)?s[0]:s,{SpacingBetweenSlices:o,SliceThickness:i}=r,l=e.images[0],c={PatientID:l.PatientID,PatientName:l.PatientName,PatientSex:l.PatientSex,PatientAge:l.PatientAge,SliceThickness:l.SliceThickness||i,StudyDate:l.StudyDate,SeriesDescription:l.SeriesDescription,SeriesInstanceUID:l.SeriesInstanceUID,SeriesNumber:l.SeriesNumber,ManufacturerModelName:l.ManufacturerModelName,SpacingBetweenSlices:l.SpacingBetweenSlices||o};return c}(H,D);U.current={displaySet:H,metadata:Y};const B=()=>{O(null)},F=(0,a.useCallback)((()=>{C?.viewports.forEach((({viewportId:e})=>{S.runCommand("storePresentation",{viewportId:e})}))}),[C]),j=(0,a.useCallback)((()=>{const{component:t}=m.getModuleEntry("@ohif/extension-cornerstone.viewportModule.cornerstone");return a.createElement(t,u({},e,{displaySets:[D],viewportOptions:{viewportType:i.viewportType,toolGroupId:b,orientation:i.orientation,viewportId:i.viewportId,presentationIds:i.presentationIds},onElementEnabled:t=>{e.onElementEnabled?.(t),(e=>{O(e.detail.element)})(t)},onElementDisabled:B}))}),[E,D,b]),q=(0,a.useCallback)((e=>{const t=D.displaySetInstanceUID,n=I.getSegmentation(t),{segments:a}=n,s=Object.keys(a).length;let r=N+e;r>s-1?r=1:0===r&&(r=s-1),I.jumpToSegmentCenter(t,r,E),T(r)}),[N]),W=(0,a.useCallback)((()=>{S.runCommand("updateStoredSegmentationPresentation",{displaySet:D,type:p.SegmentationRepresentations.Labelmap}),S.runCommand("updateStoredPositionPresentation",{viewportId:E,displaySetInstanceUID:H.displaySetInstanceUID}),h.setDisplaySetsForViewport({viewportId:E,displaySetInstanceUIDs:[H.displaySetInstanceUID]})}),[S,E,H,D]);(0,a.useEffect)((()=>{P||l({servicesManager:d,viewportId:E,segDisplaySet:D,preHydrateCallbacks:[F],hydrateCallback:W}).then((e=>{e&&k(!0)}))}),[d,E,D,P,W]),(0,a.useEffect)((()=>{I.clearSegmentationRepresentations(E);const{unsubscribe:e}=I.subscribe(I.EVENTS.SEGMENTATION_LOADING_COMPLETE,(e=>{e.segDisplaySet.displaySetInstanceUID===D.displaySetInstanceUID&&x(!1)}));return()=>{e()}}),[D]),(0,a.useEffect)((()=>{const{unsubscribe:e}=I.subscribe(I.EVENTS.SEGMENT_LOADING_COMPLETE,(({percentComplete:e,numSegments:t})=>{L({percentComplete:e,totalSegments:t})}));return()=>{e()}}),[D]),(0,a.useEffect)((()=>{const e=g.subscribe(g.EVENTS.DISPLAY_SETS_REMOVED,(({displaySetInstanceUIDs:e})=>{const t=_.get(R);e.includes(t.displaySetInstanceUID)&&h.setDisplaySetsForViewport({viewportId:R,displaySetInstanceUIDs:[]})}));return()=>{e.unsubscribe()}}),[]),(0,a.useEffect)((()=>{let e=v.getToolGroup(b);if(!e)return S.runCommand("updateStoredSegmentationPresentation",{displaySet:D,type:p.SegmentationRepresentations.Labelmap}),I.clearSegmentationRepresentations(E),e=o(v,w,b),()=>{I.clearSegmentationRepresentations(E),v.destroyToolGroup(b)}}),[]);const $=(0,a.useCallback)((async()=>{F(),W()}),[F,W]);(0,a.useEffect)((()=>{f.addComponents([{viewportId:E,id:"viewportStatusComponent",component:c({isHydrated:A,onStatusClick:$}),indexPriority:-100,location:f.LOCATIONS.topLeft},{viewportId:E,id:"viewportActionArrowsComponent",component:a.createElement(r.$I,{key:"actionArrows",onArrowsClick:q,className:E===R?"visible":"invisible group-hover/pane:visible"}),indexPriority:0,location:f.LOCATIONS.topRight}])}),[R,A,q,$,f,E]);let z=null;return U.current&&H.displaySetInstanceUID===U.current.displaySet.displaySetInstanceUID?(t&&t.length&&(z=t.map(((e,t)=>e&&a.cloneElement(e,{viewportId:E,key:t})))),a.createElement(a.Fragment,null,a.createElement("div",{className:"relative flex h-full w-full flex-row overflow-hidden"},P&&a.createElement(r.pT,{className:"h-full w-full",totalNumbers:M.totalSegments,percentComplete:M.percentComplete,loadingText:"Loading SEG..."}),j(),z))):null}}}]);
//# sourceMappingURL=8295.bundle.62febf48bbb501a44f9b.js.map