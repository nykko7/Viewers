{"version":3,"file":"8295.bundle.62febf48bbb501a44f9b.js","mappings":"wJAMA,QANA,SAAuCA,EAAkBC,EAAsBC,GAC7E,MAAM,MAAEC,GAAUF,EAAqBG,IAAI,qCAAuC,CAAC,EAEnF,OAAOJ,EAAiBK,2BAA2BH,EAAaC,EAClE,ECFMG,EAAW,CACfC,UAAW,EACXC,OAAQ,EACRC,YAAa,GA6Ef,QA1EA,UAA0B,gBACxBC,EAAe,cACfC,EAAa,WACbC,EAAU,oBACVC,EAAmB,gBACnBC,IAEA,MAAM,wBAAEC,GAA4BL,EAAgBM,SAE9CC,EADmBP,EAAgBQ,kBACNC,WAEnC,OAAO,IAAIC,SAAQC,eAAgBC,EAASC,GAC1C,MAAMC,EAAeP,GAAWQ,2BAC5BnB,EAASG,kBAoBjB,SAAqBM,EAAyBH,GAC5C,OAAO,IAAIQ,SAAQ,SAAUE,EAASC,GACpC,MAAMG,EAAU,yCACVC,EAAU,CACd,CACEC,GAAI,aACJC,KAAMC,EAAAA,GAAAA,GAAiBC,UACvBC,KAAM,KACNC,MAAO3B,EAASE,QAElB,CACEoB,GAAI,cACJC,KAAMC,EAAAA,GAAAA,GAAiBI,QACvBF,KAAM,MACNC,MAAO3B,EAASG,cAGd0B,EAAWC,IACfrB,EAAwBsB,OACxBf,EAAQc,EAAO,EAGjBrB,EAAwBuB,KAAK,CAC3B1B,aACAiB,KAAM,OACNH,UACAC,UACAQ,WACAI,eAAgBA,KACdxB,EAAwBsB,OACxBf,EAAQhB,EAASE,OAAO,EAE1BgC,WAAYC,IACQ,UAAdA,EAAMC,KACRP,EAAS7B,EAASG,YACpB,GAGN,GACF,CA1DckC,CAAY5B,EAAyBH,GAE3CY,IAAiBlB,EAASG,cAC5BI,GAAqB+B,SAAQC,IAC3BA,GAAU,IAGZC,OAAOC,YAAW1B,UAChB,MAAM2B,QAAmBlC,EAAgB,CACvCH,gBACAC,eAGFU,EAAQ0B,EAAW,GAClB,GAEP,GACF,ECnCe,SAASC,GAAoB,WAAED,EAAU,cAAEE,IACxD,IAAIC,EAAiB,KACjBC,EAAa,KAEjB,OAAQJ,GACN,KAAK,EACHI,EAAaA,IAAMC,EAAAA,cAACC,EAAAA,GAAI,CAACC,KAAK,iBAE9BJ,EAAiBA,IAAME,EAAAA,cAAA,WAAK,yDAC5B,MACF,KAAK,EACHD,EAAaA,IACXC,EAAAA,cAACC,EAAAA,GAAI,CACHE,UAAU,iBACVD,KAAK,qBAITJ,EAAiBA,IAAME,EAAAA,cAAA,WAAK,oCAGhC,MAAMI,EAAaA,KACjB,MAAM,EAAEC,IAAMC,EAAAA,EAAAA,IAAe,UACvBC,EAAUF,EAAE,QAElB,OACEL,EAAAA,cAAA,OAAKG,UAAU,wDACbH,EAAAA,cAAA,OAAKG,UAAU,+EACbH,EAAAA,cAACD,EAAU,MACXC,EAAAA,cAAA,QAAMG,UAAU,QAAO,SAEvBR,GACAK,EAAAA,cAAA,OACEG,UAAU,6FAEVK,UAAWX,GAEVU,GAGD,EAIV,OACEP,EAAAA,cAAAA,EAAAA,SAAA,KACGF,GACCE,EAAAA,cAACS,EAAAA,GAAO,CACNC,QAASV,EAAAA,cAACF,EAAc,MACxBa,SAAS,eAETX,EAAAA,cAACI,EAAU,QAGbN,GAAkBE,EAAAA,cAACI,EAAU,MAGrC,C,uOCmVA,QAtYA,SAAoCQ,GAClC,MAAM,SACJC,EAAQ,YACRC,EAAW,gBACXC,EAAe,gBACf1D,EAAe,iBACf2D,EAAgB,gBAChBC,GACEL,GAEE,EAAEP,IAAMC,EAAAA,EAAAA,IAAe,eACvB/C,EAAawD,EAAgBxD,YAE7B,kBACJ2D,EAAiB,iBACjBC,EAAgB,oBAChBC,EAAmB,qBACnBxE,EAAoB,6BACpByE,GACEhE,EAAgBM,SAEdd,EAAc,gBAA8BU,IAGlD,GAAIuD,EAAYQ,OAAS,EACvB,MAAM,IAAIC,MAAM,sDAGlB,MAAMjE,EAAgBwD,EAAY,IAC3BU,EAAcC,IAAuBC,EAAAA,EAAAA,OAGrCC,EAAiBC,IAAsBC,EAAAA,EAAAA,UAAS,IAOhDlC,EAAYmC,IAAiBD,EAAAA,EAAAA,UAASvE,EAAcqC,aACpDoC,EAAcC,IAAmBH,EAAAA,EAAAA,WAAUvE,EAAc2E,WACzDC,EAASC,IAAcN,EAAAA,EAAAA,UAAS,OAChCO,EAAoBC,IAAyBR,EAAAA,EAAAA,UAAS,CAC3DS,gBAAiB,KACjBC,cAAe,OAIXC,GAA0BC,EAAAA,EAAAA,QAAO,OAEjC,UAAEC,EAAS,iBAAEC,GAAqBnB,EAElCoB,EAAkCtF,EAAcsF,gCAChDC,EAAuB3B,EAAkB4B,mBAC7CF,GAGIG,EA4SR,SAA0CF,EAAsBvF,GAC9D,MAAM,+BAAE0F,GAAmC1F,EAAc2F,SAEnDC,EAAwBC,MAAMC,QAAQJ,GACxCA,EAA+B,GAC/BA,GAEE,sBAAEK,GAA0BH,EAE5BI,EAAgBH,MAAMC,QAAQC,GAChCA,EAAsB,GACtBA,GAEE,qBAAEE,EAAoB,eAAEC,GAAmBF,EAE3CG,EAASZ,EAAqBa,OAAO,GACrCX,EAA+B,CACnCY,UAAWF,EAAOE,UAClBC,YAAaH,EAAOG,YACpBC,WAAYJ,EAAOI,WACnBC,WAAYL,EAAOK,WACnBN,eAAgBC,EAAOD,gBAAkBA,EACzCO,UAAWN,EAAOM,UAClBC,kBAAmBP,EAAOO,kBAC1BC,kBAAmBR,EAAOQ,kBAC1BC,aAAcT,EAAOS,aACrBC,sBAAuBV,EAAOU,sBAC9BZ,qBAAsBE,EAAOF,sBAAwBA,GAGvD,OAAOR,CACT,CA3UuCqB,CACnCvB,EACAvF,GAGFkF,EAAwB6B,QAAU,CAChCC,WAAYzB,EACZ0B,SAAUxB,GAQZ,MAIMyB,EAAoBA,KACxBrC,EAAW,KAAK,EAGZsC,GAAyBC,EAAAA,EAAAA,cAAY,KACzClD,GAAckB,UAAUnD,SAAQ,EAAGhC,iBACjC0D,EAAgB0D,WAAW,oBAAqB,CAC9CpH,cACA,GACF,GACD,CAACiE,IAEEoD,GAAyBF,EAAAA,EAAAA,cAAY,KACzC,MAAQG,UAAWC,GAAc9D,EAAiB+D,eAChD,0DAIF,OACE/E,EAAAA,cAAC8E,EAASE,EAAA,GACJpE,EAAK,CACTE,YAAa,CAACxD,GACdyD,gBAAiB,CACfkE,aAAclE,EAAgBkE,aAC9BpI,YAAaA,EACbqI,YAAanE,EAAgBmE,YAC7B3H,WAAYwD,EAAgBxD,WAC5B4H,gBAAiBpE,EAAgBoE,iBAEnCC,iBAAkBC,IAChBzE,EAAMwE,mBAAmBC,GAlCRA,KACvBlD,EAAWkD,EAAIC,OAAOpD,QAAQ,EAkCxBkD,CAAiBC,EAAI,EAEvBb,kBAAmBA,IACR,GAEd,CAACjH,EAAYD,EAAeT,IAEzB0I,GAAkBb,EAAAA,EAAAA,cACtBc,IACE,MAAMC,EAAiBnI,EAAcoI,sBAC/BC,EAAevE,EAAoBwE,gBAAgBH,IAEnD,SAAEI,GAAaF,EAEfG,EAAmBC,OAAOC,KAAKH,GAAUvE,OAE/C,IAAI2E,EAA0BtE,EAAkB6D,EAI5CS,EAA0BH,EAAmB,EAC/CG,EAA0B,EACW,IAA5BA,IACTA,EAA0BH,EAAmB,GAG/C1E,EAAoB8E,oBAAoBT,EAAgBQ,EAAyB1I,GACjFqE,EAAmBqE,EAAwB,GAE7C,CAACtE,IAGGwE,GAAazB,EAAAA,EAAAA,cAAY,KAI7BzD,EAAgB0D,WAAW,uCAAwC,CACjEL,WAAYhH,EACZkB,KAAM4H,EAAAA,4BAA4BC,WAMpCpF,EAAgB0D,WAAW,mCAAoC,CAC7DpH,aACAmI,sBAAuB7C,EAAqB6C,wBAG9CjE,EAAoB6E,0BAA0B,CAC5C/I,aACAgJ,uBAAwB,CAAC1D,EAAqB6C,wBAC9C,GACD,CAACzE,EAAiB1D,EAAYsF,EAAsBvF,KAEvDkJ,EAAAA,EAAAA,YAAU,KACJzE,GAIJ0E,EAAiB,CACfpJ,kBACAE,aACAD,gBACAE,oBAAqB,CAACiH,GACtBhH,gBAAiB0I,IAChBO,MAAK/G,IACFA,GACFmC,GAAc,EAChB,GACA,GACD,CAACzE,EAAiBE,EAAYD,EAAeyE,EAAcoE,KAE9DK,EAAAA,EAAAA,YAAU,KAERpF,EAAoBuF,iCAAiCpJ,GAErD,MAAM,YAAEqJ,GAAgBxF,EAAoByF,UAC1CzF,EAAoB0F,OAAOC,+BAC3B1B,IACMA,EAAI/H,cAAcoI,wBAA0BpI,EAAcoI,uBAC5D1D,GAAgB,EAClB,IAIJ,MAAO,KACL4E,GAAa,CACd,GACA,CAACtJ,KAEJkJ,EAAAA,EAAAA,YAAU,KACR,MAAM,YAAEI,GAAgBxF,EAAoByF,UAC1CzF,EAAoB0F,OAAOE,0BAC3B,EAAG1E,kBAAiB2E,kBAClB5E,EAAsB,CACpBC,kBACAC,cAAe0E,GACf,IAIN,MAAO,KACLL,GAAa,CACd,GACA,CAACtJ,KAKJkJ,EAAAA,EAAAA,YAAU,KACR,MAAMU,EAAmChG,EAAkB2F,UACzD3F,EAAkB4F,OAAOK,sBACzB,EAAGZ,6BACD,MAAMa,EAAiB1E,EAAU3F,IAAI4F,GACjC4D,EAAuBc,SAASD,EAAe1B,wBACjDjE,EAAoB6E,0BAA0B,CAC5C/I,WAAYoF,EACZ4D,uBAAwB,IAE5B,IAIJ,MAAO,KACLW,EAAiCN,aAAa,CAC/C,GACA,KAEHJ,EAAAA,EAAAA,YAAU,KACR,IAAIc,EAAYnG,EAAiBoG,aAAa1K,GAE9C,IAAIyK,EAmBJ,OAbArG,EAAgB0D,WAAW,uCAAwC,CACjEL,WAAYhH,EACZkB,KAAM4H,EAAAA,4BAA4BC,WAKpCjF,EAAoBuF,iCAAiCpJ,GAIrD+J,EAAYE,EAA8BrG,EAAkBvE,EAAsBC,GAE3E,KAGLuE,EAAoBuF,iCAAiCpJ,GAGrD4D,EAAiBsG,iBAAiB5K,EAAY,CAC/C,GACA,IAEH,MAAMgD,GAAgB6E,EAAAA,EAAAA,cAAY1G,UAOhCyG,IACA0B,GAAY,GACX,CAAC1B,EAAwB0B,KAE5BK,EAAAA,EAAAA,YAAU,KACRnF,EAA6BqG,cAAc,CACzC,CACEnK,aACAgB,GAAI,0BACJsG,UAAWjF,EAAoB,CAC7BD,aACAE,kBAEF8H,eAAgB,IAChBC,SAAUvG,EAA6BwG,UAAUC,SAEnD,CACEvK,aACAgB,GAAI,gCACJsG,UACE7E,EAAAA,cAAC+H,EAAAA,GAAoB,CACnB1I,IAAI,eACJ2I,cAAezC,EACfpF,UACE5C,IAAeoF,EAAmB,UAAY,uCAIpDgF,cAAe,EACfC,SAAUvG,EAA6BwG,UAAUI,WAEnD,GACD,CACDtF,EACAhD,EACA4F,EACA1F,EACAwB,EACA9D,IAIF,IAAI2K,EAAoB,KAExB,OACG1F,EAAwB6B,SACzBxB,EAAqB6C,wBACnBlD,EAAwB6B,QAAQC,WAAWoB,uBAK3C7E,GAAYA,EAASS,SACvB4G,EAAoBrH,EAASsH,KAAI,CAACC,EAAOC,IAErCD,GACApI,EAAAA,aAAmBoI,EAAO,CACxB7K,aACA8B,IAAKgJ,OAOXrI,EAAAA,cAAAA,EAAAA,SAAA,KACEA,EAAAA,cAAA,OAAKG,UAAU,wDACZ4B,GACC/B,EAAAA,cAACsI,EAAAA,GAA4B,CAC3BnI,UAAU,gBACVoI,aAAcnG,EAAmBG,cACjCD,gBAAiBF,EAAmBE,gBACpCkG,YAAY,mBAGf5D,IACAsD,KA3BE,IA+BX,C","sources":["webpack:///../../../extensions/cornerstone-dicom-seg/src/utils/initSEGToolGroup.ts","webpack:///../../../extensions/cornerstone-dicom-seg/src/utils/promptHydrateSEG.ts","webpack:///../../../extensions/cornerstone-dicom-seg/src/viewports/_getStatusComponent.tsx","webpack:///../../../extensions/cornerstone-dicom-seg/src/viewports/OHIFCornerstoneSEGViewport.tsx"],"sourcesContent":["function createSEGToolGroupAndAddTools(ToolGroupService, customizationService, toolGroupId) {\n  const { tools } = customizationService.get('cornerstone.overlayViewportTools') ?? {};\n\n  return ToolGroupService.createToolGroupAndAddTools(toolGroupId, tools);\n}\n\nexport default createSEGToolGroupAndAddTools;\n","import { ButtonEnums } from '@ohif/ui';\n\nconst RESPONSE = {\n  NO_NEVER: -1,\n  CANCEL: 0,\n  HYDRATE_SEG: 5,\n};\n\nfunction promptHydrateSEG({\n  servicesManager,\n  segDisplaySet,\n  viewportId,\n  preHydrateCallbacks,\n  hydrateCallback,\n}: withAppTypes) {\n  const { uiViewportDialogService } = servicesManager.services;\n  const extensionManager = servicesManager._extensionManager;\n  const appConfig = extensionManager._appConfig;\n\n  return new Promise(async function (resolve, reject) {\n    const promptResult = appConfig?.disableConfirmationPrompts\n      ? RESPONSE.HYDRATE_SEG\n      : await _askHydrate(uiViewportDialogService, viewportId);\n\n    if (promptResult === RESPONSE.HYDRATE_SEG) {\n      preHydrateCallbacks?.forEach(callback => {\n        callback();\n      });\n\n      window.setTimeout(async () => {\n        const isHydrated = await hydrateCallback({\n          segDisplaySet,\n          viewportId,\n        });\n\n        resolve(isHydrated);\n      }, 0);\n    }\n  });\n}\n\nfunction _askHydrate(uiViewportDialogService, viewportId) {\n  return new Promise(function (resolve, reject) {\n    const message = 'Do you want to open this Segmentation?';\n    const actions = [\n      {\n        id: 'no-hydrate',\n        type: ButtonEnums.type.secondary,\n        text: 'No',\n        value: RESPONSE.CANCEL,\n      },\n      {\n        id: 'yes-hydrate',\n        type: ButtonEnums.type.primary,\n        text: 'Yes',\n        value: RESPONSE.HYDRATE_SEG,\n      },\n    ];\n    const onSubmit = result => {\n      uiViewportDialogService.hide();\n      resolve(result);\n    };\n\n    uiViewportDialogService.show({\n      viewportId,\n      type: 'info',\n      message,\n      actions,\n      onSubmit,\n      onOutsideClick: () => {\n        uiViewportDialogService.hide();\n        resolve(RESPONSE.CANCEL);\n      },\n      onKeyPress: event => {\n        if (event.key === 'Enter') {\n          onSubmit(RESPONSE.HYDRATE_SEG);\n        }\n      },\n    });\n  });\n}\n\nexport default promptHydrateSEG;\n","import React from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { Icon, Tooltip } from '@ohif/ui';\n\nexport default function _getStatusComponent({ isHydrated, onStatusClick }) {\n  let ToolTipMessage = null;\n  let StatusIcon = null;\n\n  switch (isHydrated) {\n    case true:\n      StatusIcon = () => <Icon name=\"status-alert\" />;\n\n      ToolTipMessage = () => <div>This Segmentation is loaded in the segmentation panel</div>;\n      break;\n    case false:\n      StatusIcon = () => (\n        <Icon\n          className=\"text-aqua-pale\"\n          name=\"status-untracked\"\n        />\n      );\n\n      ToolTipMessage = () => <div>Click LOAD to load segmentation.</div>;\n  }\n\n  const StatusArea = () => {\n    const { t } = useTranslation('Common');\n    const loadStr = t('LOAD');\n\n    return (\n      <div className=\"flex h-6 cursor-default text-sm leading-6 text-white\">\n        <div className=\"bg-customgray-100 flex min-w-[45px] items-center rounded-l-xl rounded-r p-1\">\n          <StatusIcon />\n          <span className=\"ml-1\">SEG</span>\n        </div>\n        {!isHydrated && (\n          <div\n            className=\"bg-primary-main hover:bg-primary-light ml-1 cursor-pointer rounded px-1.5 hover:text-black\"\n            // Using onMouseUp here because onClick is not working when the viewport is not active and is styled with pointer-events:none\n            onMouseUp={onStatusClick}\n          >\n            {loadStr}\n          </div>\n        )}\n      </div>\n    );\n  };\n\n  return (\n    <>\n      {ToolTipMessage && (\n        <Tooltip\n          content={<ToolTipMessage />}\n          position=\"bottom-left\"\n        >\n          <StatusArea />\n        </Tooltip>\n      )}\n      {!ToolTipMessage && <StatusArea />}\n    </>\n  );\n}\n","import React, { useCallback, useEffect, useRef, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { LoadingIndicatorTotalPercent, useViewportGrid, ViewportActionArrows } from '@ohif/ui';\nimport createSEGToolGroupAndAddTools from '../utils/initSEGToolGroup';\nimport promptHydrateSEG from '../utils/promptHydrateSEG';\nimport _getStatusComponent from './_getStatusComponent';\nimport { SegmentationRepresentations } from '@cornerstonejs/tools/enums';\n\nconst SEG_TOOLGROUP_BASE_NAME = 'SEGToolGroup';\n\nfunction OHIFCornerstoneSEGViewport(props: withAppTypes) {\n  const {\n    children,\n    displaySets,\n    viewportOptions,\n    servicesManager,\n    extensionManager,\n    commandsManager,\n  } = props;\n\n  const { t } = useTranslation('SEGViewport');\n  const viewportId = viewportOptions.viewportId;\n\n  const {\n    displaySetService,\n    toolGroupService,\n    segmentationService,\n    customizationService,\n    viewportActionCornersService,\n  } = servicesManager.services;\n\n  const toolGroupId = `${SEG_TOOLGROUP_BASE_NAME}-${viewportId}`;\n\n  // SEG viewport will always have a single display set\n  if (displaySets.length > 1) {\n    throw new Error('SEG viewport should only have a single display set');\n  }\n\n  const segDisplaySet = displaySets[0];\n  const [viewportGrid, viewportGridService] = useViewportGrid();\n\n  // States\n  const [selectedSegment, setSelectedSegment] = useState(1);\n\n  // Hydration means that the SEG is opened and segments are loaded into the\n  // segmentation panel, and SEG is also rendered on any viewport that is in the\n  // same frameOfReferenceUID as the referencedSeriesUID of the SEG. However,\n  // loading basically means SEG loading over network and bit unpacking of the\n  // SEG data.\n  const [isHydrated, setIsHydrated] = useState(segDisplaySet.isHydrated);\n  const [segIsLoading, setSegIsLoading] = useState(!segDisplaySet.isLoaded);\n  const [element, setElement] = useState(null);\n  const [processingProgress, setProcessingProgress] = useState({\n    percentComplete: null,\n    totalSegments: null,\n  });\n\n  // refs\n  const referencedDisplaySetRef = useRef(null);\n\n  const { viewports, activeViewportId } = viewportGrid;\n\n  const referencedDisplaySetInstanceUID = segDisplaySet.referencedDisplaySetInstanceUID;\n  const referencedDisplaySet = displaySetService.getDisplaySetByUID(\n    referencedDisplaySetInstanceUID\n  );\n\n  const referencedDisplaySetMetadata = _getReferencedDisplaySetMetadata(\n    referencedDisplaySet,\n    segDisplaySet\n  );\n\n  referencedDisplaySetRef.current = {\n    displaySet: referencedDisplaySet,\n    metadata: referencedDisplaySetMetadata,\n  };\n  /**\n   * OnElementEnabled callback which is called after the cornerstoneExtension\n   * has enabled the element. Note: we delegate all the image rendering to\n   * cornerstoneExtension, so we don't need to do anything here regarding\n   * the image rendering, element enabling etc.\n   */\n  const onElementEnabled = evt => {\n    setElement(evt.detail.element);\n  };\n\n  const onElementDisabled = () => {\n    setElement(null);\n  };\n\n  const storePresentationState = useCallback(() => {\n    viewportGrid?.viewports.forEach(({ viewportId }) => {\n      commandsManager.runCommand('storePresentation', {\n        viewportId,\n      });\n    });\n  }, [viewportGrid]);\n\n  const getCornerstoneViewport = useCallback(() => {\n    const { component: Component } = extensionManager.getModuleEntry(\n      '@ohif/extension-cornerstone.viewportModule.cornerstone'\n    );\n\n    // Todo: jump to the center of the first segment\n    return (\n      <Component\n        {...props}\n        displaySets={[segDisplaySet]}\n        viewportOptions={{\n          viewportType: viewportOptions.viewportType,\n          toolGroupId: toolGroupId,\n          orientation: viewportOptions.orientation,\n          viewportId: viewportOptions.viewportId,\n          presentationIds: viewportOptions.presentationIds,\n        }}\n        onElementEnabled={evt => {\n          props.onElementEnabled?.(evt);\n          onElementEnabled(evt);\n        }}\n        onElementDisabled={onElementDisabled}\n      ></Component>\n    );\n  }, [viewportId, segDisplaySet, toolGroupId]);\n\n  const onSegmentChange = useCallback(\n    direction => {\n      const segmentationId = segDisplaySet.displaySetInstanceUID;\n      const segmentation = segmentationService.getSegmentation(segmentationId);\n\n      const { segments } = segmentation;\n\n      const numberOfSegments = Object.keys(segments).length;\n\n      let newSelectedSegmentIndex = selectedSegment + direction;\n\n      // Segment 0 is always background\n\n      if (newSelectedSegmentIndex > numberOfSegments - 1) {\n        newSelectedSegmentIndex = 1;\n      } else if (newSelectedSegmentIndex === 0) {\n        newSelectedSegmentIndex = numberOfSegments - 1;\n      }\n\n      segmentationService.jumpToSegmentCenter(segmentationId, newSelectedSegmentIndex, viewportId);\n      setSelectedSegment(newSelectedSegmentIndex);\n    },\n    [selectedSegment]\n  );\n\n  const hydrateSEG = useCallback(() => {\n    // update the previously stored segmentationPresentation with the new viewportId\n    // presentation so that when we put the referencedDisplaySet back in the viewport\n    // it will have the correct segmentation representation hydrated\n    commandsManager.runCommand('updateStoredSegmentationPresentation', {\n      displaySet: segDisplaySet,\n      type: SegmentationRepresentations.Labelmap,\n    });\n\n    // update the previously stored positionPresentation with the new viewportId\n    // presentation so that when we put the referencedDisplaySet back in the viewport\n    // it will be in the correct position zoom and pan\n    commandsManager.runCommand('updateStoredPositionPresentation', {\n      viewportId,\n      displaySetInstanceUID: referencedDisplaySet.displaySetInstanceUID,\n    });\n\n    viewportGridService.setDisplaySetsForViewport({\n      viewportId,\n      displaySetInstanceUIDs: [referencedDisplaySet.displaySetInstanceUID],\n    });\n  }, [commandsManager, viewportId, referencedDisplaySet, segDisplaySet]);\n\n  useEffect(() => {\n    if (segIsLoading) {\n      return;\n    }\n\n    promptHydrateSEG({\n      servicesManager,\n      viewportId,\n      segDisplaySet,\n      preHydrateCallbacks: [storePresentationState],\n      hydrateCallback: hydrateSEG,\n    }).then(isHydrated => {\n      if (isHydrated) {\n        setIsHydrated(true);\n      }\n    });\n  }, [servicesManager, viewportId, segDisplaySet, segIsLoading, hydrateSEG]);\n\n  useEffect(() => {\n    // on new seg display set, remove all segmentations from all viewports\n    segmentationService.clearSegmentationRepresentations(viewportId);\n\n    const { unsubscribe } = segmentationService.subscribe(\n      segmentationService.EVENTS.SEGMENTATION_LOADING_COMPLETE,\n      evt => {\n        if (evt.segDisplaySet.displaySetInstanceUID === segDisplaySet.displaySetInstanceUID) {\n          setSegIsLoading(false);\n        }\n      }\n    );\n\n    return () => {\n      unsubscribe();\n    };\n  }, [segDisplaySet]);\n\n  useEffect(() => {\n    const { unsubscribe } = segmentationService.subscribe(\n      segmentationService.EVENTS.SEGMENT_LOADING_COMPLETE,\n      ({ percentComplete, numSegments }) => {\n        setProcessingProgress({\n          percentComplete,\n          totalSegments: numSegments,\n        });\n      }\n    );\n\n    return () => {\n      unsubscribe();\n    };\n  }, [segDisplaySet]);\n\n  /**\n   Cleanup the SEG viewport when the viewport is destroyed\n   */\n  useEffect(() => {\n    const onDisplaySetsRemovedSubscription = displaySetService.subscribe(\n      displaySetService.EVENTS.DISPLAY_SETS_REMOVED,\n      ({ displaySetInstanceUIDs }) => {\n        const activeViewport = viewports.get(activeViewportId);\n        if (displaySetInstanceUIDs.includes(activeViewport.displaySetInstanceUID)) {\n          viewportGridService.setDisplaySetsForViewport({\n            viewportId: activeViewportId,\n            displaySetInstanceUIDs: [],\n          });\n        }\n      }\n    );\n\n    return () => {\n      onDisplaySetsRemovedSubscription.unsubscribe();\n    };\n  }, []);\n\n  useEffect(() => {\n    let toolGroup = toolGroupService.getToolGroup(toolGroupId);\n\n    if (toolGroup) {\n      return;\n    }\n\n    // keep the already stored segmentationPresentation for this viewport in memory\n    // so that we can restore it after hydrating the SEG\n    commandsManager.runCommand('updateStoredSegmentationPresentation', {\n      displaySet: segDisplaySet,\n      type: SegmentationRepresentations.Labelmap,\n    });\n\n    // always start fresh for this viewport since it is special type of viewport\n    // that should only show one segmentation at a time.\n    segmentationService.clearSegmentationRepresentations(viewportId);\n\n    // This creates a custom tool group which has the lifetime of this view\n    // only, and does NOT interfere with currently displayed segmentations.\n    toolGroup = createSEGToolGroupAndAddTools(toolGroupService, customizationService, toolGroupId);\n\n    return () => {\n      // remove the segmentation representations if seg displayset changed\n      // e.g., another seg displayset is dragged into the viewport\n      segmentationService.clearSegmentationRepresentations(viewportId);\n\n      // Only destroy the viewport specific implementation\n      toolGroupService.destroyToolGroup(toolGroupId);\n    };\n  }, []);\n\n  const onStatusClick = useCallback(async () => {\n    // Before hydrating a SEG and make it added to all viewports in the grid\n    // that share the same frameOfReferenceUID, we need to store the viewport grid\n    // presentation state, so that we can restore it after hydrating the SEG. This is\n    // required if the user has changed the viewport (other viewport than SEG viewport)\n    // presentation state (w/l and invert) and then opens the SEG. If we don't store\n    // the presentation state, the viewport will be reset to the default presentation\n    storePresentationState();\n    hydrateSEG();\n  }, [storePresentationState, hydrateSEG]);\n\n  useEffect(() => {\n    viewportActionCornersService.addComponents([\n      {\n        viewportId,\n        id: 'viewportStatusComponent',\n        component: _getStatusComponent({\n          isHydrated,\n          onStatusClick,\n        }),\n        indexPriority: -100,\n        location: viewportActionCornersService.LOCATIONS.topLeft,\n      },\n      {\n        viewportId,\n        id: 'viewportActionArrowsComponent',\n        component: (\n          <ViewportActionArrows\n            key=\"actionArrows\"\n            onArrowsClick={onSegmentChange}\n            className={\n              viewportId === activeViewportId ? 'visible' : 'invisible group-hover/pane:visible'\n            }\n          ></ViewportActionArrows>\n        ),\n        indexPriority: 0,\n        location: viewportActionCornersService.LOCATIONS.topRight,\n      },\n    ]);\n  }, [\n    activeViewportId,\n    isHydrated,\n    onSegmentChange,\n    onStatusClick,\n    viewportActionCornersService,\n    viewportId,\n  ]);\n\n  // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n  let childrenWithProps = null;\n\n  if (\n    !referencedDisplaySetRef.current ||\n    referencedDisplaySet.displaySetInstanceUID !==\n      referencedDisplaySetRef.current.displaySet.displaySetInstanceUID\n  ) {\n    return null;\n  }\n\n  if (children && children.length) {\n    childrenWithProps = children.map((child, index) => {\n      return (\n        child &&\n        React.cloneElement(child, {\n          viewportId,\n          key: index,\n        })\n      );\n    });\n  }\n\n  return (\n    <>\n      <div className=\"relative flex h-full w-full flex-row overflow-hidden\">\n        {segIsLoading && (\n          <LoadingIndicatorTotalPercent\n            className=\"h-full w-full\"\n            totalNumbers={processingProgress.totalSegments}\n            percentComplete={processingProgress.percentComplete}\n            loadingText=\"Loading SEG...\"\n          />\n        )}\n        {getCornerstoneViewport()}\n        {childrenWithProps}\n      </div>\n    </>\n  );\n}\n\nfunction _getReferencedDisplaySetMetadata(referencedDisplaySet, segDisplaySet) {\n  const { SharedFunctionalGroupsSequence } = segDisplaySet.instance;\n\n  const SharedFunctionalGroup = Array.isArray(SharedFunctionalGroupsSequence)\n    ? SharedFunctionalGroupsSequence[0]\n    : SharedFunctionalGroupsSequence;\n\n  const { PixelMeasuresSequence } = SharedFunctionalGroup;\n\n  const PixelMeasures = Array.isArray(PixelMeasuresSequence)\n    ? PixelMeasuresSequence[0]\n    : PixelMeasuresSequence;\n\n  const { SpacingBetweenSlices, SliceThickness } = PixelMeasures;\n\n  const image0 = referencedDisplaySet.images[0];\n  const referencedDisplaySetMetadata = {\n    PatientID: image0.PatientID,\n    PatientName: image0.PatientName,\n    PatientSex: image0.PatientSex,\n    PatientAge: image0.PatientAge,\n    SliceThickness: image0.SliceThickness || SliceThickness,\n    StudyDate: image0.StudyDate,\n    SeriesDescription: image0.SeriesDescription,\n    SeriesInstanceUID: image0.SeriesInstanceUID,\n    SeriesNumber: image0.SeriesNumber,\n    ManufacturerModelName: image0.ManufacturerModelName,\n    SpacingBetweenSlices: image0.SpacingBetweenSlices || SpacingBetweenSlices,\n  };\n\n  return referencedDisplaySetMetadata;\n}\n\nexport default OHIFCornerstoneSEGViewport;\n"],"names":["ToolGroupService","customizationService","toolGroupId","tools","get","createToolGroupAndAddTools","RESPONSE","NO_NEVER","CANCEL","HYDRATE_SEG","servicesManager","segDisplaySet","viewportId","preHydrateCallbacks","hydrateCallback","uiViewportDialogService","services","appConfig","_extensionManager","_appConfig","Promise","async","resolve","reject","promptResult","disableConfirmationPrompts","message","actions","id","type","ButtonEnums","secondary","text","value","primary","onSubmit","result","hide","show","onOutsideClick","onKeyPress","event","key","_askHydrate","forEach","callback","window","setTimeout","isHydrated","_getStatusComponent","onStatusClick","ToolTipMessage","StatusIcon","React","Icon","name","className","StatusArea","t","useTranslation","loadStr","onMouseUp","Tooltip","content","position","props","children","displaySets","viewportOptions","extensionManager","commandsManager","displaySetService","toolGroupService","segmentationService","viewportActionCornersService","length","Error","viewportGrid","viewportGridService","useViewportGrid","selectedSegment","setSelectedSegment","useState","setIsHydrated","segIsLoading","setSegIsLoading","isLoaded","element","setElement","processingProgress","setProcessingProgress","percentComplete","totalSegments","referencedDisplaySetRef","useRef","viewports","activeViewportId","referencedDisplaySetInstanceUID","referencedDisplaySet","getDisplaySetByUID","referencedDisplaySetMetadata","SharedFunctionalGroupsSequence","instance","SharedFunctionalGroup","Array","isArray","PixelMeasuresSequence","PixelMeasures","SpacingBetweenSlices","SliceThickness","image0","images","PatientID","PatientName","PatientSex","PatientAge","StudyDate","SeriesDescription","SeriesInstanceUID","SeriesNumber","ManufacturerModelName","_getReferencedDisplaySetMetadata","current","displaySet","metadata","onElementDisabled","storePresentationState","useCallback","runCommand","getCornerstoneViewport","component","Component","getModuleEntry","_extends","viewportType","orientation","presentationIds","onElementEnabled","evt","detail","onSegmentChange","direction","segmentationId","displaySetInstanceUID","segmentation","getSegmentation","segments","numberOfSegments","Object","keys","newSelectedSegmentIndex","jumpToSegmentCenter","hydrateSEG","SegmentationRepresentations","Labelmap","setDisplaySetsForViewport","displaySetInstanceUIDs","useEffect","promptHydrateSEG","then","clearSegmentationRepresentations","unsubscribe","subscribe","EVENTS","SEGMENTATION_LOADING_COMPLETE","SEGMENT_LOADING_COMPLETE","numSegments","onDisplaySetsRemovedSubscription","DISPLAY_SETS_REMOVED","activeViewport","includes","toolGroup","getToolGroup","createSEGToolGroupAndAddTools","destroyToolGroup","addComponents","indexPriority","location","LOCATIONS","topLeft","ViewportActionArrows","onArrowsClick","topRight","childrenWithProps","map","child","index","LoadingIndicatorTotalPercent","totalNumbers","loadingText"],"sourceRoot":""}