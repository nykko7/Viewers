"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9611],{69611:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ce});var r=n(86326),i=n(81980),a=n(55139),o=n(81985),s=n(29463),l=n(58851),c=n(71353),m=n(97598),u=n.n(m);function d({viewportData:e,viewportId:t,element:n,imageSliceData:i,setImageSliceData:a,scrollbarHeight:s,servicesManager:c}){const{cineService:m,cornerstoneViewportService:u}=c.services;return(0,r.useEffect)((()=>{if(!e)return;const n=u.getCornerstoneViewport(t);if(!n||n instanceof o.VolumeViewport3D)return;const r=n.getCurrentImageIdIndex(),i=n.getNumberOfSlices();a({imageIndex:r,numberOfSlices:i})}),[t,e]),(0,r.useEffect)((()=>{if(!e)return;const{viewportType:r}=e,i=r===o.Enums.ViewportType.STACK&&o.Enums.Events.STACK_VIEWPORT_SCROLL||r===o.Enums.ViewportType.ORTHOGRAPHIC&&o.Enums.Events.VOLUME_NEW_IMAGE||o.Enums.Events.IMAGE_RENDERED,s=e=>{const n=u.getCornerstoneViewport(t);if(!n||n instanceof o.VolumeViewport3D)return;const{imageIndex:r,newImageIdIndex:i=r}=e.detail,s=n.getNumberOfSlices();a({imageIndex:i,numberOfSlices:s})};return n.addEventListener(i,s),()=>{n.removeEventListener(i,s)}}),[e,n]),r.createElement(l.uq,{onChange:e=>((e,t)=>{const r=u.getCornerstoneViewport(t),{isCineEnabled:i}=m.getState();i&&(m.stopClip(n,{viewportId:t}),m.setCine({id:t,isPlaying:!1})),o.utilities.jumpToSlice(r.element,{imageIndex:e,debounceLoading:!0})})(e,t),max:i.numberOfSlices?i.numberOfSlices-1:0,height:s,value:i.imageIndex||0})}d.propTypes={viewportData:u().object,viewportId:u().string.isRequired,element:u().instanceOf(Element),scrollbarHeight:u().string,imageSliceData:u().object.isRequired,setImageSliceData:u().func.isRequired,servicesManager:u().object.isRequired};const p=d;var g=n(5791),v=n(55530),f=n.n(v),E=n(3823);const{getOrientationStringLPS:w,invertOrientationStringLPS:I}=a.utilities.orientation;const b=function({element:e,viewportData:t,imageSliceData:n,viewportId:i,servicesManager:a,orientationMarkers:s=["top","left"]}){const[l,c]=(0,r.useState)(0),[m,u]=(0,r.useState)(!1),[d,p]=(0,r.useState)(!1),{cornerstoneViewportService:g}=a.services;(0,r.useEffect)((()=>{const t=e=>{const{previousCamera:t,camera:n}=e.detail,{rotation:r}=n;void 0!==r&&c(r),void 0!==n.flipHorizontal&&t.flipHorizontal!==n.flipHorizontal&&u(n.flipHorizontal),void 0!==n.flipVertical&&t.flipVertical!==n.flipVertical&&p(n.flipVertical)};return e.addEventListener(o.Enums.Events.CAMERA_MODIFIED,t),()=>{e.removeEventListener(o.Enums.Events.CAMERA_MODIFIED,t)}}),[]);const v=(0,r.useMemo)((()=>{if(!t)return"";let a,c,u;if("stack"===t.viewportType){const e=n.imageIndex,r=t.data[0].imageIds?.[e];if(!r)return!1;({rowCosines:a,columnCosines:c,isDefaultValueSetForColumnCosine:u,isDefaultValueSetForColumnCosine:u}=o.metaData.get("imagePlaneModule",r)||{})}else{if(!e||!(0,o.getEnabledElement)(e))return"";const{viewport:t}=(0,o.getEnabledElement)(e),{viewUp:n,viewPlaneNormal:r}=t.getCamera(),i=E.eR.create();E.eR.cross(i,n,r),c=[-n[0],-n[1],-n[2]],a=i}if(!a||!c||void 0===l||u)return"";const p=function(e,t,n,r,i){const a=w(e),o=w(t),s=I(a),l={top:I(o),left:s,right:a,bottom:o};r&&(l.top=I(l.top),l.bottom=I(l.bottom));i&&(l.left=I(l.left),l.right=I(l.right));if(90===n||-270===n)return{top:l.left,left:I(l.top),right:I(l.bottom),bottom:l.right};if(-90===n||270===n)return{top:I(l.left),left:l.top,bottom:l.left,right:l.bottom};if(180===n||-180===n)return{top:I(l.top),left:I(l.left),bottom:I(l.bottom),right:I(l.right)};return l}(a,c,l,d,m);return g.getViewportInfo(i)?s.map(((e,t)=>r.createElement("div",{className:f()("overlay-text",`${e}-mid orientation-marker`,"text-aqua-pale","text-[13px]","leading-5"),key:`${e}-mid orientation-marker`},r.createElement("div",{className:"orientation-marker-value"},p[e])))):(console.log("ViewportOrientationMarkers::No viewport"),null)}),[t,n,l,d,m,s,e]);return r.createElement("div",{className:"ViewportOrientationMarkers select-none"},v)};function S({viewportData:e,element:t}){const[n,i]=(0,r.useState)(!1),[a,s]=(0,r.useState)(!1),l=(0,r.useRef)(null),c=(0,r.useRef)(null),m=e=>{clearTimeout(l.current),l.current=setTimeout((()=>{i(!0)}),50)},u=e=>{clearTimeout(l.current),i(!1)},d=e=>{clearTimeout(l.current),c.current===e.detail.imageId&&(s(e.detail.error),c.current=null)};return(0,r.useEffect)((()=>(t.addEventListener(o.Enums.Events.STACK_VIEWPORT_SCROLL,m),t.addEventListener(o.Enums.Events.IMAGE_LOAD_ERROR,d),t.addEventListener(o.Enums.Events.STACK_NEW_IMAGE,u),()=>{t.removeEventListener(o.Enums.Events.STACK_VIEWPORT_SCROLL,m),t.removeEventListener(o.Enums.Events.STACK_NEW_IMAGE,u),t.removeEventListener(o.Enums.Events.IMAGE_LOAD_ERROR,d)})),[t,e]),a?r.createElement(r.Fragment,null,r.createElement("div",{className:"absolute top-0 left-0 h-full w-full bg-black opacity-50"},r.createElement("div",{className:"transparent flex h-full w-full items-center justify-center"},r.createElement("p",{className:"text-primary-light text-xl font-light"},r.createElement("h4",null,"Error Loading Image"),r.createElement("p",null,"An error has occurred."),r.createElement("p",null,a))))):n?r.createElement("div",{className:"pointer-events-none absolute top-0 left-0 h-full w-full bg-black opacity-50"},r.createElement("div",{className:"transparent flex h-full w-full items-center justify-center"},r.createElement("p",{className:"text-primary-light text-xl font-light"},"Loading..."))):null}S.propTypes={error:u().object,element:u().object};const y=S;const h=function(e){const{viewportId:t,element:n,scrollbarHeight:i,servicesManager:a}=e,{cornerstoneViewportService:o}=a.services,[s,l]=(0,r.useState)({imageIndex:0,numberOfSlices:0}),[c,m]=(0,r.useState)(null);if((0,r.useEffect)((()=>{const{unsubscribe:e}=o.subscribe(o.EVENTS.VIEWPORT_DATA_CHANGED,(e=>{e.viewportId===t&&m(e.viewportData)}));return()=>{e()}}),[t]),!n)return null;if(c){const e=o.getViewportInfo(t);if(e?.viewportOptions?.customViewportProps?.hideOverlays)return null}return r.createElement("div",{className:"noselect"},r.createElement(p,{viewportId:t,viewportData:c,element:n,imageSliceData:s,setImageSliceData:l,scrollbarHeight:i,servicesManager:a}),r.createElement(g.Ay,{imageSliceData:s,viewportData:c,viewportId:t,servicesManager:a,element:n}),r.createElement(y,{viewportData:c,element:n}),r.createElement(b,{imageSliceData:s,element:n,viewportData:c,servicesManager:a,viewportId:t}))};var C=n(45981);function V({viewportId:e,cineService:t,newStackFrameRate:n,isPlaying:i,dynamicInfo:a,customizationService:s}){const{component:c=l.F0}=s.get("cinePlayer")??{},[m,u]=(0,r.useState)(a);(0,r.useEffect)((()=>{u(a)}),[a]),(0,r.useEffect)((()=>{if(!m)return;const e=e=>{const{volumeId:t,timePointIndex:n,numTimePoints:r,splittingTag:i}=e.detail;u({volumeId:t,timePointIndex:n,numTimePoints:r,label:i})};return o.eventTarget.addEventListener(o.Enums.Events.DYNAMIC_VOLUME_TIME_POINT_INDEX_CHANGED,e),()=>{o.eventTarget.removeEventListener(o.Enums.Events.DYNAMIC_VOLUME_TIME_POINT_INDEX_CHANGED,e)}}),[m]),(0,r.useEffect)((()=>{if(!m)return;const{volumeId:e,timePointIndex:t,numTimePoints:n,splittingTag:r}=m||{};o.cache.getVolume(e,!0).timePointIndex=t,u({volumeId:e,timePointIndex:t,numTimePoints:n,label:r})}),[]);const d=(0,r.useCallback)((e=>{const{volumeId:t,timePointIndex:n}=e;o.cache.getVolume(t,!0).timePointIndex=n}),[]);return r.createElement(c,{className:"absolute left-1/2 bottom-3 -translate-x-1/2",frameRate:n,isPlaying:i,onClose:()=>{t.setCine({id:e,isPlaying:!1}),t.setIsCineEnabled(!1),t.setViewportCineClosed(e)},onPlayPauseChange:n=>{t.setCine({id:e,isPlaying:n})},onFrameRateChange:n=>t.setCine({id:e,frameRate:n}),dynamicInfo:m,updateDynamicInfo:d})}const x=function({enabledVPElement:e,viewportId:t,servicesManager:n}){const{customizationService:i,displaySetService:a,viewportGridService:s}=n.services,[{isCineEnabled:c,cines:m},u]=(0,l.tq)(),[d,p]=(0,r.useState)(24),[g,v]=(0,r.useState)(null),[f]=(0,C.r)(),E=(0,r.useRef)(null),w=()=>{if(!m?.[t]||!e)return;const{isPlaying:n=!1,frameRate:r=24}=m[t],i=Math.max(r,1);return n?u.playClip(e,{framesPerSecond:i,viewportId:t}):u.stopClip(e)},I=(0,r.useCallback)((()=>{if(!e||!c)return;const{viewports:n}=s.getState(),{displaySetInstanceUIDs:r}=n.get(t);let i=24,o=m[t]?.isPlaying||!1;r.forEach((e=>{const t=a.getDisplaySetByUID(e);if(t.FrameRate&&(i=Math.round(1e3/t.FrameRate),o||=!!f.autoPlayCine),t.isDynamicVolume){const{dynamicVolumeInfo:e}=t,n=e.timePoints.length,r=e.splittingTag,i=e.timePointIndex||0;v({volumeId:t.displaySetInstanceUID,timePointIndex:i,numTimePoints:n,label:r})}else v(null)})),o&&u.setIsCineEnabled(o),u.setCine({id:t,isPlaying:o,frameRate:i}),p(i)}),[a,t,s,m,c,e]);if((0,r.useEffect)((()=>(E.current=!0,I(),()=>{E.current=!1})),[c,I]),(0,r.useEffect)((()=>{c&&w()}),[c,w,e]),(0,r.useEffect)((()=>{if(e)return e.addEventListener(o.Enums.Events.VIEWPORT_NEW_IMAGE_SET,I),e.addEventListener(o.Enums.Events.VOLUME_VIEWPORT_NEW_VOLUME,I),()=>{u.setCine({id:t,isPlaying:!1}),e.removeEventListener(o.Enums.Events.VIEWPORT_NEW_IMAGE_SET,I),e.removeEventListener(o.Enums.Events.VOLUME_VIEWPORT_NEW_VOLUME,I)}}),[e,I,t]),(0,r.useEffect)((()=>{if(m&&m[t]&&e&&E.current)return w(),()=>{u.stopClip(e,{viewportId:t})}}),[m,t,u,e,w]),!c)return null;const b=m[t],S=b?.isPlaying||!1;return r.createElement(V,{viewportId:t,cineService:u,newStackFrameRate:d,isPlaying:S,dynamicInfo:g,customizationService:i})};var M=n(76255);const N=function({viewportId:e}){const[t]=(0,M.R4)();return t[e]?r.createElement(l.R2,{cornerComponents:t[e]}):null};var R=n(99993);function D({colormaps:e,viewportId:t,displaySets:n,commandsManager:i,servicesManager:a}){const{cornerstoneViewportService:s}=a.services,[c,m]=(0,r.useState)(n[0]),[u,d]=(0,r.useState)(!1),[p,g]=(0,r.useState)(null),v=(0,r.useRef)(u);v.current=u;const f=(0,r.useRef)(p);f.current=p;const E=(0,r.useRef)(c);E.current=c;const w=(0,r.useCallback)((e=>{const t=n.length>1&&!["Grayscale","X Ray"].includes(e.colormap.name)?.5:1;i.run({commandName:"setViewportColormap",commandOptions:{...e,opacity:t,immediate:!0},context:"CORNERSTONE"})}),[i]),I=(0,r.useMemo)((()=>n.map(((e,t)=>({children:e.Modality,key:t,style:{minWidth:`calc(100% / ${n.length})`,fontSize:"0.8rem",textAlign:"center",display:"flex",justifyContent:"center",alignItems:"center"}})))),[n]);return(0,r.useEffect)((()=>{m(n[n.length-1])}),[n]),r.createElement(r.Fragment,null,I.length>1&&r.createElement("div",{className:"all-in-one-menu-item flex w-full justify-center"},r.createElement(l.e2,{onActiveIndexChange:e=>{m(n[e]),g(null)},activeIndex:n.findIndex((e=>e.displaySetInstanceUID===E.current.displaySetInstanceUID))||1,className:"w-[70%] text-[10px]"},I.map((({children:e,key:t,style:n})=>r.createElement("div",{key:t,style:n},e))))),r.createElement("div",{className:"all-in-one-menu-item flex w-full justify-center"},r.createElement(l.L$,{label:"Preview in viewport",checked:u,onChange:e=>{d(e)}})),r.createElement(l.se.VG,null),r.createElement(l.se.cV,null,e.map(((n,i)=>r.createElement(l.se.q7,{key:i,label:n.description,onClick:()=>{w({viewportId:t,colormap:n,displaySetInstanceUID:E.current.displaySetInstanceUID}),g(null)},onMouseEnter:()=>{v.current&&(g(((t,n)=>{const{displaySetInstanceUID:r}=n,i=s.getCornerstoneViewport(t);if(i instanceof o.StackViewport){const{colormap:t}=i.getProperties();return t||e.find((e=>"Grayscale"===e.Name))||e[0]}const a=i.getActors(),l=a?.find((e=>e.referencedId.includes(r))),{colormap:c}=i.getProperties(l.referencedId);return c||e.find((e=>"Grayscale"===e.Name))||e[0]})(t,E.current)),w({viewportId:t,colormap:n,displaySetInstanceUID:E.current.displaySetInstanceUID}))},onMouseLeave:()=>{v.current&&f.current&&w({viewportId:t,colormap:f.current,displaySetInstanceUID:E.current.displaySetInstanceUID})}})))))}function T(e,t,n,r,i){const{cornerstoneViewportService:a}=r.services,s=a.getCornerstoneViewport(e),l=a.getViewportInfo(e).getViewportOptions().background;!!l&&o.utilities.isEqual(l,[1,1,1])&&(i.ticks={position:"left",style:{font:"12px Arial",color:"#000000",maxNumTicks:8,tickSize:5,tickWidth:1,labelMargin:3}});const c=[];s instanceof o.StackViewport&&c.push(e),s instanceof o.VolumeViewport&&t.forEach((e=>{c.push(e.displaySetInstanceUID)})),n.run({commandName:"toggleViewportColorbar",commandOptions:{viewportId:e,options:i,displaySetInstanceUIDs:c},context:"CORNERSTONE"})}function P({viewportId:e,displaySets:t,commandsManager:n,servicesManager:i,colorbarProperties:a}){const{colorbarService:o}=i.services,{width:s,colorbarTickPosition:c,colorbarContainerPosition:m,colormaps:u,colorbarInitialColormap:d}=a,[p,g]=(0,r.useState)(o.hasColorbar(e)),v=(0,r.useCallback)((()=>{T(e,t,n,i,{viewportId:e,colormaps:u,ticks:{position:c},width:s,position:m,activeColormapName:d})}),[n]);return(0,r.useEffect)((()=>{const{unsubscribe:t}=o.subscribe(o.EVENTS.STATE_CHANGED,(()=>{g(o.hasColorbar(e))}));return()=>{t()}}),[e]),r.createElement("div",{className:"all-in-one-menu-item flex w-full justify-center"},r.createElement("div",{className:"mr-2 w-[28px]"}),r.createElement(l.L$,{label:"Display Color bar",checked:p,onChange:()=>{v()}}))}function O({viewportId:e,commandsManager:t,presets:n}){const{t:i}=(0,R.Bd)("WindowLevelActionMenu"),a=(0,r.useCallback)((n=>{t.run({commandName:"setViewportWindowLevel",commandOptions:{...n,viewportId:e},context:"CORNERSTONE"})}),[t,e]);return r.createElement(l.se.cV,null,n.map(((e,t)=>r.createElement(r.Fragment,{key:t},Object.entries(e).map((([e,t])=>r.createElement(r.Fragment,{key:e},r.createElement(l.se.N5,null,i("Modality Presets",{modality:e})),t.map(((t,n)=>r.createElement(l.se.q7,{key:`${e}-${n}`,label:t.description,secondaryLabel:`${t.window} / ${t.level}`,onClick:()=>a(t)}))))))))))}function k({presets:e,viewportId:t,commandsManager:n,onClose:i}){const[a,o]=(0,r.useState)(e),[s,c]=(0,r.useState)(""),[m,u]=(0,r.useState)(null),d=(0,r.useCallback)((t=>{c(t);const n=t?e.filter((e=>e.name.toLowerCase().includes(t.toLowerCase()))):e;o(n)}),[e]),p=(0,r.useCallback)((e=>{n.runCommand("setViewportPreset",{...e})}),[n]);return r.createElement("div",{className:"flex min-h-full w-full flex-col justify-between"},r.createElement("div",{className:"border-secondary-light h-[433px] w-full overflow-hidden rounded border bg-black px-2.5"},r.createElement("div",{className:"flex h-[46px] w-full items-center justify-start"},r.createElement("div",{className:"h-[26px] w-[200px]"},r.createElement(l.Cv,{value:s,onDebounceChange:d,placeholder:"Search all"}))),r.createElement("div",{className:"ohif-scrollbar overflow h-[385px] w-full overflow-y-auto"},r.createElement("div",{className:"grid grid-cols-4 gap-3 pt-2 pr-3"},a.map(((e,n)=>{return r.createElement("div",{key:n,className:"flex cursor-pointer flex-col items-start",onClick:()=>{u(e),p({preset:e.name,viewportId:t})}},r.createElement(l.In,{name:e.name,className:m?.name===e.name?"border-primary-light h-[75px] w-[95px] max-w-none rounded border-2":"hover:border-primary-light h-[75px] w-[95px] max-w-none rounded border-2 border-black"}),r.createElement("label",{className:"text-aqua-pale mt-2 text-left text-xs"},(i=e.name,a=11,i.length>a?`${i.slice(0,a)}...`:i)));var i,a}))))),r.createElement("footer",{className:"flex h-[60px] w-full items-center justify-end"},r.createElement("div",{className:"flex"},r.createElement(l.$n,{name:"Cancel",size:l.Ny.Ej.medium,type:l.Ny.NW.secondary,onClick:i}," ","Cancel"," "))))}function L({viewportId:e,servicesManager:t,commandsManager:n,volumeRenderingPresets:i}){const{uiModalService:a}=t.services;return r.createElement(l.se.q7,{label:"Rendering Presets",icon:r.createElement(l.In,{name:"VolumeRendering"}),rightIcon:r.createElement(l.In,{name:"action-new-dialog"}),onClick:()=>{a.show({content:k,title:"Rendering Presets",movable:!0,contentProps:{onClose:a.hide,presets:i,viewportId:e,commandsManager:n},containerDimensions:"h-[543px] w-[460px]",contentDimensions:"h-[493px] w-[460px]  pl-[12px] pr-[12px]"})}})}function A({volumeRenderingQualityRange:e,commandsManager:t,servicesManager:n,viewportId:i}){const{cornerstoneViewportService:a}=n.services,{min:o,max:s,step:l}=e,[c,m]=(0,r.useState)(null),u=(0,r.useCallback)((e=>{t.runCommand("setVolumeRenderingQulaity",{viewportId:i,volumeQuality:e}),m(e)}),[t,i]);return(0,r.useEffect)((()=>{const e=a.getCornerstoneViewport(i),{actor:t}=e.getActors()[0],n=t.getMapper(),r=n.getInputData().getSpacing(),o=n.getSampleDistance(),s=r.reduce(((e,t)=>e+t))/3;m(o===s?1:Math.sqrt(s/(.5*o)))}),[a,i]),r.createElement(r.Fragment,null,r.createElement("div",{className:"all-in-one-menu-item flex  w-full flex-row !items-center justify-between gap-[10px]"},r.createElement("label",{className:"block text-white",htmlFor:"volume"},"Quality"),null!==c&&r.createElement("input",{className:"bg-inputfield-main h-2 w-[120px] cursor-pointer appearance-none rounded-lg",value:c,id:"volume",max:s,min:o,type:"range",step:l,onChange:e=>u(parseInt(e.target.value,10)),style:{background:(e=>{const t=(e-0)/1*100;return`linear-gradient(to right, #5acce6 0%, #5acce6 ${t}%, #3a3f99 ${t}%, #3a3f99 100%)`})((c-o)/(s-o)),"--thumb-inner-color":"#5acce6","--thumb-outer-color":"#090c29"}})))}function _({viewportId:e,commandsManager:t,servicesManager:n}){const{cornerstoneViewportService:i}=n.services,[a,o]=(0,r.useState)(null),[s,l]=(0,r.useState)(null),[c,m]=(0,r.useState)(i.getCornerstoneViewport(e)?.shiftedBy||0),[u,d]=(0,r.useState)(null),[p,g]=(0,r.useState)(!1),v=(0,r.useRef)(c),f=i.getCornerstoneViewport(e),{actor:E}=f.getActors()[0],w=E.getProperty().getScalarOpacity(0);(0,r.useEffect)((()=>{if(p)return;const e=w.getRange(),t=e[1]-e[0],n=t;o(-t),l(n),d(Math.pow(10,Math.floor(Math.log10(t/500))))}),[i,e,E,w,p]);const I=(0,r.useCallback)((n=>{const r=n-v.current;v.current=n,f.shiftedBy=n,t.runCommand("shiftVolumeOpacityPoints",{viewportId:e,shift:r})}),[t,e,f]);return r.createElement(r.Fragment,null,r.createElement("div",{className:"all-in-one-menu-item flex  w-full flex-row !items-center justify-between gap-[10px]"},r.createElement("label",{className:"block  text-white",htmlFor:"shift"},"Shift"),null!==u&&r.createElement("input",{className:"bg-inputfield-main h-2 w-[120px] cursor-pointer appearance-none rounded-lg",value:c,onChange:e=>{const t=parseInt(e.target.value,10);m(t),I(t)},id:"shift",onMouseDown:()=>g(!0),onMouseUp:()=>g(!1),max:s,min:a,type:"range",step:u,style:{background:(e=>{const t=(e-0)/1*100;return`linear-gradient(to right, #5acce6 0%, #5acce6 ${t}%, #3a3f99 ${t}%, #3a3f99 100%)`})((c-a)/(s-a)),"--thumb-inner-color":"#5acce6","--thumb-outer-color":"#090c29"}})))}function F({servicesManager:e,commandsManager:t,viewportId:n}){const{cornerstoneViewportService:i}=e.services,[a,o]=(0,r.useState)(null),[s,l]=(0,r.useState)(null),[c,m]=(0,r.useState)(null),u=(0,r.useCallback)((()=>{t.runCommand("setVolumeLighting",{viewportId:n,options:{ambient:a}})}),[a,t,n]),d=(0,r.useCallback)((()=>{t.runCommand("setVolumeLighting",{viewportId:n,options:{diffuse:s}})}),[s,t,n]),p=(0,r.useCallback)((()=>{t.runCommand("setVolumeLighting",{viewportId:n,options:{specular:c}})}),[c,t,n]),g=e=>{const t=(e-0)/1*100;return`linear-gradient(to right, #5acce6 0%, #5acce6 ${t}%, #3a3f99 ${t}%, #3a3f99 100%)`};return(0,r.useEffect)((()=>{const e=i.getCornerstoneViewport(n),{actor:t}=e.getActors()[0],r=t.getProperty().getAmbient(),a=t.getProperty().getDiffuse(),s=t.getProperty().getSpecular();o(r),l(a),m(s)}),[n,i]),r.createElement(r.Fragment,null,r.createElement("div",{className:"all-in-one-menu-item flex  w-full flex-row !items-center justify-between gap-[10px]"},r.createElement("label",{className:"block  text-white",htmlFor:"ambient"},"Ambient"),null!==a&&r.createElement("input",{className:"bg-inputfield-main h-2 w-[120px] cursor-pointer appearance-none rounded-lg",value:a,onChange:e=>{o(e.target.value),u()},id:"ambient",max:1,min:0,type:"range",step:.1,style:{background:g(a),"--thumb-inner-color":"#5acce6","--thumb-outer-color":"#090c29"}})),r.createElement("div",{className:"all-in-one-menu-item flex  w-full flex-row !items-center justify-between gap-[10px]"},r.createElement("label",{className:"block  text-white",htmlFor:"diffuse"},"Diffuse"),null!==s&&r.createElement("input",{className:"bg-inputfield-main h-2 w-[120px] cursor-pointer appearance-none rounded-lg",value:s,onChange:e=>{l(e.target.value),d()},id:"diffuse",max:1,min:0,type:"range",step:.1,style:{background:g(s),"--thumb-inner-color":"#5acce6","--thumb-outer-color":"#090c29"}})),r.createElement("div",{className:"all-in-one-menu-item flex  w-full flex-row !items-center justify-between gap-[10px]"},r.createElement("label",{className:"block  text-white",htmlFor:"specular"},"Specular"),null!==c&&r.createElement("input",{className:"bg-inputfield-main h-2 w-[120px] cursor-pointer appearance-none rounded-lg",value:c,onChange:e=>{m(e.target.value),p()},id:"specular",max:1,min:0,type:"range",step:.1,style:{background:g(c),"--thumb-inner-color":"#5acce6","--thumb-outer-color":"#090c29"}})))}function U({commandsManager:e,viewportId:t,servicesManager:n}){const{cornerstoneViewportService:i}=n.services,[a,o]=(0,r.useState)(!0),[s,c]=(0,r.useState)(0),m=(0,r.useCallback)((n=>{e.runCommand("setVolumeLighting",{viewportId:t,options:{shade:n}})}),[e,t]);return(0,r.useEffect)((()=>{const e=i.getCornerstoneViewport(t),{actor:n}=e.getActors()[0],r=n.getProperty().getShade();o(r),c(s+1)}),[t,i]),r.createElement(l.L$,{key:s,label:"Shade",checked:a,onChange:()=>{o(!a),m(!a)}})}function G({viewportId:e,commandsManager:t,volumeRenderingQualityRange:n,servicesManager:i}){return r.createElement(l.se.cV,null,r.createElement(A,{viewportId:e,commandsManager:t,servicesManager:i,volumeRenderingQualityRange:n}),r.createElement(_,{viewportId:e,commandsManager:t,servicesManager:i}),r.createElement("div",{className:"all-in-one-menu-item mt-2 flex !h-[20px] w-full justify-start"},r.createElement("div",{className:"text-aqua-pale text-[13px]"},"LIGHTING")),r.createElement("div",{className:"bg-primary-dark mt-1 mb-1 h-[2px] w-full"}),r.createElement("div",{className:"all-in-one-menu-item flex w-full justify-center"},r.createElement(U,{commandsManager:t,servicesManager:i,viewportId:e})),r.createElement(F,{viewportId:e,commandsManager:t,servicesManager:i}))}const H=["SR","SEG","SM","RTSTRUCT","RTPLAN","RTDOSE"];function z({viewportId:e,element:t,presets:n,verticalDirection:i,horizontalDirection:a,commandsManager:s,servicesManager:c,colorbarProperties:m,displaySets:u,volumeRenderingPresets:d,volumeRenderingQualityRange:p}){const{colormaps:g,colorbarContainerPosition:v,colorbarInitialColormap:E,colorbarTickPosition:w,width:I}=m,{colorbarService:b,cornerstoneViewportService:S}=c.services,y=S.getViewportInfo(e),h=S.getCornerstoneViewport(e),C=y.getViewportOptions().background,V=!!C&&o.utilities.isEqual(C,[1,1,1]),{t:x}=(0,R.Bd)("WindowLevelActionMenu"),[M]=(0,l.ih)(),{activeViewportId:N}=M,[k,A]=(0,r.useState)(t?.clientHeight),[_,F]=(0,r.useState)(0),[U,z]=(0,r.useState)(!1),W=(0,r.useCallback)((()=>{T(e,u,s,c,{colormaps:g,ticks:{position:w},width:I,position:v,activeColormapName:E})}),[s]);return(0,r.useEffect)((()=>{const e=t?.clientHeight;k!==e&&A(e)}),[t,k]),(0,r.useEffect)((()=>{b.hasColorbar(e)&&window.setTimeout((()=>{b.removeColorbar(e),W()}),0)}),[e,u,h]),(0,r.useEffect)((()=>{F(_+1);S.getCornerstoneViewport(e)instanceof o.VolumeViewport3D?z(!0):z(!1)}),[u,e,n,p,d,m,N,M]),r.createElement(l.se.dd,{icon:"viewport-window-level",verticalDirection:i,horizontalDirection:a,iconClassName:f()(N===e?"visible":"invisible group-hover/pane:visible","flex shrink-0 cursor-pointer rounded active:text-white text-primary-light",V?" hover:bg-secondary-dark":"hover:bg-secondary-light/60"),menuStyle:{maxHeight:k-32,minWidth:218},onVisibilityChange:()=>{A(t.clientHeight)},menuKey:_},r.createElement(l.se.cV,null,!U&&r.createElement(P,{viewportId:e,displaySets:u.filter((e=>!H.includes(e.Modality))),commandsManager:s,servicesManager:c,colorbarProperties:m}),g&&!U&&r.createElement(l.se.g8,{key:"colorLUTPresets",itemLabel:"Color LUT",itemIcon:"icon-color-lut"},r.createElement(D,{colormaps:g,viewportId:e,displaySets:u.filter((e=>!H.includes(e.Modality))),commandsManager:s,servicesManager:c})),n&&n.length>0&&!U&&r.createElement(l.se.g8,{key:"windowLevelPresets",itemLabel:x("Modality Window Presets"),itemIcon:"viewport-window-level"},r.createElement(O,{viewportId:e,commandsManager:s,presets:n})),d&&U&&r.createElement(L,{servicesManager:c,viewportId:e,commandsManager:s,volumeRenderingPresets:d}),p&&U&&r.createElement(l.se.g8,{itemLabel:"Rendering Options"},r.createElement(G,{viewportId:e,commandsManager:s,volumeRenderingQualityRange:p,servicesManager:c}))))}function W({viewportId:e,element:t,displaySets:n,servicesManager:i,commandsManager:a,verticalDirection:o,horizontalDirection:s}){const{customizationService:l}=i.services,{presets:c}=l.get("cornerstone.windowLevelPresets"),m=l.get("cornerstone.colorbar"),{volumeRenderingPresets:u,volumeRenderingQualityRange:d}=l.get("cornerstone.3dVolumeRendering"),p=n.filter((e=>c[e.Modality])).map((e=>({[e.Modality]:c[e.Modality]})));return 0===n.map((e=>e.Modality)).filter((e=>!H.includes(e))).length?null:r.createElement(z,{viewportId:e,element:t,presets:p,verticalDirection:o,horizontalDirection:s,commandsManager:a,servicesManager:i,colorbarProperties:m,displaySets:n,volumeRenderingPresets:u,volumeRenderingQualityRange:d})}var j=n(43494),$=n(99737);const q=function({viewportId:e,servicesManager:t}){const{segmentationService:n}=t.services,[i,a]=(0,r.useState)([]),[o,s]=(0,r.useState)([]);(0,r.useEffect)((()=>{const t=()=>{const t=n.getSegmentationRepresentations(e);a(t);const r=n.getSegmentations().filter((e=>!t.some((t=>t.segmentationId===e.segmentationId))));s(r)};t();const r=[n.EVENTS.SEGMENTATION_MODIFIED,n.EVENTS.SEGMENTATION_REMOVED,n.EVENTS.SEGMENTATION_REPRESENTATION_MODIFIED].map((e=>n.subscribe(e,t)));return()=>{r.forEach((e=>e.unsubscribe()))}}),[n,e]);const l=(t,r=$.SegmentationRepresentations.Labelmap)=>{n.toggleSegmentationRepresentationVisibility(e,{segmentationId:t,type:r})};return r.createElement("div",{className:"bg-muted flex h-full w-[262px] flex-col rounded p-3"},r.createElement("span",{className:"text-muted-foreground mb-2 text-xs font-semibold"},"Current Viewport"),r.createElement("ul",{className:"space-y-1"},i.map((t=>r.createElement("li",{key:t.id,className:"flex items-center text-sm"},r.createElement(j.$n,{variant:"ghost",size:"icon",className:"text-muted-foreground mr-2",onClick:()=>{return r=t.segmentationId,void n.removeSegmentationRepresentations(e,{segmentationId:r});var r}},r.createElement(j.FI.Minus,{className:"h-6 w-6"})),r.createElement("span",{className:"text-foreground flex-grow"},t.label),t.visible?r.createElement(j.$n,{variant:"ghost",size:"icon",className:"text-muted-foreground",onClick:()=>l(t.segmentationId,t.type)},r.createElement(j.FI.Hide,{className:"h-6 w-6"})):r.createElement(j.$n,{variant:"ghost",size:"icon",className:"text-muted-foreground",onClick:()=>l(t.segmentationId,t.type)},r.createElement(j.FI.Show,{className:"h-6 w-6"})))))),o.length>0&&r.createElement(r.Fragment,null,r.createElement(j.wv,{className:"bg-input mb-3"}),r.createElement("span",{className:"text-muted-foreground mb-2 text-xs font-semibold"},"Available"),r.createElement("ul",{className:"space-y-1"},o.map((({segmentationId:t,label:i})=>r.createElement("li",{key:t,className:"flex items-center text-sm"},r.createElement(j.$n,{variant:"ghost",size:"icon",className:"text-muted-foreground mr-2",onClick:()=>(t=>{n.addSegmentationRepresentation(e,{segmentationId:t})})(t)},r.createElement(j.FI.Plus,{className:"h-6 w-6"})),r.createElement("span",{className:"text-foreground/60"},i)))))))};var B=n(73421);function Q({viewportId:e,displaySets:t,servicesManager:n,commandsManager:i,location:a}){const{viewportActionCornersService:o,viewportGridService:s}=n.services,l=(0,B.j)({servicesManager:n}),c=e===s.getActiveViewportId(),{align:m,side:u}=K(o,a);return l?.length?r.createElement(j.AM,null,r.createElement(j.Wv,{asChild:!0,className:"flex items-center justify-center"},r.createElement(j.$n,{variant:"ghost",size:"icon"},r.createElement(j.FI.ViewportViews,{className:f()("text-highlight",c?"visible":"invisible group-hover/pane:visible")}))),r.createElement(j.hl,{className:"border-none bg-transparent p-0 shadow-none",side:u,align:m,alignOffset:-15,sideOffset:5},r.createElement(q,{className:"w-full",viewportId:e,displaySets:t,servicesManager:n,commandsManager:i}))):null}const K=(e,t)=>{const n=e.LOCATIONS;switch(t){case n.topLeft:return{align:"start",side:"bottom"};case n.topRight:return{align:"end",side:"bottom"};case n.bottomLeft:return{align:"start",side:"top"};case n.bottomRight:return{align:"end",side:"top"};default:return console.debug("Unknown location, defaulting to bottom-start"),{align:"start",side:"bottom"}}};function J(e){return r.createElement(Q,e)}var X=n(44646),Y=n(10182),Z=n(2847);var ee=n(68578);const te=["OT","US"],ne=(0,r.memo)((({servicesManager:e,viewportId:t})=>{const{displaySetService:n,cineService:i,viewportGridService:a,customizationService:o}=e.services,[s,l]=(0,r.useState)(t);return(0,r.useEffect)((()=>{const e=a.subscribe(a.EVENTS.ACTIVE_VIEWPORT_ID_CHANGED,(({viewportId:e})=>l(e)));return()=>e.unsubscribe()}),[t,a]),(0,r.useEffect)((()=>{if(i.isViewportCineClosed(s))return;const e=a.getDisplaySetsUIDsForViewport(s);if(!e)return;const t=e.map((e=>n.getDisplaySetByUID(e)));if(!t.length)return;const r=t.map((e=>e?.Modality)),{modalities:l}=o.getModeCustomization("autoCineModalities",{id:"autoCineModalities",modalities:te});r.some((e=>l.includes(e)))&&!i.getState().isCineEnabled&&i.setIsCineEnabled(!0)}),[s,i,a,n,o]),null}),re);function re(e,t){return e.viewportId===t.viewportId&&e.servicesManager===t.servicesManager}ne.displayName="ActiveViewportBehavior";const ie=ne;let ae;const oe=r.memo((e=>{const{displaySets:t,dataSource:n,viewportOptions:m,displaySetOptions:u,servicesManager:d,commandsManager:p,onElementEnabled:g,onElementDisabled:v,isJumpToMeasurementDisabled:f=!1,initialImageIndex:E,isHangingProtocolLayout:w}=e,I=m.viewportId;if(!I)throw new Error("Viewport ID is required");for(;u.length<t.length;)u.push({});m.viewportType=t.some((e=>e.isDynamicVolume&&e.isReconstructable))?"volume":m.viewportType;const[b,S]=(0,r.useState)("100px"),[y,V]=(0,r.useState)(null),M=(0,r.useRef)(),[R]=(0,C.r)(),{displaySetService:D,toolbarService:T,toolGroupService:P,syncGroupService:O,cornerstoneViewportService:k,segmentationService:L,cornerstoneCacheService:A,viewportActionCornersService:_}=d.services,[F]=(0,l.OR)(),U=(0,r.useCallback)((()=>{const e=M.current.clientHeight-40+"px";S(e)}),[M]),G=(0,r.useCallback)((()=>{M.current&&(k.resize(),U())}),[M]),H=(0,r.useCallback)((e=>{const t=e.getRenderingEngineId(),n=e.getSyncGroups();P.removeViewportFromToolGroup(I,t),O.removeViewportFromSyncGroup(I,t,n),L.clearSegmentationRepresentations(I),_.clear(I)}),[I,L,O,P,_]),z=(0,r.useCallback)((e=>{if(e.detail.element!==M.current)return;const{viewportId:t,element:n}=e.detail,r=k.getViewportInfo(t);(0,c.ye)(t,n),V(n);const i=r.getRenderingEngineId(),a=r.getToolGroupId(),o=r.getSyncGroups();P.addViewportToToolGroup(t,i,a),O.addViewportToSyncGroup(t,i,o);const{synchronizersStore:s}=ee.U.getState();s?.[t]?.length&&!w&&function(e,t){const{synchronizersStore:n}=ee.U.getState(),r=n[e];if(!r)return;r.forEach((n=>{if(!n.id)return;const{id:r,sourceViewports:i,targetViewports:a}=n,o=t.getSynchronizer(r);if(!o)return;const s=i.find((t=>t.viewportId===e)),l=a.find((t=>t.viewportId===e)),c=o.getSourceViewports().find((t=>t.viewportId===e)),m=o.getTargetViewports().find((t=>t.viewportId===e));s&&!c&&o.addSource({viewportId:s.viewportId,renderingEngineId:s.renderingEngineId}),l&&!m&&o.addTarget({viewportId:l.viewportId,renderingEngineId:l.renderingEngineId})}))}(t,O),g&&"function"==typeof g&&g(e)}),[I,g,P]);(0,r.useEffect)((()=>(k.enableViewport(I,M.current),o.eventTarget.addEventListener(o.Enums.Events.ELEMENT_ENABLED,z),U(),()=>{const e=k.getViewportInfo(I);e&&(k.storePresentation({viewportId:I}),H(e),v&&"function"==typeof v&&v(e),k.disableElement(I),o.eventTarget.removeEventListener(o.Enums.Events.ELEMENT_ENABLED,z))})),[]),(0,r.useEffect)((()=>{const{unsubscribe:e}=D.subscribe(D.EVENTS.DISPLAY_SET_SERIES_METADATA_INVALIDATED,(async({displaySetInstanceUID:e,invalidateData:t})=>{if(!t)return;const r=k.getViewportInfo(I);if(r.hasDisplaySet(e)){const t=r.getViewportData(),i=await A.invalidateViewportData(t,e,n,D),a=!0;k.updateViewport(I,i,a)}}));return()=>{e()}}),[I]),(0,r.useEffect)((()=>{m.viewportType||(m.viewportType="stack");(async()=>{const e=await A.createViewportData(t,m,n,E),r=function(e,t){const{lutPresentationStore:n}=Y.I.getState(),{positionPresentationStore:r}=X.q.getState(),{segmentationPresentationStore:i}=Z.v.getState(),{presentationIds:a}=t;if(!a)return{positionPresentation:null,lutPresentation:null,segmentationPresentation:null};const{lutPresentationId:o,positionPresentationId:s,segmentationPresentationId:l}=a;return{positionPresentation:r[s],lutPresentation:n[o],segmentationPresentation:i[l]}}(0,m);let i;ae?.viewportId===I&&(i=ae.measurement,r.positionPresentation=null,ae=null),m.needsRerendering&&(m.needsRerendering=!1),k.setViewportData(I,e,m,u,r),i&&a.annotation.selection.setAnnotationSelected(i.uid)})()}),[m,t,n]),(0,r.useEffect)((()=>{if(f)return;const e=function(e,t,n){const{measurementService:r,cornerstoneViewportService:i}=n.services,{unsubscribe:a}=r.subscribe(s.C5.EVENTS.JUMP_TO_MEASUREMENT_VIEWPORT,(r=>{ae=r;const{viewportId:a,measurement:o,isConsumed:s}=r;o&&!s&&(void 0===ae.cornerstoneViewport&&(ae.cornerstoneViewport=i.getViewportIdToJump(a,{displaySetInstanceUID:o.displaySetInstanceUID,...o.metadata,referencedImageId:o.referencedImageId||o.metadata?.referencedImageId})),ae.cornerstoneViewport===t&&se(o,e,t,n))}));return a}(M,I,d);return function(e,t,n,r){if(!ae)return;if(ae.isConsumed)return void(ae=null);const i=n.map((e=>e.displaySetInstanceUID));if(!i?.length)return;const{measurement:a}=ae;a&&e&&i.includes(a?.displaySetInstanceUID)&&se(a,e,t,r)}(M,I,t,d),()=>{e()}}),[t,M,I,f,d]),(0,r.useEffect)((()=>{if(!1===R.addWindowLevelActionMenu)return;const e=_.LOCATIONS.topRight;_.addComponent({viewportId:I,id:"windowLevelActionMenu",component:W({viewportId:I,element:M.current,displaySets:t,servicesManager:d,commandsManager:p,location:e,verticalDirection:l.se.mq.TopToBottom,horizontalDirection:l.se.Iu.RightToLeft}),location:e}),_.addComponent({viewportId:I,id:"segmentation",component:J({viewportId:I,element:M.current,displaySets:t,servicesManager:d,commandsManager:p,location:e}),location:e})}),[t,I,_,d,p,R]);const{ref:j}=(0,i.u)({onResize:G});return r.createElement(r.Fragment,null,r.createElement("div",{className:"viewport-wrapper"},r.createElement("div",{className:"cornerstone-viewport-element",style:{height:"100%",width:"100%"},onContextMenu:e=>e.preventDefault(),onMouseDown:e=>e.preventDefault(),ref:e=>{j.current=e,M.current=e}}),r.createElement(h,{viewportId:I,toolBarService:T,element:M.current,scrollbarHeight:b,servicesManager:d}),r.createElement(x,{enabledVPElement:y,viewportId:I,servicesManager:d}),r.createElement(ie,{viewportId:I,servicesManager:d})),r.createElement("div",{className:"absolute top-[24px] w-full"},F.viewportId===I&&r.createElement(l.Eg,{id:"viewport-notification",message:F.message,type:F.type,actions:F.actions,onSubmit:F.onSubmit,onOutsideClick:F.onOutsideClick,onKeyPress:F.onKeyPress})),r.createElement(N,{viewportId:I}))}),le);function se(e,t,n,r){const{viewportGridService:i}=r.services,s=t.current;i.setActiveViewportId(n);const l=(0,o.getEnabledElement)(s);if(l){const t=l.viewport,{metadata:n}=e;if(!t.isReferenceViewable(n,{withNavigation:!0,withOrientation:!0}))return void console.log("Reference isn't viewable, postponing until updated");t.setViewReference(n),a.annotation.selection.setAnnotationSelected(e.uid),ae?.consume?.(),ae=null}}function le(e,t){if(t.needsRerendering)return console.debug("OHIFCornerstoneViewport: Rerender caused by: needsRerendering"),!1;if(e.displaySets.length!==t.displaySets.length)return console.debug("OHIFCornerstoneViewport: Rerender caused by: displaySets length change"),!1;if(e.viewportOptions.orientation!==t.viewportOptions.orientation)return console.debug("OHIFCornerstoneViewport: Rerender caused by: orientation change"),!1;if(e.viewportOptions.toolGroupId!==t.viewportOptions.toolGroupId)return console.debug("OHIFCornerstoneViewport: Rerender caused by: toolGroupId change"),!1;if(t.viewportOptions.viewportType&&e.viewportOptions.viewportType!==t.viewportOptions.viewportType)return console.debug("OHIFCornerstoneViewport: Rerender caused by: viewportType change"),!1;if(t.viewportOptions.needsRerendering)return console.debug("OHIFCornerstoneViewport: Rerender caused by: viewportOptions.needsRerendering"),!1;const n=e.displaySets,r=t.displaySets;if(n.length!==r.length)return console.debug("OHIFCornerstoneViewport: Rerender caused by: displaySets length mismatch"),!1;for(let e=0;e<n.length;e++){const t=n[e],i=r.find((e=>e.displaySetInstanceUID===t.displaySetInstanceUID));if(!i)return console.debug("OHIFCornerstoneViewport: Rerender caused by: displaySet not found"),!1;if(i.images?.length!==t.images?.length)return console.debug("OHIFCornerstoneViewport: Rerender caused by: images length mismatch"),!1;if(i.images?.length)for(let e=0;e<i.images.length;e++)if(i.images[e].imageId!==t.images[e].imageId)return console.debug("OHIFCornerstoneViewport: Rerender caused by: imageId mismatch"),!1}return!0}oe.displayName="OHIFCornerstoneViewport";const ce=oe}}]);
//# sourceMappingURL=9611.bundle.a426cd33c098139554b9.js.map