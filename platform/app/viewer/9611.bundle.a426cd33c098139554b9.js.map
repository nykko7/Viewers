{"version":3,"file":"9611.bundle.a426cd33c098139554b9.js","mappings":"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","sources":["webpack:///../../../extensions/cornerstone/src/Viewport/Overlays/ViewportImageScrollbar.tsx","webpack:///../../../extensions/cornerstone/src/Viewport/Overlays/ViewportOrientationMarkers.tsx","webpack:///../../../extensions/cornerstone/src/Viewport/Overlays/ViewportImageSliceLoadingIndicator.tsx","webpack:///../../../extensions/cornerstone/src/Viewport/Overlays/CornerstoneOverlays.tsx","webpack:///../../../extensions/cornerstone/src/components/CinePlayer/CinePlayer.tsx","webpack:///../../../extensions/cornerstone/src/components/CinePlayer/index.ts","webpack:///../../../extensions/cornerstone/src/components/OHIFViewportActionCorners.tsx","webpack:///../../../extensions/cornerstone/src/components/WindowLevelActionMenu/Colormap.tsx","webpack:///../../../extensions/cornerstone/src/components/WindowLevelActionMenu/Colorbar.tsx","webpack:///../../../extensions/cornerstone/src/components/WindowLevelActionMenu/WindowLevel.tsx","webpack:///../../../extensions/cornerstone/src/components/WindowLevelActionMenu/VolumeRenderingPresetsContent.tsx","webpack:///../../../extensions/cornerstone/src/components/WindowLevelActionMenu/VolumeRenderingPresets.tsx","webpack:///../../../extensions/cornerstone/src/components/WindowLevelActionMenu/VolumeRenderingQuality.tsx","webpack:///../../../extensions/cornerstone/src/components/WindowLevelActionMenu/VolumeShift.tsx","webpack:///../../../extensions/cornerstone/src/components/WindowLevelActionMenu/VolumeLighting.tsx","webpack:///../../../extensions/cornerstone/src/components/WindowLevelActionMenu/VolumeShade.tsx","webpack:///../../../extensions/cornerstone/src/components/WindowLevelActionMenu/VolumeRenderingOptions.tsx","webpack:///../../../extensions/cornerstone/src/components/WindowLevelActionMenu/WindowLevelActionMenu.tsx","webpack:///../../../extensions/cornerstone/src/components/WindowLevelActionMenu/getWindowLevelActionMenu.tsx","webpack:///../../../extensions/cornerstone/src/components/ViewportDataOverlaySettingMenu/ViewportSegmentationMenu.tsx","webpack:///../../../extensions/cornerstone/src/components/ViewportDataOverlaySettingMenu/ViewportSegmentationMenuWrapper.tsx","webpack:///../../../extensions/cornerstone/src/components/ViewportDataOverlaySettingMenu/index.tsx","webpack:///../../../extensions/cornerstone/src/utils/ActiveViewportBehavior.tsx","webpack:///../../../extensions/cornerstone/src/Viewport/OHIFCornerstoneViewport.tsx","webpack:///../../../extensions/cornerstone/src/utils/presentations/getViewportPresentations.ts"],"sourcesContent":["import React, { useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport { Enums, VolumeViewport3D, utilities as csUtils } from '@cornerstonejs/core';\nimport { ImageScrollbar } from '@ohif/ui';\n\nfunction CornerstoneImageScrollbar({\n  viewportData,\n  viewportId,\n  element,\n  imageSliceData,\n  setImageSliceData,\n  scrollbarHeight,\n  servicesManager,\n}: withAppTypes<{\n  element: HTMLElement;\n}>) {\n  const { cineService, cornerstoneViewportService } = servicesManager.services;\n\n  const onImageScrollbarChange = (imageIndex, viewportId) => {\n    const viewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\n\n    const { isCineEnabled } = cineService.getState();\n\n    if (isCineEnabled) {\n      // on image scrollbar change, stop the CINE if it is playing\n      cineService.stopClip(element, { viewportId });\n      cineService.setCine({ id: viewportId, isPlaying: false });\n    }\n\n    csUtils.jumpToSlice(viewport.element, {\n      imageIndex,\n      debounceLoading: true,\n    });\n  };\n\n  useEffect(() => {\n    if (!viewportData) {\n      return;\n    }\n\n    const viewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\n\n    if (!viewport || viewport instanceof VolumeViewport3D) {\n      return;\n    }\n\n    const imageIndex = viewport.getCurrentImageIdIndex();\n    const numberOfSlices = viewport.getNumberOfSlices();\n\n    setImageSliceData({\n      imageIndex: imageIndex,\n      numberOfSlices,\n    });\n  }, [viewportId, viewportData]);\n\n  useEffect(() => {\n    if (!viewportData) {\n      return;\n    }\n    const { viewportType } = viewportData;\n    const eventId =\n      (viewportType === Enums.ViewportType.STACK && Enums.Events.STACK_VIEWPORT_SCROLL) ||\n      (viewportType === Enums.ViewportType.ORTHOGRAPHIC && Enums.Events.VOLUME_NEW_IMAGE) ||\n      Enums.Events.IMAGE_RENDERED;\n\n    const updateIndex = event => {\n      const viewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\n      if (!viewport || viewport instanceof VolumeViewport3D) {\n        return;\n      }\n      const { imageIndex, newImageIdIndex = imageIndex } = event.detail;\n      const numberOfSlices = viewport.getNumberOfSlices();\n      // find the index of imageId in the imageIds\n      setImageSliceData({\n        imageIndex: newImageIdIndex,\n        numberOfSlices,\n      });\n    };\n\n    element.addEventListener(eventId, updateIndex);\n\n    return () => {\n      element.removeEventListener(eventId, updateIndex);\n    };\n  }, [viewportData, element]);\n\n  return (\n    <ImageScrollbar\n      onChange={evt => onImageScrollbarChange(evt, viewportId)}\n      max={imageSliceData.numberOfSlices ? imageSliceData.numberOfSlices - 1 : 0}\n      height={scrollbarHeight}\n      value={imageSliceData.imageIndex || 0}\n    />\n  );\n}\n\nCornerstoneImageScrollbar.propTypes = {\n  viewportData: PropTypes.object,\n  viewportId: PropTypes.string.isRequired,\n  element: PropTypes.instanceOf(Element),\n  scrollbarHeight: PropTypes.string,\n  imageSliceData: PropTypes.object.isRequired,\n  setImageSliceData: PropTypes.func.isRequired,\n  servicesManager: PropTypes.object.isRequired,\n};\n\nexport default CornerstoneImageScrollbar;\n","import React, { useEffect, useState, useMemo } from 'react';\nimport classNames from 'classnames';\nimport { metaData, Enums, Types, getEnabledElement } from '@cornerstonejs/core';\nimport { utilities } from '@cornerstonejs/tools';\nimport { vec3 } from 'gl-matrix';\n\nimport './ViewportOrientationMarkers.css';\n\nconst { getOrientationStringLPS, invertOrientationStringLPS } = utilities.orientation;\n\nfunction ViewportOrientationMarkers({\n  element,\n  viewportData,\n  imageSliceData,\n  viewportId,\n  servicesManager,\n  orientationMarkers = ['top', 'left'],\n}: withAppTypes) {\n  // Rotation is in degrees\n  const [rotation, setRotation] = useState(0);\n  const [flipHorizontal, setFlipHorizontal] = useState(false);\n  const [flipVertical, setFlipVertical] = useState(false);\n  const { cornerstoneViewportService } = servicesManager.services;\n\n  useEffect(() => {\n    const cameraModifiedListener = (evt: Types.EventTypes.CameraModifiedEvent) => {\n      const { previousCamera, camera } = evt.detail;\n\n      const { rotation } = camera;\n      if (rotation !== undefined) {\n        setRotation(rotation);\n      }\n\n      if (\n        camera.flipHorizontal !== undefined &&\n        previousCamera.flipHorizontal !== camera.flipHorizontal\n      ) {\n        setFlipHorizontal(camera.flipHorizontal);\n      }\n\n      if (\n        camera.flipVertical !== undefined &&\n        previousCamera.flipVertical !== camera.flipVertical\n      ) {\n        setFlipVertical(camera.flipVertical);\n      }\n    };\n\n    element.addEventListener(Enums.Events.CAMERA_MODIFIED, cameraModifiedListener);\n\n    return () => {\n      element.removeEventListener(Enums.Events.CAMERA_MODIFIED, cameraModifiedListener);\n    };\n  }, []);\n\n  const markers = useMemo(() => {\n    if (!viewportData) {\n      return '';\n    }\n\n    let rowCosines, columnCosines, isDefaultValueSetForRowCosine, isDefaultValueSetForColumnCosine;\n    if (viewportData.viewportType === 'stack') {\n      const imageIndex = imageSliceData.imageIndex;\n      const imageId = viewportData.data[0].imageIds?.[imageIndex];\n\n      // Workaround for below TODO stub\n      if (!imageId) {\n        return false;\n      }\n\n      ({\n        rowCosines,\n        columnCosines,\n        isDefaultValueSetForColumnCosine,\n        isDefaultValueSetForColumnCosine,\n      } = metaData.get('imagePlaneModule', imageId) || {});\n    } else {\n      if (!element || !getEnabledElement(element)) {\n        return '';\n      }\n\n      const { viewport } = getEnabledElement(element);\n      const { viewUp, viewPlaneNormal } = viewport.getCamera();\n\n      const viewRight = vec3.create();\n      vec3.cross(viewRight, viewUp, viewPlaneNormal);\n\n      columnCosines = [-viewUp[0], -viewUp[1], -viewUp[2]];\n      rowCosines = viewRight;\n    }\n\n    if (\n      !rowCosines ||\n      !columnCosines ||\n      rotation === undefined ||\n      isDefaultValueSetForRowCosine ||\n      isDefaultValueSetForColumnCosine\n    ) {\n      return '';\n    }\n\n    const markers = _getOrientationMarkers(\n      rowCosines,\n      columnCosines,\n      rotation,\n      flipVertical,\n      flipHorizontal\n    );\n\n    const ohifViewport = cornerstoneViewportService.getViewportInfo(viewportId);\n\n    if (!ohifViewport) {\n      console.log('ViewportOrientationMarkers::No viewport');\n      return null;\n    }\n\n    return orientationMarkers.map((m, index) => (\n      <div\n        className={classNames(\n          'overlay-text',\n          `${m}-mid orientation-marker`,\n          'text-aqua-pale',\n          'text-[13px]',\n          'leading-5'\n        )}\n        key={`${m}-mid orientation-marker`}\n      >\n        <div className=\"orientation-marker-value\">{markers[m]}</div>\n      </div>\n    ));\n  }, [\n    viewportData,\n    imageSliceData,\n    rotation,\n    flipVertical,\n    flipHorizontal,\n    orientationMarkers,\n    element,\n  ]);\n\n  return <div className=\"ViewportOrientationMarkers select-none\">{markers}</div>;\n}\n\n/**\n *\n * Computes the orientation labels on a Cornerstone-enabled Viewport element\n * when the viewport settings change (e.g. when a horizontal flip or a rotation occurs)\n *\n * @param {*} rowCosines\n * @param {*} columnCosines\n * @param {*} rotation in degrees\n * @returns\n */\nfunction _getOrientationMarkers(rowCosines, columnCosines, rotation, flipVertical, flipHorizontal) {\n  const rowString = getOrientationStringLPS(rowCosines);\n  const columnString = getOrientationStringLPS(columnCosines);\n  const oppositeRowString = invertOrientationStringLPS(rowString);\n  const oppositeColumnString = invertOrientationStringLPS(columnString);\n\n  const markers = {\n    top: oppositeColumnString,\n    left: oppositeRowString,\n    right: rowString,\n    bottom: columnString,\n  };\n\n  // If any vertical or horizontal flips are applied, change the orientation strings ahead of\n  // the rotation applications\n  if (flipVertical) {\n    markers.top = invertOrientationStringLPS(markers.top);\n    markers.bottom = invertOrientationStringLPS(markers.bottom);\n  }\n\n  if (flipHorizontal) {\n    markers.left = invertOrientationStringLPS(markers.left);\n    markers.right = invertOrientationStringLPS(markers.right);\n  }\n\n  // Swap the labels accordingly if the viewport has been rotated\n  // This could be done in a more complex way for intermediate rotation values (e.g. 45 degrees)\n  if (rotation === 90 || rotation === -270) {\n    return {\n      top: markers.left,\n      left: invertOrientationStringLPS(markers.top),\n      right: invertOrientationStringLPS(markers.bottom),\n      bottom: markers.right, // left\n    };\n  } else if (rotation === -90 || rotation === 270) {\n    return {\n      top: invertOrientationStringLPS(markers.left),\n      left: markers.top,\n      bottom: markers.left,\n      right: markers.bottom,\n    };\n  } else if (rotation === 180 || rotation === -180) {\n    return {\n      top: invertOrientationStringLPS(markers.top),\n      left: invertOrientationStringLPS(markers.left),\n      bottom: invertOrientationStringLPS(markers.bottom),\n      right: invertOrientationStringLPS(markers.right),\n    };\n  }\n\n  return markers;\n}\n\nexport default ViewportOrientationMarkers;\n","import React, { useEffect, useState, useRef } from 'react';\nimport PropTypes from 'prop-types';\nimport { Enums } from '@cornerstonejs/core';\n\nfunction ViewportImageSliceLoadingIndicator({ viewportData, element }) {\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(false);\n\n  const loadIndicatorRef = useRef(null);\n  const imageIdToBeLoaded = useRef(null);\n\n  const setLoadingState = evt => {\n    clearTimeout(loadIndicatorRef.current);\n\n    loadIndicatorRef.current = setTimeout(() => {\n      setLoading(true);\n    }, 50);\n  };\n\n  const setFinishLoadingState = evt => {\n    clearTimeout(loadIndicatorRef.current);\n\n    setLoading(false);\n  };\n\n  const setErrorState = evt => {\n    clearTimeout(loadIndicatorRef.current);\n\n    if (imageIdToBeLoaded.current === evt.detail.imageId) {\n      setError(evt.detail.error);\n      imageIdToBeLoaded.current = null;\n    }\n  };\n\n  useEffect(() => {\n    element.addEventListener(Enums.Events.STACK_VIEWPORT_SCROLL, setLoadingState);\n    element.addEventListener(Enums.Events.IMAGE_LOAD_ERROR, setErrorState);\n    element.addEventListener(Enums.Events.STACK_NEW_IMAGE, setFinishLoadingState);\n\n    return () => {\n      element.removeEventListener(Enums.Events.STACK_VIEWPORT_SCROLL, setLoadingState);\n\n      element.removeEventListener(Enums.Events.STACK_NEW_IMAGE, setFinishLoadingState);\n\n      element.removeEventListener(Enums.Events.IMAGE_LOAD_ERROR, setErrorState);\n    };\n  }, [element, viewportData]);\n\n  if (error) {\n    return (\n      <>\n        <div className=\"absolute top-0 left-0 h-full w-full bg-black opacity-50\">\n          <div className=\"transparent flex h-full w-full items-center justify-center\">\n            <p className=\"text-primary-light text-xl font-light\">\n              <h4>Error Loading Image</h4>\n              <p>An error has occurred.</p>\n              <p>{error}</p>\n            </p>\n          </div>\n        </div>\n      </>\n    );\n  }\n\n  if (loading) {\n    return (\n      // IMPORTANT: we need to use the pointer-events-none class to prevent the loading indicator from\n      // interacting with the mouse, since scrolling should propagate to the viewport underneath\n      <div className=\"pointer-events-none absolute top-0 left-0 h-full w-full bg-black opacity-50\">\n        <div className=\"transparent flex h-full w-full items-center justify-center\">\n          <p className=\"text-primary-light text-xl font-light\">Loading...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return null;\n}\n\nViewportImageSliceLoadingIndicator.propTypes = {\n  error: PropTypes.object,\n  element: PropTypes.object,\n};\n\nexport default ViewportImageSliceLoadingIndicator;\n","import React, { useEffect, useState } from 'react';\n\nimport ViewportImageScrollbar from './ViewportImageScrollbar';\nimport CustomizableViewportOverlay from './CustomizableViewportOverlay';\nimport ViewportOrientationMarkers from './ViewportOrientationMarkers';\nimport ViewportImageSliceLoadingIndicator from './ViewportImageSliceLoadingIndicator';\n\nfunction CornerstoneOverlays(props: withAppTypes) {\n  const { viewportId, element, scrollbarHeight, servicesManager } = props;\n  const { cornerstoneViewportService } = servicesManager.services;\n  const [imageSliceData, setImageSliceData] = useState({\n    imageIndex: 0,\n    numberOfSlices: 0,\n  });\n  const [viewportData, setViewportData] = useState(null);\n\n  useEffect(() => {\n    const { unsubscribe } = cornerstoneViewportService.subscribe(\n      cornerstoneViewportService.EVENTS.VIEWPORT_DATA_CHANGED,\n      props => {\n        if (props.viewportId !== viewportId) {\n          return;\n        }\n\n        setViewportData(props.viewportData);\n      }\n    );\n\n    return () => {\n      unsubscribe();\n    };\n  }, [viewportId]);\n\n  if (!element) {\n    return null;\n  }\n\n  if (viewportData) {\n    const viewportInfo = cornerstoneViewportService.getViewportInfo(viewportId);\n\n    if (viewportInfo?.viewportOptions?.customViewportProps?.hideOverlays) {\n      return null;\n    }\n  }\n\n  return (\n    <div className=\"noselect\">\n      <ViewportImageScrollbar\n        viewportId={viewportId}\n        viewportData={viewportData}\n        element={element}\n        imageSliceData={imageSliceData}\n        setImageSliceData={setImageSliceData}\n        scrollbarHeight={scrollbarHeight}\n        servicesManager={servicesManager}\n      />\n\n      <CustomizableViewportOverlay\n        imageSliceData={imageSliceData}\n        viewportData={viewportData}\n        viewportId={viewportId}\n        servicesManager={servicesManager}\n        element={element}\n      />\n\n      <ViewportImageSliceLoadingIndicator\n        viewportData={viewportData}\n        element={element}\n      />\n\n      <ViewportOrientationMarkers\n        imageSliceData={imageSliceData}\n        element={element}\n        viewportData={viewportData}\n        servicesManager={servicesManager}\n        viewportId={viewportId}\n      />\n    </div>\n  );\n}\n\nexport default CornerstoneOverlays;\n","import React, { useCallback, useEffect, useState, useRef } from 'react';\nimport { CinePlayer, useCine } from '@ohif/ui';\nimport { Enums, eventTarget, cache } from '@cornerstonejs/core';\nimport { useAppConfig } from '@state';\n\nfunction WrappedCinePlayer({\n  enabledVPElement,\n  viewportId,\n  servicesManager,\n}: withAppTypes<{\n  enabledVPElement: HTMLElement;\n  viewportId: string;\n}>) {\n  const { customizationService, displaySetService, viewportGridService } = servicesManager.services;\n  const [{ isCineEnabled, cines }, cineService] = useCine();\n  const [newStackFrameRate, setNewStackFrameRate] = useState(24);\n  const [dynamicInfo, setDynamicInfo] = useState(null);\n  const [appConfig] = useAppConfig();\n  const isMountedRef = useRef(null);\n\n  const cineHandler = () => {\n    if (!cines?.[viewportId] || !enabledVPElement) {\n      return;\n    }\n\n    const { isPlaying = false, frameRate = 24 } = cines[viewportId];\n    const validFrameRate = Math.max(frameRate, 1);\n\n    return isPlaying\n      ? cineService.playClip(enabledVPElement, { framesPerSecond: validFrameRate, viewportId })\n      : cineService.stopClip(enabledVPElement);\n  };\n\n  const newDisplaySetHandler = useCallback(() => {\n    if (!enabledVPElement || !isCineEnabled) {\n      return;\n    }\n\n    const { viewports } = viewportGridService.getState();\n    const { displaySetInstanceUIDs } = viewports.get(viewportId);\n    let frameRate = 24;\n    let isPlaying = cines[viewportId]?.isPlaying || false;\n    displaySetInstanceUIDs.forEach(displaySetInstanceUID => {\n      const displaySet = displaySetService.getDisplaySetByUID(displaySetInstanceUID);\n\n      if (displaySet.FrameRate) {\n        // displaySet.FrameRate corresponds to DICOM tag (0018,1063) which is defined as the the frame time in milliseconds\n        // So a bit of math to get the actual frame rate.\n        frameRate = Math.round(1000 / displaySet.FrameRate);\n        isPlaying ||= !!appConfig.autoPlayCine;\n      }\n\n      // check if the displaySet is dynamic and set the dynamic info\n      if (displaySet.isDynamicVolume) {\n        const { dynamicVolumeInfo } = displaySet;\n        const numTimePoints = dynamicVolumeInfo.timePoints.length;\n        const label = dynamicVolumeInfo.splittingTag;\n        const timePointIndex = dynamicVolumeInfo.timePointIndex || 0;\n        setDynamicInfo({\n          volumeId: displaySet.displaySetInstanceUID,\n          timePointIndex,\n          numTimePoints,\n          label,\n        });\n      } else {\n        setDynamicInfo(null);\n      }\n    });\n\n    if (isPlaying) {\n      cineService.setIsCineEnabled(isPlaying);\n    }\n    cineService.setCine({ id: viewportId, isPlaying, frameRate });\n    setNewStackFrameRate(frameRate);\n  }, [displaySetService, viewportId, viewportGridService, cines, isCineEnabled, enabledVPElement]);\n\n  useEffect(() => {\n    isMountedRef.current = true;\n\n    newDisplaySetHandler();\n\n    return () => {\n      isMountedRef.current = false;\n    };\n  }, [isCineEnabled, newDisplaySetHandler]);\n\n  useEffect(() => {\n    if (!isCineEnabled) {\n      return;\n    }\n\n    cineHandler();\n  }, [isCineEnabled, cineHandler, enabledVPElement]);\n\n  /**\n   * Use effect for handling new display set\n   */\n  useEffect(() => {\n    if (!enabledVPElement) {\n      return;\n    }\n\n    enabledVPElement.addEventListener(Enums.Events.VIEWPORT_NEW_IMAGE_SET, newDisplaySetHandler);\n    // this doesn't makes sense that we are listening to this event on viewport element\n    enabledVPElement.addEventListener(\n      Enums.Events.VOLUME_VIEWPORT_NEW_VOLUME,\n      newDisplaySetHandler\n    );\n\n    return () => {\n      cineService.setCine({ id: viewportId, isPlaying: false });\n\n      enabledVPElement.removeEventListener(\n        Enums.Events.VIEWPORT_NEW_IMAGE_SET,\n        newDisplaySetHandler\n      );\n      enabledVPElement.removeEventListener(\n        Enums.Events.VOLUME_VIEWPORT_NEW_VOLUME,\n        newDisplaySetHandler\n      );\n    };\n  }, [enabledVPElement, newDisplaySetHandler, viewportId]);\n\n  useEffect(() => {\n    if (!cines || !cines[viewportId] || !enabledVPElement || !isMountedRef.current) {\n      return;\n    }\n\n    cineHandler();\n\n    return () => {\n      cineService.stopClip(enabledVPElement, { viewportId });\n    };\n  }, [cines, viewportId, cineService, enabledVPElement, cineHandler]);\n\n  if (!isCineEnabled) {\n    return null;\n  }\n\n  const cine = cines[viewportId];\n  const isPlaying = cine?.isPlaying || false;\n\n  return (\n    <RenderCinePlayer\n      viewportId={viewportId}\n      cineService={cineService}\n      newStackFrameRate={newStackFrameRate}\n      isPlaying={isPlaying}\n      dynamicInfo={dynamicInfo}\n      customizationService={customizationService}\n    />\n  );\n}\n\nfunction RenderCinePlayer({\n  viewportId,\n  cineService,\n  newStackFrameRate,\n  isPlaying,\n  dynamicInfo: dynamicInfoProp,\n  customizationService,\n}) {\n  const { component: CinePlayerComponent = CinePlayer } =\n    customizationService.get('cinePlayer') ?? {};\n\n  const [dynamicInfo, setDynamicInfo] = useState(dynamicInfoProp);\n\n  useEffect(() => {\n    setDynamicInfo(dynamicInfoProp);\n  }, [dynamicInfoProp]);\n\n  /**\n   * Use effect for handling 4D time index changed\n   */\n  useEffect(() => {\n    if (!dynamicInfo) {\n      return;\n    }\n\n    const handleTimePointIndexChange = evt => {\n      const { volumeId, timePointIndex, numTimePoints, splittingTag } = evt.detail;\n      setDynamicInfo({ volumeId, timePointIndex, numTimePoints, label: splittingTag });\n    };\n\n    eventTarget.addEventListener(\n      Enums.Events.DYNAMIC_VOLUME_TIME_POINT_INDEX_CHANGED,\n      handleTimePointIndexChange\n    );\n\n    return () => {\n      eventTarget.removeEventListener(\n        Enums.Events.DYNAMIC_VOLUME_TIME_POINT_INDEX_CHANGED,\n        handleTimePointIndexChange\n      );\n    };\n  }, [dynamicInfo]);\n\n  useEffect(() => {\n    if (!dynamicInfo) {\n      return;\n    }\n\n    const { volumeId, timePointIndex, numTimePoints, splittingTag } = dynamicInfo || {};\n    const volume = cache.getVolume(volumeId, true);\n    volume.timePointIndex = timePointIndex;\n\n    setDynamicInfo({ volumeId, timePointIndex, numTimePoints, label: splittingTag });\n  }, []);\n\n  const updateDynamicInfo = useCallback(props => {\n    const { volumeId, timePointIndex } = props;\n    const volume = cache.getVolume(volumeId, true);\n    volume.timePointIndex = timePointIndex;\n  }, []);\n\n  return (\n    <CinePlayerComponent\n      className=\"absolute left-1/2 bottom-3 -translate-x-1/2\"\n      frameRate={newStackFrameRate}\n      isPlaying={isPlaying}\n      onClose={() => {\n        // also stop the clip\n        cineService.setCine({\n          id: viewportId,\n          isPlaying: false,\n        });\n        cineService.setIsCineEnabled(false);\n        cineService.setViewportCineClosed(viewportId);\n      }}\n      onPlayPauseChange={isPlaying => {\n        cineService.setCine({\n          id: viewportId,\n          isPlaying,\n        });\n      }}\n      onFrameRateChange={frameRate =>\n        cineService.setCine({\n          id: viewportId,\n          frameRate,\n        })\n      }\n      dynamicInfo={dynamicInfo}\n      updateDynamicInfo={updateDynamicInfo}\n    />\n  );\n}\n\nexport default WrappedCinePlayer;\n","import CinePlayer from './CinePlayer';\n\nexport default CinePlayer;\n","import React from 'react';\nimport { useViewportActionCornersContext } from '../contextProviders/ViewportActionCornersProvider';\nimport { ViewportActionCorners } from '@ohif/ui';\n\nexport type OHIFViewportActionCornersProps = {\n  viewportId: string;\n};\n\nfunction OHIFViewportActionCorners({ viewportId }: OHIFViewportActionCornersProps) {\n  const [viewportActionCornersState] = useViewportActionCornersContext();\n\n  if (!viewportActionCornersState[viewportId]) {\n    return null;\n  }\n\n  return (\n    <ViewportActionCorners\n      cornerComponents={viewportActionCornersState[viewportId]}\n    ></ViewportActionCorners>\n  );\n}\n\nexport default OHIFViewportActionCorners;\n","import React, { ReactElement, useCallback, useEffect, useRef, useState, useMemo } from 'react';\nimport { AllInOneMenu, ButtonGroup, SwitchButton } from '@ohif/ui';\nimport { StackViewport, Types } from '@cornerstonejs/core';\nimport { ColormapProps } from '../../types/Colormap';\n\nexport function Colormap({\n  colormaps,\n  viewportId,\n  displaySets,\n  commandsManager,\n  servicesManager,\n}: ColormapProps): ReactElement {\n  const { cornerstoneViewportService } = servicesManager.services;\n\n  const [activeDisplaySet, setActiveDisplaySet] = useState(displaySets[0]);\n\n  const [showPreview, setShowPreview] = useState(false);\n  const [prePreviewColormap, setPrePreviewColormap] = useState(null);\n\n  const showPreviewRef = useRef(showPreview);\n  showPreviewRef.current = showPreview;\n  const prePreviewColormapRef = useRef(prePreviewColormap);\n  prePreviewColormapRef.current = prePreviewColormap;\n  const activeDisplaySetRef = useRef(activeDisplaySet);\n  activeDisplaySetRef.current = activeDisplaySet;\n\n  const onSetColorLUT = useCallback(\n    props => {\n      // TODO: Better way to check if it's a fusion\n      const oneOpacityColormaps = ['Grayscale', 'X Ray'];\n      const opacity =\n        displaySets.length > 1 && !oneOpacityColormaps.includes(props.colormap.name) ? 0.5 : 1;\n      commandsManager.run({\n        commandName: 'setViewportColormap',\n        commandOptions: {\n          ...props,\n          opacity,\n          immediate: true,\n        },\n        context: 'CORNERSTONE',\n      });\n    },\n    [commandsManager]\n  );\n\n  const getViewportColormap = (viewportId, displaySet) => {\n    const { displaySetInstanceUID } = displaySet;\n    const viewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\n    if (viewport instanceof StackViewport) {\n      const { colormap } = viewport.getProperties();\n      if (!colormap) {\n        return colormaps.find(c => c.Name === 'Grayscale') || colormaps[0];\n      }\n      return colormap;\n    }\n    const actorEntries = viewport.getActors();\n    const actorEntry = actorEntries?.find(entry =>\n      entry.referencedId.includes(displaySetInstanceUID)\n    );\n    const { colormap } = (viewport as Types.IVolumeViewport).getProperties(actorEntry.referencedId);\n    if (!colormap) {\n      return colormaps.find(c => c.Name === 'Grayscale') || colormaps[0];\n    }\n    return colormap;\n  };\n\n  const buttons = useMemo(() => {\n    return displaySets.map((displaySet, index) => ({\n      children: displaySet.Modality,\n      key: index,\n      style: {\n        minWidth: `calc(100% / ${displaySets.length})`,\n        fontSize: '0.8rem',\n        textAlign: 'center',\n        display: 'flex',\n        justifyContent: 'center',\n        alignItems: 'center',\n      },\n    }));\n  }, [displaySets]);\n\n  useEffect(() => {\n    setActiveDisplaySet(displaySets[displaySets.length - 1]);\n  }, [displaySets]);\n\n  return (\n    <>\n      {buttons.length > 1 && (\n        <div className=\"all-in-one-menu-item flex w-full justify-center\">\n          <ButtonGroup\n            onActiveIndexChange={index => {\n              setActiveDisplaySet(displaySets[index]);\n              setPrePreviewColormap(null);\n            }}\n            activeIndex={\n              displaySets.findIndex(\n                ds => ds.displaySetInstanceUID === activeDisplaySetRef.current.displaySetInstanceUID\n              ) || 1\n            }\n            className=\"w-[70%] text-[10px]\"\n          >\n            {buttons.map(({ children, key, style }) => (\n              <div\n                key={key}\n                style={style}\n              >\n                {children}\n              </div>\n            ))}\n          </ButtonGroup>\n        </div>\n      )}\n      <div className=\"all-in-one-menu-item flex w-full justify-center\">\n        <SwitchButton\n          label=\"Preview in viewport\"\n          checked={showPreview}\n          onChange={checked => {\n            setShowPreview(checked);\n          }}\n        />\n      </div>\n      <AllInOneMenu.DividerItem />\n      <AllInOneMenu.ItemPanel>\n        {colormaps.map((colormap, index) => (\n          <AllInOneMenu.Item\n            key={index}\n            label={colormap.description}\n            onClick={() => {\n              onSetColorLUT({\n                viewportId,\n                colormap,\n                displaySetInstanceUID: activeDisplaySetRef.current.displaySetInstanceUID,\n              });\n              setPrePreviewColormap(null);\n            }}\n            onMouseEnter={() => {\n              if (showPreviewRef.current) {\n                setPrePreviewColormap(getViewportColormap(viewportId, activeDisplaySetRef.current));\n                onSetColorLUT({\n                  viewportId,\n                  colormap,\n                  displaySetInstanceUID: activeDisplaySetRef.current.displaySetInstanceUID,\n                });\n              }\n            }}\n            onMouseLeave={() => {\n              if (showPreviewRef.current && prePreviewColormapRef.current) {\n                onSetColorLUT({\n                  viewportId,\n                  colormap: prePreviewColormapRef.current,\n                  displaySetInstanceUID: activeDisplaySetRef.current.displaySetInstanceUID,\n                });\n              }\n            }}\n          ></AllInOneMenu.Item>\n        ))}\n      </AllInOneMenu.ItemPanel>\n    </>\n  );\n}\n","import React, { ReactElement, useCallback, useEffect, useState } from 'react';\nimport { SwitchButton } from '@ohif/ui';\nimport { StackViewport, VolumeViewport } from '@cornerstonejs/core';\nimport { ColorbarProps } from '../../types/Colorbar';\nimport { utilities } from '@cornerstonejs/core';\n\nexport function setViewportColorbar(\n  viewportId,\n  displaySets,\n  commandsManager,\n  servicesManager: AppTypes.ServicesManager,\n  colorbarOptions\n) {\n  const { cornerstoneViewportService } = servicesManager.services;\n  const viewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\n\n  const viewportInfo = cornerstoneViewportService.getViewportInfo(viewportId);\n  const backgroundColor = viewportInfo.getViewportOptions().background;\n  const isLight = backgroundColor ? utilities.isEqual(backgroundColor, [1, 1, 1]) : false;\n\n  if (isLight) {\n    colorbarOptions.ticks = {\n      position: 'left',\n      style: {\n        font: '12px Arial',\n        color: '#000000',\n        maxNumTicks: 8,\n        tickSize: 5,\n        tickWidth: 1,\n        labelMargin: 3,\n      },\n    };\n  }\n\n  const displaySetInstanceUIDs = [];\n\n  if (viewport instanceof StackViewport) {\n    displaySetInstanceUIDs.push(viewportId);\n  }\n\n  if (viewport instanceof VolumeViewport) {\n    displaySets.forEach(ds => {\n      displaySetInstanceUIDs.push(ds.displaySetInstanceUID);\n    });\n  }\n\n  commandsManager.run({\n    commandName: 'toggleViewportColorbar',\n    commandOptions: {\n      viewportId,\n      options: colorbarOptions,\n      displaySetInstanceUIDs,\n    },\n    context: 'CORNERSTONE',\n  });\n}\n\nexport function Colorbar({\n  viewportId,\n  displaySets,\n  commandsManager,\n  servicesManager,\n  colorbarProperties,\n}: withAppTypes<ColorbarProps>): ReactElement {\n  const { colorbarService } = servicesManager.services;\n  const {\n    width: colorbarWidth,\n    colorbarTickPosition,\n    colorbarContainerPosition,\n    colormaps,\n    colorbarInitialColormap,\n  } = colorbarProperties;\n  const [showColorbar, setShowColorbar] = useState(colorbarService.hasColorbar(viewportId));\n\n  const onSetColorbar = useCallback(() => {\n    setViewportColorbar(viewportId, displaySets, commandsManager, servicesManager, {\n      viewportId,\n      colormaps,\n      ticks: {\n        position: colorbarTickPosition,\n      },\n      width: colorbarWidth,\n      position: colorbarContainerPosition,\n      activeColormapName: colorbarInitialColormap,\n    });\n  }, [commandsManager]);\n\n  useEffect(() => {\n    const updateColorbarState = () => {\n      setShowColorbar(colorbarService.hasColorbar(viewportId));\n    };\n\n    const { unsubscribe } = colorbarService.subscribe(\n      colorbarService.EVENTS.STATE_CHANGED,\n      updateColorbarState\n    );\n\n    return () => {\n      unsubscribe();\n    };\n  }, [viewportId]);\n\n  return (\n    <div className=\"all-in-one-menu-item flex w-full justify-center\">\n      <div className=\"mr-2 w-[28px]\"></div>\n      <SwitchButton\n        label=\"Display Color bar\"\n        checked={showColorbar}\n        onChange={() => {\n          onSetColorbar();\n        }}\n      />\n    </div>\n  );\n}\n","import React, { ReactElement, useCallback } from 'react';\nimport { AllInOneMenu } from '@ohif/ui';\nimport { WindowLevelPreset } from '../../types/WindowLevel';\nimport { CommandsManager } from '@ohif/core';\nimport { useTranslation } from 'react-i18next';\n\nexport type WindowLevelProps = {\n  viewportId: string;\n  presets: Array<Record<string, Array<WindowLevelPreset>>>;\n  commandsManager: CommandsManager;\n};\n\nexport function WindowLevel({\n  viewportId,\n  commandsManager,\n  presets,\n}: WindowLevelProps): ReactElement {\n  const { t } = useTranslation('WindowLevelActionMenu');\n\n  const onSetWindowLevel = useCallback(\n    props => {\n      commandsManager.run({\n        commandName: 'setViewportWindowLevel',\n        commandOptions: {\n          ...props,\n          viewportId,\n        },\n        context: 'CORNERSTONE',\n      });\n    },\n    [commandsManager, viewportId]\n  );\n\n  return (\n    <AllInOneMenu.ItemPanel>\n      {presets.map((modalityPresets, modalityIndex) => (\n        <React.Fragment key={modalityIndex}>\n          {Object.entries(modalityPresets).map(([modality, presetsArray]) => (\n            <React.Fragment key={modality}>\n              <AllInOneMenu.HeaderItem>\n                {t('Modality Presets', { modality })}\n              </AllInOneMenu.HeaderItem>\n              {presetsArray.map((preset, index) => (\n                <AllInOneMenu.Item\n                  key={`${modality}-${index}`}\n                  label={preset.description}\n                  secondaryLabel={`${preset.window} / ${preset.level}`}\n                  onClick={() => onSetWindowLevel(preset)}\n                />\n              ))}\n            </React.Fragment>\n          ))}\n        </React.Fragment>\n      ))}\n    </AllInOneMenu.ItemPanel>\n  );\n}\n","import { Icon } from '@ohif/ui';\nimport { ButtonEnums } from '@ohif/ui';\nimport React, { ReactElement, useState, useCallback } from 'react';\nimport { Button, InputFilterText } from '@ohif/ui';\nimport { ViewportPreset, VolumeRenderingPresetsContentProps } from '../../types/ViewportPresets';\n\nexport function VolumeRenderingPresetsContent({\n  presets,\n  viewportId,\n  commandsManager,\n  onClose,\n}: VolumeRenderingPresetsContentProps): ReactElement {\n  const [filteredPresets, setFilteredPresets] = useState(presets);\n  const [searchValue, setSearchValue] = useState('');\n  const [selectedPreset, setSelectedPreset] = useState<ViewportPreset | null>(null);\n\n  const handleSearchChange = useCallback(\n    (value: string) => {\n      setSearchValue(value);\n      const filtered = value\n        ? presets.filter(preset => preset.name.toLowerCase().includes(value.toLowerCase()))\n        : presets;\n      setFilteredPresets(filtered);\n    },\n    [presets]\n  );\n\n  const handleApply = useCallback(\n    props => {\n      commandsManager.runCommand('setViewportPreset', {\n        ...props,\n      });\n    },\n    [commandsManager]\n  );\n\n  const formatLabel = (label: string, maxChars: number) => {\n    return label.length > maxChars ? `${label.slice(0, maxChars)}...` : label;\n  };\n\n  return (\n    <div className=\"flex min-h-full w-full flex-col justify-between\">\n      <div className=\"border-secondary-light h-[433px] w-full overflow-hidden rounded border bg-black px-2.5\">\n        <div className=\"flex h-[46px] w-full items-center justify-start\">\n          <div className=\"h-[26px] w-[200px]\">\n            <InputFilterText\n              value={searchValue}\n              onDebounceChange={handleSearchChange}\n              placeholder={'Search all'}\n            />\n          </div>\n        </div>\n        <div className=\"ohif-scrollbar overflow h-[385px] w-full overflow-y-auto\">\n          <div className=\"grid grid-cols-4 gap-3 pt-2 pr-3\">\n            {filteredPresets.map((preset, index) => (\n              <div\n                key={index}\n                className=\"flex cursor-pointer flex-col items-start\"\n                onClick={() => {\n                  setSelectedPreset(preset);\n                  handleApply({ preset: preset.name, viewportId });\n                }}\n              >\n                <Icon\n                  name={preset.name}\n                  className={\n                    selectedPreset?.name === preset.name\n                      ? 'border-primary-light h-[75px] w-[95px] max-w-none rounded border-2'\n                      : 'hover:border-primary-light h-[75px] w-[95px] max-w-none rounded border-2 border-black'\n                  }\n                />\n                <label className=\"text-aqua-pale mt-2 text-left text-xs\">\n                  {formatLabel(preset.name, 11)}\n                </label>\n              </div>\n            ))}\n          </div>\n        </div>\n      </div>\n      <footer className=\"flex h-[60px] w-full items-center justify-end\">\n        <div className=\"flex\">\n          <Button\n            name=\"Cancel\"\n            size={ButtonEnums.size.medium}\n            type={ButtonEnums.type.secondary}\n            onClick={onClose}\n          >\n            {' '}\n            Cancel{' '}\n          </Button>\n        </div>\n      </footer>\n    </div>\n  );\n}\n","import { AllInOneMenu, Icon } from '@ohif/ui';\nimport React, { ReactElement } from 'react';\nimport { VolumeRenderingPresetsProps } from '../../types/ViewportPresets';\nimport { VolumeRenderingPresetsContent } from './VolumeRenderingPresetsContent';\n\nexport function VolumeRenderingPresets({\n  viewportId,\n  servicesManager,\n  commandsManager,\n  volumeRenderingPresets,\n}: VolumeRenderingPresetsProps): ReactElement {\n  const { uiModalService } = servicesManager.services;\n\n  const onClickPresets = () => {\n    uiModalService.show({\n      content: VolumeRenderingPresetsContent,\n      title: 'Rendering Presets',\n      movable: true,\n      contentProps: {\n        onClose: uiModalService.hide,\n        presets: volumeRenderingPresets,\n        viewportId,\n        commandsManager,\n      },\n      containerDimensions: 'h-[543px] w-[460px]',\n      contentDimensions: 'h-[493px] w-[460px]  pl-[12px] pr-[12px]',\n    });\n  };\n\n  return (\n    <AllInOneMenu.Item\n      label=\"Rendering Presets\"\n      icon={<Icon name=\"VolumeRendering\" />}\n      rightIcon={<Icon name=\"action-new-dialog\" />}\n      onClick={onClickPresets}\n    />\n  );\n}\n","import React, { ReactElement, useCallback, useState, useEffect } from 'react';\nimport { VolumeRenderingQualityProps } from '../../types/ViewportPresets';\n\nexport function VolumeRenderingQuality({\n  volumeRenderingQualityRange,\n  commandsManager,\n  servicesManager,\n  viewportId,\n}: VolumeRenderingQualityProps): ReactElement {\n  const { cornerstoneViewportService } = servicesManager.services;\n  const { min, max, step } = volumeRenderingQualityRange;\n  const [quality, setQuality] = useState(null);\n\n  const onChange = useCallback(\n    (value: number) => {\n      commandsManager.runCommand('setVolumeRenderingQulaity', {\n        viewportId,\n        volumeQuality: value,\n      });\n      setQuality(value);\n    },\n    [commandsManager, viewportId]\n  );\n\n  const calculateBackground = value => {\n    const percentage = ((value - 0) / (1 - 0)) * 100;\n    return `linear-gradient(to right, #5acce6 0%, #5acce6 ${percentage}%, #3a3f99 ${percentage}%, #3a3f99 100%)`;\n  };\n\n  useEffect(() => {\n    const viewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\n    const { actor } = viewport.getActors()[0];\n    const mapper = actor.getMapper();\n    const image = mapper.getInputData();\n    const spacing = image.getSpacing();\n    const sampleDistance = mapper.getSampleDistance();\n    const averageSpacing = spacing.reduce((a, b) => a + b) / 3.0;\n    if (sampleDistance === averageSpacing) {\n      setQuality(1);\n    } else {\n      setQuality(Math.sqrt(averageSpacing / (sampleDistance * 0.5)));\n    }\n  }, [cornerstoneViewportService, viewportId]);\n  return (\n    <>\n      <div className=\"all-in-one-menu-item flex  w-full flex-row !items-center justify-between gap-[10px]\">\n        <label\n          className=\"block text-white\"\n          htmlFor=\"volume\"\n        >\n          Quality\n        </label>\n        {quality !== null && (\n          <input\n            className=\"bg-inputfield-main h-2 w-[120px] cursor-pointer appearance-none rounded-lg\"\n            value={quality}\n            id=\"volume\"\n            max={max}\n            min={min}\n            type=\"range\"\n            step={step}\n            onChange={e => onChange(parseInt(e.target.value, 10))}\n            style={{\n              background: calculateBackground((quality - min) / (max - min)),\n              '--thumb-inner-color': '#5acce6',\n              '--thumb-outer-color': '#090c29',\n            }}\n          />\n        )}\n      </div>\n    </>\n  );\n}\n","import React, { ReactElement, useCallback, useEffect, useState, useRef } from 'react';\nimport { VolumeShiftProps } from '../../types/ViewportPresets';\n\nexport function VolumeShift({\n  viewportId,\n  commandsManager,\n  servicesManager,\n}: VolumeShiftProps): ReactElement {\n  const { cornerstoneViewportService } = servicesManager.services;\n  const [minShift, setMinShift] = useState<number | null>(null);\n  const [maxShift, setMaxShift] = useState<number | null>(null);\n  const [shift, setShift] = useState<number | null>(\n    cornerstoneViewportService.getCornerstoneViewport(viewportId)?.shiftedBy || 0\n  );\n  const [step, setStep] = useState<number | null>(null);\n  const [isBlocking, setIsBlocking] = useState(false);\n\n  const prevShiftRef = useRef<number>(shift);\n\n  const viewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\n  const { actor } = viewport.getActors()[0];\n  const ofun = actor.getProperty().getScalarOpacity(0);\n\n  useEffect(() => {\n    if (isBlocking) {\n      return;\n    }\n    const range = ofun.getRange();\n\n    const transferFunctionWidth = range[1] - range[0];\n\n    const minShift = -transferFunctionWidth;\n    const maxShift = transferFunctionWidth;\n\n    setMinShift(minShift);\n    setMaxShift(maxShift);\n    setStep(Math.pow(10, Math.floor(Math.log10(transferFunctionWidth / 500))));\n  }, [cornerstoneViewportService, viewportId, actor, ofun, isBlocking]);\n\n  const onChangeRange = useCallback(\n    newShift => {\n      const shiftDifference = newShift - prevShiftRef.current;\n      prevShiftRef.current = newShift;\n      viewport.shiftedBy = newShift;\n      commandsManager.runCommand('shiftVolumeOpacityPoints', {\n        viewportId,\n        shift: shiftDifference,\n      });\n    },\n    [commandsManager, viewportId, viewport]\n  );\n\n  const calculateBackground = value => {\n    const percentage = ((value - 0) / (1 - 0)) * 100;\n    return `linear-gradient(to right, #5acce6 0%, #5acce6 ${percentage}%, #3a3f99 ${percentage}%, #3a3f99 100%)`;\n  };\n\n  return (\n    <>\n      <div className=\"all-in-one-menu-item flex  w-full flex-row !items-center justify-between gap-[10px]\">\n        <label\n          className=\"block  text-white\"\n          htmlFor=\"shift\"\n        >\n          Shift\n        </label>\n        {step !== null && (\n          <input\n            className=\"bg-inputfield-main h-2 w-[120px] cursor-pointer appearance-none rounded-lg\"\n            value={shift}\n            onChange={e => {\n              const shiftValue = parseInt(e.target.value, 10);\n              setShift(shiftValue);\n              onChangeRange(shiftValue);\n            }}\n            id=\"shift\"\n            onMouseDown={() => setIsBlocking(true)}\n            onMouseUp={() => setIsBlocking(false)}\n            max={maxShift}\n            min={minShift}\n            type=\"range\"\n            step={step}\n            style={{\n              background: calculateBackground((shift - minShift) / (maxShift - minShift)),\n              '--thumb-inner-color': '#5acce6',\n              '--thumb-outer-color': '#090c29',\n            }}\n          />\n        )}\n      </div>\n    </>\n  );\n}\n","import React, { ReactElement, useState, useEffect, useCallback } from 'react';\nimport { VolumeLightingProps } from '../../types/ViewportPresets';\n\nexport function VolumeLighting({\n  servicesManager,\n  commandsManager,\n  viewportId,\n}: VolumeLightingProps): ReactElement {\n  const { cornerstoneViewportService } = servicesManager.services;\n  const [ambient, setAmbient] = useState(null);\n  const [diffuse, setDiffuse] = useState(null);\n  const [specular, setSpecular] = useState(null);\n\n  const onAmbientChange = useCallback(() => {\n    commandsManager.runCommand('setVolumeLighting', { viewportId, options: { ambient } });\n  }, [ambient, commandsManager, viewportId]);\n\n  const onDiffuseChange = useCallback(() => {\n    commandsManager.runCommand('setVolumeLighting', { viewportId, options: { diffuse } });\n  }, [diffuse, commandsManager, viewportId]);\n\n  const onSpecularChange = useCallback(() => {\n    commandsManager.runCommand('setVolumeLighting', { viewportId, options: { specular } });\n  }, [specular, commandsManager, viewportId]);\n\n  const calculateBackground = value => {\n    const percentage = ((value - 0) / (1 - 0)) * 100;\n    return `linear-gradient(to right, #5acce6 0%, #5acce6 ${percentage}%, #3a3f99 ${percentage}%, #3a3f99 100%)`;\n  };\n\n  useEffect(() => {\n    const viewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\n    const { actor } = viewport.getActors()[0];\n    const ambient = actor.getProperty().getAmbient();\n    const diffuse = actor.getProperty().getDiffuse();\n    const specular = actor.getProperty().getSpecular();\n    setAmbient(ambient);\n    setDiffuse(diffuse);\n    setSpecular(specular);\n  }, [viewportId, cornerstoneViewportService]);\n  return (\n    <>\n      <div className=\"all-in-one-menu-item flex  w-full flex-row !items-center justify-between gap-[10px]\">\n        <label\n          className=\"block  text-white\"\n          htmlFor=\"ambient\"\n        >\n          Ambient\n        </label>\n        {ambient !== null && (\n          <input\n            className=\"bg-inputfield-main h-2 w-[120px] cursor-pointer appearance-none rounded-lg\"\n            value={ambient}\n            onChange={e => {\n              setAmbient(e.target.value);\n              onAmbientChange();\n            }}\n            id=\"ambient\"\n            max={1}\n            min={0}\n            type=\"range\"\n            step={0.1}\n            style={{\n              background: calculateBackground(ambient),\n              '--thumb-inner-color': '#5acce6',\n              '--thumb-outer-color': '#090c29',\n            }}\n          />\n        )}\n      </div>\n      <div className=\"all-in-one-menu-item flex  w-full flex-row !items-center justify-between gap-[10px]\">\n        <label\n          className=\"block  text-white\"\n          htmlFor=\"diffuse\"\n        >\n          Diffuse\n        </label>\n        {diffuse !== null && (\n          <input\n            className=\"bg-inputfield-main h-2 w-[120px] cursor-pointer appearance-none rounded-lg\"\n            value={diffuse}\n            onChange={e => {\n              setDiffuse(e.target.value);\n              onDiffuseChange();\n            }}\n            id=\"diffuse\"\n            max={1}\n            min={0}\n            type=\"range\"\n            step={0.1}\n            style={{\n              background: calculateBackground(diffuse),\n              '--thumb-inner-color': '#5acce6',\n              '--thumb-outer-color': '#090c29',\n            }}\n          />\n        )}\n      </div>\n\n      <div className=\"all-in-one-menu-item flex  w-full flex-row !items-center justify-between gap-[10px]\">\n        <label\n          className=\"block  text-white\"\n          htmlFor=\"specular\"\n        >\n          Specular\n        </label>\n        {specular !== null && (\n          <input\n            className=\"bg-inputfield-main h-2 w-[120px] cursor-pointer appearance-none rounded-lg\"\n            value={specular}\n            onChange={e => {\n              setSpecular(e.target.value);\n              onSpecularChange();\n            }}\n            id=\"specular\"\n            max={1}\n            min={0}\n            type=\"range\"\n            step={0.1}\n            style={{\n              background: calculateBackground(specular),\n              '--thumb-inner-color': '#5acce6',\n              '--thumb-outer-color': '#090c29',\n            }}\n          />\n        )}\n      </div>\n    </>\n  );\n}\n","import React, { ReactElement, useCallback, useEffect, useState } from 'react';\nimport { SwitchButton } from '@ohif/ui';\nimport { VolumeShadeProps } from '../../types/ViewportPresets';\n\nexport function VolumeShade({\n  commandsManager,\n  viewportId,\n  servicesManager,\n}: VolumeShadeProps): ReactElement {\n  const { cornerstoneViewportService } = servicesManager.services;\n  const [shade, setShade] = useState(true);\n  const [key, setKey] = useState(0);\n\n  const onShadeChange = useCallback(\n    (checked: boolean) => {\n      commandsManager.runCommand('setVolumeLighting', { viewportId, options: { shade: checked } });\n    },\n    [commandsManager, viewportId]\n  );\n  useEffect(() => {\n    const viewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\n    const { actor } = viewport.getActors()[0];\n    const shade = actor.getProperty().getShade();\n    setShade(shade);\n    setKey(key + 1);\n  }, [viewportId, cornerstoneViewportService]);\n\n  return (\n    <SwitchButton\n      key={key}\n      label=\"Shade\"\n      checked={shade}\n      onChange={() => {\n        setShade(!shade);\n        onShadeChange(!shade);\n      }}\n    />\n  );\n}\n","import React, { ReactElement } from 'react';\nimport { AllInOneMenu } from '@ohif/ui';\nimport { VolumeRenderingOptionsProps } from '../../types/ViewportPresets';\nimport { VolumeRenderingQuality } from './VolumeRenderingQuality';\nimport { VolumeShift } from './VolumeShift';\nimport { VolumeLighting } from './VolumeLighting';\nimport { VolumeShade } from './VolumeShade';\nexport function VolumeRenderingOptions({\n  viewportId,\n  commandsManager,\n  volumeRenderingQualityRange,\n  servicesManager,\n}: VolumeRenderingOptionsProps): ReactElement {\n  return (\n    <AllInOneMenu.ItemPanel>\n      <VolumeRenderingQuality\n        viewportId={viewportId}\n        commandsManager={commandsManager}\n        servicesManager={servicesManager}\n        volumeRenderingQualityRange={volumeRenderingQualityRange}\n      />\n\n      <VolumeShift\n        viewportId={viewportId}\n        commandsManager={commandsManager}\n        servicesManager={servicesManager}\n      />\n      <div className=\"all-in-one-menu-item mt-2 flex !h-[20px] w-full justify-start\">\n        <div className=\"text-aqua-pale text-[13px]\">LIGHTING</div>\n      </div>\n      <div className=\"bg-primary-dark mt-1 mb-1 h-[2px] w-full\"></div>\n      <div className=\"all-in-one-menu-item flex w-full justify-center\">\n        <VolumeShade\n          commandsManager={commandsManager}\n          servicesManager={servicesManager}\n          viewportId={viewportId}\n        />\n      </div>\n      <VolumeLighting\n        viewportId={viewportId}\n        commandsManager={commandsManager}\n        servicesManager={servicesManager}\n      />\n    </AllInOneMenu.ItemPanel>\n  );\n}\n","import React, { ReactElement, useCallback, useEffect, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport classNames from 'classnames';\nimport { AllInOneMenu, useViewportGrid } from '@ohif/ui';\nimport { Colormap } from './Colormap';\nimport { Colorbar } from './Colorbar';\nimport { setViewportColorbar } from './Colorbar';\nimport { WindowLevelPreset } from '../../types/WindowLevel';\nimport { ColorbarProperties } from '../../types/Colorbar';\nimport { VolumeRenderingQualityRange } from '../../types/ViewportPresets';\nimport { WindowLevel } from './WindowLevel';\nimport { VolumeRenderingPresets } from './VolumeRenderingPresets';\nimport { VolumeRenderingOptions } from './VolumeRenderingOptions';\nimport { ViewportPreset } from '../../types/ViewportPresets';\nimport { VolumeViewport3D } from '@cornerstonejs/core';\nimport { utilities } from '@cornerstonejs/core';\n\nexport const nonWLModalities = ['SR', 'SEG', 'SM', 'RTSTRUCT', 'RTPLAN', 'RTDOSE'];\n\nexport type WindowLevelActionMenuProps = {\n  viewportId: string;\n  element: HTMLElement;\n  presets: Array<Record<string, Array<WindowLevelPreset>>>;\n  colorbarProperties: ColorbarProperties;\n  displaySets: Array<any>;\n  volumeRenderingPresets: Array<ViewportPreset>;\n  volumeRenderingQualityRange: VolumeRenderingQualityRange;\n};\n\nexport function WindowLevelActionMenu({\n  viewportId,\n  element,\n  presets,\n  verticalDirection,\n  horizontalDirection,\n  commandsManager,\n  servicesManager,\n  colorbarProperties,\n  displaySets,\n  volumeRenderingPresets,\n  volumeRenderingQualityRange,\n}: withAppTypes<WindowLevelActionMenuProps>): ReactElement {\n  const {\n    colormaps,\n    colorbarContainerPosition,\n    colorbarInitialColormap,\n    colorbarTickPosition,\n    width: colorbarWidth,\n  } = colorbarProperties;\n  const { colorbarService, cornerstoneViewportService } = servicesManager.services;\n  const viewportInfo = cornerstoneViewportService.getViewportInfo(viewportId);\n  const viewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\n  const backgroundColor = viewportInfo.getViewportOptions().background;\n  const isLight = backgroundColor ? utilities.isEqual(backgroundColor, [1, 1, 1]) : false;\n\n  const { t } = useTranslation('WindowLevelActionMenu');\n\n  const [viewportGrid] = useViewportGrid();\n  const { activeViewportId } = viewportGrid;\n\n  const [vpHeight, setVpHeight] = useState(element?.clientHeight);\n  const [menuKey, setMenuKey] = useState(0);\n  const [is3DVolume, setIs3DVolume] = useState(false);\n\n  const onSetColorbar = useCallback(() => {\n    setViewportColorbar(viewportId, displaySets, commandsManager, servicesManager, {\n      colormaps,\n      ticks: {\n        position: colorbarTickPosition,\n      },\n      width: colorbarWidth,\n      position: colorbarContainerPosition,\n      activeColormapName: colorbarInitialColormap,\n    });\n  }, [commandsManager]);\n\n  useEffect(() => {\n    const newVpHeight = element?.clientHeight;\n    if (vpHeight !== newVpHeight) {\n      setVpHeight(newVpHeight);\n    }\n  }, [element, vpHeight]);\n\n  useEffect(() => {\n    if (!colorbarService.hasColorbar(viewportId)) {\n      return;\n    }\n    window.setTimeout(() => {\n      colorbarService.removeColorbar(viewportId);\n      onSetColorbar();\n    }, 0);\n  }, [viewportId, displaySets, viewport]);\n\n  useEffect(() => {\n    setMenuKey(menuKey + 1);\n    const viewport = cornerstoneViewportService.getCornerstoneViewport(viewportId);\n    if (viewport instanceof VolumeViewport3D) {\n      setIs3DVolume(true);\n    } else {\n      setIs3DVolume(false);\n    }\n  }, [\n    displaySets,\n    viewportId,\n    presets,\n    volumeRenderingQualityRange,\n    volumeRenderingPresets,\n    colorbarProperties,\n    activeViewportId,\n    viewportGrid,\n  ]);\n\n  return (\n    <AllInOneMenu.IconMenu\n      icon=\"viewport-window-level\"\n      verticalDirection={verticalDirection}\n      horizontalDirection={horizontalDirection}\n      iconClassName={classNames(\n        // Visible on hover and for the active viewport\n        activeViewportId === viewportId ? 'visible' : 'invisible group-hover/pane:visible',\n        'flex shrink-0 cursor-pointer rounded active:text-white text-primary-light',\n        isLight ? ' hover:bg-secondary-dark' : 'hover:bg-secondary-light/60'\n      )}\n      menuStyle={{ maxHeight: vpHeight - 32, minWidth: 218 }}\n      onVisibilityChange={() => {\n        setVpHeight(element.clientHeight);\n      }}\n      menuKey={menuKey}\n    >\n      <AllInOneMenu.ItemPanel>\n        {!is3DVolume && (\n          <Colorbar\n            viewportId={viewportId}\n            displaySets={displaySets.filter(ds => !nonWLModalities.includes(ds.Modality))}\n            commandsManager={commandsManager}\n            servicesManager={servicesManager}\n            colorbarProperties={colorbarProperties}\n          />\n        )}\n\n        {colormaps && !is3DVolume && (\n          <AllInOneMenu.SubMenu\n            key=\"colorLUTPresets\"\n            itemLabel=\"Color LUT\"\n            itemIcon=\"icon-color-lut\"\n          >\n            <Colormap\n              colormaps={colormaps}\n              viewportId={viewportId}\n              displaySets={displaySets.filter(ds => !nonWLModalities.includes(ds.Modality))}\n              commandsManager={commandsManager}\n              servicesManager={servicesManager}\n            />\n          </AllInOneMenu.SubMenu>\n        )}\n\n        {presets && presets.length > 0 && !is3DVolume && (\n          <AllInOneMenu.SubMenu\n            key=\"windowLevelPresets\"\n            itemLabel={t('Modality Window Presets')}\n            itemIcon=\"viewport-window-level\"\n          >\n            <WindowLevel\n              viewportId={viewportId}\n              commandsManager={commandsManager}\n              presets={presets}\n            />\n          </AllInOneMenu.SubMenu>\n        )}\n\n        {volumeRenderingPresets && is3DVolume && (\n          <VolumeRenderingPresets\n            servicesManager={servicesManager}\n            viewportId={viewportId}\n            commandsManager={commandsManager}\n            volumeRenderingPresets={volumeRenderingPresets}\n          />\n        )}\n\n        {volumeRenderingQualityRange && is3DVolume && (\n          <AllInOneMenu.SubMenu itemLabel=\"Rendering Options\">\n            <VolumeRenderingOptions\n              viewportId={viewportId}\n              commandsManager={commandsManager}\n              volumeRenderingQualityRange={volumeRenderingQualityRange}\n              servicesManager={servicesManager}\n            />\n          </AllInOneMenu.SubMenu>\n        )}\n      </AllInOneMenu.ItemPanel>\n    </AllInOneMenu.IconMenu>\n  );\n}\n","import React, { ReactNode } from 'react';\nimport { nonWLModalities, WindowLevelActionMenu } from './WindowLevelActionMenu';\n\nexport function getWindowLevelActionMenu({\n  viewportId,\n  element,\n  displaySets,\n  servicesManager,\n  commandsManager,\n  verticalDirection,\n  horizontalDirection,\n}: withAppTypes<{\n  viewportId: string;\n  element: HTMLElement;\n  displaySets: AppTypes.DisplaySet[];\n}>): ReactNode {\n  const { customizationService } = servicesManager.services;\n\n  const { presets } = customizationService.get('cornerstone.windowLevelPresets');\n  const colorbarProperties = customizationService.get('cornerstone.colorbar');\n  const { volumeRenderingPresets, volumeRenderingQualityRange } = customizationService.get(\n    'cornerstone.3dVolumeRendering'\n  );\n\n  const displaySetPresets = displaySets\n    .filter(displaySet => presets[displaySet.Modality])\n    .map(displaySet => {\n      return { [displaySet.Modality]: presets[displaySet.Modality] };\n    });\n\n  const modalities = displaySets\n    .map(displaySet => displaySet.Modality)\n    .filter(modality => !nonWLModalities.includes(modality));\n\n  if (modalities.length === 0) {\n    return null;\n  }\n\n  return (\n    <WindowLevelActionMenu\n      viewportId={viewportId}\n      element={element}\n      presets={displaySetPresets}\n      verticalDirection={verticalDirection}\n      horizontalDirection={horizontalDirection}\n      commandsManager={commandsManager}\n      servicesManager={servicesManager}\n      colorbarProperties={colorbarProperties}\n      displaySets={displaySets}\n      volumeRenderingPresets={volumeRenderingPresets}\n      volumeRenderingQualityRange={volumeRenderingQualityRange}\n    />\n  );\n}\n","import React, { useEffect, useState } from 'react';\nimport { Button, Icons, Separator } from '@ohif/ui-next';\nimport { SegmentationRepresentations } from '@cornerstonejs/tools/enums';\n\nfunction ViewportSegmentationMenu({\n  viewportId,\n  servicesManager,\n}: withAppTypes<{ viewportId: string }>) {\n  const { segmentationService } = servicesManager.services;\n  const [activeSegmentations, setActiveSegmentations] = useState([]);\n  const [availableSegmentations, setAvailableSegmentations] = useState([]);\n\n  useEffect(() => {\n    const updateSegmentations = () => {\n      const active = segmentationService.getSegmentationRepresentations(viewportId);\n      setActiveSegmentations(active);\n\n      const all = segmentationService.getSegmentations();\n      const available = all.filter(\n        seg => !active.some(activeSeg => activeSeg.segmentationId === seg.segmentationId)\n      );\n      setAvailableSegmentations(available);\n    };\n\n    updateSegmentations();\n\n    const subscriptions = [\n      segmentationService.EVENTS.SEGMENTATION_MODIFIED,\n      segmentationService.EVENTS.SEGMENTATION_REMOVED,\n      segmentationService.EVENTS.SEGMENTATION_REPRESENTATION_MODIFIED,\n    ].map(event => segmentationService.subscribe(event, updateSegmentations));\n\n    return () => {\n      subscriptions.forEach(subscription => subscription.unsubscribe());\n    };\n  }, [segmentationService, viewportId]);\n\n  const toggleSegmentationRepresentationVisibility = (\n    segmentationId,\n    type = SegmentationRepresentations.Labelmap\n  ) => {\n    segmentationService.toggleSegmentationRepresentationVisibility(viewportId, {\n      segmentationId,\n      type,\n    });\n  };\n\n  const addSegmentationToViewport = segmentationId => {\n    segmentationService.addSegmentationRepresentation(viewportId, { segmentationId });\n  };\n\n  const removeSegmentationFromViewport = segmentationId => {\n    segmentationService.removeSegmentationRepresentations(viewportId, {\n      segmentationId,\n    });\n  };\n\n  return (\n    <div className=\"bg-muted flex h-full w-[262px] flex-col rounded p-3\">\n      <span className=\"text-muted-foreground mb-2 text-xs font-semibold\">Current Viewport</span>\n      <ul className=\"space-y-1\">\n        {activeSegmentations.map(segmentation => (\n          <li\n            key={segmentation.id}\n            className=\"flex items-center text-sm\"\n          >\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"text-muted-foreground mr-2\"\n              onClick={() => removeSegmentationFromViewport(segmentation.segmentationId)}\n            >\n              <Icons.Minus className=\"h-6 w-6\" />\n            </Button>\n            <span className=\"text-foreground flex-grow\">{segmentation.label}</span>\n            {segmentation.visible ? (\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                className=\"text-muted-foreground\"\n                onClick={() =>\n                  toggleSegmentationRepresentationVisibility(\n                    segmentation.segmentationId,\n                    segmentation.type\n                  )\n                }\n              >\n                <Icons.Hide className=\"h-6 w-6\" />\n              </Button>\n            ) : (\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                className=\"text-muted-foreground\"\n                onClick={() =>\n                  toggleSegmentationRepresentationVisibility(\n                    segmentation.segmentationId,\n                    segmentation.type\n                  )\n                }\n              >\n                <Icons.Show className=\"h-6 w-6\" />\n              </Button>\n            )}\n          </li>\n        ))}\n      </ul>\n      {availableSegmentations.length > 0 && (\n        <>\n          <Separator className=\"bg-input mb-3\" />\n          <span className=\"text-muted-foreground mb-2 text-xs font-semibold\">Available</span>\n          <ul className=\"space-y-1\">\n            {availableSegmentations.map(({segmentationId, label}) => (\n              <li\n                key={segmentationId}\n                className=\"flex items-center text-sm\"\n              >\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  className=\"text-muted-foreground mr-2\"\n                  onClick={() => addSegmentationToViewport(segmentationId)}\n                >\n                  <Icons.Plus className=\"h-6 w-6\" />\n                </Button>\n                <span className=\"text-foreground/60\">{label}</span>\n              </li>\n            ))}\n          </ul>\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default ViewportSegmentationMenu;\n","import React, { ReactNode, useEffect, useState } from 'react';\nimport { Button, Icons, Popover, PopoverContent, PopoverTrigger } from '@ohif/ui-next';\nimport ViewportSegmentationMenu from './ViewportSegmentationMenu';\nimport classNames from 'classnames';\nimport { useSegmentations } from '../../hooks/useSegmentations';\n\nexport function ViewportSegmentationMenuWrapper({\n  viewportId,\n  displaySets,\n  servicesManager,\n  commandsManager,\n  location,\n}: withAppTypes<{\n  viewportId: string;\n  element: HTMLElement;\n}>): ReactNode {\n  const { viewportActionCornersService, viewportGridService } = servicesManager.services;\n\n  const segmentations = useSegmentations({ servicesManager });\n\n  const activeViewportId = viewportGridService.getActiveViewportId();\n  const isActiveViewport = viewportId === activeViewportId;\n\n  const { align, side } = getAlignAndSide(viewportActionCornersService, location);\n\n  if (!segmentations?.length) {\n    return null;\n  }\n\n  return (\n    <Popover>\n      <PopoverTrigger\n        asChild\n        className=\"flex items-center justify-center\"\n      >\n        <Button\n          variant=\"ghost\"\n          size=\"icon\"\n        >\n          <Icons.ViewportViews\n            className={classNames(\n              'text-highlight',\n              isActiveViewport ? 'visible' : 'invisible group-hover/pane:visible'\n            )}\n          />\n        </Button>\n      </PopoverTrigger>\n      <PopoverContent\n        className=\"border-none bg-transparent p-0 shadow-none\"\n        side={side}\n        align={align}\n        alignOffset={-15}\n        sideOffset={5}\n      >\n        <ViewportSegmentationMenu\n          className=\"w-full\"\n          viewportId={viewportId}\n          displaySets={displaySets}\n          servicesManager={servicesManager}\n          commandsManager={commandsManager}\n        />\n      </PopoverContent>\n    </Popover>\n  );\n}\n\nconst getAlignAndSide = (viewportActionCornersService, location) => {\n  const ViewportActionCornersLocations = viewportActionCornersService.LOCATIONS;\n\n  switch (location) {\n    case ViewportActionCornersLocations.topLeft:\n      return { align: 'start', side: 'bottom' };\n    case ViewportActionCornersLocations.topRight:\n      return { align: 'end', side: 'bottom' };\n    case ViewportActionCornersLocations.bottomLeft:\n      return { align: 'start', side: 'top' };\n    case ViewportActionCornersLocations.bottomRight:\n      return { align: 'end', side: 'top' };\n    default:\n      console.debug('Unknown location, defaulting to bottom-start');\n      return { align: 'start', side: 'bottom' };\n  }\n};\n","import React, { ReactNode } from 'react';\nimport { ViewportSegmentationMenuWrapper } from './ViewportSegmentationMenuWrapper';\n\nexport function getViewportDataOverlaySettingsMenu(\n  props: withAppTypes<{\n    viewportId: string;\n    element: HTMLElement;\n  }>\n): ReactNode {\n  return <ViewportSegmentationMenuWrapper {...props} />;\n}\n","import { useEffect, useState, memo } from 'react';\n\nconst MODALITIES_REQUIRING_CINE_AUTO_MOUNT = ['OT', 'US'];\n\nconst ActiveViewportBehavior = memo(\n  ({ servicesManager, viewportId }: withAppTypes<{ viewportId: string }>) => {\n    const { displaySetService, cineService, viewportGridService, customizationService } =\n      servicesManager.services;\n\n    const [activeViewportId, setActiveViewportId] = useState(viewportId);\n\n    useEffect(() => {\n      const subscription = viewportGridService.subscribe(\n        viewportGridService.EVENTS.ACTIVE_VIEWPORT_ID_CHANGED,\n        ({ viewportId }) => setActiveViewportId(viewportId)\n      );\n\n      return () => subscription.unsubscribe();\n    }, [viewportId, viewportGridService]);\n\n    useEffect(() => {\n      if (cineService.isViewportCineClosed(activeViewportId)) {\n        return;\n      }\n\n      const displaySetInstanceUIDs =\n        viewportGridService.getDisplaySetsUIDsForViewport(activeViewportId);\n\n      if (!displaySetInstanceUIDs) {\n        return;\n      }\n\n      const displaySets = displaySetInstanceUIDs.map(uid =>\n        displaySetService.getDisplaySetByUID(uid)\n      );\n\n      if (!displaySets.length) {\n        return;\n      }\n\n      const modalities = displaySets.map(displaySet => displaySet?.Modality);\n\n      const { modalities: sourceModalities } = customizationService.getModeCustomization(\n        'autoCineModalities',\n        {\n          id: 'autoCineModalities',\n          modalities: MODALITIES_REQUIRING_CINE_AUTO_MOUNT,\n        }\n      );\n\n      const requiresCine = modalities.some(modality => sourceModalities.includes(modality));\n\n      if (requiresCine && !cineService.getState().isCineEnabled) {\n        cineService.setIsCineEnabled(true);\n      }\n    }, [\n      activeViewportId,\n      cineService,\n      viewportGridService,\n      displaySetService,\n      customizationService,\n    ]);\n\n    return null;\n  },\n  arePropsEqual\n);\n\nActiveViewportBehavior.displayName = 'ActiveViewportBehavior';\n\nfunction arePropsEqual(prevProps, nextProps) {\n  return (\n    prevProps.viewportId === nextProps.viewportId &&\n    prevProps.servicesManager === nextProps.servicesManager\n  );\n}\n\nexport default ActiveViewportBehavior;\n","import React, { useEffect, useRef, useCallback, useState } from 'react';\nimport { useResizeDetector } from 'react-resize-detector';\nimport * as cs3DTools from '@cornerstonejs/tools';\nimport { Enums, eventTarget, getEnabledElement } from '@cornerstonejs/core';\nimport { MeasurementService } from '@ohif/core';\nimport { AllInOneMenu, Notification, useViewportDialog } from '@ohif/ui';\nimport type { Types as csTypes } from '@cornerstonejs/core';\n\nimport { setEnabledElement } from '../state';\n\nimport './OHIFCornerstoneViewport.css';\nimport CornerstoneOverlays from './Overlays/CornerstoneOverlays';\nimport CinePlayer from '../components/CinePlayer';\nimport type { Types } from '@ohif/core';\n\nimport OHIFViewportActionCorners from '../components/OHIFViewportActionCorners';\nimport { getWindowLevelActionMenu } from '../components/WindowLevelActionMenu/getWindowLevelActionMenu';\nimport { useAppConfig } from '@state';\nimport { getViewportDataOverlaySettingsMenu } from '../components/ViewportDataOverlaySettingMenu';\nimport { getViewportPresentations } from '../utils/presentations/getViewportPresentations';\nimport { useSynchronizersStore } from '../stores/useSynchronizersStore';\nimport ActiveViewportBehavior from '../utils/ActiveViewportBehavior';\n\nconst STACK = 'stack';\n\n/**\n * Caches the jump to measurement operation, so that if display set is shown,\n * it can jump to the measurement.\n */\nlet cacheJumpToMeasurementEvent;\n\n// Todo: This should be done with expose of internal API similar to react-vtkjs-viewport\n// Then we don't need to worry about the re-renders if the props change.\nconst OHIFCornerstoneViewport = React.memo(\n  (\n    props: withAppTypes<{\n      viewportId: string;\n      displaySets: AppTypes.DisplaySet[];\n      viewportOptions: AppTypes.ViewportGrid.GridViewportOptions;\n      initialImageIndex: number;\n    }>\n  ) => {\n    const {\n      displaySets,\n      dataSource,\n      viewportOptions,\n      displaySetOptions,\n      servicesManager,\n      commandsManager,\n      onElementEnabled,\n      // eslint-disable-next-line react/prop-types\n      onElementDisabled,\n      isJumpToMeasurementDisabled = false,\n      // Note: you SHOULD NOT use the initialImageIdOrIndex for manipulation\n      // of the imageData in the OHIFCornerstoneViewport. This prop is used\n      // to set the initial state of the viewport's first image to render\n      // eslint-disable-next-line react/prop-types\n      initialImageIndex,\n      // if the viewport is part of a hanging protocol layout\n      // we should not really rely on the old synchronizers and\n      // you see below we only rehydrate the synchronizers if the viewport\n      // is not part of the hanging protocol layout. HPs should\n      // define their own synchronizers. Since the synchronizers are\n      // viewportId dependent and\n      // eslint-disable-next-line react/prop-types\n      isHangingProtocolLayout,\n    } = props;\n    const viewportId = viewportOptions.viewportId;\n\n    if (!viewportId) {\n      throw new Error('Viewport ID is required');\n    }\n\n    // Make sure displaySetOptions has one object per displaySet\n    while (displaySetOptions.length < displaySets.length) {\n      displaySetOptions.push({});\n    }\n\n    // Since we only have support for dynamic data in volume viewports, we should\n    // handle this case here and set the viewportType to volume if any of the\n    // displaySets are dynamic volumes\n    viewportOptions.viewportType = displaySets.some(\n      ds => ds.isDynamicVolume && ds.isReconstructable\n    )\n      ? 'volume'\n      : viewportOptions.viewportType;\n\n    const [scrollbarHeight, setScrollbarHeight] = useState('100px');\n    const [enabledVPElement, setEnabledVPElement] = useState(null);\n    const elementRef = useRef() as React.MutableRefObject<HTMLDivElement>;\n    const [appConfig] = useAppConfig();\n\n    const {\n      displaySetService,\n      toolbarService,\n      toolGroupService,\n      syncGroupService,\n      cornerstoneViewportService,\n      segmentationService,\n      cornerstoneCacheService,\n      viewportActionCornersService,\n    } = servicesManager.services;\n\n    const [viewportDialogState] = useViewportDialog();\n    // useCallback for scroll bar height calculation\n    const setImageScrollBarHeight = useCallback(() => {\n      const scrollbarHeight = `${elementRef.current.clientHeight - 40}px`;\n      setScrollbarHeight(scrollbarHeight);\n    }, [elementRef]);\n\n    // useCallback for onResize\n    const onResize = useCallback(() => {\n      if (elementRef.current) {\n        cornerstoneViewportService.resize();\n        setImageScrollBarHeight();\n      }\n    }, [elementRef]);\n\n    const cleanUpServices = useCallback(\n      viewportInfo => {\n        const renderingEngineId = viewportInfo.getRenderingEngineId();\n        const syncGroups = viewportInfo.getSyncGroups();\n\n        toolGroupService.removeViewportFromToolGroup(viewportId, renderingEngineId);\n        syncGroupService.removeViewportFromSyncGroup(viewportId, renderingEngineId, syncGroups);\n\n        segmentationService.clearSegmentationRepresentations(viewportId);\n\n        viewportActionCornersService.clear(viewportId);\n      },\n      [\n        viewportId,\n        segmentationService,\n        syncGroupService,\n        toolGroupService,\n        viewportActionCornersService,\n      ]\n    );\n\n    const elementEnabledHandler = useCallback(\n      evt => {\n        // check this is this element reference and return early if doesn't match\n        if (evt.detail.element !== elementRef.current) {\n          return;\n        }\n\n        const { viewportId, element } = evt.detail;\n        const viewportInfo = cornerstoneViewportService.getViewportInfo(viewportId);\n        setEnabledElement(viewportId, element);\n        setEnabledVPElement(element);\n\n        const renderingEngineId = viewportInfo.getRenderingEngineId();\n        const toolGroupId = viewportInfo.getToolGroupId();\n        const syncGroups = viewportInfo.getSyncGroups();\n\n        toolGroupService.addViewportToToolGroup(viewportId, renderingEngineId, toolGroupId);\n\n        syncGroupService.addViewportToSyncGroup(viewportId, renderingEngineId, syncGroups);\n\n        // we don't need reactivity here so just use state\n        const { synchronizersStore } = useSynchronizersStore.getState();\n        if (synchronizersStore?.[viewportId]?.length && !isHangingProtocolLayout) {\n          // If the viewport used to have a synchronizer, re apply it again\n          _rehydrateSynchronizers(viewportId, syncGroupService);\n        }\n\n        if (onElementEnabled && typeof onElementEnabled === 'function') {\n          onElementEnabled(evt);\n        }\n      },\n      [viewportId, onElementEnabled, toolGroupService]\n    );\n\n    // disable the element upon unmounting\n    useEffect(() => {\n      cornerstoneViewportService.enableViewport(viewportId, elementRef.current);\n\n      eventTarget.addEventListener(Enums.Events.ELEMENT_ENABLED, elementEnabledHandler);\n\n      setImageScrollBarHeight();\n\n      return () => {\n        const viewportInfo = cornerstoneViewportService.getViewportInfo(viewportId);\n\n        if (!viewportInfo) {\n          return;\n        }\n\n        cornerstoneViewportService.storePresentation({ viewportId });\n\n        // This should be done after the store presentation since synchronizers\n        // will get cleaned up and they need the viewportInfo to be present\n        cleanUpServices(viewportInfo);\n\n        if (onElementDisabled && typeof onElementDisabled === 'function') {\n          onElementDisabled(viewportInfo);\n        }\n\n        cornerstoneViewportService.disableElement(viewportId);\n\n        eventTarget.removeEventListener(Enums.Events.ELEMENT_ENABLED, elementEnabledHandler);\n      };\n    }, []);\n\n    // subscribe to displaySet metadata invalidation (updates)\n    // Currently, if the metadata changes we need to re-render the display set\n    // for it to take effect in the viewport. As we deal with scaling in the loading,\n    // we need to remove the old volume from the cache, and let the\n    // viewport to re-add it which will use the new metadata. Otherwise, the\n    // viewport will use the cached volume and the new metadata will not be used.\n    // Note: this approach does not actually end of sending network requests\n    // and it uses the network cache\n    useEffect(() => {\n      const { unsubscribe } = displaySetService.subscribe(\n        displaySetService.EVENTS.DISPLAY_SET_SERIES_METADATA_INVALIDATED,\n        async ({\n          displaySetInstanceUID: invalidatedDisplaySetInstanceUID,\n          invalidateData,\n        }: Types.DisplaySetSeriesMetadataInvalidatedEvent) => {\n          if (!invalidateData) {\n            return;\n          }\n\n          const viewportInfo = cornerstoneViewportService.getViewportInfo(viewportId);\n\n          if (viewportInfo.hasDisplaySet(invalidatedDisplaySetInstanceUID)) {\n            const viewportData = viewportInfo.getViewportData();\n            const newViewportData = await cornerstoneCacheService.invalidateViewportData(\n              viewportData,\n              invalidatedDisplaySetInstanceUID,\n              dataSource,\n              displaySetService\n            );\n\n            const keepCamera = true;\n            cornerstoneViewportService.updateViewport(viewportId, newViewportData, keepCamera);\n          }\n        }\n      );\n      return () => {\n        unsubscribe();\n      };\n    }, [viewportId]);\n\n    useEffect(() => {\n      // handle the default viewportType to be stack\n      if (!viewportOptions.viewportType) {\n        viewportOptions.viewportType = STACK;\n      }\n\n      const loadViewportData = async () => {\n        const viewportData = await cornerstoneCacheService.createViewportData(\n          displaySets,\n          viewportOptions,\n          dataSource,\n          initialImageIndex\n        );\n\n        const presentations = getViewportPresentations(viewportId, viewportOptions);\n\n        let measurement;\n        if (cacheJumpToMeasurementEvent?.viewportId === viewportId) {\n          measurement = cacheJumpToMeasurementEvent.measurement;\n          // Delete the position presentation so that viewport navigates direct\n          presentations.positionPresentation = null;\n          cacheJumpToMeasurementEvent = null;\n        }\n\n        // Note: This is a hack to get the grid to re-render the OHIFCornerstoneViewport component\n        // Used for segmentation hydration right now, since the logic to decide whether\n        // a viewport needs to render a segmentation lives inside the CornerstoneViewportService\n        // so we need to re-render (force update via change of the needsRerendering) so that React\n        // does the diffing and decides we should render this again (although the id and element has not changed)\n        // so that the CornerstoneViewportService can decide whether to render the segmentation or not. Not that we reached here we can turn it off.\n        if (viewportOptions.needsRerendering) {\n          viewportOptions.needsRerendering = false;\n        }\n\n        cornerstoneViewportService.setViewportData(\n          viewportId,\n          viewportData,\n          viewportOptions,\n          displaySetOptions,\n          presentations\n        );\n\n        if (measurement) {\n          cs3DTools.annotation.selection.setAnnotationSelected(measurement.uid);\n        }\n      };\n\n      loadViewportData();\n    }, [viewportOptions, displaySets, dataSource]);\n\n    /**\n     * There are two scenarios for jump to click\n     * 1. Current viewports contain the displaySet that the annotation was drawn on\n     * 2. Current viewports don't contain the displaySet that the annotation was drawn on\n     * and we need to change the viewports displaySet for jumping.\n     * Since measurement_jump happens via events and listeners, the former case is handled\n     * by the measurement_jump direct callback, but the latter case is handled first by\n     * the viewportGrid to set the correct displaySet on the viewport, AND THEN we check\n     * the cache for jumping to see if there is any jump queued, then we jump to the correct slice.\n     */\n    useEffect(() => {\n      if (isJumpToMeasurementDisabled) {\n        return;\n      }\n\n      const unsubscribeFromJumpToMeasurementEvents = _subscribeToJumpToMeasurementEvents(\n        elementRef,\n        viewportId,\n        servicesManager\n      );\n\n      _checkForCachedJumpToMeasurementEvents(elementRef, viewportId, displaySets, servicesManager);\n\n      return () => {\n        unsubscribeFromJumpToMeasurementEvents();\n      };\n    }, [displaySets, elementRef, viewportId, isJumpToMeasurementDisabled, servicesManager]);\n\n    // Set up the window level action menu in the viewport action corners.\n    useEffect(() => {\n      // Doing an === check here because the default config value when not set is true\n      if (appConfig.addWindowLevelActionMenu === false) {\n        return;\n      }\n\n      const location = viewportActionCornersService.LOCATIONS.topRight;\n\n      // TODO: In the future we should consider using the customization service\n      // to determine if and in which corner various action components should go.\n      viewportActionCornersService.addComponent({\n        viewportId,\n        id: 'windowLevelActionMenu',\n        component: getWindowLevelActionMenu({\n          viewportId,\n          element: elementRef.current,\n          displaySets,\n          servicesManager,\n          commandsManager,\n          location,\n          verticalDirection: AllInOneMenu.VerticalDirection.TopToBottom,\n          horizontalDirection: AllInOneMenu.HorizontalDirection.RightToLeft,\n        }),\n        location,\n      });\n\n      viewportActionCornersService.addComponent({\n        viewportId,\n        id: 'segmentation',\n        component: getViewportDataOverlaySettingsMenu({\n          viewportId,\n          element: elementRef.current,\n          displaySets,\n          servicesManager,\n          commandsManager,\n          location,\n        }),\n        location,\n      });\n    }, [\n      displaySets,\n      viewportId,\n      viewportActionCornersService,\n      servicesManager,\n      commandsManager,\n      appConfig,\n    ]);\n\n    const { ref: resizeRef } = useResizeDetector({\n      onResize,\n    });\n\n    return (\n      <React.Fragment>\n        <div className=\"viewport-wrapper\">\n          <div\n            className=\"cornerstone-viewport-element\"\n            style={{ height: '100%', width: '100%' }}\n            onContextMenu={e => e.preventDefault()}\n            onMouseDown={e => e.preventDefault()}\n            ref={el => {\n              resizeRef.current = el;\n              elementRef.current = el;\n            }}\n          ></div>\n          <CornerstoneOverlays\n            viewportId={viewportId}\n            toolBarService={toolbarService}\n            element={elementRef.current}\n            scrollbarHeight={scrollbarHeight}\n            servicesManager={servicesManager}\n          />\n          <CinePlayer\n            enabledVPElement={enabledVPElement}\n            viewportId={viewportId}\n            servicesManager={servicesManager}\n          />\n          <ActiveViewportBehavior\n            viewportId={viewportId}\n            servicesManager={servicesManager}\n          />\n        </div>\n        {/* top offset of 24px to account for ViewportActionCorners. */}\n        <div className=\"absolute top-[24px] w-full\">\n          {viewportDialogState.viewportId === viewportId && (\n            <Notification\n              id=\"viewport-notification\"\n              message={viewportDialogState.message}\n              type={viewportDialogState.type}\n              actions={viewportDialogState.actions}\n              onSubmit={viewportDialogState.onSubmit}\n              onOutsideClick={viewportDialogState.onOutsideClick}\n              onKeyPress={viewportDialogState.onKeyPress}\n            />\n          )}\n        </div>\n        {/* The OHIFViewportActionCorners follows the viewport in the DOM so that it is naturally at a higher z-index.*/}\n        <OHIFViewportActionCorners viewportId={viewportId} />\n      </React.Fragment>\n    );\n  },\n  areEqual\n);\n\nfunction _subscribeToJumpToMeasurementEvents(elementRef, viewportId, servicesManager) {\n  const { measurementService, cornerstoneViewportService } = servicesManager.services;\n\n  const { unsubscribe } = measurementService.subscribe(\n    MeasurementService.EVENTS.JUMP_TO_MEASUREMENT_VIEWPORT,\n    props => {\n      cacheJumpToMeasurementEvent = props;\n      const { viewportId: jumpId, measurement, isConsumed } = props;\n      if (!measurement || isConsumed) {\n        return;\n      }\n      if (cacheJumpToMeasurementEvent.cornerstoneViewport === undefined) {\n        // Decide on which viewport should handle this\n        cacheJumpToMeasurementEvent.cornerstoneViewport =\n          cornerstoneViewportService.getViewportIdToJump(jumpId, {\n            displaySetInstanceUID: measurement.displaySetInstanceUID,\n            ...measurement.metadata,\n            referencedImageId:\n              measurement.referencedImageId || measurement.metadata?.referencedImageId,\n          });\n      }\n      if (cacheJumpToMeasurementEvent.cornerstoneViewport !== viewportId) {\n        return;\n      }\n      _jumpToMeasurement(measurement, elementRef, viewportId, servicesManager);\n    }\n  );\n\n  return unsubscribe;\n}\n\n// Check if there is a queued jumpToMeasurement event\nfunction _checkForCachedJumpToMeasurementEvents(\n  elementRef,\n  viewportId,\n  displaySets,\n  servicesManager\n) {\n  if (!cacheJumpToMeasurementEvent) {\n    return;\n  }\n  if (cacheJumpToMeasurementEvent.isConsumed) {\n    cacheJumpToMeasurementEvent = null;\n    return;\n  }\n  const displaysUIDs = displaySets.map(displaySet => displaySet.displaySetInstanceUID);\n  if (!displaysUIDs?.length) {\n    return;\n  }\n\n  // Jump to measurement if the measurement exists\n  const { measurement } = cacheJumpToMeasurementEvent;\n  if (measurement && elementRef) {\n    if (displaysUIDs.includes(measurement?.displaySetInstanceUID)) {\n      _jumpToMeasurement(measurement, elementRef, viewportId, servicesManager);\n    }\n  }\n}\n\nfunction _jumpToMeasurement(measurement, targetElementRef, viewportId, servicesManager) {\n  const { viewportGridService } = servicesManager.services;\n\n  const targetElement = targetElementRef.current;\n\n  // Todo: setCornerstoneMeasurementActive should be handled by the toolGroupManager\n  //  to set it properly\n  // setCornerstoneMeasurementActive(measurement);\n\n  viewportGridService.setActiveViewportId(viewportId);\n\n  const enabledElement = getEnabledElement(targetElement);\n\n  if (enabledElement) {\n    // See how the jumpToSlice() of Cornerstone3D deals with imageIdx param.\n    const viewport = enabledElement.viewport as csTypes.IStackViewport | csTypes.IVolumeViewport;\n\n    const { metadata } = measurement;\n    if (!viewport.isReferenceViewable(metadata, { withNavigation: true, withOrientation: true })) {\n      console.log(\"Reference isn't viewable, postponing until updated\");\n      return;\n    }\n\n    viewport.setViewReference(metadata);\n\n    cs3DTools.annotation.selection.setAnnotationSelected(measurement.uid);\n    // Jump to measurement consumed, remove.\n    cacheJumpToMeasurementEvent?.consume?.();\n    cacheJumpToMeasurementEvent = null;\n  }\n}\n\nfunction _rehydrateSynchronizers(viewportId: string, syncGroupService: any) {\n  const { synchronizersStore } = useSynchronizersStore.getState();\n  const synchronizers = synchronizersStore[viewportId];\n\n  if (!synchronizers) {\n    return;\n  }\n\n  synchronizers.forEach(synchronizerObj => {\n    if (!synchronizerObj.id) {\n      return;\n    }\n\n    const { id, sourceViewports, targetViewports } = synchronizerObj;\n\n    const synchronizer = syncGroupService.getSynchronizer(id);\n\n    if (!synchronizer) {\n      return;\n    }\n\n    const sourceViewportInfo = sourceViewports.find(\n      sourceViewport => sourceViewport.viewportId === viewportId\n    );\n\n    const targetViewportInfo = targetViewports.find(\n      targetViewport => targetViewport.viewportId === viewportId\n    );\n\n    const isSourceViewportInSynchronizer = synchronizer\n      .getSourceViewports()\n      .find(sourceViewport => sourceViewport.viewportId === viewportId);\n\n    const isTargetViewportInSynchronizer = synchronizer\n      .getTargetViewports()\n      .find(targetViewport => targetViewport.viewportId === viewportId);\n\n    // if the viewport was previously a source viewport, add it again\n    if (sourceViewportInfo && !isSourceViewportInSynchronizer) {\n      synchronizer.addSource({\n        viewportId: sourceViewportInfo.viewportId,\n        renderingEngineId: sourceViewportInfo.renderingEngineId,\n      });\n    }\n\n    // if the viewport was previously a target viewport, add it again\n    if (targetViewportInfo && !isTargetViewportInSynchronizer) {\n      synchronizer.addTarget({\n        viewportId: targetViewportInfo.viewportId,\n        renderingEngineId: targetViewportInfo.renderingEngineId,\n      });\n    }\n  });\n}\n\n// Component displayName\nOHIFCornerstoneViewport.displayName = 'OHIFCornerstoneViewport';\n\nfunction areEqual(prevProps, nextProps) {\n  if (nextProps.needsRerendering) {\n    console.debug('OHIFCornerstoneViewport: Rerender caused by: needsRerendering');\n    return false;\n  }\n\n  if (prevProps.displaySets.length !== nextProps.displaySets.length) {\n    console.debug('OHIFCornerstoneViewport: Rerender caused by: displaySets length change');\n    return false;\n  }\n\n  if (prevProps.viewportOptions.orientation !== nextProps.viewportOptions.orientation) {\n    console.debug('OHIFCornerstoneViewport: Rerender caused by: orientation change');\n    return false;\n  }\n\n  if (prevProps.viewportOptions.toolGroupId !== nextProps.viewportOptions.toolGroupId) {\n    console.debug('OHIFCornerstoneViewport: Rerender caused by: toolGroupId change');\n    return false;\n  }\n\n  if (\n    nextProps.viewportOptions.viewportType &&\n    prevProps.viewportOptions.viewportType !== nextProps.viewportOptions.viewportType\n  ) {\n    console.debug('OHIFCornerstoneViewport: Rerender caused by: viewportType change');\n    return false;\n  }\n\n  if (nextProps.viewportOptions.needsRerendering) {\n    console.debug('OHIFCornerstoneViewport: Rerender caused by: viewportOptions.needsRerendering');\n    return false;\n  }\n\n  const prevDisplaySets = prevProps.displaySets;\n  const nextDisplaySets = nextProps.displaySets;\n\n  if (prevDisplaySets.length !== nextDisplaySets.length) {\n    console.debug('OHIFCornerstoneViewport: Rerender caused by: displaySets length mismatch');\n    return false;\n  }\n\n  for (let i = 0; i < prevDisplaySets.length; i++) {\n    const prevDisplaySet = prevDisplaySets[i];\n\n    const foundDisplaySet = nextDisplaySets.find(\n      nextDisplaySet =>\n        nextDisplaySet.displaySetInstanceUID === prevDisplaySet.displaySetInstanceUID\n    );\n\n    if (!foundDisplaySet) {\n      console.debug('OHIFCornerstoneViewport: Rerender caused by: displaySet not found');\n      return false;\n    }\n\n    // check they contain the same image\n    if (foundDisplaySet.images?.length !== prevDisplaySet.images?.length) {\n      console.debug('OHIFCornerstoneViewport: Rerender caused by: images length mismatch');\n      return false;\n    }\n\n    // check if their imageIds are the same\n    if (foundDisplaySet.images?.length) {\n      for (let j = 0; j < foundDisplaySet.images.length; j++) {\n        if (foundDisplaySet.images[j].imageId !== prevDisplaySet.images[j].imageId) {\n          console.debug('OHIFCornerstoneViewport: Rerender caused by: imageId mismatch');\n          return false;\n        }\n      }\n    }\n  }\n\n  return true;\n}\n\n// Helper function to check if display sets have changed\nfunction haveDisplaySetsChanged(prevDisplaySets, currentDisplaySets) {\n  if (prevDisplaySets.length !== currentDisplaySets.length) {\n    return true;\n  }\n\n  return currentDisplaySets.some((currentDS, index) => {\n    const prevDS = prevDisplaySets[index];\n    return currentDS.displaySetInstanceUID !== prevDS.displaySetInstanceUID;\n  });\n}\n\nexport default OHIFCornerstoneViewport;\n","import { usePositionPresentationStore } from '../../stores/usePositionPresentationStore';\nimport { useLutPresentationStore } from '../../stores/useLutPresentationStore';\nimport { useSegmentationPresentationStore } from '../../stores/useSegmentationPresentationStore';\n\nexport function getViewportPresentations(\n  viewportId: string,\n  viewportOptions: AppTypes.ViewportGrid.GridViewportOptions\n) {\n  const { lutPresentationStore } = useLutPresentationStore.getState();\n  const { positionPresentationStore } = usePositionPresentationStore.getState();\n  const { segmentationPresentationStore } = useSegmentationPresentationStore.getState();\n\n  // NOTE: this is the new viewport state, we should not get the presentationIds from the cornerstoneViewportService\n  // since that has the old viewport state\n  const { presentationIds } = viewportOptions;\n\n  if (!presentationIds) {\n    return {\n      positionPresentation: null,\n      lutPresentation: null,\n      segmentationPresentation: null,\n    };\n  }\n\n  const { lutPresentationId, positionPresentationId, segmentationPresentationId } = presentationIds;\n\n  return {\n    positionPresentation: positionPresentationStore[positionPresentationId],\n    lutPresentation: lutPresentationStore[lutPresentationId],\n    segmentationPresentation: segmentationPresentationStore[segmentationPresentationId],\n  };\n}\n"],"names":["CornerstoneImageScrollbar","viewportData","viewportId","element","imageSliceData","setImageSliceData","scrollbarHeight","servicesManager","cineService","cornerstoneViewportService","services","useEffect","viewport","getCornerstoneViewport","VolumeViewport3D","imageIndex","getCurrentImageIdIndex","numberOfSlices","getNumberOfSlices","viewportType","eventId","Enums","STACK","STACK_VIEWPORT_SCROLL","ORTHOGRAPHIC","VOLUME_NEW_IMAGE","IMAGE_RENDERED","updateIndex","event","newImageIdIndex","detail","addEventListener","removeEventListener","React","ImageScrollbar","onChange","evt","onImageScrollbarChange","isCineEnabled","getState","stopClip","setCine","id","isPlaying","csUtils","debounceLoading","max","height","value","propTypes","PropTypes","isRequired","Element","getOrientationStringLPS","invertOrientationStringLPS","utilities","orientationMarkers","rotation","setRotation","useState","flipHorizontal","setFlipHorizontal","flipVertical","setFlipVertical","cameraModifiedListener","previousCamera","camera","undefined","CAMERA_MODIFIED","markers","useMemo","rowCosines","columnCosines","isDefaultValueSetForColumnCosine","imageId","data","imageIds","metaData","getEnabledElement","viewUp","viewPlaneNormal","getCamera","viewRight","vec3","rowString","columnString","oppositeRowString","top","left","right","bottom","_getOrientationMarkers","getViewportInfo","map","m","index","className","classNames","key","console","log","ViewportImageSliceLoadingIndicator","loading","setLoading","error","setError","loadIndicatorRef","useRef","imageIdToBeLoaded","setLoadingState","clearTimeout","current","setTimeout","setFinishLoadingState","setErrorState","IMAGE_LOAD_ERROR","STACK_NEW_IMAGE","props","setViewportData","unsubscribe","subscribe","EVENTS","VIEWPORT_DATA_CHANGED","viewportInfo","viewportOptions","customViewportProps","hideOverlays","ViewportImageScrollbar","CustomizableViewportOverlay","ViewportOrientationMarkers","RenderCinePlayer","newStackFrameRate","dynamicInfo","dynamicInfoProp","customizationService","component","CinePlayerComponent","CinePlayer","get","setDynamicInfo","handleTimePointIndexChange","volumeId","timePointIndex","numTimePoints","splittingTag","label","eventTarget","DYNAMIC_VOLUME_TIME_POINT_INDEX_CHANGED","cache","getVolume","updateDynamicInfo","useCallback","frameRate","onClose","setIsCineEnabled","setViewportCineClosed","onPlayPauseChange","onFrameRateChange","enabledVPElement","displaySetService","viewportGridService","cines","useCine","setNewStackFrameRate","appConfig","useAppConfig","isMountedRef","cineHandler","validFrameRate","Math","playClip","framesPerSecond","newDisplaySetHandler","viewports","displaySetInstanceUIDs","forEach","displaySetInstanceUID","displaySet","getDisplaySetByUID","FrameRate","round","autoPlayCine","isDynamicVolume","dynamicVolumeInfo","timePoints","length","VIEWPORT_NEW_IMAGE_SET","VOLUME_VIEWPORT_NEW_VOLUME","cine","viewportActionCornersState","useViewportActionCornersContext","ViewportActionCorners","cornerComponents","Colormap","colormaps","displaySets","commandsManager","activeDisplaySet","setActiveDisplaySet","showPreview","setShowPreview","prePreviewColormap","setPrePreviewColormap","showPreviewRef","prePreviewColormapRef","activeDisplaySetRef","onSetColorLUT","opacity","includes","colormap","name","run","commandName","commandOptions","immediate","context","buttons","children","Modality","style","minWidth","fontSize","textAlign","display","justifyContent","alignItems","ButtonGroup","onActiveIndexChange","activeIndex","findIndex","ds","SwitchButton","checked","AllInOneMenu","description","onClick","onMouseEnter","getViewportColormap","StackViewport","getProperties","find","c","Name","actorEntries","getActors","actorEntry","entry","referencedId","onMouseLeave","setViewportColorbar","colorbarOptions","backgroundColor","getViewportOptions","background","ticks","position","font","color","maxNumTicks","tickSize","tickWidth","labelMargin","push","VolumeViewport","options","Colorbar","colorbarProperties","colorbarService","width","colorbarWidth","colorbarTickPosition","colorbarContainerPosition","colorbarInitialColormap","showColorbar","setShowColorbar","hasColorbar","onSetColorbar","activeColormapName","STATE_CHANGED","updateColorbarState","WindowLevel","presets","t","useTranslation","onSetWindowLevel","modalityPresets","modalityIndex","Object","entries","modality","presetsArray","preset","secondaryLabel","window","level","VolumeRenderingPresetsContent","filteredPresets","setFilteredPresets","searchValue","setSearchValue","selectedPreset","setSelectedPreset","handleSearchChange","filtered","filter","toLowerCase","handleApply","runCommand","InputFilterText","onDebounceChange","placeholder","Icon","maxChars","slice","formatLabel","Button","size","ButtonEnums","medium","type","secondary","VolumeRenderingPresets","volumeRenderingPresets","uiModalService","icon","rightIcon","onClickPresets","show","content","title","movable","contentProps","hide","containerDimensions","contentDimensions","VolumeRenderingQuality","volumeRenderingQualityRange","min","step","quality","setQuality","volumeQuality","actor","mapper","getMapper","spacing","getInputData","getSpacing","sampleDistance","getSampleDistance","averageSpacing","reduce","a","b","sqrt","htmlFor","e","parseInt","target","percentage","calculateBackground","VolumeShift","minShift","setMinShift","maxShift","setMaxShift","shift","setShift","shiftedBy","setStep","isBlocking","setIsBlocking","prevShiftRef","ofun","getProperty","getScalarOpacity","range","getRange","transferFunctionWidth","pow","floor","log10","onChangeRange","newShift","shiftDifference","shiftValue","onMouseDown","onMouseUp","VolumeLighting","ambient","setAmbient","diffuse","setDiffuse","specular","setSpecular","onAmbientChange","onDiffuseChange","onSpecularChange","getAmbient","getDiffuse","getSpecular","VolumeShade","shade","setShade","setKey","onShadeChange","getShade","VolumeRenderingOptions","nonWLModalities","WindowLevelActionMenu","verticalDirection","horizontalDirection","isLight","viewportGrid","useViewportGrid","activeViewportId","vpHeight","setVpHeight","clientHeight","menuKey","setMenuKey","is3DVolume","setIs3DVolume","newVpHeight","removeColorbar","iconClassName","menuStyle","maxHeight","onVisibilityChange","itemLabel","itemIcon","getWindowLevelActionMenu","displaySetPresets","segmentationService","activeSegmentations","setActiveSegmentations","availableSegmentations","setAvailableSegmentations","updateSegmentations","active","getSegmentationRepresentations","available","getSegmentations","seg","some","activeSeg","segmentationId","subscriptions","SEGMENTATION_MODIFIED","SEGMENTATION_REMOVED","SEGMENTATION_REPRESENTATION_MODIFIED","subscription","toggleSegmentationRepresentationVisibility","SegmentationRepresentations","Labelmap","segmentation","variant","removeSegmentationFromViewport","removeSegmentationRepresentations","Icons","Minus","visible","Hide","Show","Separator","addSegmentationRepresentation","addSegmentationToViewport","Plus","ViewportSegmentationMenuWrapper","location","viewportActionCornersService","segmentations","useSegmentations","isActiveViewport","getActiveViewportId","align","side","getAlignAndSide","Popover","PopoverTrigger","asChild","ViewportViews","PopoverContent","alignOffset","sideOffset","ViewportSegmentationMenu","ViewportActionCornersLocations","LOCATIONS","topLeft","topRight","bottomLeft","bottomRight","debug","getViewportDataOverlaySettingsMenu","MODALITIES_REQUIRING_CINE_AUTO_MOUNT","ActiveViewportBehavior","memo","setActiveViewportId","ACTIVE_VIEWPORT_ID_CHANGED","isViewportCineClosed","getDisplaySetsUIDsForViewport","uid","modalities","sourceModalities","getModeCustomization","arePropsEqual","prevProps","nextProps","displayName","cacheJumpToMeasurementEvent","OHIFCornerstoneViewport","dataSource","displaySetOptions","onElementEnabled","onElementDisabled","isJumpToMeasurementDisabled","initialImageIndex","isHangingProtocolLayout","Error","isReconstructable","setScrollbarHeight","setEnabledVPElement","elementRef","toolbarService","toolGroupService","syncGroupService","cornerstoneCacheService","viewportDialogState","useViewportDialog","setImageScrollBarHeight","onResize","resize","cleanUpServices","renderingEngineId","getRenderingEngineId","syncGroups","getSyncGroups","removeViewportFromToolGroup","removeViewportFromSyncGroup","clearSegmentationRepresentations","clear","elementEnabledHandler","setEnabledElement","toolGroupId","getToolGroupId","addViewportToToolGroup","addViewportToSyncGroup","synchronizersStore","useSynchronizersStore","synchronizers","synchronizerObj","sourceViewports","targetViewports","synchronizer","getSynchronizer","sourceViewportInfo","sourceViewport","targetViewportInfo","targetViewport","isSourceViewportInSynchronizer","getSourceViewports","isTargetViewportInSynchronizer","getTargetViewports","addSource","addTarget","_rehydrateSynchronizers","enableViewport","ELEMENT_ENABLED","storePresentation","disableElement","DISPLAY_SET_SERIES_METADATA_INVALIDATED","async","invalidatedDisplaySetInstanceUID","invalidateData","hasDisplaySet","getViewportData","newViewportData","invalidateViewportData","keepCamera","updateViewport","createViewportData","presentations","lutPresentationStore","useLutPresentationStore","positionPresentationStore","usePositionPresentationStore","segmentationPresentationStore","useSegmentationPresentationStore","presentationIds","positionPresentation","lutPresentation","segmentationPresentation","lutPresentationId","positionPresentationId","segmentationPresentationId","getViewportPresentations","measurement","needsRerendering","cs3DTools","loadViewportData","unsubscribeFromJumpToMeasurementEvents","measurementService","MeasurementService","JUMP_TO_MEASUREMENT_VIEWPORT","jumpId","isConsumed","cornerstoneViewport","getViewportIdToJump","metadata","referencedImageId","_jumpToMeasurement","_subscribeToJumpToMeasurementEvents","displaysUIDs","_checkForCachedJumpToMeasurementEvents","addWindowLevelActionMenu","addComponent","TopToBottom","RightToLeft","ref","resizeRef","useResizeDetector","onContextMenu","preventDefault","el","CornerstoneOverlays","toolBarService","Notification","message","actions","onSubmit","onOutsideClick","onKeyPress","OHIFViewportActionCorners","areEqual","targetElementRef","targetElement","enabledElement","isReferenceViewable","withNavigation","withOrientation","setViewReference","consume","orientation","prevDisplaySets","nextDisplaySets","i","prevDisplaySet","foundDisplaySet","nextDisplaySet","images","j"],"sourceRoot":""}